(function(o,h){typeof module=="object"&&module.exports?module.exports=h():o.game={config:h()}})(typeof self!="undefined"?self:this,function(){return{build_time:"09.02.2021 15:02:23",build_version:680,channel:"poki",game_title:"Bouncy Woods",game_title_short:"Bouncy Woods",game_slug:"bouncy-woods"}});var __extends=this&&this.__extends||function(){var o=function(h,r){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,e){n.__proto__=e}||function(n,e){for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(n[t]=e[t])},o(h,r)};return function(h,r){o(h,r);function n(){this.constructor=h}h.prototype=r===null?Object.create(r):(n.prototype=r.prototype,new n)}}(),__awaiter=this&&this.__awaiter||function(o,h,r,n){function e(t){return t instanceof r?t:new r(function(i){i(t)})}return new(r||(r=Promise))(function(t,i){function s(c){try{l(n.next(c))}catch(u){i(u)}}function a(c){try{l(n.throw(c))}catch(u){i(u)}}function l(c){c.done?t(c.value):e(c.value).then(s,a)}l((n=n.apply(o,h||[])).next())})},__generator=this&&this.__generator||function(o,h){var r={label:0,sent:function(){if(t[0]&1)throw t[1];return t[1]},trys:[],ops:[]},n,e,t,i;return i={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function s(l){return function(c){return a([l,c])}}function a(l){if(n)throw new TypeError("Generator is already executing.");for(;r;)try{if(n=1,e&&(t=l[0]&2?e.return:l[0]?e.throw||((t=e.return)&&t.call(e),0):e.next)&&!(t=t.call(e,l[1])).done)return t;(e=0,t)&&(l=[l[0]&2,t.value]);switch(l[0]){case 0:case 1:t=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,e=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(!(t=r.trys,t=t.length>0&&t[t.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!t||l[1]>t[0]&&l[1]<t[3])){r.label=l[1];break}if(l[0]===6&&r.label<t[1]){r.label=t[1],t=l;break}if(t&&r.label<t[2]){r.label=t[2],r.ops.push(l);break}t[2]&&r.ops.pop(),r.trys.pop();continue}l=h.call(o,r)}catch(c){l=[6,c],e=0}finally{n=t=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},__assign=this&&this.__assign||function(){return __assign=Object.assign||function(o){for(var h,r=1,n=arguments.length;r<n;r++){h=arguments[r];for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(o[e]=h[e])}return o},__assign.apply(this,arguments)},__spreadArrays=this&&this.__spreadArrays||function(){for(var o=0,h=0,r=arguments.length;h<r;h++)o+=arguments[h].length;for(var n=Array(o),e=0,h=0;h<r;h++)for(var t=arguments[h],i=0,s=t.length;i<s;i++,e++)n[e]=t[i];return n},game;(function(o){var h=function(){function r(){}return r.GAME_TITLE="Bouncy_Woods",r.SERVER_URL="https://robowhale.com/html5/bouncy-woods-levels/",r.SOURCE_GAME_WIDTH=750,r.SOURCE_GAME_HEIGHT=1334,r.IS_LANDSCAPE=r.SOURCE_GAME_WIDTH>r.SOURCE_GAME_HEIGHT,r.IS_PORTRAIT=r.SOURCE_GAME_HEIGHT>r.SOURCE_GAME_WIDTH,r.GAME_WIDTH=r.SOURCE_GAME_WIDTH,r.GAME_HEIGHT=r.SOURCE_GAME_HEIGHT,r.HALF_GAME_WIDTH=r.GAME_WIDTH*.5,r.HALF_GAME_HEIGHT=r.GAME_HEIGHT*.5,r.ASPECT_RATIO=r.SOURCE_GAME_WIDTH/r.SOURCE_GAME_HEIGHT,r.ZOOM=1,r.ASSETS_SCALE=1,r}();o.Config=h})(game||(game={}));var game;(function(o){var h=Phaser.Renderer.WebGL.WebGLRenderer,r=Phaser.Renderer.Canvas.CanvasRenderer,n=function(){function e(){}return e.create=function(){return{type:this.getRenderType(),scale:this.createScaleConfig(),audio:this.createAudioConfig(),parent:"canvas-container",input:{windowEvents:!0,smoothFactor:.5},render:{clearBeforeRender:!1,transparent:!1,failIfMajorPerformanceCaveat:!0,powerPreference:"high-performance",antialias:this.disableAntialias()===!1},banner:{background:["rgba(0,0,255,0.4)"]},plugins:{global:[{key:"gacha",plugin:rexgashaponplugin,start:!0},{key:"rexWebfontLoader",plugin:rexwebfontloaderplugin,start:!0},{key:"rexawaitloaderplugin",plugin:rexawaitloaderplugin,start:!0}]},callbacks:{preBoot:this.preBootCallback.bind(this),postBoot:this.postBootCallback.bind(this)}}},e.getRenderType=function(){var t=utils.NetUtil.getParam("forceCanvas");return t==="1"?Phaser.CANVAS:Phaser.AUTO},e.createScaleConfig=function(){return utils.DeviceUtil.isDesktop()?this.createDesktopScaleConfig():this.createMobileScaleConfig()},e.createDesktopScaleConfig=function(){o.Config.SOURCE_GAME_HEIGHT=960,o.Config.GAME_HEIGHT=o.Config.SOURCE_GAME_HEIGHT,o.Config.HALF_GAME_HEIGHT=o.Config.GAME_HEIGHT/2,o.Config.ASPECT_RATIO=o.Config.SOURCE_GAME_WIDTH/o.Config.SOURCE_GAME_HEIGHT;var t={width:o.Config.SOURCE_GAME_WIDTH,height:o.Config.SOURCE_GAME_HEIGHT,autoCenter:Phaser.Scale.CENTER_VERTICALLY,mode:Phaser.Scale.FIT},i=utils.NetUtil.getParamBool("originalSize");return i&&(t.max={width:o.Config.SOURCE_GAME_WIDTH,height:o.Config.SOURCE_GAME_HEIGHT}),t},e.createMobileScaleConfig=function(){return{width:o.Config.SOURCE_GAME_WIDTH,height:o.Config.SOURCE_GAME_HEIGHT,mode:Phaser.Scale.NONE}},e.createAudioConfig=function(){var t,i=(t=window.AudioContext)!==null&&t!==void 0?t:window.webkitAudioContext,s=typeof i!="undefined";if(s===!1)return{disableWebAudio:!0};var a=this.createAudioContext(i);if(typeof a.resume=="undefined"||typeof a.suspend=="undefined")return{disableWebAudio:!0};var l=utils.NetUtil.getParamBool("noWebAudio");return{disableWebAudio:l,context:a}},e.createAudioContext=function(t){var i={sampleRate:44100,latencyHint:"playback"},s;try{s=new t(i)}catch(a){s=new t}return s},e.disableAntialias=function(){return utils.NetUtil.getParamBool("noaa")},e.preBootCallback=function(t){},e.postBootCallback=function(t){t.audioType=o.GameAudio.getAudioType(t.sound),t.rendererType=this.getRendererType(t.renderer),t.raven=new o.RavenWrapper(t),t.raven.setContextsOnStart()},e.getRendererType=function(t){return t instanceof h?o.RendererType.WEBGL:t instanceof r?o.RendererType.CANVAS:o.RendererType.HEADLESS},e}();o.GameConfigCreator=n})(game||(game={}));var game;(function(o){var h=function(){function r(n){this._enabled=!1,this.game=n,this._enabled=typeof Raven!="undefined"&&Raven.isSetup()}return Object.defineProperty(r.prototype,"enabled",{get:function(){return this._enabled},enumerable:!1,configurable:!0}),r.prototype.captureBreadcrumb=function(n){if(this._enabled===!1)return;Raven.captureBreadcrumb(n)},r.prototype.addTagsContext=function(n){if(this._enabled===!1)return;Raven.setTagsContext(n)},r.prototype.addExtraContext=function(n){if(this._enabled===!1)return;Raven.setExtraContext(n)},r.prototype.setContextsOnStart=function(){var n;if(this._enabled===!1)return;Raven.setTagsContext({renderer:this.game.rendererType,audio:this.game.audioType,browserLanguage:navigator.language,audioSampleRate:(n=this.game.sound.context)===null||n===void 0?void 0:n.sampleRate});var e=this.game.device;Raven.setExtraContext({gameplayLoaded:!1,levelsMapLoaded:!1,device:{fullscreen:e.fullscreen.available,vibration:e.features.vibration,canvas:e.features.canvas,webgl:e.features.webGL,audio:{mp3:e.audio.mp3,m4a:e.audio.m4a,wav:e.audio.wav}}})},r.prototype.trackSceneChanges=function(n){if(this._enabled===!1)return;n.on(o.SceneTransitionEvent.COMPLETE,this.onSceneTransitionComplete,this)},r.prototype.onSceneTransitionComplete=function(n,e,t,i){Raven.setExtraContext({lastScene:e,currentScene:t,currentSceneData:i}),this.trackSceneInput(t)},r.prototype.trackSceneInput=function(n){var e;if(this._enabled===!1)return;var t=this.game.scene.getScene(n);t&&(t.events.once(Phaser.Scenes.Events.SHUTDOWN,this.removePointerDownListener.bind(this,t)),(e=t.input)===null||e===void 0||e.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this))},r.prototype.removePointerDownListener=function(n){var e;(e=n.input)===null||e===void 0||e.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this)},r.prototype.onPointerDown=function(n,e){var t=e.map(function(i){var s,a;return i.name||((s=i.frame)===null||s===void 0?void 0:s.name)||((a=i.texture)===null||a===void 0?void 0:a.key)});if(t.length===0)return;Raven.setExtraContext({lastClick:t.join()})},r.prototype.captureMessage=function(n,e){e===void 0&&(e="info"),this._enabled&&Raven.captureMessage(n,{level:e})},r.prototype.captureException=function(n,e){this._enabled&&Raven.captureException(n,e)},r}();o.RavenWrapper=h})(game||(game={}));var game;(function(o){var h;(function(i){i.BOLD="700",i.BLACK="900"})(h=o.FontWeight||(o.FontWeight={}));var r;(function(i){i.WEBFONT_ACTIVE="webfontactive",i.WEBFONT_INACTIVE="webfontinactive"})(r=o.GameFontsEvent||(o.GameFontsEvent={}));var n;(function(i){i.SOUSES="Souses",i.DEFAULT="Souses"})(n=o.GameFont||(o.GameFont={}));var e;(function(i){i.GAMEPLAY_BOOSTERS="GAMEPLAY_BOOSTERS",i.GAMEPLAY_GUI_BOOSTERS="GAMEPLAY_GUI_BOOSTERS",i.BLOCKS_LABEL_COMPLETE="BLOCKS_LABEL_COMPLETE",i.BLOCKS_LABEL="BLOCKS_LABEL",i.INGAME_GUI_DIGITS="ingame_gui_digits",i.EDITOR_BLOCK_LIVES="editor_block_lives",i.EDITOR_ROW_NUMBERS="editor_row_numbers",i.LEVELS_MAP_NUMBERS_COMPLETE="LEVELS_MAP_NUMBERS_COMPLETE",i.LEVELS_MAP_NUMBERS_UNLOCKED="LEVELS_MAP_NUMBERS_UNLOCKED",i.BLOCK_DAMAGE_FX="BLOCK_DAMAGE_FX",i.BLOCK_LIVES="BLOCK_LIVES"})(e=o.BitmapGameFont||(o.BitmapGameFont={}));var t=function(i){__extends(s,i);function s(a){var l=i.call(this)||this;return l.game=a,l}return s}(Phaser.Events.EventEmitter);o.GameFonts=t})(game||(game={}));var game;(function(o){var h=Phaser.Events.EventEmitter;o.LANGUAGES_MAP={ru:"\u0420\u0443\u0441\u0441\u043A\u0438\u0439",en:"English",fr:"Fran\xE7ais",it:"Italiano",de:"Deutsch",es:"Espa\xF1ol",nl:"Nederlands",no:"Norsk",fi:"Suomi",br:"Brasileiro",pt:"Portugu\xEAs"};function r(t){return o.LANGUAGES_MAP[t]}o.getLanguageTitle=r;var n;(function(t){t.LANGUAGE_CHANGE="GameTexts_LANGUAGE_CHANGE"})(n=o.GameTextsEvent||(o.GameTextsEvent={}));var e=function(t){__extends(i,t);function i(s){var a=t.call(this)||this;return a.game=s,a.allTexts=a.game.cache.json.get("texts"),a.allLanguages=Object.keys(a.allTexts),a._language=a.detectLanguage(),a.texts=a.allTexts[a._language],a.game.raven.addTagsContext({gameLanguage:a._language}),""+a._language,a}return Object.defineProperty(i.prototype,"language",{get:function(){return this._language},enumerable:!1,configurable:!0}),i.prototype.detectLanguage=function(){return this.getLanguageFromUrlParam()||this.getSavedLanguage()||this.getLanguageFromBrowser()||"en"},i.prototype.getLanguageFromUrlParam=function(){var s=utils.NetUtil.getParam("lang")||utils.NetUtil.getParam("language");return s&&typeof s=="string"&&this.isLanguageSupported(s)?s:null},i.prototype.getSavedLanguage=function(){return this.game.store.getValue(o.GameStoreKey.LANGUAGE)},i.prototype.getLanguageFromBrowser=function(){var s=navigator.language.split("-")[0].toLowerCase();return s&&this.isLanguageSupported(s)?s:void 0},i.prototype.isLanguageSupported=function(s){return this.allLanguages.includes(s)},i.prototype.injectTextsIntoScenes=function(){var s=this;this.game.scene.getScenes(!1).forEach(function(a){a.texts=s.texts})},i.prototype.setLanguage=function(s){return this.isLanguageSupported(s)?(this._language=s,this.texts=this.allTexts[s],this.game.raven.addTagsContext({gameLanguage:this._language}),this.injectTextsIntoScenes(),this.emit(n.LANGUAGE_CHANGE,s),!0):(""+s,!1)},i}(h);o.GameTexts=e})(game||(game={}));var game;(function(o){var h=function(){function r(){this.name="Runtime Storage",this.storage={}}return Object.defineProperty(r.prototype,"namespace",{get:function(){return this._namespace},enumerable:!1,configurable:!0}),r.prototype.init=function(){},r.prototype.setNamespace=function(n){this._namespace=n},r.prototype.saveValue=function(n,e){this.storage[this.getSaveKey(n)]=e},r.prototype.getValue=function(n){return this.storage[this.getSaveKey(n)]},r.prototype.getNumber=function(n){return this.getValue(n)||0},r.prototype.getBoolean=function(n){return this.getValue(n)||!1},r.prototype.getString=function(n){return this.getValue(n)||""},r.prototype.getObject=function(n){return this.getValue(n)||{}},r.prototype.getContent=function(n){var e=this;if(n===void 0&&(n=!1),n)return this.storage;var t=Object.keys(this.storage).filter(function(s){return s.indexOf(e._namespace)>-1}),i={};return t.forEach(function(s){i[s]=e.storage[s]}),i},r.prototype.clear=function(n){var e=this;if(n===void 0&&(n=!1),n)this.storage={};else{var t=Object.keys(this.storage).filter(function(i){return i.indexOf(e._namespace)>-1});t.forEach(function(i){delete e.storage[i]})}},r.prototype.getSaveKey=function(n){return this._namespace+"__"+n},r}();o.RuntimeStorage=h})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.type="Local Forage",this.storeName=n}return r.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var n,e,t;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),this.instance=localforage.createInstance({driver:[localforage.LOCALSTORAGE,localforage.INDEXEDDB],storeName:this.storeName,name:"robowhale"}),n="testKey",[4,Promise.all([this.instance.setItem(n,n),this.instance.getItem(n),this.instance.removeItem(n)])];case 1:return e=i.sent(),[2,Promise.resolve()];case 2:return t=i.sent(),this.instance=null,[2,Promise.reject(t)];case 3:return[2]}})})},r.prototype.saveValue=function(n,e){var t,i=typeof e=="string"?e:JSON.stringify(e);return(t=this.instance)===null||t===void 0?void 0:t.setItem(this.getStorageKey(n),i)},r.prototype.getStorageKey=function(n){return"__"+n},r.prototype.getValue=function(n){var e;return Promise.resolve((e=this.instance)===null||e===void 0?void 0:e.getItem(this.getStorageKey(n)))},r.prototype.getNumber=function(n){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getValue(n)];case 1:if(e=i.sent(),e===null)return[2,Promise.resolve(0)];return t=parseFloat(e)||0,[2,Promise.resolve(t)];return[2]}})})},r.prototype.getBoolean=function(n){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getValue(n)];case 1:if(e=i.sent(),e===null)return[2,Promise.resolve(!1)];return t=e==="true",[2,Promise.resolve(t)];return[2]}})})},r.prototype.getString=function(n){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return[4,this.getValue(n)];case 1:if(e=t.sent(),e===null)return[2,Promise.resolve("")];return[2,Promise.resolve(e)];return[2]}})})},r.prototype.getObject=function(n){return __awaiter(this,void 0,void 0,function(){var e,t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getValue(n)];case 1:e=i.sent(),t=null;try{t=JSON.parse(e)}catch(s){}return[2,Promise.resolve(t)]}})})},r.prototype.remove=function(n){var e;(e=this.instance)===null||e===void 0||e.removeItem(this.getStorageKey(n))},r.prototype.clear=function(){var n=this;return Object.keys(this.instance).filter(function(e){return e.includes(n.storeName)}).forEach(function(e){var t;(t=n.instance)===null||t===void 0||t.removeItem(e)}),Promise.resolve()},r.prototype.getDriverType=function(){if(!this.instance)return"none";switch(this.instance._driver){case localforage.LOCALSTORAGE:return"localStorage";case localforage.INDEXEDDB:return"indexed db";case localforage.WEBSQL:return"websql";default:return"none"}},r}();o.LocalForageWrapper=h})(game||(game={}));var game;(function(o){var h=Phaser.Events.EventEmitter,r;(function(t){t.LEVEL_GIFTS="level_gifts",t.INGAME_BOOSTERS="ingame_boosters",t.LEVELS="levels",t.LANGUAGE="language",t.SOUND_MUTED="sound_muted",t.EDITOR_ZOOM="editor_zoom",t.FAST_FORWARD_WAS_USED="fast_forward_was_used",t.LOSE_TUTORIAL_COMPLETE="lose_tutorial_complete"})(r=o.GameStoreKey||(o.GameStoreKey={}));var n;(function(t){t.CLEAR="GameStore_CLEAR"})(n=o.GameStoreEvent||(o.GameStoreEvent={}));var e=function(t){__extends(i,t);function i(s,a){var l=t.call(this)||this;return l.game=s,l.storeName=a,l.initRuntimeStorage(),l}return i.prototype.initRuntimeStorage=function(){this._runtimeStorage=new o.RuntimeStorage,this._runtimeStorage.setNamespace(game.Config.GAME_TITLE)},i.prototype.initActualStorage=function(){return this.useLocalForage()},i.prototype.useLocalForage=function(){var s=this,a=new o.LocalForageWrapper(this.storeName);return new Promise(function(l,c){a.init().then(function(){s.setStorage(a),l()}).catch(function(u){c(u)}).finally(function(){var u,d,p=a.getDriverType();(u=s.game.raven)===null||u===void 0||u.addTagsContext({storage:p}),(d=s.game.analytics)===null||d===void 0||d.sendDesignEvent("Storage:"+p)})})},i.prototype.setStorage=function(s){this._storage=s},i.prototype.getValue=function(s){return this._runtimeStorage.getValue(s)},i.prototype.getBoolean=function(s){return this._runtimeStorage.getBoolean(s)},i.prototype.getNumber=function(s){return this._runtimeStorage.getNumber(s)},i.prototype.getObject=function(s){return this._runtimeStorage.getObject(s)},i.prototype.saveValue=function(s,a){var l;(l=this._storage)===null||l===void 0||l.saveValue(s,a),this._runtimeStorage.saveValue(s,a)},i.prototype.changeNumber=function(s,a,l,c){l===void 0&&(l=Number.MIN_SAFE_INTEGER),c===void 0&&(c=Number.MAX_SAFE_INTEGER);var u=this.getNumber(s),d=u+a;return d=Phaser.Math.Clamp(d,l,c),this.saveValue(s,d),d},i.prototype.getLevelResult=function(s){var a=this.getObject(r.LEVELS);return a[s]},i.prototype.saveLevelResult=function(s,a){var l,c=this.getObject(r.LEVELS),u=__assign(__assign({},c),(l={},l[s]=a,l));this.saveValue(r.LEVELS,u)},i.prototype.loadInitialValues=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(s){switch(s.label){case 0:return[4,Promise.all([this.loadValue(r.LANGUAGE,""),this.loadValue(r.SOUND_MUTED,!1),this.loadValue(r.LEVELS,{}),this.loadValue(r.LEVEL_GIFTS,{}),this.loadValue(r.INGAME_BOOSTERS,{}),this.loadValue(r.EDITOR_ZOOM,1),this.loadValue(r.FAST_FORWARD_WAS_USED,!1),this.loadValue(r.LOSE_TUTORIAL_COMPLETE,!1)])];case 1:return s.sent(),[2]}})})},i.prototype.loadValue=function(s,a,l,c){return __awaiter(this,void 0,void 0,function(){var u,d,p;return __generator(this,function(f){switch(f.label){case 0:return this._storage?(u=l||this.getLoadCallbackByValueType(a),d=c||this._storage,[4,u.call(d,s)]):(this._runtimeStorage.saveValue(s,a),[2]);case 1:return p=f.sent()||a,this._runtimeStorage.saveValue(s,p),[2]}})})},i.prototype.getLoadCallbackByValueType=function(s){var a=typeof s;switch(a){case"number":return this._storage.getNumber;case"string":return this._storage.getValue;case"boolean":return this._storage.getBoolean;case"object":return this._storage.getObject;default:return this._storage.getValue}},i.prototype.checkLoadedValues=function(){var s=Object.keys(r).map(function(c){return r[c]}),a=Object.keys(this._runtimeStorage.getContent()).map(function(c){return c.split("__")[1]}),l=_.xor(s,a);l.length>0},i.prototype.clear=function(){this.saveValue(r.LEVELS,{}),this.saveValue(r.LEVEL_GIFTS,{}),this.saveValue(r.INGAME_BOOSTERS,{}),this.saveValue(r.EDITOR_ZOOM,1),this.saveValue(r.FAST_FORWARD_WAS_USED,!1),this.saveValue(r.LOSE_TUTORIAL_COMPLETE,!1),this.emit(n.CLEAR,this)},i.prototype.migrateSaveData=function(){var s,a=this;try{var l=(s={},s[r.INGAME_BOOSTERS]=function(c){return JSON.parse(c)},s[r.LEVEL_GIFTS]=function(c){return JSON.parse(c)},s[r.LEVELS]=function(c){return JSON.parse(c)},s[r.LANGUAGE]=function(c){return c},s[r.EDITOR_ZOOM]=function(c){return parseFloat(c)},s[r.SOUND_MUTED]=function(c){return c==="true"},s[r.FAST_FORWARD_WAS_USED]=function(c){return c==="true"},s[r.LOSE_TUTORIAL_COMPLETE]=function(c){return c==="true"},s);Object.keys(localStorage).filter(function(c){return c.includes("Bouncy_Woods")}).forEach(function(c){var u=c.split("__")[1],d=l[u];if(d){var p=localStorage.getItem(c),f=d(p);a.saveValue(u,f),localStorage.removeItem(c)}})}catch(c){}},i}(h);o.GameStore=e})(game||(game={}));var game;(function(o){var h;(function(r){r.MENU_LOOP="menu_loop",r.GAMEPLAY_LOOP="forest_sounds",r.TAP="tap",r.FANCY_TAP="fancy_tap",r.GIFT_REVEAL="gift_reveal",r.GIFT_CHARGE="gift_charge_1",r.GIFT_EXPLODE="gift_explode",r.CATCH_YOU_SHOUT="catch_you_shout",r.STOP_SHOUT="stop_shout",r.BOOSTER_STOP_ACTIVE="booster_stop_active",r.BOOSTER_BOMB_IGNITE="booster_bomb_ignite",r.BOOSTER_CRACKER="booster_cracker",r.BOOSTER_CRACKER_PUNCH="booster_cracker_punch",r.AIM_1="aim_1_1",r.AIM_2="aim_1_2",r.AIM_3="aim_1_8",r.BALL_THROW="ball_throw_2",r.BALL_HIT_1="ball_hit_1",r.BALL_HIT_2="ball_hit_2",r.BALL_HIT_3="ball_hit_3",r.BLOCK_HIT="block_hit",r.BLOCK_ZAPPED="block_zapped_1",r.BLOCK_COLLECTED_WHOOSH="block_collected_whoosh",r.BLOCK_COLLECTED="block_collected",r.PINATA="block_pinata",r.EXPLOSION="explosion1",r.SPINNER="spinner",r.LIGHTNING="lightning_1",r.NEW_BALL_HIT="new_ball_hit_2",r.NEW_BALL_LANDED="new_ball_landed_3",r.MOVE_ITEMS_UP="move_items_up",r.MOVE_ITEMS_DOWN="move_items_down",r.CLEAR_FIELD_MOVE_COMPLETE="clear_field_move_complete",r.CLEAR_FIELD="clear_field",r.TURN_COMPLETE_TEXT="turn_complete_text",r.WINNING_BALL_WHOOSH="winning_ball_whoosh",r.POP_1="pop_1",r.LEVEL_COMPLETE_TEXT="level_complete_text",r.LEVEL_COMPLETE="level_complete",r.LEVEL_COMPLETE_STAR_SHOW_1="level_complete_star_show1",r.LEVEL_COMPLETE_STAR_SHOW_2="level_complete_star_show2",r.LEVEL_COMPLETE_STAR_SHOW_3="level_complete_star_show3",r.FOX_OOH="fox_ooh",r.FOX_UH_OH_1="fox_uh_oh_1",r.FOX_UH_OH_2="fox_uh_oh_2",r.BLOCK_STOMP_WHOOSH="block_stomp_whoosh",r.BLOCK_STOMP_HIT="block_stomp_hit_1",r.DUCK_SCREAM="duck_scream_2",r.LEVEL_FAILED="level_failed_2",r.FAST_FORWARD="fast_forward",r.DROP_BALLS_DOWN="drop_balls_down_3",r.STAR_TWINKLE_1="star_twinkle_2",r.STAR_TWINKLE_2="star_twinkle_3"})(h=o.GameSoundKey||(o.GameSoundKey={}))})(game||(game={}));var game;(function(o){var h=Phaser.Sound.WebAudioSoundManager,r=Phaser.Sound.HTML5AudioSoundManager,n;(function(t){t.NO_AUDIO="no_audio",t.HTML5_AUDIO="html5_audio",t.WEB_AUDIO="web_audio"})(n=o.SoundManagerType||(o.SoundManagerType={}));var e=function(){function t(i){this.scene=i,this.sound=this.scene.sound,this.wasMuted=this.sound.mute,this.sound.pauseOnBlur=!1,this.iOS=this.scene.game.device.os.iOS,this.onFocusThrottled=_.throttle(this.onFocus.bind(this),100),this.startTrackingVisibility()}return t.getAudioType=function(i){return i instanceof h?n.WEB_AUDIO:i instanceof r?n.HTML5_AUDIO:n.NO_AUDIO},t.prototype.startTrackingVisibility=function(){this.scene.game.events.on(Phaser.Core.Events.BLUR,this.onBlur,this),this.scene.game.events.on(Phaser.Core.Events.FOCUS,this.onFocusThrottled)},t.prototype.stopTrackingVisibility=function(){this.scene.game.events.off(Phaser.Core.Events.BLUR,this.onBlur,this),this.scene.game.events.off(Phaser.Core.Events.FOCUS,this.onFocusThrottled)},t.prototype.onBlur=function(){this.wasMuted=this.sound.mute,this.sound.mute=!0},t.prototype.onFocus=function(){this.sound.mute=this.wasMuted},t.prototype.suspendAudioContext=function(){var i;return((i=this.sound.context)===null||i===void 0?void 0:i.state)==="running"?this.sound.context.suspend():Promise.resolve()},t.prototype.resumeAudioContext=function(){var i;return((i=this.sound.context)===null||i===void 0?void 0:i.state)==="suspended"?this.sound.context.resume():Promise.resolve()},t.prototype.listenToScenesChange=function(i){i.on(o.SceneTransitionEvent.START,this.onSceneChangeStart,this)},t.prototype.onSceneChangeStart=function(i,s,a){if(a===o.SceneKey.LEVELS_MAP){this.switchToMainLoop();return}if(a===o.SceneKey.GAMEPLAY_ROOT){this.switchToGameplayLoop();return}},t.prototype.switchToMainLoop=function(){this.stopLoop(this.gameplayLoop),this.playLoop(this.menuLoop,.5)},t.prototype.switchToGameplayLoop=function(){this.stopLoop(this.menuLoop),this.playLoop(this.gameplayLoop,1)},t.prototype.loadMute=function(){this.sound.mute=this.scene.game.store.getBoolean(o.GameStoreKey.SOUND_MUTED)},t.prototype.addMenuLoop=function(){this.menuLoop=this.addLoop(o.GameSoundKey.MENU_LOOP)},t.prototype.addGameplayLoop=function(){this.gameplayLoop=this.addLoop(o.GameSoundKey.GAMEPLAY_LOOP)},t.prototype.onGameplayLoopLoaded=function(){this.addGameplayLoop(),this.isGameplayActive()&&this.playLoop(this.gameplayLoop,1)},t.prototype.isGameplayActive=function(){return this.scene.game.scene.getScenes(!0).some(function(i){return i.scene.key===o.SceneKey.GAMEPLAY_ROOT})},t.prototype.addLoop=function(i){var s=this.scene.cache.audio.has(i);return s===!1?null:this.sound.add(i,{loop:!0})},t.prototype.playLoop=function(i,s){if(!i||i.isPlaying)return;i.volume=0,i.play(),this.scene.tweens.killTweensOf(i),this.scene.tweens.add({targets:i,duration:1300,ease:Phaser.Math.Easing.Cubic.In,volume:s})},t.prototype.stopLoop=function(i){if(!i)return;this.scene.tweens.killTweensOf(i),this.scene.tweens.add({targets:i,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,volume:0,onComplete:function(){i.stop()}})},t.prototype.playClickSound=function(i){i===void 0&&(i=1),this.scene.cache.audio.has(o.GameSoundKey.TAP)&&this.sound.play(o.GameSoundKey.TAP,{volume:i})},t}();o.GameAudio=e})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.name="toast",i.options=t,i.addBack(),i.addText(t.message),i.setInteractive(new Phaser.Geom.Rectangle(-i.back.width/2,-i.back.height/2,i.back.width,i.back.height),Phaser.Geom.Rectangle.Contains),i.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,i.dismiss,i),i.input.cursor="pointer",i}return n.prototype.addBack=function(){this.back=this.scene.add.graphics({fillStyle:{color:14935011,alpha:1},lineStyle:{width:0}});var e=o.Config.SOURCE_GAME_WIDTH*.7,t=100;this.back.fillRoundedRect(-e/2,-t/2,e,t,{tl:20,bl:0,br:0,tr:20}),this.back.width=e,this.back.height=t,this.add(this.back)},n.prototype.addText=function(e){var t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"30px",color:"#205466",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setLineSpacing(-4),this.text.setWordWrapWidth(this.back.width*.9),this.add(this.text),this.adjustTextSize()},n.prototype.adjustTextSize=function(){var e=this.back.height*.8;this.text.scale=Math.min(1,e/this.text.height)},n.prototype.show=function(e){var t=20;this.alpha=0,this.y+=t,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:this.y-t,onComplete:this.onShowCompelete.bind(this,e)})},n.prototype.onShowCompelete=function(e){var t=this;this.dismissTimerEvent=this.scene.time.delayedCall(e,function(){t.dismiss()})},n.prototype.dismiss=function(){this.dismissTimerEvent&&this.dismissTimerEvent.remove(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,y:"+=15",onComplete:this.destroy.bind(this)})},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.height},n.prototype.preDestroy=function(){this.dismissTimerEvent&&this.dismissTimerEvent.remove(),this.scene.tweens.killTweensOf(this)},n}(Phaser.GameObjects.Container);o.Toast=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="toasts_container",t.toasts=[],t.setSize(o.Config.SOURCE_GAME_WIDTH,o.Config.SOURCE_GAME_HEIGHT),t}return n.prototype.onToastDestroy=function(e){var t=this.toasts.indexOf(e);t>-1&&this.toasts.splice(t,1)},n.prototype.dismissAll=function(){this.toasts.forEach(function(e){return e.dismiss()})},n.prototype.getGameHeight=function(){return o.Config.GAME_HEIGHT/this.scale},n.prototype.resize=function(){},n.prototype.show=function(e){this.dismissAll();var t=0,i=new o.Toast(this.scene,e);i.y=this.getGameHeight()/2-i.getHeight()/2-t,i.once(Phaser.GameObjects.Events.DESTROY,this.onToastDestroy,this),i.show(e.lifespan),this.toasts.push(i),this.add(i)},n.prototype.showNoRewardedAdsWarning=function(){this.show({message:this.scene.texts.ads.adblock_video_ads,lifespan:2500})},n.prototype.showRewardedAdsDontSkipWarning=function(){this.show({message:this.scene.texts.ads.dont_skip,lifespan:2500})},n}(Phaser.GameObjects.Container);o.ToastsManager=h})(game||(game={}));var Phaser;(function(o){var h;(function(r){var n=function(e){__extends(t,e);function t(i,s){var a=e.call(this,i)||this;return a.name="screen",a.options=__assign({backgroundAlpha:.8},s),a.addBackground(),a}return t.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,this.options.backgroundKey,this.options.backgroundFrame),this.background.alpha=this.options.backgroundAlpha,this.background.displayWidth=game.Config.SOURCE_GAME_WIDTH,this.background.displayHeight=game.Config.SOURCE_GAME_HEIGHT,this.add(this.background)},t.prototype.resize=function(i){},t}(o.GameObjects.Container);r.Screen=n})(h=o.GameObjects||(o.GameObjects={}))})(Phaser||(Phaser={}));var Phaser;(function(o){var h;(function(r){var n;(function(t){t.PRESS="button_press",t.RELEASE="button_release"})(n=r.ButtonEvent||(r.ButtonEvent={}));var e=function(t){__extends(i,t);function i(s,a,l,c){var u=t.call(this,s,0,0,a,l)||this;return u._enabled=!0,u.originalScale=1,u.areTweensEnabled=!0,u.checkIfOver=!0,u.soundKey="tap",u.soundVolume=1,c?c.add(u):u.scene.add.existing(u),u.setInteractive(),u.on(o.Input.Events.GAMEOBJECT_POINTER_DOWN,u.onPointerDown,u),u.scene.input.on(o.Input.Events.POINTER_UP,u.onScenePointerUp,u),u.input.cursor="pointer",u}return Object.defineProperty(i.prototype,"enabled",{get:function(){return this._enabled},set:function(s){this._enabled=s,this._enabled?this.setInteractive():this.disableInteractive()},enumerable:!1,configurable:!0}),i.prototype.onPointerDown=function(s){this.scene.cache.audio.has(this.soundKey)&&this.scene.sound.play(this.soundKey),this.playPressedTween(),this.playSound(),this.emit(n.PRESS,this,s),this.currentPointer=s},i.prototype.playPressedTween=function(){if(!this.areTweensEnabled)return;this.originalScale=this.scale,this.scene.tweens.add({targets:this,scale:this.scale*.9,ease:o.Math.Easing.Cubic.Out,duration:50})},i.prototype.playSound=function(){this.scene.cache.audio.has(this.soundKey)&&this.scene.sound.play(this.soundKey,{volume:this.soundVolume})},i.prototype.onScenePointerUp=function(s,a){if(this.currentPointer&&this.currentPointer===s){this.currentPointer=null;var l=a.includes(this);(this.checkIfOver===!1||l)&&(this.onPointerUp(),this.emit(n.RELEASE,this,s)),this.playReleasedTween()}},i.prototype.playReleasedTween=function(){if(!this.scene)return;if(!this.areTweensEnabled)return;this.scene.tweens.add({targets:this,scale:this.originalScale,ease:o.Math.Easing.Back.Out,duration:300})},i.prototype.onPointerUp=function(){},i.prototype.destroy=function(s){this.scene&&this.scene.input.off(o.Input.Events.POINTER_UP,this.onScenePointerUp,this),t.prototype.destroy.call(this,s)},i}(o.GameObjects.Image);r.Button=e})(h=o.GameObjects||(o.GameObjects={}))})(Phaser||(Phaser={}));var Phaser;(function(o){var h;(function(r){var n;(function(t){t[t.STATE_1=0]="STATE_1",t[t.STATE_2=1]="STATE_2"})(n=r.ToggleButtonState||(r.ToggleButtonState={}));var e=function(t){__extends(i,t);function i(s,a,l,c,u){var d=t.call(this,s,a,l,u)||this;return d.frame_1=l,d.frame_2=c,d._buttonState=n.STATE_1,d}return i.prototype.onPointerUp=function(){t.prototype.onPointerUp.call(this),this.switchTextures()},i.prototype.switchTextures=function(){this.buttonState=this._buttonState===n.STATE_1?n.STATE_2:n.STATE_1},Object.defineProperty(i.prototype,"buttonState",{get:function(){return this._buttonState},set:function(s){this._buttonState=s,this._buttonState===n.STATE_1?this.setFrame(this.frame_1):this.setFrame(this.frame_2)},enumerable:!1,configurable:!0}),i}(o.GameObjects.Button);r.ToggleButton=e})(h=o.GameObjects||(o.GameObjects={}))})(Phaser||(Phaser={}));var Phaser;(function(o){var h;(function(r){var n=game.GameStoreKey,e=function(t){__extends(i,t);function i(s,a,l,c,u){var d=t.call(this,s,a,l,u)||this;return d.frame_1=l,d.frame_2=c,d.store=d.scene.game.store,d.soundManager=d.scene.sound,d.soundManager.on(o.Sound.Events.GLOBAL_MUTE,d.onMuteChange,d),d.updateFrame(d.soundManager.mute),d}return i.prototype.onMuteChange=function(s,a){this.updateFrame(a)},i.prototype.updateFrame=function(s){this.setFrame(s?this.frame_2:this.frame_1)},i.prototype.onPointerUp=function(){t.prototype.onPointerUp.call(this),this.soundManager.mute=!this.soundManager.mute,this.store.saveValue(n.SOUND_MUTED,!this.soundManager.mute)},i.prototype.destroy=function(s){this.soundManager.off(o.Sound.Events.GLOBAL_MUTE,this.onMuteChange,this),t.prototype.destroy.call(this,s)},i}(o.GameObjects.Button);r.SoundButton=e})(h=o.GameObjects||(o.GameObjects={}))})(Phaser||(Phaser={}));var Phaser;(function(o){var h;(function(r){var n=function(e){__extends(t,e);function t(i,s,a){var l=e.call(this,i)||this;return l.soundKey="tap",l.tweensEnabled=!0,l.checkIfOver=!0,l.name="button",l.addBack(s,a),l}return t.prototype.enableInput=function(){this.back.setInteractive()},t.prototype.disableInput=function(){this.back.disableInteractive()},t.prototype.addBack=function(i,s){this.back=this.scene.add.image(0,0,i,s),this.back.setInteractive(),this.back.input.cursor="pointer",this.back.on(o.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onPointerDown,this),this.scene.input.on(o.Input.Events.POINTER_UP,this.onScenePointerUp,this),this.add(this.back)},t.prototype.onPointerDown=function(i){this.scene.cache.audio.has(this.soundKey)&&this.scene.sound.play(this.soundKey),this.tweensEnabled&&this.scene.tweens.add({targets:this,scale:.9,ease:o.Math.Easing.Cubic.Out,duration:50}),this.emit(r.ButtonEvent.PRESS,this,i),this.currentPointer=i},t.prototype.onScenePointerUp=function(i,s){if(this.currentPointer&&this.currentPointer===i){this.currentPointer=null;var a=s.includes(this.back);(this.checkIfOver===!1||a)&&(this.onPointerUp(),this.emit(o.GameObjects.ButtonEvent.RELEASE,this,i)),this.tweensEnabled&&this.scene&&this.scene.tweens.add({targets:this,scale:1,ease:o.Math.Easing.Back.Out,duration:300})}},t.prototype.onPointerUp=function(){},t.prototype.addBitmapText=function(i,s,a,l,c){return l===void 0&&(l=0),c===void 0&&(c=0),this.bitmapText=this.scene.add.bitmapText(0,0,s,i,a),this.bitmapText.align=o.Display.Align.CENTER,this.bitmapText.setOrigin(.5,.5),this.bitmapText.x=this.back.x+l,this.bitmapText.y=this.back.y+c,this.add(this.bitmapText),this.bitmapText},t.prototype.addText=function(i,s,a,l){return a===void 0&&(a=0),l===void 0&&(l=0),this.text=this.scene.make.text({text:i,style:s}),this.text.setOrigin(.5,.5),this.text.x=this.back.x+a,this.text.y=this.back.y+l,this.add(this.text),this.text},t}(o.GameObjects.Container);r.ComplexButton=n})(h=o.GameObjects||(o.GameObjects={}))})(Phaser||(Phaser={}));var game;(function(o){var h=function(){function r(n,e){this.thresholdOfTapTime=100,this.thresholdOfTapDistance=10,this.moveTimestamp=0,this.scene=n;var t={camera:this.scene.cameras.main,kineticMovement:!0,timeConstantScroll:325,horizontalScroll:!0,verticalScroll:!0,horizontalWheel:!1,verticalWheel:!1,wheelDeceleration:.95,onUpdate:null,scrollMultiplier:1};this.settings=__assign(__assign({},t),e),this.tempCameraBounds=new Phaser.Geom.Rectangle}return r.prototype.addPointerListeners=function(){this.scene.input.on("pointerdown",this.beginMove,this),this.scene.input.on("pointerup",this.endMove,this),this.scene.input.on("pointermove",this.move,this)},r.prototype.removePointerListeners=function(){this.scene.input.off("pointerdown",this.beginMove,this),this.scene.input.off("pointerup",this.endMove,this),this.scene.input.off("pointermove",this.move,this)},r.prototype.beginMove=function(n){this.pointerId=n.id,this.startX=this.scene.input.x,this.startY=this.scene.input.y,this.screenX=n.screenX,this.screenY=n.screenY,this.pressedDown=!0,this.timestamp=this.getNow(),this.beginTime=this.timestamp,this.velocityY=this.amplitudeY=this.velocityX=this.amplitudeX=0},r.prototype.canCameraMoveY=function(){var n=this.settings.camera;return n.getBounds(this.tempCameraBounds),n.scrollY>0&&n.scrollY+n.height<this.tempCameraBounds.height},r.prototype.canCameraMoveX=function(){var n=this.settings.camera;return n.getBounds(this.tempCameraBounds),n.scrollX>0&&n.scrollX+n.width<this.tempCameraBounds.right},r.prototype.move=function(n){var e=n.x,t=n.y;if(!this.pressedDown)return;if(this.pointerId!==n.id)return;this.now=this.getNow();var i=this.now-this.timestamp;this.timestamp=this.now;var s=0,a=0;if(this.isTap(n))return;var l=this.settings.camera;this.settings.horizontalScroll&&(s=e-this.startX,s!==0&&(this.dragging=!0),this.startX=e,this.velocityX=.8*(1e3*s/(1+i))+.2*this.velocityX,l.setScroll(l.scrollX-s,l.scrollY)),this.settings.verticalScroll&&(a=(t-this.startY)*this.settings.scrollMultiplier,a!==0&&(this.dragging=!0),this.startY=t,this.velocityY=.8*(1e3*a/(1+i))+.2*this.velocityY,l.setScroll(l.scrollX,l.scrollY-a)),this.callCustomUpdate(s,a),this.moveTimestamp=this.getNow()},r.prototype.callCustomUpdate=function(n,e){if(typeof this.settings.onUpdate!="function")return;var t=this.canCameraMoveX()?n:0,i=this.canCameraMoveY()?e:0;this.settings.onUpdate(t,i)},r.prototype.isTap=function(n){return this.now-this.beginTime<this.thresholdOfTapTime&&Math.abs(n.screenY-this.screenY)<this.thresholdOfTapDistance&&Math.abs(n.screenX-this.screenX)<this.thresholdOfTapDistance},r.prototype.endMove=function(){if(this.pointerId=null,this.pressedDown=!1,this.autoScrollX=!1,this.autoScrollY=!1,!this.settings.kineticMovement)return;this.now=this.getNow();var n=this.settings.camera;this.withinGame()&&((this.velocityX>10||this.velocityX<-10)&&(this.amplitudeX=.8*this.velocityX,this.targetX=Math.round(n.scrollX-this.amplitudeX),this.autoScrollX=!0),(this.velocityY>10||this.velocityY<-10)&&(this.amplitudeY=.8*this.velocityY,this.targetY=Math.round(n.scrollY-this.amplitudeY),this.autoScrollY=!0)),this.withinGame()||(this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY),this.settings.horizontalScroll&&(this.velocityWheelXAbs<.1||!this.withinGame())&&(this.autoScrollX=!0),this.settings.verticalScroll&&(this.velocityWheelYAbs<.1||!this.withinGame())&&(this.autoScrollY=!0))},r.prototype.update=function(){var n=this.getNow()-this.moveTimestamp;n>20&&(this.velocityX=0,this.velocityY=0),this.elapsed=this.getNow()-this.timestamp,this.velocityWheelXAbs=Math.abs(this.velocityWheelX),this.velocityWheelYAbs=Math.abs(this.velocityWheelY);var e=0,t=this.settings.camera;this.autoScrollX&&this.amplitudeX!==0&&(e=-this.amplitudeX*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveX()&&(e>.5||e<-.5)?t.setScroll(this.targetX-e,t.scrollY):(this.autoScrollX=!1,t.setScroll(this.targetX,t.scrollY))),this.autoScrollY&&this.amplitudeY!==0&&(e=-this.amplitudeY*Math.exp(-this.elapsed/this.settings.timeConstantScroll),this.canCameraMoveY()&&(e>.5||e<-.5)?t.setScroll(t.scrollX,this.targetY-e):(this.autoScrollY=!1,t.setScroll(t.scrollX,this.targetY))),!this.autoScrollX&&!this.autoScrollY&&(this.dragging=!1),this.settings.horizontalWheel&&this.velocityWheelXAbs>.1&&(this.dragging=!0,this.amplitudeX=0,this.autoScrollX=!1,t.setScroll(t.scrollX-this.velocityWheelX,t.scrollY),this.velocityWheelX*=this.settings.wheelDeceleration),this.settings.verticalWheel&&this.velocityWheelYAbs>.1&&(this.dragging=!0,this.autoScrollY=!1,t.setScroll(t.scrollX,t.scrollY-this.velocityWheelY),this.velocityWheelY*=this.settings.wheelDeceleration)},r.prototype.getNow=function(){return performance&&performance.now?performance.now():Date.now()},r.prototype.withinGame=function(){return!0},r.prototype.resetScroll=function(){this.autoScrollX=!1,this.autoScrollY=!1,this.velocityWheelX=0,this.velocityWheelY=0},r}();o.KineticScroll=h})(game||(game={}));var utils;(function(o){var h=function(){function r(){}return r.getTextureEmitZone=function(n,e){var t=e.getTopLeft(),i=function(s){do var a=Phaser.Math.Between(0,e.width),l=Phaser.Math.Between(0,e.height),c=n.textures.getPixel(a,l,e.texture.key);while(c.alpha<255);return s.setTo(a+t.x,l+t.y)};return{getRandomPoint:i}},r.getCircleEdgeEmitZone=function(n,e,t){e===void 0&&(e=360),t===void 0&&(t=!0);var i=new Phaser.Geom.Circle(0,0,n),s={source:i,type:"edge",quantity:e},a=function(c){var u=c.emitter,d=u.follow?u.follow.x:u.x.propertyValue,p=u.follow?u.follow.y:u.y.propertyValue;return Math.atan2(c.y-p,c.x-d)},l=t?{emitCallback:function(c,u){var d=u.emitZone;d.counter=Phaser.Math.RND.between(0,d.points.length)}}:{};return __assign(__assign({},l),{emitZone:s,angle:{onEmit:function(c){return a(c)*Phaser.Math.RAD_TO_DEG}},rotate:{onEmit:function(c){return(a(c)+Math.PI/2)*Phaser.Math.RAD_TO_DEG}}})},r}();o.ParticleUtil=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(n,e){this.counter=0,this.scene=n,this.options=e,this.pool=this.createAnimations(this.options.initialNum)}return r.prototype.createAnimations=function(n){var e=this,t=function(i){return typeof i!="boolean"};return Array(n).fill(0).map(function(){return e.createAnimation()}).filter(t).map(function(i){return i.active=!1,i})},r.prototype.createAnimation=function(){return this.counter++,this.scene.anims.create(__assign(__assign({},this.options.animationConfig),{key:this.options.prefix+"_"+this.counter.toString(),frames:this.scene.anims.getFrameNames(this.options.atlas,this.options.prefix)}))},r.prototype.getInactive=function(){var n=this.pool.find(function(e){return e.active===!1});return n||(n=this.createAnimation(),this.pool.push(n),""+this.options.name+this.pool.length),n.active=!0,n},r.prototype.recycleActive=function(n){n.active=!1},r.prototype.recycleAll=function(){this.pool.forEach(function(n){return n.active=!1})},r.prototype.getState=function(){var n=this.pool.filter(function(i){return i.active}).length,e=this.pool.length-n,t=this.pool.map(function(i){return i.key+": "+i.active.toString()}).join("\n");return"\n			Active: "+n+"\n			Inactive: "+e+"\n			Total: "+this.pool.length+"\n			=============================\n			"+t+"\n			"},r.prototype.destroy=function(){this.pool.forEach(function(n){return n.destroy()}),this.pool=null},r}();o.AnimationsPool=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(){}return r.getCurrentHost=function(){return location&&location.hostname?location.hostname:null},r.isLocalhost=function(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return r.isHostAllowed(__spreadArrays(n,["localhost"]))},r.isHostAllowed=function(n){var e=r.getCurrentHost();return e?n.some(function(t){return e.includes(t)}):!1},r.inIFrame=function(){try{return window.self!==window.top}catch(n){return!0}},r.getParam=function(n){var e=n.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),t=new RegExp("[\\?&]"+e+"=([^&#]*)"),i=t.exec(location.search);return i===null?null:decodeURIComponent(i[1].replace(/\+/g," "))},r.getParamInt=function(n,e){e===void 0&&(e=0);var t=this.getParam(n);if(t){var i=parseInt(t);return isNaN(i)?e:i}return e},r.getParamFloat=function(n,e){e===void 0&&(e=0);var t=this.getParam(n);if(t){var i=parseFloat(t);return isNaN(i)?e:i}return e},r.getParamBool=function(n,e){e===void 0&&(e="1");var t=r.getParam(n);return!!(t&&t===e)},r}();o.NetUtil=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(){}return r.polyfill=function(){var n=Object.keys(r);n.forEach(function(e){if(e==="polyfill")return;if(e.startsWith("_"))return;r[e]()})},r.nodeRemove=function(){var n=[Element,CharacterData,DocumentType],e=[];n.forEach(function(t){t&&e.push(t.prototype)}),function(t){t.forEach(function(i){if(i.hasOwnProperty("remove"))return;Object.defineProperty(i,"remove",{configurable:!0,enumerable:!0,writable:!0,value:function(){this.parentNode.removeChild(this)}})})}(e)},r}();o.Polyfills=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(){}return r.extend=function(){var n=Object.keys(r);n.forEach(function(e){e!=="extend"&&r[e]()})},r.addGetGlobalPosition=function(){var n=function(t){var i=this.getWorldTransformMatrix();return t=t!=null?t:{x:0,y:0},t.x=i.tx,t.y=i.ty,t},e=[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape].forEach(function(t){t.prototype.getWorldPosition=n})},r.addKillRevive=function(){var n=function(){this.visible=!1,this.active=!1},e=function(){this.visible=!0,this.active=!0},t=[Phaser.GameObjects.Container,Phaser.GameObjects.Image,Phaser.GameObjects.Sprite,Phaser.GameObjects.Graphics,Phaser.GameObjects.Shape,Phaser.GameObjects.Text,Phaser.GameObjects.BitmapText,Phaser.GameObjects.TileSprite].forEach(function(i){i.prototype.kill=n,i.prototype.revive=e})},r.extendContainer=function(){Phaser.GameObjects.Container.prototype.gridAlign=function(n,e,t){typeof e=="undefined"&&(e=0),typeof t=="undefined"&&(t=this.length);var i=this.list.slice(e,t);return Phaser.Actions.GridAlign(i,n),this}},r.extendAnimationManager=function(){var n=function(t,i){var s=e(t),a=e(i);return s-a},e=function(t,i){return i===void 0&&(i=4),parseInt(t.slice(-i))};Phaser.Animations.AnimationManager.prototype.getFrameNames=function(t,i){var s=this.game.textures.get(t).getFrameNames(),a=s.filter(function(l){return l.includes(i)}).sort(n);return a.map(function(l){return{key:t,frame:l}})}},r.extendMath=function(){Phaser.Math.Sign=function(n){return n>=0?1:-1},Phaser.Math.MapLinear=function(n,e,t,i,s){return i+(n-e)*(s-i)/(t-e)}},r.extendRandomDataGenerator=function(){Phaser.Math.RandomDataGenerator.prototype.bool=function(){return this.frac()>.5},Phaser.Math.RandomDataGenerator.prototype.pickExcept=function(n,e,t){t===void 0&&(t=100);var i;do i=this.pick(n);while(e===i&&--t>0);return i},Phaser.Math.RandomDataGenerator.prototype.pickExceptMultiple=function(n,e,t){t===void 0&&(t=100);var i;do i=this.pick(n);while(e.includes(i)&&--t>0);return i}},r.extendFactory=function(){var n=Phaser.GameObjects.GameObjectFactory.prototype;n.existingMultiple=function(e){var t=this;return e.map(function(i){return t.existing(i)})},n.button=function(e,t,i){return new Phaser.GameObjects.Button(this.scene,e,t,i)},n.toggleButton=function(e,t,i,s){return new Phaser.GameObjects.ToggleButton(this.scene,e,t,i,s)},n.soundButton=function(e,t,i,s){return new Phaser.GameObjects.SoundButton(this.scene,e,t,i,s)}},r.addScaleMethods=function(){var n=function(e){return typeof e.setScale!="undefined"};Phaser.GameObjects.GameObject.prototype.fitWidth=function(e){if(n(this)===!1)return;this.setScale(1),this.setScale(e/this.width)},Phaser.GameObjects.GameObject.prototype.fitHeight=function(e){if(n(this)===!1)return;this.setScale(Math.min(1,e/this.height))},Phaser.GameObjects.GameObject.prototype.fitIn=function(e,t){if(n(this)===!1)return;var i=e/this.width,s=t/this.height;this.scale=Math.min(1,i,s)},Phaser.GameObjects.GameObject.prototype.fillWidth=function(e){if(n(this)===!1)return;this.setScale(Math.max(1,e/this.width))},Phaser.GameObjects.GameObject.prototype.fillHeight=function(e){if(n(this)===!1)return;this.setScale(Math.max(1,e/this.height))},Phaser.GameObjects.GameObject.prototype.envelop=function(e,t){if(n(this)===!1)return;var i=e/this.width,s=t/this.height;this.scale=Math.max(i,s)}},r.addAlighMethods=function(){Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"top",{get:function(){return Phaser.Display.Bounds.GetTop(this)},set:function(n){return Phaser.Display.Bounds.SetTop(this,n)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"right",{get:function(){return Phaser.Display.Bounds.GetRight(this)},set:function(n){return Phaser.Display.Bounds.SetRight(this,n)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"bottom",{get:function(){return Phaser.Display.Bounds.GetBottom(this)},set:function(n){return Phaser.Display.Bounds.SetBottom(this,n)}}),Object.defineProperty(Phaser.GameObjects.GameObject.prototype,"left",{get:function(){return Phaser.Display.Bounds.GetLeft(this)},set:function(n){return Phaser.Display.Bounds.SetLeft(this,n)}})},r.extendLoader=function(){Phaser.Loader.LoaderPlugin.prototype.bitmapFontFromAtlas=function(n,e,t,i,s,a){var l=this,c=n+"_data";return this.xml(c,i),this.once(Phaser.Loader.Events.COMPLETE,function(){var u=Phaser.GameObjects.BitmapText.ParseFromAtlas(l.scene,n,e,t,c,s,a);u===!1&&""+n}),this}},r}();o.Phaser3Extensions=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(){}return r.extend=function(){var n=Object.keys(r);n.forEach(function(e){e!=="extend"&&r[e]()})},r.addIgnoreCollisionCategory=function(){var n=function(e){return this.body.collisionFilter.mask&=~e,this};Phaser.Physics.Matter.Image.prototype.ignoreCollisionCategory=n,Phaser.Physics.Matter.Sprite.prototype.ignoreCollisionCategory=n},r.addGetContactPoint=function(){Phaser.Physics.Matter.World.prototype.getContactPoint=function(n,e){var t=n.activeContacts[0],i=t.vertex.x-n.collision.penetration.x,s=t.vertex.y-n.collision.penetration.y;return e=e!=null?e:e||{x:i,y:s},e}},r}();o.MatterExtensions=h})(utils||(utils={}));var utils;(function(o){var h=function(){function r(){}return r.webP=function(){var n=navigator.userAgent.match(/(Edge|Firefox)\/(\d+)\./);if(n)return n[1]==="Firefox"&&+n[2]>=65||n[1]==="Edge"&&+n[2]>=18;var e=document.createElement("canvas");return e.toDataURL?e.toDataURL("image/webp").indexOf("data:image/webp")==0:!1},r.getDeviceInfo=function(){var n=navigator.userAgent,e={android:!1,chromeOS:!1,cordova:!1,crosswalk:!1,desktop:!1,ejecta:!1,electron:!1,iOS:!1,iOSVersion:0,iPad:!1,iPhone:!1,kindle:!1,linux:!1,macOS:!1,node:!1,nodeWebkit:!1,pixelRatio:1,webApp:!1,windows:!1,windowsPhone:!1};/Windows/.test(n)?e.windows=!0:/Mac OS/.test(n)&&!/like Mac OS/.test(n)?e.macOS=!0:/Android/.test(n)?e.android=!0:/Linux/.test(n)?e.linux=!0:/iP[ao]d|iPhone/i.test(n)?(e.iOS=!0,navigator.appVersion.match(/OS (\d+)/),e.iOSVersion=parseInt(RegExp.$1,10),e.iPhone=n.toLowerCase().indexOf("iphone")!==-1,e.iPad=n.toLowerCase().indexOf("ipad")!==-1):/Kindle/.test(n)||/\bKF[A-Z][A-Z]+/.test(n)||/Silk.*Mobile Safari/.test(n)?e.kindle=!0:/CrOS/.test(n)&&(e.chromeOS=!0),(/Windows Phone/i.test(n)||/IEMobile/i.test(n))&&(e.android=!1,e.iOS=!1,e.macOS=!1,e.windows=!0,e.windowsPhone=!0);var t=/Silk/.test(n);return(e.windows||e.macOS||e.linux&&!t||e.chromeOS)&&(e.desktop=!0),(e.windowsPhone||/Windows NT/i.test(n)&&/Touch/i.test(n))&&(e.desktop=!1),e},r.isIpad=function(n){return n=n!=null?n:this.getDeviceInfo(),n.macOS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2},r.isDesktop=function(){return this.getDeviceInfo().desktop},r}();o.DeviceUtil=h})(utils||(utils={}));var Phaser;(function(o){var h;(function(r){var n;(function(e){e.Power0="Linear",e.Power1="Quadratic.Out",e.Power2="Cubic.Out",e.Power3="Quartic.Out",e.Power4="Quintic.Out",e.Linear="Linear",e.Quad="Quadratic.Out",e.Cubic="Cubic.Out",e.Quart="Quartic.Out",e.Quint="Quintic.Out",e.Sine="Sine.Out",e.Expo="Expo.Out",e.Circ="Circular.Out",e.Elastic="Elastic.Out",e.Back="Back.Out",e.Bounce="Bounce.Out",e.Stepped="Stepped",e.QuadEaseIn="Quadratic.In",e.CubicEaseIn="Cubic.In",e.QuartEaseIn="Quartic.In",e.QuintEaseIn="Quintic.In",e.SineEaseIn="Sine.In",e.ExpoEaseIn="Expo.In",e.CircEaseIn="Circular.In",e.ElasticEaseIn="Elastic.In",e.BackEaseIn="Back.In",e.BounceEaseIn="Bounce.In",e.QuadEaseOut="Quadratic.Out",e.CubicEaseOut="Cubic.Out",e.QuartEaseOut="Quartic.Out",e.QuintEaseOut="Quintic.Out",e.SineEaseOut="Sine.Out",e.ExpoEaseOut="Expo.Out",e.CircEaseOut="Circular.Out",e.ElasticEaseOut="Elastic.Out",e.BackEaseOut="Back.Out",e.BounceEaseOut="Bounce.Out",e.QuadEaseInOut="Quadratic.InOut",e.CubicEaseInOut="Cubic.InOut",e.QuartEaseInOut="Quartic.InOut",e.QuintEaseInOut="Quintic.InOut",e.SineEaseInOut="Sine.InOut",e.ExpoEaseInOut="Expo.InOut",e.CircEaseInOut="Circular.InOut",e.ElasticEaseInOut="Elastic.InOut",e.BackEaseInOut="Back.InOut",e.BounceEaseInOut="Bounce.InOut"})(n=r.EasingString||(r.EasingString={}))})(h=o.Math||(o.Math={}))})(Phaser||(Phaser={}));var game;(function(o){var h=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return Object.defineProperty(n.prototype,"keyboard",{get:function(){return this.input.keyboard},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"activePointer",{get:function(){return this.input.activePointer},enumerable:!1,configurable:!0}),n.prototype.init=function(e){this.events.once("shutdown",this.shutdown,this)},n.prototype.create=function(){},n.prototype.resize=function(){},n.prototype.restart=function(e){this.game.restartScene(this.scene.key,e)},n.prototype.onKeyDown=function(e,t,i){this.keyboard.on("keydown-"+e,t,i)},n.prototype.onceKeyDown=function(e,t,i){this.keyboard.once("keydown-"+e,t,i)},n.prototype.shutdown=function(){},n}(Phaser.Scene);o.BaseScene=h})(game||(game={}));var game;(function(o){var h;(function(r){r.TEST_EMITTERS="TEST_EMITTERS",r.TEST_TRAIL="TEST_TRAIL",r.TEST_LINE="TEST_LINE",r.TEST_LIGHTNING="TEST_LIGHTNING",r.TEST_ANIMATIONS="TEST_ANIMATIONS",r.GLOBAL="GLOBAL",r.BOOT="BOOT",r.PRELOADER="PRELOADER",r.LEVELS_MAP="LEVELS_MAP",r.LEVELS_MAP_DEV="LEVELS_MAP_DEV",r.GAMEPLAY_ROOT="GAMEPLAY_ROOT",r.GAMEPLAY="GAMEPLAY",r.GAMEPLAY_COPY="GAMEPLAY_COPY",r.GAMEPLAY_GUI="GAMEPLAY_GUI",r.TUTORIAL_EDITOR="TUTORIAL_EDITOR",r.LEVELS_MAP_EDITOR="LEVELS_MAP_EDITOR",r.LEVEL_EDITOR_ROOT="LEVEL_EDITOR_ROOT",r.LEVEL_EDITOR="LEVEL_EDITOR",r.LEVEL_EDITOR_GUI="LEVEL_EDITOR_GUI"})(h=o.SceneKey||(o.SceneKey={}))})(game||(game={}));var utils;(function(o){var h=function(){function r(n){this.timer=0,this.updateInterval=100,this.drawCallsNum=0,this.scene=n,this.gameLoop=this.scene.game.loop,this.span=document.createElement("span"),this.span.id="stats",this.span.addEventListener("click",this.toggleVisibility.bind(this)),document.body.appendChild(this.span),this.scene.scale.on(Phaser.Scale.Events.RESIZE,this.onResize,this),this.onResize(),this.hookToWebGL()}return r.prototype.toggleVisibility=function(){this.span.style.opacity==="0"?this.span.style.opacity="1":this.span.style.opacity="0"},r.prototype.onResize=function(){this.span.style.left=this.scene.scale.canvasBounds.left+"px"},r.prototype.hookToWebGL=function(){var n=this,e=this.scene.sys.renderer;if(e instanceof Phaser.Renderer.WebGL.WebGLRenderer){this.scene.game.events.on(Phaser.Core.Events.POST_STEP,function(){n.drawCallsNum=0});var t=WebGLRenderingContext.prototype;t.incrementDrawCalls=function(){n.drawCallsNum++},t.realDrawArrays=WebGLRenderingContext.prototype.drawArrays,t.drawArrays=function(i,s,a){this.incrementDrawCalls(),this.realDrawArrays(i,s,a)}}},r.prototype.update=function(n){this.timer+=n,this.timer>=this.updateInterval&&(this.timer-=this.updateInterval,this.updateStats())},r.prototype.updateStats=function(){var n="FPS: "+Math.round(this.gameLoop.actualFps),e="DC: "+this.drawCallsNum,t=n+" | "+e;this.span.innerText=t},r}();o.RenderStatsDOM=h})(utils||(utils={}));var game;(function(o){var h;(function(r){r.START="start",r.COMPLETE="complete"})(h=o.SceneTransitionEvent||(o.SceneTransitionEvent={}))})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.instantChange=!1,i.name="scene_transition",i.sceneManager=i.scene.game.scene,i.addMask(t),i.addBackground(t),i.resize(),i}return n.prototype.changeScene=function(e,t,i){if(this.instantChange){this.emit(o.SceneTransitionEvent.START,this,e,t,i),this.emit(o.SceneTransitionEvent.COMPLETE,this,e,t,i);var s=this.sceneManager.getScene(e);s.scene.start(t,i);return}this.revive(),this.emit(o.SceneTransitionEvent.START,this,e,t,i),this.resize(),this.reApplyMask(),this.fadeIn(),this.hideScreen(e,t,i)},n.prototype.resize=function(){this.background.displayWidth=o.Config.GAME_WIDTH+4,this.background.displayHeight=o.Config.GAME_HEIGHT+4,this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT,this.maskImage.x=o.Config.HALF_GAME_WIDTH,this.maskImage.y=o.Config.HALF_GAME_HEIGHT},n.prototype.addMask=function(e){this.maskImage=this.scene.make.image({add:!1,key:e.textureKey,frame:e.maskFrameName})},n.prototype.addBackground=function(e){this.background=this.scene.add.image(0,0,e.textureKey,e.backgroundFrameName),this.background.setTint(e.fillColor),this.add(this.background)},n.prototype.reApplyMask=function(){this.background.mask&&this.background.mask.destroy(),this.background.mask=this.maskImage.createBitmapMask(),this.background.mask.invertAlpha=!0},n.prototype.fadeIn=function(){this.alpha=0,this.scene.tweens.add({targets:this,alpha:1,duration:270,ease:Phaser.Math.Easing.Cubic.Out})},n.prototype.hideScreen=function(e,t,i){var s=this;this.maskImage.scale=this.getMaskScale(this.maskImage),this.scene.tweens.add({targets:this.maskImage,scale:0,duration:270,ease:Phaser.Math.Easing.Cubic.Out,onComplete:function(){s.doChangeScenes(e,t,i)}})},n.prototype.doChangeScenes=function(e,t,i){var s=this.sceneManager.getScene(e);s.events.once(Phaser.Scenes.Events.SHUTDOWN,this.revealScreen.bind(this,e,t,i)),s.scene.start(t,i)},n.prototype.revealScreen=function(e,t){var i=this;this.scene.tweens.add({targets:this,alpha:0,duration:400,ease:Phaser.Math.Easing.Linear.Linear,onComplete:function(){i.kill(),i.emit(o.SceneTransitionEvent.COMPLETE,i,e,t)}})},n.prototype.getMaskScale=function(e){var t=o.Config.GAME_WIDTH/e.width,i=o.Config.GAME_HEIGHT/e.height,s=Math.max(t,i);return s},n}(Phaser.GameObjects.Container);o.SceneTransition=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i){var s=r.call(this,e,0,0,t,i)||this;return s.sceneManager=s.scene.game.scene,s}return n.prototype.changeScene=function(e,t,i){if(this.instantChange){this.emit(o.SceneTransitionEvent.START,this,e,t),this.emit(o.SceneTransitionEvent.COMPLETE,this,e,t);var s=this.sceneManager.getScene(e);s.scene.start(t,i);return}this.emit(o.SceneTransitionEvent.START,this,e,t),this.resize(),this.fadeIn(e,t,i)},n.prototype.fadeIn=function(e,t,i){var s=this;this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Quadratic.In,alpha:1,onComplete:function(){s.doChangeScenes(e,t,i)}})},n.prototype.doChangeScenes=function(e,t,i){var s=this.sceneManager.getScene(e);s.events.once(Phaser.Scenes.Events.SHUTDOWN,this.fadeOut.bind(this,e,t)),s.scene.start(t,i)},n.prototype.fadeOut=function(){var e=this;this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Quadratic.In,alpha:0,onComplete:function(){e.kill()}})},n.prototype.resize=function(){this.setDisplaySize(o.Config.GAME_WIDTH+4,o.Config.GAME_HEIGHT+4),this.x=o.Config.HALF_GAME_WIDTH,this.y=o.Config.HALF_GAME_HEIGHT},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.CanvasSceneTransition=h})(game||(game={}));var game;(function(o){var h;(function(n){n.GAMEPLAY_ASSETS_READY="__GAMEPLAY_ASSETS_READY"})(h=o.DelayedLoaderEvent||(o.DelayedLoaderEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.areGameplayAssetsLoaded=!1,i}return e.prototype.startLoading=function(){this.json("physics","assets/configs/physics_shapes.json"),this.loadGameplayGraphics(),this.loadGameplayFonts(),this.loadGameplayAudio(),this.once(Phaser.Loader.Events.COMPLETE,this.onGameplayAssetsLoadComplete,this),this.start()},e.prototype.loadGameplayGraphics=function(){this.atlas("backgrounds","assets/graphics/backgrounds.png","assets/graphics/backgrounds.json"),this.atlas("gameplay","assets/graphics/gameplay.png","assets/graphics/gameplay.json"),this.atlas("gameplay_gui","assets/graphics/gameplay_gui.png","assets/graphics/gameplay_gui.json")},e.prototype.loadGameplayFonts=function(){this.bitmapFontFromAtlas(o.BitmapGameFont.GAMEPLAY_GUI_BOOSTERS,"gameplay_gui","boosters_label","assets/fonts/bitmap/boosters_label.fnt",-1),this.bitmapFontFromAtlas(o.BitmapGameFont.GAMEPLAY_BOOSTERS,"gameplay","boosters_label","assets/fonts/bitmap/boosters_label.fnt",-1),this.bitmapFontFromAtlas(o.BitmapGameFont.BLOCK_LIVES,"gameplay","block_lives","assets/fonts/bitmap/block_lives.fnt",-1),this.bitmapFontFromAtlas(o.BitmapGameFont.BLOCK_DAMAGE_FX,"gameplay","block_lives_fx","assets/fonts/bitmap/block_lives_fx.fnt",-1),this.bitmapFontFromAtlas(o.BitmapGameFont.INGAME_GUI_DIGITS,"gameplay_gui","ingame_gui_digits","assets/fonts/bitmap/ingame_gui_digits.fnt"),this.bitmapFontFromAtlas(o.BitmapGameFont.BLOCKS_LABEL,"gameplay_gui","blocks_label","assets/fonts/bitmap/blocks_label.fnt",1),this.bitmapFontFromAtlas(o.BitmapGameFont.BLOCKS_LABEL_COMPLETE,"gameplay_gui","blocks_label_complete","assets/fonts/bitmap/blocks_label_complete.fnt")},e.prototype.loadGameplayAudio=function(){this.loadSound(o.GameSoundKey.BALL_HIT_1),this.loadSound(o.GameSoundKey.BALL_HIT_2),this.loadSound(o.GameSoundKey.BALL_HIT_3),this.loadSound(o.GameSoundKey.AIM_1),this.loadSound(o.GameSoundKey.AIM_2),this.loadSound(o.GameSoundKey.AIM_3)},e.prototype.loadSound=function(t,i){i===void 0&&(i="mp3"),this.audio(t,"assets/audio/"+t+"."+i)},e.prototype.onGameplayAssetsLoadComplete=function(){this.areGameplayAssetsLoaded=!0,this.emit(h.GAMEPLAY_ASSETS_READY,this),this.loadRemainingAudio(),this.on(Phaser.Loader.Events.FILE_COMPLETE,this.onSoundLoadComplete,this),this.start()},e.prototype.loadRemainingAudio=function(){if(this.scene.game.audioType===o.SoundManagerType.HTML5_AUDIO){this.loadGameplayLoop();return}this.loadGameplayLoop(),this.loadSound(o.GameSoundKey.FANCY_TAP),this.loadSound(o.GameSoundKey.GIFT_EXPLODE),this.loadSound(o.GameSoundKey.GIFT_CHARGE),this.loadSound(o.GameSoundKey.GIFT_REVEAL),this.loadSound(o.GameSoundKey.STOP_SHOUT),this.loadSound(o.GameSoundKey.CATCH_YOU_SHOUT),this.loadSound(o.GameSoundKey.BOOSTER_BOMB_IGNITE),this.loadSound(o.GameSoundKey.BOOSTER_STOP_ACTIVE),this.loadSound(o.GameSoundKey.BOOSTER_CRACKER),this.loadSound(o.GameSoundKey.BOOSTER_CRACKER_PUNCH),this.loadSound(o.GameSoundKey.POP_1,"wav"),this.loadSound(o.GameSoundKey.BALL_THROW,"wav"),this.loadSound(o.GameSoundKey.BLOCK_HIT),this.loadSound(o.GameSoundKey.BLOCK_ZAPPED),this.loadSound(o.GameSoundKey.BLOCK_COLLECTED),this.loadSound(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH),this.loadSound(o.GameSoundKey.PINATA),this.loadSound(o.GameSoundKey.EXPLOSION),this.loadSound(o.GameSoundKey.NEW_BALL_HIT),this.loadSound(o.GameSoundKey.NEW_BALL_LANDED),this.loadSound(o.GameSoundKey.SPINNER),this.loadSound(o.GameSoundKey.LIGHTNING),this.loadSound(o.GameSoundKey.MOVE_ITEMS_UP),this.loadSound(o.GameSoundKey.MOVE_ITEMS_DOWN),this.loadSound(o.GameSoundKey.TURN_COMPLETE_TEXT),this.loadSound(o.GameSoundKey.CLEAR_FIELD),this.loadSound(o.GameSoundKey.CLEAR_FIELD_MOVE_COMPLETE,"wav"),this.loadSound(o.GameSoundKey.WINNING_BALL_WHOOSH),this.loadSound(o.GameSoundKey.LEVEL_COMPLETE_TEXT),this.loadSound(o.GameSoundKey.FOX_OOH),this.loadSound(o.GameSoundKey.FOX_UH_OH_1),this.loadSound(o.GameSoundKey.FOX_UH_OH_2),this.loadSound(o.GameSoundKey.BLOCK_STOMP_HIT),this.loadSound(o.GameSoundKey.BLOCK_STOMP_WHOOSH),this.loadSound(o.GameSoundKey.DUCK_SCREAM),this.loadSound(o.GameSoundKey.LEVEL_FAILED),this.loadSound(o.GameSoundKey.LEVEL_COMPLETE),this.loadSound(o.GameSoundKey.LEVEL_COMPLETE_STAR_SHOW_1),this.loadSound(o.GameSoundKey.LEVEL_COMPLETE_STAR_SHOW_2),this.loadSound(o.GameSoundKey.LEVEL_COMPLETE_STAR_SHOW_3),this.loadSound(o.GameSoundKey.DROP_BALLS_DOWN),this.loadSound(o.GameSoundKey.FAST_FORWARD),this.loadSound(o.GameSoundKey.STAR_TWINKLE_1),this.loadSound(o.GameSoundKey.STAR_TWINKLE_2)},e.prototype.loadGameplayLoop=function(){this.audio(o.GameSoundKey.GAMEPLAY_LOOP,"assets/audio/forest_sounds.mp3")},e.prototype.onSoundLoadComplete=function(t){t===o.GameSoundKey.GAMEPLAY_LOOP&&this.scene.game.audio.onGameplayLoopLoaded()},e}(Phaser.Loader.LoaderPlugin);o.DelayedLoader=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.init=function(){},n.prototype.create=function(){var e=utils.NetUtil.getParamBool("stats");e&&this.addRenderStats()},n.prototype.addRenderStats=function(){this.renderStats=new utils.RenderStatsDOM(this)},n.prototype.addIngamePreloader=function(){this.preloader=new o.IngamePreloader(this),this.preloader.kill(),this.add.existing(this.preloader)},n.prototype.addSceneTranstion=function(e){this.sceneTransition=e,this.sceneTransition.visible=!1,this.sceneTransition.active=!1,this.add.existing(this.sceneTransition)},n.prototype.addToasts=function(){return this.toasts=new o.ToastsManager(this),this.add.existing(this.toasts),this.resize(),this.toasts},n.prototype.addDelayedLoader=function(){this.delayedLoader=new o.DelayedLoader(this)},n.prototype.update=function(e,t){this.renderStats&&this.renderStats.update(t)},n.prototype.resize=function(){this.toasts&&(this.toasts.scale=o.Config.GAME_WIDTH/o.Config.SOURCE_GAME_WIDTH,this.toasts.x=o.Config.HALF_GAME_WIDTH,this.toasts.y=o.Config.HALF_GAME_HEIGHT,this.toasts.resize())},n}(Phaser.Scene);o.GlobalScene=h})(game||(game={}));var game;(function(o){function h(){try{var n="__storage_test__";return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(e){return!1}}o.isLocalStorageAvailable=h;var r=function(){function n(e){this.type="Local Storage",this.prefix=e}return n.prototype.init=function(){return Promise.resolve()},n.prototype.saveValue=function(e,t){if(typeof t=="string")localStorage.setItem(this.getStorageKey(e),t);else{var i=JSON.stringify(t);localStorage.setItem(this.getStorageKey(e),i)}return Promise.resolve()},n.prototype.getStorageKey=function(e){return this.prefix+"__"+e},n.prototype.getValue=function(e){return Promise.resolve(localStorage.getItem(this.getStorageKey(e)))},n.prototype.getNumber=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(s){switch(s.label){case 0:return[4,this.getValue(e)];case 1:if(t=s.sent(),t===null)return[2,Promise.resolve(0)];return i=parseFloat(t)||0,[2,Promise.resolve(i)];return[2]}})})},n.prototype.getBoolean=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(s){switch(s.label){case 0:return[4,this.getValue(e)];case 1:if(t=s.sent(),t===null)return[2,Promise.resolve(!1)];return i=t==="true",[2,Promise.resolve(i)];return[2]}})})},n.prototype.getString=function(e){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(i){switch(i.label){case 0:return[4,this.getValue(e)];case 1:if(t=i.sent(),t===null)return[2,Promise.resolve("")];return[2,Promise.resolve(t)];return[2]}})})},n.prototype.getObject=function(e){return __awaiter(this,void 0,void 0,function(){var t,i;return __generator(this,function(s){switch(s.label){case 0:return[4,this.getValue(e)];case 1:t=s.sent(),i=null;try{i=JSON.parse(t)}catch(a){}return[2,Promise.resolve(i)]}})})},n.prototype.remove=function(e){localStorage.removeItem(this.getStorageKey(e))},n.prototype.clear=function(){var e=this;return Object.keys(localStorage).filter(function(t){return t.includes(e.prefix)}).forEach(function(t){localStorage.removeItem(t)}),Promise.resolve()},n}();o.LocalStorageWrapper=r})(game||(game={}));var game;(function(o){var h=Phaser.Loader.FileTypes.ImageFile,r=Phaser.Loader.FileTypes.AudioFile,n=function(e){__extends(t,e);function t(){var i=e!==null&&e.apply(this,arguments)||this;return i.wasPaused=!1,i.wasIncorrectOrientation=!1,i}return t.prototype.init=function(){return __awaiter(this,void 0,void 0,function(){var i,s;return __generator(this,function(a){switch(a.label){case 0:return i=o.isLocalStorageAvailable()?window.localStorage:null,s=this.game,[4,this.checkAvifSupport(i)];case 1:return s.avif=a.sent(),this.game.webp=this.checkWebpSupport(i),(this.game.avif||this.game.webp)&&this.patchImageLoader(),this.setPageBackground(),this.patchAudioFileLoading(),[2]}})})},t.prototype.checkAvifSupport=function(i){var s=utils.NetUtil.getParamBool("noAvif");if(s)return Promise.resolve(!1);var a=window.environment===GameEnvironment.DEVELOP;if(a)return Promise.resolve(!1);var l="robowhale__avif";return(i==null?void 0:i.getItem(l))==="true"?Promise.resolve(!0):new Promise(function(c){var u=function(){d.height===2?(i==null||i.setItem(l,"true"),c(!0)):c(!1)},d=new Image;d.onload=u,d.onerror=u,d.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A="})},t.prototype.checkWebpSupport=function(i){var s=utils.NetUtil.getParamBool("noWebp");if(s)return!1;var a=window.environment===GameEnvironment.DEVELOP;if(a)return!1;var l="robowhale__webp";if((i==null?void 0:i.getItem(l))==="true")return!0;var c=this.doCheckWebP();return c&&(i==null||i.setItem(l,"true")),c},t.prototype.doCheckWebP=function(){var i=navigator.userAgent.match(/(Edge|Firefox)\/(\d+)\.(\d*)/);if(i&&i[1]==="Firefox"&&+i[2]>=65)return!0;if(i&&i[1]==="Edge"&&+i[2]===18&&+i[3]===17763)return!1;var s=Phaser.Display.Canvas.CanvasPool.create(document),a=s.toDataURL?s.toDataURL("image/webp").indexOf("data:image/webp")==0:!1;return Phaser.Display.Canvas.CanvasPool.remove(s),a},t.prototype.patchImageLoader=function(){var i=this.getDefaultImageFormat(".png"),s=[".png",".jpg"],a=function(l){if(l instanceof h){var c=l.url,u=s.find(function(d){return c.includes(d)});u&&(l.url=l.url.replace(u,i))}};Phaser.Loader.LoaderPlugin.prototype.addFileOld=Phaser.Loader.LoaderPlugin.prototype.addFile,Phaser.Loader.LoaderPlugin.prototype.addFile=function(l){return Array.isArray(l)?l.forEach(function(c){return a(c)}):a(l),this.addFileOld(l)}},t.prototype.getDefaultImageFormat=function(i){return this.game.avif?".avif":this.game.webp?".webp":i},t.prototype.setPageBackground=function(){this.game.canvas.parentElement.style.backgroundImage="url('assets/graphics/page_background"+this.getDefaultImageFormat(".jpg")+"')"},t.prototype.patchAudioFileLoading=function(){r.prototype.onProcessOld=r.prototype.onProcess,r.prototype.onProcess=function(){var i,s,a;try{this.onProcessOld()}catch(l){(a=(s=(i=this.loader)===null||i===void 0?void 0:i.scene)===null||s===void 0?void 0:s.raven)===null||a===void 0||a.captureException("Error processing audio "+this.key+" - "+l)}}},t.prototype.preload=function(){this.load.atlas("preloader","assets/graphics/preloader.png","assets/graphics/preloader.json"),this.loadWebFonts()},t.prototype.loadWebFonts=function(){this.load.on(o.GameFontsEvent.WEBFONT_INACTIVE,this.onWebFontInactive,this),this.load.rexWebFont({custom:{families:["Souses:n7,n9"],urls:["css/fonts.css"]}})},t.prototype.onWebFontActive=function(){},t.prototype.onWebFontInactive=function(i,s,a){var l="Can't load webfont "+s+":"+a},t.prototype.create=function(){var i=this;this.game.raven.addTagsContext({avif:this.game.avif,webP:this.game.webp}),this.game.injectIntoScenes(this.game.raven,"raven"),this.addThrottling(),this.disableScrollBySpacebar(),this.setupAnalytics(),this.setupScale(),this.setupPoki().finally(function(){i.launchGlobalScene()})},t.prototype.addThrottling=function(){var i=utils.NetUtil.getParamInt("throttle");i>0&&this.events.on(Phaser.Scenes.Events.PRE_UPDATE,function(){for(var s=i*1e6,a=0;--s;)a+=Math.sqrt(s)})},t.prototype.disableScrollBySpacebar=function(){if(this.game.device.os.desktop)return;this.game.input.keyboard.addCapture(32)},t.prototype.setupAnalytics=function(){this.game.analytics=new o.GameAnalyticsWrapper(this.game),this.game.injectIntoScenes(this.game.analytics,"analytics")},t.prototype.launchGlobalScene=function(){var i=this.scene.get(o.SceneKey.GLOBAL);i.events.once(Phaser.Scenes.Events.READY,this.onGlobalSceneReady.bind(this,i)),i.scene.start(o.SceneKey.GLOBAL)},t.prototype.onGlobalSceneReady=function(i){this.game.globalScene=i,i.scene.launch(o.SceneKey.PRELOADER),i.scene.bringToTop()},t.prototype.setupScale=function(){this.game.config.scaleMode===Phaser.Scale.NONE&&(this.scaleForMobile(),this.updateScreenConstants())},t.prototype.scaleForMobile=function(){var i=this.game.scale;i.orientation=Phaser.Scale.Orientation.PORTRAIT,this.wasIncorrectOrientation=!0,window.addEventListener("resize",this.onWindowResize.bind(this)),this.onWindowResize()},t.prototype.onWindowResize=function(){var i,s=window.innerWidth,a=window.innerHeight,l=Math.min(window.devicePixelRatio,1.5);this.game.raven.captureBreadcrumb({category:"game",message:"resize",data:{width:s,height:a,dpr:window.devicePixelRatio,orientation:(i=screen.orientation)===null||i===void 0?void 0:i.type}}),this.scale.zoom=1/l,this.scale.resize(s*l,a*l);var c=this.isCorrectOrientation();c?(this.updateScreenConstants(),this.resizeActiveScenes(),this.hideRotateIcon(),this.wasPaused&&(this.game.loop.resume(),this.wasPaused=!1)):(this.showRotateIcon(),this.game.loop.pause(),this.wasPaused=!0);var u=!this.wasIncorrectOrientation&&c;u&&this.handleScroll();var d=this.wasIncorrectOrientation&&c;d&&this.fillViewport(),this.wasIncorrectOrientation=!c},t.prototype.handleScroll=function(){typeof this.scrollTimeout=="undefined"&&clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout(function(){window.scrollTo(0,-window.innerHeight)},500)},t.prototype.fillViewport=function(){typeof this.resizeTimeout!="undefined"&&clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){document.body.style.width="100vw",document.body.style.height="100vh"},500)},t.prototype.isCorrectOrientation=function(){var i=o.Config.IS_PORTRAIT&&this.isPortrait(),s=o.Config.IS_LANDSCAPE&&this.isLandscape();return i||s},t.prototype.resizeActiveScenes=function(){this.game.scene.getScenes(!0).forEach(function(i){i.resize&&i.resize()})},t.prototype.setupPoki=function(){return this.game.poki=new o.PokiSdkWrapper(this.game),this.game.poki.injectIntoScenes(),this.game.poki.init()},t.prototype.updateScreenConstants=function(){o.Config.GAME_WIDTH=this.game.scale.width,o.Config.GAME_HEIGHT=this.game.scale.height,o.Config.HALF_GAME_WIDTH=o.Config.GAME_WIDTH*.5,o.Config.HALF_GAME_HEIGHT=o.Config.GAME_HEIGHT*.5,o.Config.ASPECT_RATIO=o.Config.GAME_WIDTH/o.Config.GAME_HEIGHT,o.Config.ZOOM=this.game.scale.zoom,o.Config.ASSETS_SCALE=o.Config.IS_PORTRAIT?o.Config.GAME_WIDTH/o.Config.SOURCE_GAME_WIDTH:o.Config.GAME_HEIGHT/o.Config.SOURCE_GAME_HEIGHT},t.prototype.showRotateIcon=function(){this.getRotateElement().style.display="flex"},t.prototype.hideRotateIcon=function(){this.getRotateElement().style.display="none"},t.prototype.getRotateElement=function(){return document.getElementById("rotate")},t.prototype.isLandscape=function(){return window.innerWidth>window.innerHeight},t.prototype.isPortrait=function(){return window.innerHeight>window.innerWidth},t}(Phaser.Scene);o.Boot=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){t===void 0&&(t="preloader");var i=r.call(this,e)||this;return i.name="loading_logo",i.atlasKey=t,i.addLogo(),i.addLogoCrop(),i}return n.prototype.addLogo=function(){this.logoShadow=this.scene.add.image(0,0,this.atlasKey,"fox_head_black"),this.logoShadow.y=10,this.logoShadow.alpha=.15,this.logoBack=this.scene.add.image(0,0,this.atlasKey,"fox_head_beige"),this.logo=this.scene.add.image(0,0,this.atlasKey,"fox_head"),this.add([this.logoShadow,this.logoBack,this.logo])},n.prototype.addLogoCrop=function(){var e=1;this.logoCrop=new Phaser.Geom.Rectangle(0,this.logo.height-e,this.logo.width,e),this.logo.setCrop(this.logoCrop)},n.prototype.setProgressInstant=function(e){this.scene.tweens.killTweensOf(this.logoCrop);var t=this.getLogoCropParams(e);this.logoCrop.height=t.height,this.logoCrop.y=t.y,this.logo.setCrop(this.logoCrop)},n.prototype.setProgress=function(e){var t=this,i=this.getLogoCropParams(e);this.scene.tweens.killTweensOf(this.logoCrop),this.scene.tweens.add({targets:this.logoCrop,duration:200,ease:Phaser.Math.Easing.Linear.Linear,y:i.y,height:i.height,onUpdate:function(){t.logo.setCrop(t.logoCrop)}})},n.prototype.getLogoCropParams=function(e){var t=this.logo.height,i=t*Math.max(.001,e);return{height:i,y:t-i}},n.prototype.getWidth=function(){return this.logoBack.width},n}(Phaser.GameObjects.Container);o.LoadingLogo=h})(game||(game={}));var game;(function(o){var h=utils.NetUtil,r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(){this.events.on("shutdown",this.shutdown,this),this.addBackground(),this.addLogo(),this.addCopyright(),this.events.on(Phaser.Scenes.Events.UPDATE,this.scrollBackground,this),this.resize()},e.prototype.addBackground=function(){this.background=this.add.tileSprite(0,0,0,0,"preloader","bg")},e.prototype.addLogo=function(){this.logo=new o.LoadingLogo(this),this.add.existing(this.logo)},e.prototype.addCopyright=function(){var t=this.getCopyrightContent(),i={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"28px",color:"#FDF2E7",align:"center"};this.copyright=this.add.text(0,0,t,i),this.copyright.setOrigin(.5,1),this.copyright.setShadow(0,2,"rgba(0,0,0,0.2)"),this.copyright.visible=utils.NetUtil.isHostAllowed(["192.168","localhost","robowhale.com"]),this.copyright.kill()},e.prototype.getCopyrightContent=function(){var t=2020,i=new Date().getUTCFullYear(),s=i===t?i.toString():t+"-"+i;return"Developed by RoboWhale, "+s+"\nUse with permission"},e.prototype.preload=function(){this.analytics.sendLoadingEvent("main","start"),this.poki.sdk.gameLoadingStart(),this.game.loadingOverlay.fadeOut(),this.load.maxParallelDownloads=this.game.device.os.android?6:32,this.load.cacheBuster=window.game.config.build_version,this.load.on(Phaser.Loader.Events.PROGRESS,this.onLoadProgress,this),this.load.on(Phaser.Loader.Events.COMPLETE,this.onLoadComplete,this),this.loadOtherAssets(),this.loadFonts(),this.loadAudio(),this.loadGraphics(),this.loadEditor(),this.loadSaveData()},e.prototype.onLoadProgress=function(){this.logo.setProgress(this.load.progress)},e.prototype.onLoadComplete=function(){this.load.off(Phaser.Loader.Events.FILE_COMPLETE,this.onLoadProgress,this)},e.prototype.loadOtherAssets=function(){this.load.json("texts","assets/texts.json"),this.loadLevelConfigs(),this.loadLevelsMapConfig()},e.prototype.loadLevelConfigs=function(){var t,i=utils.NetUtil.getParamBool("loadRemote"),s=(t=utils.NetUtil.getParam("levelsFile"))!==null&&t!==void 0?t:"levels",a=s+".json",l=i?o.Config.SERVER_URL+a:"assets/configs/"+a;this.load.json("levels",l)},e.prototype.loadLevelsMapConfig=function(){var t=utils.NetUtil.getParamBool("loadRemote"),i=t?o.Config.SERVER_URL+"levels_map.json":"assets/configs/levels_map_config.json";this.load.json(o.LevelsMap.CONFIG_KEY,i)},e.prototype.loadFonts=function(){this.load.bitmapFontFromAtlas(o.BitmapGameFont.LEVELS_MAP_NUMBERS_COMPLETE,"levels_map","level_icons_font_complete","assets/fonts/bitmap/level_icons_font_complete.fnt"),this.load.bitmapFontFromAtlas(o.BitmapGameFont.LEVELS_MAP_NUMBERS_UNLOCKED,"levels_map","level_icons_font_unlocked","assets/fonts/bitmap/level_icons_font_unlocked.fnt")},e.prototype.loadAudio=function(){this.load.audio(o.GameSoundKey.MENU_LOOP,"assets/audio/menu_loop.mp3"),this.game.audioType===o.SoundManagerType.WEB_AUDIO&&this.load.audio(o.GameSoundKey.TAP,"assets/audio/tap.mp3")},e.prototype.loadGraphics=function(){this.load.image("levels_map_bg_1","assets/graphics/levels_map_bg_1.jpg"),this.load.image("levels_map_bg_2","assets/graphics/levels_map_bg_2.jpg"),this.load.image("levels_map_bg_3","assets/graphics/levels_map_bg_3.jpg"),this.load.atlas("levels_map","assets/graphics/levels_map.png","assets/graphics/levels_map.json")},e.prototype.loadEditor=function(){if(o.Main.editorEnabled===!1)return;this.load.script("tweakpane","js/tweakpane.min.js"),this.load.atlas("editor","assets/graphics/editor.png","assets/graphics/editor.json"),this.load.bitmapFontFromAtlas(o.BitmapGameFont.EDITOR_BLOCK_LIVES,"editor","block_lives","assets/fonts/bitmap/block_lives.fnt",-1),this.load.bitmapFontFromAtlas(o.BitmapGameFont.EDITOR_ROW_NUMBERS,"editor","row_numbers","assets/fonts/bitmap/row_numbers.fnt",-1)},e.prototype.loadSaveData=function(){var t=this;this.load.rexAwait("init_game_store",{callback:function(i){t.game.store.initActualStorage().catch(function(s){t.sendStorageErrorToAnalytics(s)}).finally(function(){return __awaiter(t,void 0,void 0,function(){return __generator(this,function(s){switch(s.label){case 0:return[4,this.game.store.loadInitialValues()];case 1:return s.sent(),[4,this.game.store.migrateSaveData()];case 2:return s.sent(),i(),[2]}})})})}})},e.prototype.sendStorageErrorToAnalytics=function(t){var i,s=t instanceof DOMException?t.message:t.toString();(i=this.game.analytics)===null||i===void 0||i.sendError("LocalStorage:"+s)},e.prototype.create=function(){this.addSidebards(),this.initTexts(),this.initBoosters(),this.initLevelConfigs(),this.addIngamePreloader(),this.addScenesTransition(),this.addToasts(),this.initAudio(),this.initDelayedLoader(),this.poki.sdk.gameLoadingFinished(),this.analytics.sendLoadingEvent("main","complete"),this.startGame()},e.prototype.addSidebards=function(){this.setSidebackground("left-sidebar","page_left_sidebar"),this.setSidebackground("right-sidebar","page_right_sidebar")},e.prototype.setSidebackground=function(t,i){var s=document.getElementById(t);if(!s)return;var a=this.game.getDefaultImageFormat("png"),l=i+"."+a;s.style.backgroundImage="url('assets/graphics/"+l+"')"},e.prototype.initTexts=function(){this.game.texts=new o.GameTexts(this.game),this.game.texts.injectTextsIntoScenes()},e.prototype.initBoosters=function(){this.game.boosters=new o.BoostersManager(this.game);var t=utils.NetUtil.getParamBool("boosters");t&&this.game.boosters.boosters.forEach(function(i){i.num=99})},e.prototype.initLevelConfigs=function(){var t=this.cache.json.get("levels");this.game.levelConfigs=new o.LevelConfigsManager(t)},e.prototype.initAudio=function(){var t=new o.GameAudio(this.game.globalScene);t.loadMute(),t.addMenuLoop(),t.listenToScenesChange(this.game.globalScene.sceneTransition),this.game.audio=t},e.prototype.initDelayedLoader=function(){this.game.globalScene.addDelayedLoader(),this.game.globalScene.delayedLoader.startLoading()},e.prototype.addIngamePreloader=function(){this.game.globalScene.addIngamePreloader()},e.prototype.addScenesTransition=function(){var t=new o.CanvasSceneTransition(this.game.globalScene,"preloader","black_rect");this.game.globalScene.addSceneTranstion(t),this.game.globalScene.sceneTransition.instantChange=utils.NetUtil.getParamBool("instantSceneChange"),this.game.raven.trackSceneChanges(t)},e.prototype.addToasts=function(){this.game.toasts=this.game.globalScene.addToasts()},e.prototype.startGame=function(){window.environment===GameEnvironment.DEVELOP?this.startGameOnDev():this.startGameOnDeploy()},e.prototype.startGameOnDev=function(){var t=h.getParamInt("level");if(t>0&&this.game.levelConfigs.check(t)){this.startScene(o.SceneKey.GAMEPLAY_ROOT,{levelNumber:t});return}var i=h.getParamInt("levelEditor");if(i>0&&this.game.levelConfigs.check(i)){this.startScene(o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:i});return}this.startScene(o.SceneKey.LEVELS_MAP)},e.prototype.startGameOnDeploy=function(){if(o.Main.editorEnabled){this.startScene(o.SceneKey.LEVELS_MAP_DEV);return}var t=this.getLevelFromUrl();t?this.startScene(o.SceneKey.GAMEPLAY_ROOT,{levelNumber:t}):this.startScene(o.SceneKey.LEVELS_MAP)},e.prototype.getLevelFromUrl=function(){var t=utils.NetUtil.getParam("level");return t===null?null:parseInt(t)},e.prototype.startScene=function(t,i){var s=[o.SceneKey.LEVELS_MAP_DEV,o.SceneKey.LEVEL_EDITOR_ROOT,o.SceneKey.LEVELS_MAP_EDITOR,o.SceneKey.TUTORIAL_EDITOR].includes(t);if(s&&o.Main.editorEnabled===!1){""+t;return}this.game.changeScene(this.scene.key,t,i)},e.prototype.scrollBackground=function(t,i){this.background.tilePositionY+=.066*i},e.prototype.resize=function(){this.resizeBackground(),this.alignLogo(),this.alignCopyright()},e.prototype.resizeBackground=function(){this.background.envelop(o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},e.prototype.alignLogo=function(){var t=o.Config.GAME_WIDTH*.45;this.logo.scale=Math.min(1,t/this.logo.getWidth()),this.logo.x=o.Config.HALF_GAME_WIDTH,this.logo.y=o.Config.HALF_GAME_HEIGHT},e.prototype.alignCopyright=function(){var t=o.Config.GAME_WIDTH*.66;this.copyright.scale=1,this.copyright.scale=Math.min(1,t/this.copyright.width),this.copyright.x=o.Config.HALF_GAME_WIDTH,this.copyright.y=o.Config.GAME_HEIGHT-20},e.prototype.shutdown=function(){this.events.off(Phaser.Scenes.Events.UPDATE,this.scrollBackground,this)},e}(Phaser.Scene);o.Preloader=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s,a){var l=r.call(this,e,0,0,t,i)||this;return l.originalAlpha=1,l._isSelected=!1,l._column=s,l._row=a,l.name="cell",l.setInteractive(),l.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,l.onPointerOver,l),l.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,l.onPointerOut,l),l}return Object.defineProperty(n.prototype,"isSelected",{get:function(){return this._isSelected},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"row",{get:function(){return this._row},set:function(e){this._row=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"column",{get:function(){return this._column},enumerable:!1,configurable:!0}),n.prototype.onPointerOver=function(){this.scale=1.2},n.prototype.onPointerOut=function(){this.scale=1},n.prototype.getSelectedAlpha=function(){return this.originalAlpha*3},n.prototype.setSelected=function(e){if(this._isSelected===e)return;this._isSelected=e,this._isSelected?(this.setFrame("cell_with_plus"),this.alpha=this.getSelectedAlpha()):(this.setFrame("cell"),this.alpha=this.originalAlpha)},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.EditorCell=h})(game||(game={}));var game;(function(o){var h;(function(n){n.ADD_ROW="add_row",n.REMOVE_ROW="remove_row"})(h=o.EditorGridEvent||(o.EditorGridEvent={}));var r=function(n){__extends(e,n);function e(t,i,s){var a=n.call(this,t)||this;return t.add.existing(a),a.editor=a.scene,a.selectedCells=[],a.rowLabels=[],a.removeRowButtons=[],a.name="grid",a.initialColumns=i,a.initialRows=s,a._columns=i,a._rows=0,a.addInitialRows(),a.addVisibleRowsSeparator(),a.addColumnLabels(),a.addAddRowButton(),a}return Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),e.prototype.addSelectedCell=function(t){t.setSelected(!0),this.lastSelectedCell=t,this.selectedCells.push(t)},e.prototype.removeSelectedCell=function(t){t.setSelected(!1),_.pull(this.selectedCells,t),this.lastSelectedCell===t&&(this.lastSelectedCell=null)},e.prototype.resetSelectedCells=function(){this.selectedCells.forEach(function(t){t.setSelected(!1)}),this.lastSelectedCell=null,this.selectedCells.length=0},e.prototype.addInitialRows=function(){this.cells=[],_.times(this.initialRows,this.addRow.bind(this))},e.prototype.addRow=function(){this.addRowOfCells(this._rows),this.addRowLabel(this._rows),this.addRemoveRowButton(this._rows),this._rows++,this.emit(h.ADD_ROW,this,this._rows)},e.prototype.addRowOfCells=function(t){var i=this;_.times(this._columns,function(s){i.addCell(s,t)})},e.prototype.addCell=function(t,i){var s=new o.EditorCell(this.scene,"editor","cell",t,i);return s.x=e.CELL_SIZE/2+t*e.CELL_SIZE,s.y=-e.CELL_SIZE/2-i*e.CELL_SIZE,s.alpha=.2,s.originalAlpha=s.alpha,this.cells.push(s),this.add(s),s},e.prototype.addVisibleRowsSeparator=function(){var t=-o.GameGrid.ROWS*o.GameGrid.CELL_SIZE,i=this.scene.add.line(this.getWidth()/2,0,0,t,this.getWidth(),t,16777215);i.setLineWidth(6),this.addAt(i,0)},e.prototype.addColumnLabels=function(){var t=this;_.times(this._columns,function(i){var s=i.toString(),a=t.scene.add.bitmapText(0,0,o.BitmapGameFont.EDITOR_ROW_NUMBERS,s,28,Phaser.RIGHT);return a.x=i*e.CELL_SIZE+e.CELL_SIZE/2,a.y=20,a.setData("column",i),t.add(a),a.setInteractive(),a.input.cursor="pointer",a.setData("type","column_label"),a})},e.prototype.addRowLabel=function(t){var i=t.toString(),s=this.scene.add.bitmapText(0,0,o.BitmapGameFont.EDITOR_ROW_NUMBERS,i,28,Phaser.RIGHT);return s.setOrigin(1,.5),s.x=-16,s.y=-t*e.CELL_SIZE-e.CELL_SIZE/2+4,s.setData("row",t),this.add(s),this.rowLabels.push(s),s.setInteractive(),s.input.cursor="pointer",s.setData("type","row_label"),s},e.prototype.addRemoveRowButton=function(t){var i=this.scene.add.button("editor","remove_row_button",this);i.on(Phaser.GameObjects.ButtonEvent.RELEASE,this.onRemoveRowButtonClick,this),i.setData("row",t),i.x=this.getWidth()+i.displayWidth/2+10,i.y=-t*e.CELL_SIZE-e.CELL_SIZE/2,this.removeRowButtons.push(i)},e.prototype.onRemoveRowButtonClick=function(t){if(this._rows<=o.GameGrid.ROWS){""+o.GameGrid.ROWS;return}var i=t.getData("row");this.removeRow(i)},e.prototype.removeRow=function(t){this.removeCellsByRow(t),this.removeRowLabel(t),this.removeRemoveRowButton(t),this.updateRowsAbove(t),this._rows--,this.alignAddRowButton(),this.emit(h.REMOVE_ROW,t)},e.prototype.removeCellsByRow=function(t){var i=this.cells.filter(function(s){return s.row===t});i.forEach(function(s){return s.destroy()}),_.pull.apply(_,__spreadArrays([this.cells],i))},e.prototype.removeRowLabel=function(t){var i=this.rowLabels.findIndex(function(s){return s.getData("row")===t});if(i===-1)return;this.rowLabels[i].destroy(),this.rowLabels.splice(i,1)},e.prototype.removeRemoveRowButton=function(t){var i=this.removeRowButtons.findIndex(function(s){return s.getData("row")===t});if(i===-1)return;this.removeRowButtons[i].destroy(),this.removeRowButtons.splice(i,1)},e.prototype.addAddRowButton=function(){this.addRowButton=this.scene.add.button("editor","add_row_button",this),this.addRowButton.on(Phaser.GameObjects.ButtonEvent.RELEASE,this.onAddRowClick,this),this.alignAddRowButton()},e.prototype.alignAddRowButton=function(){this.addRowButton.x=this.getWidth()/2,this.addRowButton.y=-e.CELL_SIZE/2-this._rows*e.CELL_SIZE},e.prototype.onAddRowClick=function(){for(var t=this.editor.shiftKey.isDown?5:1,i=0;i<t;i++)this.addRow(),this.alignAddRowButton()},e.prototype.getWidth=function(){return this._columns*e.CELL_SIZE},e.prototype.getHeight=function(){return this._rows*e.CELL_SIZE},e.prototype.getDisplayWidth=function(){return this.initialColumns*e.CELL_SIZE},e.prototype.getCellAt=function(t,i){return this.cells.find(function(s){return s.row===t&&s.column===i})},e.prototype.getCellAtXY=function(t,i){var s=Math.floor(i/e.CELL_SIZE),a=Math.floor(t/e.CELL_SIZE);return this.getCellAt(s,a)},e.prototype.getRandomColumns=function(t){var i=_.times(this._columns);return Phaser.Math.RND.shuffle(i).slice(0,t)},e.prototype.updateRowsAbove=function(t){var i=this;this.cells.filter(function(s){return s.row>t}).forEach(function(s){s.row--,s.y=i.getYByRow(s.row)}),this.rowLabels.filter(function(s){return s.getData("row")>t}).forEach(function(s){var a=s.getData("row")-1;s.setData("row",a),s.y=i.getYByRow(a),s.text=a.toString()}),this.removeRowButtons.filter(function(s){return s.getData("row")>t}).forEach(function(s){var a=s.getData("row")-1;s.setData("row",a),s.y=i.getYByRow(a)})},e.prototype.getYByRow=function(t){return-e.CELL_SIZE/2-t*e.CELL_SIZE},e.prototype.addSelectedRow=function(t){var i=this;this.cells.filter(function(s){return s.row===t}).forEach(function(s){return i.addSelectedCell(s)})},e.prototype.hasRow=function(t){return this.cells.some(function(i){return i.row===t})},e.CELL_SIZE=100,e}(Phaser.GameObjects.Container);o.EditorGrid=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.itemTypes=o.ItemTypeUtil.getAllTypes(),t.cellSize=120,t.name="item_icons",t.addIcons(),t.alignIcons(),t}return n.prototype.addIcons=function(){var e=this;this.icons=this.itemTypes.map(function(t){var i=o.ItemTypeUtil.getFrameName(t),s=e.scene.add.image(0,0,"editor",i);return s.setData("type","add_item_icon"),s.setData(o.ITEM_TYPE,t),s.setInteractive(),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,e.onPointerOver.bind(e,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,e.onPointerOut.bind(e,s)),s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,e.onPointerDown.bind(e,s)),s}),this.add(this.icons)},n.prototype.alignIcons=function(){Phaser.Actions.GridAlign(this.icons,{width:5,position:Phaser.Display.Align.CENTER,cellWidth:this.cellSize,cellHeight:this.cellSize,x:this.cellSize/2,y:this.cellSize/2})},n.prototype.onPointerOver=function(e){e.scale=1.1},n.prototype.onPointerOut=function(e){e.scale=1},n.prototype.onPointerDown=function(e){},n.prototype.updateEnabledItems=function(e){this.icons.forEach(function(t){var i=e.includes(t.getData(o.ITEM_TYPE));t.visible=i}),this.icons=Phaser.Utils.Array.StableSort(this.icons,this.sortByVisible.bind(this)),this.alignIcons(),this.emit("resize")},n.prototype.sortByVisible=function(e,t){var i=e.visible?1:0,s=t.visible?1:0;return s-i},n.prototype.getRealBounds=function(){var e=this.icons.filter(function(p){return p.visible});if(e.length===0)return{width:0,height:0};var t=_.minBy(e,"x"),i=_.maxBy(e,"x"),s=_.minBy(e,"y"),a=_.maxBy(e,"y"),l=t.x-this.cellSize/2,c=i.x+this.cellSize/2,u=s.y-this.cellSize/2,d=a.y+this.cellSize/2;return{width:c-l,height:d-u}},n}(Phaser.GameObjects.Container);o.ItemIconsGrid=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="add_block_panel",t.addBack(),t.addIcons(),t.alignIcons(),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"editor","add_block_back"),this.back.setOrigin(.5,1),this.add(this.back)},n.prototype.addIcons=function(){this.icons=new o.ItemIconsGrid(this.scene),this.icons.on("resize",this.alignIcons,this),this.add(this.icons)},n.prototype.alignIcons=function(){this.icons.setScale(1);var e=this.icons.getRealBounds(),t=e.width,i=e.height,s=270,a=this.back.width*.9,l=s*.9,c=a/t,u=l/i;this.icons.scale=Math.min(1,c,u);var d=this.back.getTopLeft();this.icons.x=d.x+(this.back.width-t*this.icons.scale)/2,this.icons.y=d.y+(s-i*this.icons.scale)/2},n.prototype.revive=function(){this.visible=!0,this.active=!0},n.prototype.kill=function(){this.visible=!1,this.active=!1},n.prototype.show=function(){this.revive(),this.alpha=0,this.scale=.75,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,scale:1,alpha:1})},n.prototype.hide=function(){this.kill()},n.prototype.updateIcons=function(e){this.icons.updateEnabledItems(e)},n}(Phaser.GameObjects.Container);o.AddItemPanel=h})(game||(game={}));var game;(function(o){var h;(function(e){e.HEALTH="health",e.FRAME="frame"})(h=o.EditorItemParam||(o.EditorItemParam={}));var r;(function(e){e.SELECTED="selected",e.DESELECTED="deselected",e.PARAMS_CHANGED="params_changed"})(r=o.EditorItemEvent||(o.EditorItemEvent={}));var n=function(e){__extends(t,e);function t(i,s,a){var l=e.call(this,i,0,0,s,o.ItemTypeUtil.getFrameName(a))||this;return l._isSelected=!1,l.manuallyAdded=!1,l.params={},l.itemType=a,l.setData("type","item"),l.setInteractive(),l.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,l.onPointerOver,l),l.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OUT,l.onPointerOut,l),l}return Object.defineProperty(t.prototype,"isSelected",{get:function(){return this._isSelected},enumerable:!1,configurable:!0}),t.prototype.loadParams=function(i){var s=this;Object.keys(i).forEach(function(a){s.updateParams(a,i[a])})},t.prototype.updateParams=function(i,s){this.params[i]=s,i===h.FRAME&&this.setFrame(s),this.emit(r.PARAMS_CHANGED,this,i,s)},t.prototype.onPointerOver=function(){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,scale:1.2}),this.parentContainer.bringToTop(this)},t.prototype.onPointerOut=function(){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,scale:1})},t.prototype.setSelected=function(i){if(this._isSelected===i)return;this._isSelected=i,this._isSelected?this.emit(r.SELECTED,this):this.emit(r.DESELECTED,this)},t.prototype.getConfig=function(){var i=__assign(__assign({},this.params),this.itemType===o.ItemType.TRIANGLE&&{frame:this.frame.name});return __assign(__assign({},this.manuallyAdded&&{manuallyAdded:!0}),{column:this.column,row:this.row,type:this.itemType,params:i})},t.prototype.destroy=function(i){e.prototype.destroy.call(this,i)},t}(Phaser.GameObjects.Image);o.EditorItem=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i){var s=r.call(this,e,0,0,o.BitmapGameFont.EDITOR_BLOCK_LIVES,t.params[o.EditorItemParam.HEALTH]||"0",28)||this;return s.setOrigin(.5,.5),s.blockOffset=i,s.block=t,s.block.on(o.EditorItemEvent.PARAMS_CHANGED,s.onItemParamsChanged,s),s.block.on(Phaser.GameObjects.Events.DESTROY,s.onBlockDestroy,s),s.scene.events.on("postupdate",s.followBlock,s),s}return n.prototype.onItemParamsChanged=function(e,t,i){t===o.EditorItemParam.HEALTH&&this.setText(i.toString())},n.prototype.onBlockDestroy=function(){this.destroy()},n.prototype.followBlock=function(){if(this.visible===!1)return;this.x=this.block.x+this.blockOffset.x,this.y=this.block.y+this.blockOffset.y},n.prototype.destroy=function(e){this.scene&&this.scene.events.on("postupdate",this.followBlock,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.BitmapText);o.EditorItemLivesCounter=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,t.texture.key,t.frame.name)||this;return i.setTintFill(16777215),i.setAlpha(.5),i.hide(),i.originalItem=t,i.originalItem.on(o.EditorItemEvent.SELECTED,i.show,i),i.originalItem.on(o.EditorItemEvent.DESELECTED,i.hide,i),i.originalItem.on(o.EditorItemEvent.PARAMS_CHANGED,i.onItemParamChanged,i),i.originalItem.on(Phaser.Input.Events.GAMEOBJECT_POINTER_OVER,i.onOriginalItemPointerOver,i),i.originalItem.on(Phaser.GameObjects.Events.DESTROY,function(){i.destroy(!1)}),i.scene.events.on("postupdate",i.followOriginalItem,i),i}return n.prototype.onItemParamChanged=function(e,t,i){t===o.EditorItemParam.FRAME&&this.setFrame(i)},n.prototype.show=function(){this.visible=!0,this.alpha=0,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:.5})},n.prototype.hide=function(){this.visible=!1},n.prototype.onOriginalItemPointerOver=function(){this.parentContainer.bringToTop(this)},n.prototype.followOriginalItem=function(){if(this.visible===!1)return;this.x=this.originalItem.x,this.y=this.originalItem.y,this.scale=this.originalItem.scale},n.prototype.destroy=function(e){this.scene&&this.scene.events.off("postupdate",this.followOriginalItem,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.EditorItemCopy=h})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){this.scene=n,this.events=new Phaser.Events.EventEmitter,this.panel=new Tweakpane({title:e,container:document.getElementById("editor-panels")})}return r.prototype.disableInput=function(){this.panel.containerElem_.classList.add("disable-panel-input")},r.prototype.enableInput=function(){this.panel.containerElem_.classList.remove("disable-panel-input")},r.prototype.refresh=function(){this.panel.refresh()},r.prototype.destroy=function(){this.panel.dispose()},r}();o.EditorPanel=h})(game||(game={}));var game;(function(o){var h;(function(n){n.AUTO_THROW_CHANGE="AUTO_THROW_CHANGE"})(h=o.LevelConfigPanelEvent||(o.LevelConfigPanelEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t,"Level "+i.levelNumber)||this;return s.levelConfig=i,s.panel.addInput(s.levelConfig,"balls",{step:1}),s.bgInput=s.panel.addInput(s.levelConfig,"background",{options:s.getBackgrounds()}),s.addAutoThrowFolder(),s.addGiftsFolder(),s.addButtons(),s}return e.prototype.getBackgrounds=function(){return[{text:"green",value:"background_1"},{text:"pink",value:"background_2"},{text:"night",value:"background_3"}]},e.prototype.addAutoThrowFolder=function(){var t=this.panel.addFolder({title:"Auto throw"});t.addInput(this.levelConfig.autoThrow,"enabled").on("change",this.onAutoThrowChange.bind(this)),t.addInput(this.levelConfig.autoThrow,"fastForward"),t.addInput(this.levelConfig.autoThrow,"snapping"),t.addInput(this.levelConfig.autoThrow,"delay",{min:0,max:1e3,step:50})},e.prototype.onAutoThrowChange=function(t){this.events.emit(h.AUTO_THROW_CHANGE,t)},e.prototype.addGiftsFolder=function(){var t=this.panel.addFolder({title:"Gifts"});this.levelConfig.gift||(this.levelConfig.gift=this.createDefaultGiftConfig());var i=this.levelConfig.gift;Object.keys(i).forEach(function(s){t.addInput(i,s,{min:0,max:10,step:1})})},e.prototype.createDefaultGiftConfig=function(){var t;return t={},t[o.BoosterType.BOMB]=0,t[o.BoosterType.CRACKER]=0,t[o.BoosterType.STOP]=0,t},e.prototype.addButtons=function(){this.tutorialButton=this.panel.addButton({title:"Tutorial"}),this.removeButton=this.panel.addButton({title:"Remove"}),this.playButton=this.panel.addButton({title:"Play"})},e}(o.EditorPanel);o.LevelConfigPanel=r})(game||(game={}));var game;(function(o){var h;(function(n){n.ITEM_TYPE_CHANGE="item_type_change",n.CLEAR="clear",n.GENERATE="generate"})(h=o.LevelGeneratorPanelEvent||(o.LevelGeneratorPanelEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t,"Generator")||this;return s.generator=i,s.panel.addInput(s.generator,"general",{step:1,min:1,max:100}),s.panel.addInput(s.generator,"sides",{step:1,min:0,max:100}),s.panel.addInput(s.generator,"startRow",{step:1,min:2,max:20}),s.panel.addInput(s.generator,"targetItemType",{options:s.getTargetItemTypes()}).on("change",s.onTargetItemTypeChanged.bind(s)),s.panel.addInput(s.generator,"targetItemsNum",{step:1}),s.addSeedControls(),s.addHealthFolder(),s.addItemTypesFolder(),s.addWeightsFolder(),s.addButtons(),s}return e.prototype.addHealthFolder=function(){var t=this.panel.addFolder({title:"Health",expanded:!0});t.addInput(this.generator,"minHealth",{step:1,label:"min"}).on("change",this.onMinHealthChange.bind(this)),t.addInput(this.generator,"maxHealth",{step:1,label:"max"}).on("change",this.onMaxHealthChange.bind(this)),t.addInput(this.generator,"incrementHealth",{step:.05,min:.1,max:1,label:"increment"}),t.addInput(this.generator,"deltaHealth",{step:1,min:0,max:10,label:"delta"})},e.prototype.onMinHealthChange=function(t){this.generator.minHealth=Math.min(t,this.generator.maxHealth),this.panel.refresh()},e.prototype.onMaxHealthChange=function(t){this.generator.maxHealth=Math.max(t,this.generator.minHealth),this.panel.refresh()},e.prototype.onTargetItemTypeChanged=function(t){this.generator.itemTypes[t]=!0,this.panel.refresh()},e.prototype.addSeedControls=function(){this.panel.addInput(this.generator,"seed"),this.panel.addButton({title:"New seed"}).on("click",this.onSeedButtonClick.bind(this))},e.prototype.onSeedButtonClick=function(){this.generator.seed=this.getNewSeed(),this.panel.refresh()},e.prototype.getNewSeed=function(){return _.shuffle(Date.now().toString().split("")).join("")},e.prototype.getTargetItemTypes=function(){var t=[o.ItemType.SHATTER_BLOCK_PIECE],i=o.ItemTypeUtil.getBlockTypes(),s=_.without.apply(_,__spreadArrays([i],t)),a=__spreadArrays(s);return _.zipObject(s,a)},e.prototype.addItemTypesFolder=function(){var t=this,i=this.panel.addFolder({title:"Item types",expanded:!0});Object.keys(this.generator.itemTypes).sort(this.sortItemTypes.bind(this)).forEach(function(s){i.addInput(t.generator.itemTypes,s).on("change",t.onItemTypeChange.bind(t,s))}),this.selectAllButton=i.addButton({title:"Select all"}),this.selectAllButton.on("click",this.onSelectAllButtonClick.bind(this)),this.deselectAllButton=i.addButton({title:"Deselect all"}),this.deselectAllButton.on("click",this.onDeselectAllButtonClick.bind(this))},e.prototype.sortItemTypes=function(t,i){var s=o.ItemTypeUtil.isBlockType(t),a=o.ItemTypeUtil.isBlockType(i);return s&&a===!1?-1:s===!1&&a?1:s&&a?t.toString().charCodeAt(0)-i.toString().charCodeAt(0):0},e.prototype.onSelectAllButtonClick=function(){this.updateAllItemTypesInConfig(!0),this.panel.refresh()},e.prototype.onDeselectAllButtonClick=function(){this.updateAllItemTypesInConfig(!1),this.panel.refresh()},e.prototype.updateAllItemTypesInConfig=function(t){var i=this;Object.keys(this.generator.itemTypes).forEach(function(s){i.generator.itemTypes[s]=t})},e.prototype.onItemTypeChange=function(t,i){this.events.emit(h.ITEM_TYPE_CHANGE,t,i),this.updateWeightsFolder()},e.prototype.updateWeightsFolder=function(){this.weightsFolder.dispose(),this.clearButton.dispose(),this.generateButton.dispose(),this.addWeightsFolder(),this.addButtons()},e.prototype.addWeightsFolder=function(){var t=this;this.weightsFolder=this.panel.addFolder({title:"Weights"}),this.getAllowedItemTypes().forEach(function(i){t.weightsFolder.addInput(t.generator.weights,i,{step:1,min:0,max:200})}),this.weightsFolder.addButton({title:"Reset"}).on("click",this.onResetWeightsClick.bind(this))},e.prototype.getAllowedItemTypes=function(){var t=this;return Object.keys(this.generator.itemTypes).filter(function(i){return t.generator.itemTypes[i]===!0})},e.prototype.onResetWeightsClick=function(){var t=this;Object.keys(this.generator.weights).forEach(function(i){t.generator.weights[i]=100}),this.panel.refresh()},e.prototype.addButtons=function(){var t=this;this.clearButton=this.panel.addButton({title:"Clear"}),this.clearButton.on("click",function(){t.events.emit(h.CLEAR)}),this.generateButton=this.panel.addButton({title:"Generate"}),this.generateButton.on("click",function(){t.events.emit(h.GENERATE)})},e}(o.EditorPanel);o.LevelGeneratorPanel=r})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){this.scene=n,this.levelConfig=e,this.rnd=new Phaser.Math.RandomDataGenerator([e.generator.seed]),this.gacha=this.createGacha(this.levelConfig.generator.itemTypes,this.levelConfig.generator.weights,this.rnd)}return r.prototype.createGacha=function(n,e,t){var i=this.scene.plugins.get("gacha"),s=Object.keys(n).filter(function(l){return n[l]===!0}),a=s.reduce(function(l,c){return l[c]=e[c],l},{});return i.add({mode:"shuffle",rnd:t,items:__assign({},a)})},r.prototype.canGenerateItem=function(){return this.rnd.between(0,100)<this.levelConfig.generator.general},r.prototype.canGenerateItemOnSide=function(){return this.rnd.between(0,100)<this.levelConfig.generator.sides},r.prototype.getItemType=function(){return this.gacha.next()},r.prototype.getItemTypeForPinata=function(){for(var n=o.ItemType.PINATA_BLOCK;n===o.ItemType.PINATA_BLOCK;)n=this.gacha.next();return n},r.prototype.getItemParams=function(n,e,t){var i={},s=o.ItemTypeUtil.isBlockType(n);s&&(i[o.EditorItemParam.HEALTH]=r.getBlockHealth(t,e,this.rnd,this.levelConfig.generator));var a=n===o.ItemType.TRIANGLE;if(a){var l=[1,2,3,4].map(function(u){return o.TriangleBlock.getFrame(u)}),c=this.rnd.pick(l);i[o.EditorItemParam.FRAME]=c}return i},r.getBlockHealth=function(n,e,t,i){var s=i.minHealth,a=i.maxHealth,l=i.incrementHealth,c=s+Math.floor((n-e)*l),u=i.deltaHealth*t.sign();return Phaser.Math.Clamp(c+u,s,a)},r}();o.ItemsGenerator=h})(game||(game={}));var game;(function(o){var h;(function(n){n.GOTO_TUTORIAL_EDITOR="goto_tutorial_editor",n.BACKGROUND_CHANGE="background_change",n.CONFIG_REMOVE="config_remove",n.TEST_LEVEL="test_level",n.CHANGE_LEVEL="change_level"})(h=o.EditorEvent||(o.EditorEvent={}));var r=function(n){__extends(e,n);function e(){return n.call(this,{})||this}return e.prototype.init=function(t){this.events.once("shutdown",this.shutdown,this),this.levelConfig=t,this.levelNumber=t.levelNumber,this.configPanel=null,this.generatorPanel=null,this.items=[]},e.prototype.create=function(){this.addEditorPanels(),this.addGrid(),this.addItemsContainer(),this.addFox(),this.addLivesCounterLayer(),this.addCrosshair(),this.addAddBlockPanel(),this.onBackgroundChange(this.levelConfig.background),this.loadItems(),this.addPointerCallbacks(),this.addKeyboardCallbacks()},e.prototype.addEditorPanels=function(){this.addConfigPanel(),this.addGeneratorPanel();var t=this.game.store.getNumber(o.GameStoreKey.EDITOR_ZOOM);this.panelsContainer=document.getElementById("editor-panels"),this.panelsContainer.style.visibility="visible",this.panelsContainer.style.zoom=t.toString()},e.prototype.enablePanels=function(){this.configPanel.enableInput(),this.generatorPanel.enableInput()},e.prototype.disablePanels=function(){this.configPanel.disableInput(),this.generatorPanel.disableInput()},e.prototype.addConfigPanel=function(){this.configPanel=new o.LevelConfigPanel(this,this.levelConfig),this.configPanel.events.on(o.LevelConfigPanelEvent.AUTO_THROW_CHANGE,this.onAutoThrowChange,this),this.configPanel.bgInput.on("change",this.onBackgroundChange.bind(this)),this.configPanel.tutorialButton.on("click",this.gotoTutorialEditor.bind(this)),this.configPanel.removeButton.on("click",this.onRemoveButtonClick.bind(this)),this.configPanel.playButton.on("click",this.testLevel.bind(this))},e.prototype.gotoTutorialEditor=function(){this.events.emit(h.GOTO_TUTORIAL_EDITOR)},e.prototype.onAutoThrowChange=function(t){this.crosshairContainer.visible=t},e.prototype.testLevel=function(){this.updateLevelConfig(),this.events.emit(h.TEST_LEVEL,{levelNumber:this.levelNumber,fromEditor:!0})},e.prototype.onBackgroundChange=function(t){this.events.emit(h.BACKGROUND_CHANGE,t)},e.prototype.onRemoveButtonClick=function(){return __awaiter(this,void 0,void 0,function(){var t,i=this;return __generator(this,function(s){return t=window.confirm("Do you want to remove level "+this.levelNumber+" config?"),t===!1?[2]:(this.disablePanels(),this.game.levelConfigs.remove(this.levelNumber),this.game.levelConfigs.saveLocally(),this.game.levelConfigs.saveRemotely().then(function(){""+i.levelNumber,i.events.emit(h.CONFIG_REMOVE)}).catch(function(a){""+i.levelNumber}).finally(function(){i.enablePanels()}),[2])})})},e.prototype.saveLevelConfigAs=function(){var t=this,i=this.game.levelConfigs.getLevelNumbers(),s=Math.max.apply(Math,i)+1||1,a=prompt("Enter level number",s.toString());if(!a)return;var l=parseInt(a);if(!l)return;var c=i.includes(l);if(c){""+l;return}this.gui.saveButton.alpha=.5,this.gui.saveButton.enabled=!1,this.disablePanels();var u=__assign(__assign({},this.levelConfig),{levelNumber:l});this.game.levelConfigs.add(u),this.game.levelConfigs.saveLocally(),this.game.levelConfigs.saveRemotely().then(function(){""+l,t.events.emit(h.CHANGE_LEVEL,l)}).catch(function(){""+l})},e.prototype.saveLevelConfig=function(){var t=this,i=this.levelConfig.generator.targetItemType,s=this.levelConfig.generator.targetItemsNum,a=this.items.filter(function(l){return l.itemType===i}).length;if(a>s){""+i+a+s,""+(a-s)+i.toUpperCase();return}else a<s&&(""+s+a+i.toUpperCase(),this.levelConfig.generator.targetItemsNum=a,this.generatorPanel.refresh());this.gui.saveButton.alpha=.5,this.gui.saveButton.enabled=!1,this.disablePanels(),this.updateLevelConfig(),""+this.levelNumber,_.omit(this.levelConfig,"items"),this.game.levelConfigs.saveLocally().then(function(l){}).catch(function(l){}),this.game.levelConfigs.saveRemotely().then(function(){}).catch(function(l){}).finally(function(){t.gui.saveButton.alpha=1,t.gui.saveButton.enabled=!0,t.enablePanels()})},e.prototype.updateLevelConfig=function(){this.levelConfig.autoThrow.x=Phaser.Math.RoundTo(this.crosshair.x,-2),this.levelConfig.autoThrow.y=Phaser.Math.RoundTo(this.crosshair.y,-2),this.levelConfig.items=this.items.map(function(t){return t.getConfig()}),this.levelConfig.stars=e.createStarsConfig(this.levelConfig.levelNumber,this.levelConfig.items)},e.createStarsConfig=function(t,i){var s=i.reduce(function(u,d){var p=typeof d.params.health!="undefined";return p?u+d.params.health:u},0);if(t===1)return e.getFirstLevelStars(s);var a=Math.round(s*.7),l=Math.round(s*1),c=Math.round(s*1.3);return[a,l,c]},e.getFirstLevelStars=function(t){var i=Math.round(t*.33),s=Math.round(t*.66),a=t;return[i,s,a]},e.prototype.addGeneratorPanel=function(){this.generatorPanel=new o.LevelGeneratorPanel(this,this.levelConfig.generator),this.generatorPanel.events.on(o.LevelGeneratorPanelEvent.ITEM_TYPE_CHANGE,this.onItemTypesChange,this),this.generatorPanel.events.on(o.LevelGeneratorPanelEvent.CLEAR,this.clearGeneratedItems,this),this.generatorPanel.events.on(o.LevelGeneratorPanelEvent.GENERATE,this.onGenerateButtonClick,this)},e.prototype.clearGeneratedItems=function(){this.getItemsToClear().forEach(function(t){return t.destroy()}),this.clearTopEmptyRows(),this.scrollToHome()},e.prototype.getItemsToClear=function(){var t=this.shiftKey.isDown;return t?this.items.slice():this.items.filter(function(i){return!i.manuallyAdded})},e.prototype.onGenerateButtonClick=function(){var t=Object.values(this.levelConfig.generator.itemTypes).some(function(i){return i===!0});if(t===!1)return;this.clearGeneratedItems(),this.generateItems()},e.prototype.clearTopEmptyRows=function(){for(var t=o.GameGrid.ROWS-1,i=_.maxBy(this.items,"row"),s=Math.max(i==null?void 0:i.row,t)||t,a=this.grid.rows,l=a-1;l>s;l--)this.grid.removeRow(l)},e.prototype.generateItems=function(){var t=this.levelConfig.generator,i=new o.ItemsGenerator(this,this.levelConfig),s=this.items.filter(function(m){return m.itemType===t.targetItemType}).length;if(s===t.targetItemsNum)return;for(var a=t.startRow;a<1e3;a++){var l=!!this.grid.getCellAt(a,0);l===!1&&(this.grid.addRow(),this.grid.alignAddRowButton());for(var c=0;c<this.grid.columns;c++){if(this.isCellFree(c,a)===!1)continue;var u=i.canGenerateItem();if(u===!1)continue;var d=i.getItemType(),p=o.ItemTypeUtil.isBlockType(d),f=c===0||c===o.GameGrid.COLUMNS-1;if(p&&f){var y=i.canGenerateItemOnSide();if(y===!1)continue}var v=this.grid.getCellAt(a,c),g=i.getItemParams(d,t.startRow,a);if(this.addItem(d,v,g,!0),d===t.targetItemType&&++s===t.targetItemsNum)return}}},e.prototype.onItemTypesChange=function(){var t=this.getAllowedItemTypes();this.addBlockPanel.updateIcons(t)},e.prototype.getAllowedItemTypes=function(){var t=this;return Object.keys(this.levelConfig.generator.itemTypes).filter(function(i){return t.levelConfig.generator.itemTypes[i]===!0})},e.prototype.addGrid=function(){var t=this.getGridRowsFromLevelConfig();this.grid=new o.EditorGrid(this,o.GameGrid.COLUMNS,t),this.grid.alpha=.66,this.grid.on(o.EditorGridEvent.ADD_ROW,this.onAddRow,this),this.grid.on(o.EditorGridEvent.REMOVE_ROW,this.onRemoveRow,this)},e.prototype.getGridRowsFromLevelConfig=function(){var t=this.levelConfig.items.map(function(s){return s.row}),i=Math.max.apply(Math,t);return Math.max(o.GameGrid.ROWS,i+1)},e.prototype.onAddRow=function(t){},e.prototype.onRemoveRow=function(t){var i=this,s=this.items.filter(function(l){return l.row===t});s.forEach(function(l){l.destroy(),_.pull(i.items,l)});var a=this.items.filter(function(l){return l.row>t});a.forEach(function(l){l.row--,l.y+=o.EditorGrid.CELL_SIZE})},e.prototype.addFox=function(){this.fox=this.add.image(0,0,"editor","FOX_IDLE0001"),this.fox.setOrigin(.45,.8),this.fox.x=this.grid.getWidth()/2,this.itemsContainer.add(this.fox)},e.prototype.getFoxHandPosition=function(){return{x:this.fox.x,y:this.fox.y-this.fox.height*.28}},e.prototype.addItemsContainer=function(){this.itemsContainer=this.add.container(0,0),this.itemsContainer.name="items"},e.prototype.addLivesCounterLayer=function(){this.liveCountersContainer=this.add.container(0,0),this.liveCountersContainer.name="live_counters"},e.prototype.addCrosshair=function(){this.crosshairLine=this.add.line(0,0),this.crosshairLine.setStrokeStyle(3,16777215),this.crosshairLine.setOrigin(0,0),this.crosshair=this.add.image(0,0,"editor","crosshair"),this.crosshair.name="crosshair",this.crosshair.setInteractive(),this.crosshair.input.cursor="pointer",this.crosshair.on(Phaser.Input.Events.DRAG_END,this.onCrosshairDragEnd,this),this.crosshair.on(Phaser.Input.Events.DRAG,this.onCrosshairDrag,this),this.input.setDraggable(this.crosshair);var t=this.levelConfig.autoThrow;t.x===0&&t.y===0?(this.crosshair.x=this.grid.getWidth()/2,this.crosshair.y=-o.EditorGrid.CELL_SIZE*2.5):(this.crosshair.x=t.x,this.crosshair.y=t.y),this.crosshairContainer=this.add.container(0,0),this.crosshairContainer.name="crosshair_container",this.crosshairContainer.visible=t.enabled,this.crosshairContainer.add(this.crosshairLine),this.crosshairContainer.add(this.crosshair),this.redrawCrosshairLine()},e.prototype.onCrosshairDrag=function(t,i,s){this.crosshair.x=Phaser.Math.Clamp(i,0,this.grid.getWidth()),this.crosshair.y=Phaser.Math.Clamp(s,-this.grid.getHeight(),this.getFoxHandPosition().y),this.redrawCrosshairLine()},e.prototype.redrawCrosshairLine=function(){var t=this.getFoxHandPosition(),i=t.x,s=t.y;this.crosshairLine.setTo(i,s,this.crosshair.x,this.crosshair.y)},e.prototype.onCrosshairDragEnd=function(){if(this.levelConfig.autoThrow.snapping===!1)return;var t=o.EditorGrid.CELL_SIZE/2;this.crosshair.x=Phaser.Math.Snap.To(this.crosshair.x,t),this.crosshair.y=Phaser.Math.Snap.To(this.crosshair.y,t),this.redrawCrosshairLine()},e.prototype.addAddBlockPanel=function(){this.addBlockPanel=new o.AddItemPanel(this),this.addBlockPanel.x=300,this.addBlockPanel.y=300,this.addBlockPanel.kill(),this.addBlockPanel.updateIcons(this.getAllowedItemTypes()),this.add.existing(this.addBlockPanel)},e.prototype.loadItems=function(){var t=this;this.levelConfig.items.forEach(function(i){var s=t.grid.getCellAt(i.row,i.column),a=t.addItem(i.type,s,i.params,!0);a.manuallyAdded=i.manuallyAdded})},e.prototype.addPointerCallbacks=function(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on(Phaser.Input.Events.POINTER_WHEEL,this.onPointerWheel,this)},e.prototype.onPointerDown=function(t,i){var s=i.find(function(u){return u.name==="cell"});if(s){this.onCellClick(s);return}var a=i.find(function(u){return u.getData("type")==="row_label"});if(a){this.onRowLabelClick(a);return}var l=i.find(function(u){return u.getData("type")==="add_item_icon"});if(l){this.addItems(l),this.grid.resetSelectedCells(),this.addBlockPanel.hide();return}var c=i.find(function(u){return u.getData("type")==="item"});if(c){this.onItemClick(c);return}this.resetSelectedItems(),this.grid.resetSelectedCells(),this.addBlockPanel.hide()},e.prototype.onItemClick=function(t){t.isSelected?t.setSelected(!1):(this.shiftKey.isDown===!1&&this.resetSelectedItems(),t.setSelected(!0))},e.prototype.onRowLabelClick=function(t){var i=t.getData("row");this.shiftKey.isDown?this.grid.addSelectedRow(i):(this.grid.resetSelectedCells(),this.grid.addSelectedRow(i))},e.prototype.onCellClick=function(t){t.isSelected?(this.grid.removeSelectedCell(t),this.addBlockPanel.hide()):(this.shiftKey.isDown===!1&&this.grid.resetSelectedCells(),this.grid.addSelectedCell(t),this.showAddItemPanel(t))},e.prototype.showAddItemPanel=function(t){var i=t.getWorldPosition(),s=i.x,a=i.y;this.addBlockPanel.x=s,this.addBlockPanel.y=a,this.addBlockPanel.show()},e.prototype.resetSelectedItems=function(){this.getSelectedItems().forEach(function(t){return t.setSelected(!1)})},e.prototype.addItems=function(t){var i=this,s=t.getData(o.ITEM_TYPE),a=this.grid.selectedCells.map(function(l){var c=i.createItemParams(s,l.row),u=i.addItem(s,l,c);return u.manuallyAdded=!0,u});s===this.levelConfig.generator.targetItemType&&(this.levelConfig.generator.targetItemsNum+=a.length,this.generatorPanel.refresh())},e.prototype.createItemParams=function(t,i){var s={},a=o.ItemTypeUtil.isBlockType(t);return a&&(s[o.EditorItemParam.HEALTH]=o.ItemsGenerator.getBlockHealth(i,this.levelConfig.generator.startRow,Phaser.Math.RND,this.levelConfig.generator)),s},e.prototype.addItem=function(t,i,s,a){if(s===void 0&&(s={}),a===void 0&&(a=!1),i.row<2)return;var l=!!this.getItemAtCell(i.column,i.row);if(l){""+i.column+i.row;return}var c=new o.EditorItem(this,"editor",t);return c.x=i.x,c.y=i.y,c.column=i.column,c.row=i.row,c.loadParams(s),c.on(Phaser.GameObjects.Events.DESTROY,this.onItemDestroy,this),this.itemsContainer.add(c),this.items.push(c),this.addItemCopy(c),this.addLiveCounter(c),a===!1&&this.tweens.add({targets:c,duration:200,ease:Phaser.Math.Easing.Cubic.Out,scale:{from:.75,to:1},alpha:{from:0,to:1}}),c},e.prototype.isCellFree=function(t,i){return!this.getItemAtCell(t,i)},e.prototype.getItemAtCell=function(t,i){return this.items.find(function(s){return s.column===t&&s.row===i})},e.prototype.onItemDestroy=function(t){_.pull(this.items,t)},e.prototype.addItemCopy=function(t){var i=new o.EditorItemCopy(this,t);this.itemsContainer.add(i)},e.prototype.addLiveCounter=function(t){var i=o.ItemTypeUtil.getBlockTypes(),s=i.includes(t.itemType);if(s===!1)return;var a={x:-3,y:-t.displayHeight/2+16},l=new o.EditorItemLivesCounter(this,t,a);this.liveCountersContainer.add(l)},e.prototype.onPointerWheel=function(t,i,s,a){var l=this.getBlock(i);if(l&&l.isSelected){var c=l.params[o.EditorItemParam.HEALTH],u=a>0?-1:1,d=Math.max(1,c+u);l.updateParams(o.EditorItemParam.HEALTH,d);return}var p=a>=0?1:-1;this.cameras.main.scrollY+=o.EditorGrid.CELL_SIZE*p},e.prototype.getBlock=function(t){var i=t.find(function(a){return a.getData("type")==="item"});if(!i)return null;var s=o.ItemTypeUtil.getBlockTypes().includes(i.itemType);return s===!1?null:i},e.prototype.addKeyboardCallbacks=function(){this.shiftKey=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SHIFT),this.input.keyboard.on("keydown-S",this.onKeyDownS,this),this.input.keyboard.on("keydown-ENTER",this.testLevel,this),this.input.keyboard.on("keydown-HOME",this.scrollToHome,this),this.input.keyboard.on("keydown-END",this.scrollToEnd,this),this.input.keyboard.on("keydown-DELETE",this.removeItems,this),this.input.keyboard.on("keydown-UP",this.moveSelectedItems.bind(this,0,-1)),this.input.keyboard.on("keydown-RIGHT",this.moveSelectedItems.bind(this,1,0)),this.input.keyboard.on("keydown-DOWN",this.moveSelectedItems.bind(this,0,1)),this.input.keyboard.on("keydown-LEFT",this.moveSelectedItems.bind(this,-1,0)),this.input.keyboard.on("keydown-PLUS",this.changeEditorPanelsZoom.bind(this,1)),this.input.keyboard.on("keydown-MINUS",this.changeEditorPanelsZoom.bind(this,-1)),this.input.keyboard.on("keydown-ZERO",this.resetEditorPanelsZoom,this),this.input.keyboard.on("keydown-OPEN_BRACKET",this.changeCanvasMargin.bind(this,-1)),this.input.keyboard.on("keydown-CLOSED_BRACKET",this.changeCanvasMargin.bind(this,1)),this.input.keyboard.on("keydown-BACK_SLASH",this.resetCanvasMargin,this),this.input.keyboard.on("keydown-ONE",this.updateSelectedItemsFrame.bind(this,1)),this.input.keyboard.on("keydown-TWO",this.updateSelectedItemsFrame.bind(this,2)),this.input.keyboard.on("keydown-THREE",this.updateSelectedItemsFrame.bind(this,3)),this.input.keyboard.on("keydown-FOUR",this.updateSelectedItemsFrame.bind(this,4))},e.prototype.onKeyDownS=function(){this.shiftKey.isDown?this.saveLevelConfigAs():this.saveLevelConfig()},e.prototype.updateSelectedItemsFrame=function(t){this.setSelectedTrianglesFrame(t),this.setSelectedShatterPiecesFrame(t)},e.prototype.setSelectedTrianglesFrame=function(t){this.getSelectedTriangles().forEach(function(i){var s=o.TriangleBlock.getFrame(t);i.updateParams(o.EditorItemParam.FRAME,s)})},e.prototype.setSelectedShatterPiecesFrame=function(t){var i=o.ShatterBlockPiece.getFrame(t);this.getSelectedShatterPieces().forEach(function(s){return s.updateParams(o.EditorItemParam.FRAME,i)})},e.prototype.getSelectedShatterPieces=function(){return this.getSelectedItems().filter(function(t){return t.itemType===o.ItemType.SHATTER_BLOCK_PIECE})},e.prototype.getSelectedTriangles=function(){return this.getSelectedItems().filter(function(t){return t.itemType===o.ItemType.TRIANGLE})},e.prototype.moveSelectedItems=function(t,i){var s=this,a=this.getSelectedItems(),l=a.map(function(p){return s.grid.getCellAt(p.row,p.column)}),c=a.map(function(p){return s.grid.getCellAt(p.row-i,p.column+t)}),u=_.without.apply(_,__spreadArrays([c],l)),d=u.every(function(p){if(!p)return!1;if(p.row<2)return!1;var f=s.getItemAtCell(p.column,p.row);return!f});d&&this.moveItems(a,t,i)},e.prototype.moveItems=function(t,i,s){t.forEach(function(a){a.row-=s,a.column+=i,a.x+=o.EditorGrid.CELL_SIZE*i,a.y+=o.EditorGrid.CELL_SIZE*s})},e.prototype.removeItems=function(){var t=this,i=this.levelConfig.generator.targetItemType;this.getSelectedItems().forEach(function(s){s.itemType===i&&t.levelConfig.generator.targetItemsNum--,s.destroy()}),this.generatorPanel.refresh()},e.prototype.getSelectedItems=function(){return this.items.filter(function(t){return t.isSelected})},e.prototype.changeEditorPanelsZoom=function(t){t===void 0&&(t=1);var i=parseFloat(this.panelsContainer.style.zoom)||1,s=i+Phaser.Math.Sign(t)*.1;s=Math.max(.2,s),this.panelsContainer.style.zoom=s.toString(),this.game.store.saveValue(o.GameStoreKey.EDITOR_ZOOM,s)},e.prototype.resetEditorPanelsZoom=function(){var t=1;this.panelsContainer.style.zoom=t.toString(),this.game.store.saveValue(o.GameStoreKey.EDITOR_ZOOM,t)},e.prototype.changeCanvasMargin=function(t){var i=this.game.canvas.style,s=i.marginLeft.slice(0,-2),a=parseFloat(s),l=a+50*t;i.marginLeft=l+"px"},e.prototype.resetCanvasMargin=function(){this.scale.updateCenter()},e.prototype.scrollToHome=function(){this.cameras.main.scrollY=0},e.prototype.scrollToEnd=function(){},e.prototype.toggleMatterAutoUpdate=function(){this.matter.world.autoUpdate=!this.matter.world.autoUpdate,""+(this.matter.world.autoUpdate?"OFF":"ON")},e.prototype.onAnyKeyDown=function(){},e.prototype.togglePhysicsDebug=function(){if(this.matter.config.debug===!1)return;this.matter.world.drawDebug=!this.matter.world.drawDebug,this.matter.world.drawDebug===!1&&this.matter.world.debugGraphic.clear()},e.prototype.doResize=function(){this.alignGrid(),this.alignItems(),this.alignLiveCounters(),this.alignCrosshairContainer(),this.resizeCamera()},e.prototype.alignGrid=function(){var t=this.grid.getDisplayWidth(),i=o.Config.GAME_WIDTH*.66,s=i/t;this.grid.scale=s,this.grid.x=(o.Config.GAME_WIDTH-this.grid.getDisplayWidth()*s)/2,this.grid.y=o.Config.GAME_HEIGHT-80},e.prototype.alignItems=function(){this.itemsContainer.scale=this.grid.scale,this.itemsContainer.x=this.grid.x,this.itemsContainer.y=this.grid.y},e.prototype.alignLiveCounters=function(){this.liveCountersContainer.scale=this.grid.scale,this.liveCountersContainer.x=this.grid.x,this.liveCountersContainer.y=this.grid.y},e.prototype.alignCrosshairContainer=function(){this.crosshairContainer.scale=this.grid.scale,this.crosshairContainer.x=this.grid.x,this.crosshairContainer.y=this.grid.y},e.prototype.resizeCamera=function(){var t=this.cameras.main;t.setViewport(0,0,o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT)},e.prototype.onGuiCreated=function(){},e.prototype.update=function(t,i){},e.prototype.shutdown=function(){this.destroyPanels()},e.prototype.destroyPanels=function(){this.panelsContainer.style.visibility="hidden",this.panelsContainer=null,this.configPanel&&this.configPanel.destroy(),this.generatorPanel&&this.generatorPanel.destroy()},e}(Phaser.Scene);o.Editor=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.buttonsMargin=12,i.name="level_label",i.addLabelBack(),i.addLabel(t),i.addPrevLevelButton(),i.addNextLevelButton(),i}return n.prototype.addLabelBack=function(){this.labelBack=this.scene.add.image(0,0,"editor","level_label_back"),this.add(this.labelBack)},n.prototype.addLabel=function(e){var t="LEVEL "+e,i={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"36px",color:"#ffffff",align:"center"};this.label=this.scene.add.text(0,0,t,i),this.label.setOrigin(.5,.5),this.add(this.label)},n.prototype.addPrevLevelButton=function(){this.prevLevelButton=this.scene.add.button("editor","prev_level_button",this),this.prevLevelButton.x=this.labelBack.left-this.prevLevelButton.displayWidth/2-this.buttonsMargin},n.prototype.addNextLevelButton=function(){this.nextLevelButton=this.scene.add.button("editor","next_level_button",this),this.nextLevelButton.x=this.labelBack.right+this.nextLevelButton.displayWidth/2+this.buttonsMargin},n}(Phaser.GameObjects.Container);o.EditorLevelLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.init=function(e){this.levelConfig=e.levelConfig},n.prototype.create=function(){this.addLevelLabel(),this.addSaveButton()},n.prototype.addLevelLabel=function(){this.levelLabel=new o.EditorLevelLabel(this,this.levelConfig.levelNumber),this.add.existing(this.levelLabel)},n.prototype.addSaveButton=function(){this.saveButton=this.add.button("editor","save_button")},n.prototype.doResize=function(){this.alignLevelLabel(),this.alignSaveButton()},n.prototype.alignLevelLabel=function(){this.levelLabel.scale=.66,this.levelLabel.x=o.Config.HALF_GAME_WIDTH,this.levelLabel.y=this.levelLabel.getBounds().height/2+20},n.prototype.alignSaveButton=function(){var e=50;this.saveButton.x=o.Config.GAME_WIDTH-e,this.saveButton.y=o.Config.GAME_HEIGHT-e+4},n.prototype.shutdown=function(){},n}(Phaser.Scene);o.EditorGui=h})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ButtonEvent,r=function(n){__extends(e,n);function e(){return n!==null&&n.apply(this,arguments)||this}return e.prototype.init=function(t){this.levelNumber=t?t.levelNumber:1,this.levelConfig=this.getLevelConfig(this.levelNumber),""+this.levelNumber,this.events.once("shutdown",this.shutdown,this),this.editor=null,this.editorGui=null},e.prototype.getLevelConfig=function(t){var i=this.game.levelConfigs.check(t);return i?this.game.levelConfigs.get(t):this.game.levelConfigs.create(t)},e.prototype.create=function(){this.addBackground(),this.addKeyboardCallbacks(),this.launchEditorScene()},e.prototype.addBackground=function(){this.background=this.add.image(0,0,"editor",this.levelConfig.background),this.background.setOrigin(.5,1)},e.prototype.addKeyboardCallbacks=function(){this.input.keyboard.once("keydown-R",this.restart,this),this.input.keyboard.once("keydown-T",this.gotoTutorialEditor,this),this.input.keyboard.once("keydown-ESC",this.gotoLevelsMapDev,this)},e.prototype.gotoTutorialEditor=function(){this.scene.start(o.SceneKey.TUTORIAL_EDITOR,{levelNumber:this.levelNumber})},e.prototype.restart=function(){this.game.changeScene(o.SceneKey.LEVEL_EDITOR_ROOT,o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:this.levelNumber})},e.prototype.gotoPrevLevel=function(){this.gotoLevel(this.levelNumber-1)},e.prototype.gotoNextLevel=function(){this.gotoLevel(this.levelNumber+1)},e.prototype.gotoLevel=function(t){var i=this.game.levelConfigs.check(t);if(i===!1){""+t;return}this.scene.start(o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:t})},e.prototype.gotoLevelsMapDev=function(){this.scene.start(o.SceneKey.LEVELS_MAP_DEV)},e.prototype.launchEditorScene=function(){this.editor=this.launchScene(o.SceneKey.LEVEL_EDITOR,this.levelConfig),this.editor.events.on(Phaser.Scenes.Events.CREATE,this.launchEditorGuiScene,this),this.editor.events.on(o.EditorEvent.BACKGROUND_CHANGE,this.onBackgroundChange,this),this.editor.events.on(o.EditorEvent.CONFIG_REMOVE,this.gotoLevelsMapDev,this),this.editor.events.once(o.EditorEvent.TEST_LEVEL,this.testLevelConfig,this),this.editor.events.once(o.EditorEvent.CHANGE_LEVEL,this.gotoLevel,this),this.editor.events.once(o.EditorEvent.GOTO_TUTORIAL_EDITOR,this.gotoTutorialEditor,this)},e.prototype.launchEditorGuiScene=function(){this.editorGui=this.launchScene(o.SceneKey.LEVEL_EDITOR_GUI,{levelConfig:this.levelConfig}),this.editorGui.events.on(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this)},e.prototype.onGuiCreated=function(){this.editor.gui=this.editorGui,this.editor.onGuiCreated(),this.editorGui.saveButton.on(h.RELEASE,this.onSaveButtonClick,this),this.editorGui.levelLabel.nextLevelButton.once(h.PRESS,this.gotoNextLevel,this),this.editorGui.levelLabel.prevLevelButton.once(h.PRESS,this.gotoPrevLevel,this),this.resize()},e.prototype.onSaveButtonClick=function(t,i){i.event.shiftKey?this.editor.saveLevelConfigAs():this.editor.saveLevelConfig()},e.prototype.onBackgroundChange=function(t){this.background.setFrame(t),this.background.setOrigin(.5,1)},e.prototype.testLevelConfig=function(t){this.scene.start(o.SceneKey.GAMEPLAY_ROOT,t)},e.prototype.launchScene=function(t,i){return this.scene.launch(t,i).get(t)},e.prototype.resize=function(){this.resizeBackground(),this.editorGui.doResize(),this.editor.doResize()},e.prototype.resizeBackground=function(){this.background.envelop(o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.GAME_HEIGHT},e.prototype.shutdown=function(){this.editor&&(this.scene.stop(this.editor.scene.key),this.editor.events.off(Phaser.Scenes.Events.CREATE,this.launchEditorGuiScene,this),this.editor.events.off(o.EditorEvent.BACKGROUND_CHANGE,this.onBackgroundChange,this),this.editor.events.off(o.EditorEvent.CONFIG_REMOVE,this.gotoLevelsMapDev,this),this.editor.events.off(o.EditorEvent.TEST_LEVEL,this.testLevelConfig,this),this.editor.events.off(o.EditorEvent.CHANGE_LEVEL,this.gotoLevel,this),this.editor.events.off(o.EditorEvent.GOTO_TUTORIAL_EDITOR,this.gotoTutorialEditor,this)),this.editorGui&&(this.scene.stop(this.editorGui.scene.key),this.editorGui.events.off(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this))},e}(Phaser.Scene);o.EditorRoot=r})(game||(game={}));var game;(function(o){var h;(function(n){})(h=o.MapEditorPanelEvent||(o.MapEditorPanelEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t,"Levels Map Config")||this;return s.config=i,s.addButtons(),s}return e.prototype.addButtons=function(){this.saveButton=this.panel.addButton({title:"Save"}),this.testButton=this.panel.addButton({title:"Test"})},e}(o.EditorPanel);o.MapEditorPanel=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i._levelNumber=0,i._isSelected=!1,i._levelNumber=t,i.addBack(),i.addText(),i.setSize(i.back.width,i.back.height),i.setInteractive(),i.input.cursor="pointer",i.on(Phaser.Input.Events.GAMEOBJECT_POINTER_WHEEL,i.onPointerWheel,i),i.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,i.onPointerDown,i),i}return Object.defineProperty(n.prototype,"isSelected",{get:function(){return this._isSelected},set:function(e){this._isSelected=e,this._isSelected?this.back.setFrame("LevelMapButtonButtonRed"):this.back.setFrame("LevelMapButtonButtonBlue")},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"levelNumber",{get:function(){return this._levelNumber},enumerable:!1,configurable:!0}),n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","LevelMapButtonButtonBlue"),this.add(this.back)},n.prototype.onPointerWheel=function(e,t,i){var s=this._levelNumber-Phaser.Math.Sign(i);this._levelNumber=Phaser.Math.Clamp(s,1,40),this.setLevelNumber(this._levelNumber)},n.prototype.onPointerDown=function(){this.isSelected=!this.isSelected},n.prototype.addText=function(){this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.LEVELS_MAP_NUMBERS_COMPLETE,this._levelNumber.toString(),34),this.text.align=Phaser.Display.Align.CENTER,this.text.setOrigin(.5,.5),this.text.x=this.back.x,this.text.y=this.back.y-3,this.add(this.text)},n.prototype.setLevelNumber=function(e){this._levelNumber=e,this.text.setText(this._levelNumber.toString())},n}(Phaser.GameObjects.Container);o.LevelsMapEditorLevelIcon=h})(game||(game={}));var game;(function(o){var h=Phaser.Cameras.Controls.FixedKeyControl,r=function(n){__extends(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.lastTapTime=0,t}return e.prototype.init=function(){this.config=this.cache.json.get("levels_map_config"),this.events.once("shutdown",this.shutdown,this),this.config},e.prototype.create=function(){this.addEditorPanel(),this.addMainContainer(),this.addBackgrounds(),this.addLevelIcons(),this.addClouds(),this.setupCamera(),this.addCameraKeyboardControls(),this.addCameraScroll(),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.resize()},e.prototype.addEditorPanel=function(){this.mapEditorPanel=new o.MapEditorPanel(this,this.config),this.mapEditorPanel.saveButton.on("click",this.onSaveButtonClick.bind(this)),this.mapEditorPanel.testButton.on("click",this.onTestButtonClick.bind(this)),this.panelsContainer=document.getElementById("editor-panels"),this.panelsContainer.style.visibility="visible"},e.prototype.onSaveButtonClick=function(){var t=this,i=this.createLevelsMapConfig();if(!i)return;this.cache.json.remove("levels_map_config"),this.cache.json.add("levels_map_config",i),this.config=i,this.config,this.mapEditorPanel.disableInput(),this.uploadConfig(i).then(function(s){s.responseText}).catch(function(s){}).finally(function(){t.mapEditorPanel.enableInput()})},e.prototype.onTestButtonClick=function(){var t=this.createLevelsMapConfig();if(!t)return;this.cache.json.remove("levels_map_config"),this.cache.json.add("levels_map_config",t),this.game.changeScene(o.SceneKey.LEVELS_MAP_EDITOR,o.SceneKey.LEVELS_MAP)},e.prototype.createLevelsMapConfig=function(){var t=this.createLevelIconsConfig(),i=this.validateLevelIconConfig(t);return i.success===!1?(i.errors,null):{backgrounds:__spreadArrays(this.config.backgrounds),level_icons:t,decor:__spreadArrays([this.config.decor.find(function(s){return s.type===o.LevelsMapDecor.FOX_IN_HOLE}),this.config.decor.find(function(s){return s.type===o.LevelsMapDecor.FOX}),this.config.decor.find(function(s){return s.type===o.LevelsMapDecor.FIRE})],this.getCloudsConfigs())}},e.prototype.createLevelIconsConfig=function(){var t=function(s){return{level_number:s.levelNumber,x:Phaser.Math.RoundTo(s.x,-2),y:Phaser.Math.RoundTo(s.y,-2)}},i=this.levelIcons.map(function(s){return t(s)});return i=_.sortBy(i,"level_number"),i},e.prototype.getCloudsConfigs=function(){return this.clouds.map(function(t){return{type:o.LevelsMapDecor.CLOUD,frame:t.frame.name,x:t.x,y:t.y}})},e.prototype.validateLevelIconConfig=function(t){var i={success:!0,errors:[]},s=_.countBy(t,"level_number");for(var a in s){if(s.hasOwnProperty(a)===!1)continue;var l=s[a];l>1&&(i.success=!1,i.errors.push("Check level number = "+a+". There are "+l+" instances of it."))}return i},e.prototype.uploadConfig=function(t){var i=this;return new Promise(function(s,a){var l={filename:"levels_map.json",content:JSON.stringify(t)},c=o.Config.SERVER_URL+"upload.php",u=new XMLHttpRequest;u.open("POST",c,!0),u.onload=function(){s(u)},u.onerror=function(){a(u)},u.send(i.convertObjectToURLSearchParams(l))})},e.prototype.convertObjectToURLSearchParams=function(t){return new URLSearchParams(t)},e.prototype.addMainContainer=function(){this.mainContainer=this.add.container(0,0),this.mainContainer.name="main_container"},e.prototype.addBackgrounds=function(){var t=this;this.backgrounds=this.config.backgrounds.map(function(i,s){var a=t.add.image(0,0,i);return a.setOrigin(0,0),a.y=a.height*s,t.mainContainer.add(a),a})},e.prototype.addLevelIcons=function(){var t=this;this.levelIcons=[],this.config.level_icons.forEach(function(i){t.doAddLevelIcon(i.level_number,i.x,i.y)})},e.prototype.addClouds=function(){var t=this;this.clouds=[],this.config.decor.filter(function(i){return i.type===o.LevelsMapDecor.CLOUD}).forEach(function(i){t.doAddCloud(i.x,i.y,i.frame)})},e.prototype.setupCamera=function(){this.camera=this.cameras.main},e.prototype.addCameraKeyboardControls=function(){var t=this.input.keyboard.createCursorKeys();this.cameraControl=new h({camera:this.camera,left:t.left,right:t.right,up:t.up,down:t.down,speed:4})},e.prototype.addCameraScroll=function(){var t=this;this.cameraScroll=new o.KineticScroll(this,{kineticMovement:!0,timeConstantScroll:300,horizontalScroll:!1,verticalScroll:!0}),this.input.on("pointerup",function(){t.cameraScroll.endMove()}),this.input.on("pointermove",function(i){t.cameraScroll.move(i)})},e.prototype.addPointerCallbacks=function(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on("drag",function(t,i,s,a){i.x=s,i.y=a})},e.prototype.onPointerDown=function(t,i){var s=Date.now();if(i.length>0){this.lastTapTime=s;return}this.cameraScroll.beginMove(t);var a=s-this.lastTapTime;a<300&&this.addLevelIcon(),this.lastTapTime=s},e.prototype.addKeyboardCallbacks=function(){this.input.keyboard.on("keydown-PLUS",this.addLevelIcon,this),this.input.keyboard.on("keydown-DELETE",this.onDeleteKeyPress,this),this.input.keyboard.on("keydown-HOME",this.scrollToTop,this),this.input.keyboard.on("keydown-END",this.scrollToBottom,this),this.input.keyboard.on("keydown-F",this.addFire,this),this.input.keyboard.on("keydown-C",this.addCloudByKey,this)},e.prototype.addCloudByKey=function(){var t=this.input.activePointer.positionToCamera(this.camera);this.doAddCloud(t.x,t.y)},e.prototype.doAddCloud=function(t,i,s){var a=this.add.image(0,0,"levels_map",s||e.CLOUD_FRAMES[0]);return a.x=t,a.y=i,a.setInteractive(),a.on(Phaser.Input.Events.GAMEOBJECT_POINTER_WHEEL,this.onCloudPointerWheel.bind(this,a)),this.input.setDraggable(a),this.mainContainer.add(a),this.clouds.push(a),a},e.prototype.onCloudPointerWheel=function(t,i,s,a){var l=t.frame.name,c=e.CLOUD_FRAMES.indexOf(l),u=c+Phaser.Math.Sign(a);u=Phaser.Math.Wrap(u,0,e.CLOUD_FRAMES.length),t.setFrame(e.CLOUD_FRAMES[u])},e.prototype.addFire=function(){},e.prototype.addLevelIcon=function(){var t={x:this.input.activePointer.worldX,y:this.input.activePointer.worldY},i=this.mainContainer.pointToContainer(t),s=Math.max.apply(Math,__spreadArrays(this.levelIcons.map(function(a){return a.levelNumber}),[0]))+1;this.doAddLevelIcon(s,i.x,i.y)},e.prototype.doAddLevelIcon=function(t,i,s){var a=new o.LevelsMapEditorLevelIcon(this,t);return a.x=i,a.y=s,this.input.setDraggable(a),this.mainContainer.add(a),this.levelIcons.push(a),a},e.prototype.onDeleteKeyPress=function(){var t=this;this.getSelectedLevelIcons().forEach(function(i){i.destroy(),_.pull(t.levelIcons,i)})},e.prototype.getSelectedLevelIcons=function(){return this.levelIcons.filter(function(t){return t.isSelected})},e.prototype.scrollToTop=function(){this.camera.scrollY=0},e.prototype.scrollToBottom=function(){this.camera.scrollY=this.camera.getBounds().height},e.prototype.update=function(t,i){this.cameraScroll.update(),this.cameraControl.update(i)},e.prototype.resize=function(){this.resizeMainContainer(),this.updateCameraBounds()},e.prototype.resizeMainContainer=function(){this.mainContainer.scale=o.Config.GAME_WIDTH/this.backgrounds[0].width},e.prototype.updateCameraBounds=function(){var t=Phaser.Display.Bounds.GetTop(this.backgrounds[0]),i=Phaser.Display.Bounds.GetBottom(this.backgrounds[this.backgrounds.length-1]),s=i-t;this.camera.setBounds(0,0,o.Config.GAME_WIDTH,s*this.mainContainer.scale)},e.prototype.shutdown=function(){this.destroyPanels()},e.prototype.destroyPanels=function(){this.panelsContainer.style.visibility="hidden",this.panelsContainer=null,this.mapEditorPanel&&this.mapEditorPanel.destroy()},e.CLOUD_FRAMES=["decor/Clouds/cloud_1_01","decor/Clouds/cloud_1_02","decor/Clouds/cloud_1_03","decor/Clouds/cloud_2_01","decor/Clouds/cloud_2_02","decor/Clouds/cloud_2_03","decor/Clouds/cloud_3_01","decor/Clouds/cloud_3_02","decor/Clouds/cloud_3_03"],e}(Phaser.Scene);o.LevelsMapEditor=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,"editor","level_icon_back")||this;return i.name="level_icon",i.levelNumber=t,i.addBitmapText(t.toString(),o.BitmapGameFont.EDITOR_ROW_NUMBERS,32,-1,-4),i.addTutorialIcon(),i}return n.prototype.addTutorialIcon=function(){var e=this.scene.game.levelConfigs.get(this.levelNumber),t=e.tutorial;if(!t)return;var i=this.scene.add.image(0,0,"editor","tutorial_icon");this.add(i),Phaser.Display.Align.In.BottomRight(i,this.back,-15,-15)},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.height},n}(Phaser.GameObjects.ComplexButton);o.LevelIconDev=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.prototype.init=function(){this.events.once("shutdown",this.shutdown,this)},n.prototype.create=function(){this.addBackground(),this.addBackButton(),this.addLevelIcons(),this.addNewLevelButton(),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.resize()},n.prototype.addBackground=function(){this.background=this.add.image(0,0,"editor","background_1"),this.background.setScrollFactor(0,0)},n.prototype.addBackButton=function(){this.backButton=this.add.button("editor","button_close"),this.backButton.once(Phaser.GameObjects.ButtonEvent.PRESS,this.gotoLevelsMap,this),this.backButton.setScrollFactor(0,0)},n.prototype.gotoLevelsMap=function(){this.game.changeScene(this.scene.key,o.SceneKey.LEVELS_MAP)},n.prototype.addLevelIcons=function(){var e=this.game.levelConfigs.getLevelNumbers();this.levelIcons=this.createLevelIcons(e),this.levelIconsContainer=this.add.container(0,0,this.levelIcons)},n.prototype.createLevelIcons=function(e){var t=this;return e.map(function(i){var s=new o.LevelIconDev(t,i);return s.once(Phaser.GameObjects.ButtonEvent.PRESS,t.onLevelIconClick,t),s})},n.prototype.onLevelIconClick=function(e){var t=e.levelNumber;this.shiftKey.isDown?this.tryToRemoveLevelConfig(t):this.tKey.isDown?this.gotoTutorialEditor(t):this.editLevel(t)},n.prototype.gotoTutorialEditor=function(e){this.game.changeScene(this.scene.key,o.SceneKey.TUTORIAL_EDITOR,{levelNumber:e})},n.prototype.tryToRemoveLevelConfig=function(e){var t=window.confirm("Do you want to delete level "+e+" config?");t&&(this.shiftKey.reset(),this.removeLevelConfig(e))},n.prototype.removeLevelConfig=function(e){var t=this;this.levelIconsContainer.alpha=.66,this.levelIcons.forEach(function(i){return i.disableInput()}),this.game.levelConfigs.remove(e),this.game.levelConfigs.saveLocally(),this.game.levelConfigs.saveRemotely().then(function(){""+e,t.onConfigRemoved(e)}).catch(function(i){""+e}).finally(function(){t.levelIconsContainer.alpha=1,t.levelIcons.forEach(function(i){return i.enableInput()})})},n.prototype.onConfigRemoved=function(e){var t=this.levelIcons.findIndex(function(i){return i.levelNumber===e});t>-1&&(this.levelIcons[t].destroy(),this.levelIcons.splice(t,1),this.alignIcons(),this.alignNewLevelButton())},n.prototype.editLevel=function(e){this.scene.start(o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:e})},n.prototype.addNewLevelButton=function(){this.newLevelButton=this.add.button("editor","add_level_button"),this.newLevelButton.on(Phaser.GameObjects.ButtonEvent.RELEASE,this.onNewLevelClick,this)},n.prototype.onNewLevelClick=function(){var e=Math.max.apply(Math,__spreadArrays(this.game.levelConfigs.getLevelNumbers(),[0]))+1,t=window.prompt("Enter new level number",e.toString());if(!t)return;var i=parseInt(t);if(!i)return;var s=this.game.levelConfigs.check(i);if(s){""+t;return}this.editLevel(i)},n.prototype.addPointerCallbacks=function(){this.input.on(Phaser.Input.Events.POINTER_WHEEL,this.onPointerWheel,this)},n.prototype.onPointerWheel=function(e,t,i,s){this.cameras.main.scrollY+=s},n.prototype.addKeyboardCallbacks=function(){this.input.keyboard.on("keydown-R",this.restart,this),this.input.keyboard.on("keydown-PLUS",this.onNewLevelClick,this),this.input.keyboard.on("keydown-M",this.gotoLevelsMap,this),this.input.keyboard.on("keydown-SPACE",this.gotoLastExistingLevel,this),this.shiftKey=this.input.keyboard.addKey("shift"),this.tKey=this.input.keyboard.addKey("T")},n.prototype.restart=function(){this.game.changeScene(this.scene.key,o.SceneKey.LEVELS_MAP_DEV)},n.prototype.gotoLastExistingLevel=function(){var e=Math.max.apply(Math,this.game.levelConfigs.getLevelNumbers());this.editLevel(e)},n.prototype.resize=function(){this.alignBackground(),this.alignBackButton(),this.alignIcons(),this.alignNewLevelButton()},n.prototype.alignBackground=function(){this.background.envelop(o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},n.prototype.alignBackButton=function(){var e=50;this.backButton.x=o.Config.GAME_WIDTH-e,this.backButton.y=e},n.prototype.alignIcons=function(){this.gridAlignIcons(),this.scaleIcons()},n.prototype.gridAlignIcons=function(){if(this.levelIcons.length===0)return;this.levelIconsContainer.gridAlign({cellWidth:120,width:5,position:Phaser.Display.Align.CENTER,x:this.levelIcons[0].getWidth()/2,y:this.levelIcons[0].getHeight()/2})},n.prototype.scaleIcons=function(){var e=o.Config.GAME_WIDTH*.8,t=this.levelIconsContainer.getBounds().width,i=Math.min(1,e/t);this.levelIconsContainer.scale=i,this.levelIconsContainer.x=(o.Config.GAME_WIDTH-this.levelIconsContainer.getBounds().width)/2,this.levelIconsContainer.y=70},n.prototype.alignNewLevelButton=function(){var e=this.levelIconsContainer.y+this.levelIconsContainer.getBounds().height;this.newLevelButton.scale=this.levelIconsContainer.scale,this.newLevelButton.x=o.Config.HALF_GAME_WIDTH,this.newLevelButton.y=e+this.newLevelButton.displayHeight/2+20*this.newLevelButton.scale},n.prototype.shutdown=function(){},n}(Phaser.Scene);o.LevelsMapDev=h})(game||(game={}));var game;(function(o){var h=Phaser.Actions.GridAlign,r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.name="stars",i.addStars(),i.alignStars(),i.finetuneAligment(),i}return e.prototype.addStars=function(){var t=this;this.stars=_.times(3,function(i){return t.scene.add.image(0,0,"levels_map","small_star")}),this.add(this.stars)},e.prototype.alignStars=function(){var t=41;h(this.stars,{height:1,width:this.stars.length,position:Phaser.Display.Align.TOP_CENTER,cellWidth:t,x:-(this.stars.length*t)/2+this.stars[0].width/2})},e.prototype.finetuneAligment=function(){var t=30;this.stars[0].angle=-t,this.stars[2].angle=t,this.stars[1].y-=11.2},e.prototype.setActiveNum=function(t){this.stars.forEach(function(i,s){var a=s<t?"small_star":"small_star_inactive",l=s<t?1:.66;i.setFrame(a),i.alpha=l})},e}(Phaser.GameObjects.Container);o.LevelIconStars=r})(game||(game={}));var game;(function(o){var h;(function(n){n.LOCKED="LOCKED",n.UNLOCKED="UNLOCKED",n.COMPLETE="COMPLETE"})(h=o.LevelIconState||(o.LevelIconState={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t)||this;return s.iconData=i,s.name="level_icon_"+s.iconData.levelNumber.toString(),s._levelNumber=s.iconData.levelNumber,s.addBack(),s.addUnlockedText(),s.addCompleteText(),s.addStars(),s.setSize(s.back.width,s.back.height),s.setInitialState(),s}return Object.defineProperty(e.prototype,"levelNumber",{get:function(){return this._levelNumber},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"iconState",{get:function(){return this._iconState},enumerable:!1,configurable:!0}),e.prototype.setInitialState=function(){this.iconData.locked?this.setLocked():this.iconData.complete?this.setComplete():this.setUnlocked()},e.prototype.setLocked=function(){this._iconState=h.LOCKED,this.back.setFrame("LevelMapButtonButtonLocked"),this.completeText.visible=!1,this.unlockedText.visible=!1,this.stars.visible=!1,this.removeInteractive()},e.prototype.setUnlocked=function(){this._iconState=h.UNLOCKED,this.back.setFrame("LevelMapButtonButtonRed"),this.stars.visible=!1,this.completeText.visible=!1,this.unlockedText.visible=!0,this.setInteractive(),this.input.cursor="pointer"},e.prototype.setComplete=function(){this._iconState=h.COMPLETE,this.back.setFrame("LevelMapButtonButtonBlue"),this.stars.visible=!0,this.unlockedText.visible=!1,this.completeText.visible=!0,this.setInteractive(),this.input.cursor="pointer"},e.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","LevelMapButtonButtonBlue"),this.add(this.back)},e.prototype.addUnlockedText=function(){this.unlockedText=this.scene.add.bitmapText(0,0,o.BitmapGameFont.LEVELS_MAP_NUMBERS_UNLOCKED,this._levelNumber.toString(),32),this.unlockedText.setOrigin(.5,.5),this.unlockedText.x=this.back.x,this.unlockedText.y=this.back.y-4,this.add(this.unlockedText)},e.prototype.addCompleteText=function(){this.completeText=this.scene.add.bitmapText(0,0,o.BitmapGameFont.LEVELS_MAP_NUMBERS_COMPLETE,this._levelNumber.toString(),32),this.completeText.setOrigin(.5,.5),this.completeText.x=this.unlockedText.x,this.completeText.y=this.unlockedText.y,this.add(this.completeText)},e.prototype.addStars=function(){this.stars=new o.LevelIconStars(this.scene),this.stars.x=1,this.stars.y=this.back.y-this.back.height/2-11,this.stars.setActiveNum(this.iconData.stars),this.add(this.stars)},e}(Phaser.GameObjects.Container);o.LevelIcon=r})(game||(game={}));var game;(function(o){var h;(function(n){n.EXPLODE="explode"})(h=o.LevelCompleteStarEvent||(o.LevelCompleteStarEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t)||this;return c._isActive=!0,c.isTwinklingEnabled=!0,c.name="star",c.inactiveStar=c.scene.add.image(0,0,i,a),c.activeStar=c.scene.add.image(0,0,i,s),c.whiteStar=c.scene.add.image(0,0,i,l).setVisible(!1),c.hideActiveStar(),c.add(c.inactiveStar),c.add(c.activeStar),c.add(c.whiteStar),c}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),e.prototype.showActiveStar=function(){this.activeStar.visible=!0,this.activeStar.active=!0,this._isActive=!0},e.prototype.hideActiveStar=function(){this.activeStar.visible=!1,this.activeStar.active=!1,this._isActive=!1},e.prototype.tweenActiveStar=function(t){var i=this;this.activeStar.alpha=0,this.scene.tweens.add({targets:this.activeStar,delay:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.activeStar.scale=2.5,this.scene.tweens.add({targets:this.activeStar,delay:t,duration:400,ease:Phaser.Math.Easing.Cubic.Out,scale:1,onStart:function(){i.parentContainer.bringToTop(i)},onComplete:function(){i.inactiveStar.visible=!1}}),this.scene.time.delayedCall(t+300,function(){i.emit(h.EXPLODE,i),i.showWhiteStar()})},e.prototype.showWhiteStar=function(){var t=this;this.whiteStar.visible=!0,this.whiteStar.alpha=.4,this.scene.tweens.add({targets:this.whiteStar,scale:{value:1.55,duration:400,ease:Phaser.Math.Easing.Linear.Linear},alpha:{value:0,duration:400,ease:Phaser.Math.Easing.Cubic.Out},onComplete:function(){t.whiteStar.visible=!1,t.whiteStar.scale=1,t.twinkle()}})},e.prototype.twinkle=function(){if(!this.isTwinklingEnabled)return;this.scene.time.addEvent({delay:3e3,startAt:2300,loop:!0,callback:this.doTwinkle,callbackScope:this})},e.prototype.doTwinkle=function(){this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Sine.InOut,scale:this.scale*1.17,yoyo:!0}),this.twinkleWhiteStar()},e.prototype.twinkleWhiteStar=function(){var t=this;this.whiteStar.visible=!0,this.whiteStar.alpha=0,this.scene.tweens.add({targets:this.whiteStar,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:.33,onComplete:function(){t.scene.tweens.add({targets:t.whiteStar,duration:400,ease:Phaser.Math.Easing.Cubic.In,alpha:0,onComplete:function(){t.whiteStar.visible=!1}})}})},e}(Phaser.GameObjects.Container);o.LevelCompleteStar=r})(game||(game={}));var game;(function(o){var h;(function(n){n.ANIMATION_COMPLETE="animation_complete"})(h=o.LevelCompleteStarsEvent||(o.LevelCompleteStarsEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t)||this;return s.SIDE_STAR_ANGLE=15,s.SIDE_STAR_SCALE=.8,s.SIDE_STAR_X_OFFSET=140,s.SIDE_STAR_Y=26,s.activeStarsNum=0,s.starsExploded=0,s.name="stars",s.props=i,s.addStars(),s}return e.prototype.addStars=function(){this.leftStar=new o.LevelCompleteStar(this.scene,this.props.atlas,this.props.activeStarFrame,this.props.inactiveStarFrame,this.props.whiteStarFrame),this.leftStar.angle=-this.SIDE_STAR_ANGLE,this.leftStar.scale=this.SIDE_STAR_SCALE,this.leftStar.x=-this.SIDE_STAR_X_OFFSET,this.leftStar.y=this.SIDE_STAR_Y,this.centralStar=new o.LevelCompleteStar(this.scene,this.props.atlas,this.props.activeStarFrame,this.props.inactiveStarFrame,this.props.whiteStarFrame),this.rightStar=new o.LevelCompleteStar(this.scene,this.props.atlas,this.props.activeStarFrame,this.props.inactiveStarFrame,this.props.whiteStarFrame),this.rightStar.angle=this.SIDE_STAR_ANGLE,this.rightStar.scale=this.SIDE_STAR_SCALE,this.rightStar.x=this.SIDE_STAR_X_OFFSET,this.rightStar.y=this.SIDE_STAR_Y,this.allStars=[this.leftStar,this.centralStar,this.rightStar],this.add(this.allStars),this.bringToTop(this.centralStar)},e.prototype.updateData=function(t){this.activeStarsNum=t},e.prototype.showActiveStarsInstant=function(){var t=this;this.allStars.forEach(function(i,s){s<t.activeStarsNum?i.showActiveStar():i.hideActiveStar()})},e.prototype.showActiveStars=function(t){var i=this;this.activeStarsNum===0&&this.emit(h.ANIMATION_COMPLETE,this),this.allStars.forEach(function(s,a){if(a<i.activeStarsNum){var l=t+a*300;i.playStarSound(a,l),s.on(o.LevelCompleteStarEvent.EXPLODE,i.onStarExplode,i),s.showActiveStar(),s.tweenActiveStar(l)}})},e.prototype.playStarSound=function(t,i){var s="level_complete_star_show"+(t+1),a=(i+300)/1e3;this.scene.cache.audio.has(s)&&this.scene.sound.play(s,{volume:1,delay:a})},e.prototype.onStarExplode=function(t){if(this.explodeEmitter){var i=t.getWorldTransformMatrix();this.explodeEmitter.explode(16,i.tx,i.ty)}++this.starsExploded===this.activeStarsNum&&this.emit(h.ANIMATION_COMPLETE,this)},e.prototype.addEmitter=function(t,i,s){this.manager=this.scene.add.particles(t),this.manager.setDepth(s),this.explodeEmitter=this.manager.createEmitter({emitZone:{source:new Phaser.Geom.Circle(0,0,60),type:"random"},frame:i,speed:25,scale:{start:.75,end:.15,ease:Phaser.Math.EasingString.Cubic},alpha:{start:.75,end:0,ease:Phaser.Math.EasingString.Cubic},lifespan:2e3,on:!1})},e.prototype.startFloating=function(){var t=this;this.allStars.forEach(function(i,s){t.scene.tweens.add({targets:i,duration:800,delay:s*200,ease:Phaser.Math.Easing.Sine.InOut,y:"-=14",yoyo:!0,repeat:-1})})},e}(Phaser.GameObjects.Container);o.LevelCompleteStars=r})(game||(game={}));var game;(function(o){var h;o.ITEM_TYPE="item_type";var r;(function(e){e.TRIANGLE="triangle",e.BASIC_BLOCK="basic_block",e.DYNAMITE_BLOCK="dynamite_block",e.ICE_BLOCK="ice_block",e.ICE_RHOMB="ice_rhomb",e.ICE_OCTAGON="ice_octagon",e.PINATA_BLOCK="pinata_block",e.SHATTER_BLOCK="shatter_block",e.SHATTER_BLOCK_PIECE="shatter_block_piece",e.LIGHTNING="lightning",e.COLLECTABLE_BALL="collectable_ball",e.SPINNER="spinner"})(r=o.ItemType||(o.ItemType={}));var n=function(){function e(){}return e.getAllTypes=function(){return Object.values(r)},e.isBlockType=function(t){return e.getBlockTypes().includes(t)},e.getBlockTypes=function(){return e.BLOCK_TYPES},e.getFrameName=function(t){return e.FRAMES_MAP[t]},e.isBlock=function(t){return e.isBlockType(t.itemType)},e.BLOCK_TYPES=[r.BASIC_BLOCK,r.TRIANGLE,r.DYNAMITE_BLOCK,r.ICE_BLOCK,r.ICE_RHOMB,r.ICE_OCTAGON,r.PINATA_BLOCK,r.SHATTER_BLOCK,r.SHATTER_BLOCK_PIECE],e.FRAMES_MAP=(h={},h[r.BASIC_BLOCK]="blocks/basic_block_01",h[r.SHATTER_BLOCK]="blocks/shatter_block_02",h[r.SHATTER_BLOCK_PIECE]="blocks/shatter_block_02_left",h[r.TRIANGLE]="blocks/triangle_01",h[r.ICE_BLOCK]="blocks/ice_block",h[r.ICE_RHOMB]="blocks/ice_romb",h[r.ICE_OCTAGON]="blocks/ice_octagon",h[r.PINATA_BLOCK]="blocks/pinata_block",h[r.DYNAMITE_BLOCK]="blocks/dynamite_block",h[r.SPINNER]="spinner/spinner0001",h[r.LIGHTNING]="lightning/lightning0001",h[r.COLLECTABLE_BALL]="ball_collectable",h),e}();o.ItemTypeUtil=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="blocks_label",t.addBack(),t.addBlock(),t.addText(),t.align(),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","popup/label_back"),this.add(this.back)},n.prototype.addBlock=function(){this.block=this.scene.add.image(0,0,"levels_map","popup/blocks/basic_block_01"),this.add(this.block)},n.prototype.addText=function(){var e=this.getTextContent(0),t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"36px",color:"#B72C35",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.add(this.text)},n.prototype.getTextContent=function(e){return this.scene.texts.start_level_popup.task.replace("#",e.toString())},n.prototype.align=function(){this.block.x=this.back.left+this.block.width/2+20,this.block.y=this.back.getCenter().y,this.alignText()},n.prototype.alignText=function(){var e=this.block.right,t=this.back.right,i=t-e;this.text.setWordWrapWidth(i*.75),this.text.x=e+i/2,this.text.y=this.back.getCenter().y},n.prototype.updateData=function(e,t){this.block.setFrame(this.getBlockFrame(e)),this.text.text=this.getTextContent(t)},n.prototype.getBlockFrame=function(e){var t,i="popup/blocks/",s=(t={},t[o.ItemType.BASIC_BLOCK]=i+"basic_block_01",t[o.ItemType.TRIANGLE]=i+"triangle_01",t[o.ItemType.ICE_BLOCK]=i+"ice_block",t[o.ItemType.PINATA_BLOCK]=i+"pinata_block",t[o.ItemType.DYNAMITE_BLOCK]=i+"dynamite_block_3",t);return s[e]||s[o.ItemType.BASIC_BLOCK]},n.prototype.getHeight=function(){return this.back.height},n.prototype.getWidth=function(){return this.back.width},n}(Phaser.GameObjects.Container);o.StartLevelPopupBlocksLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="popup",t.addBack(),t.addBanner(),t.addFoxBody(),t.addBlocksLabel(),t.addFoxPaws(),t.addTick(),t.addHighscore(),t.addCloseButton(),t.addFirefly(),t.align(),t.bringToTop(t.highscore),t.bringToTop(t.banner),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","popup/popup_back"),this.add(this.back)},n.prototype.addBanner=function(){var e=this.scene.make.image({key:"levels_map",frame:"popup/banner",add:!1}),t=360;this.bannerText=this.createBannerText(),this.bannerText.setOrigin(.5,.5),this.bannerText.scale=Math.min(1,t/this.bannerText.width),this.bannerText.y=-34,this.bannerText.name="title",this.banner=this.scene.add.container(0,0,[e,this.bannerText]),this.add(this.banner)},n.prototype.createBannerText=function(){var e=this.scene.make.text({add:!1,text:this.getBannerContent(1),style:{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"52px",color:"#FAD353",align:"center"}});return e.setShadow(0,4,"rgba(0,0,0,0.15)"),e},n.prototype.getBannerContent=function(e){var t=this.scene.texts.start_level_popup.title;return t.replace("#",e.toString())},n.prototype.addFoxBody=function(){this.foxBody=this.scene.add.image(0,0,"levels_map","popup/Fox"),this.add(this.foxBody)},n.prototype.addBlocksLabel=function(){this.blocksLabel=new o.StartLevelPopupBlocksLabel(this.scene),this.add(this.blocksLabel)},n.prototype.addFoxPaws=function(){this.foxPaws=this.scene.add.image(0,0,"levels_map","popup/FoxPaws"),this.add(this.foxPaws)},n.prototype.addTick=function(){this.tick=this.scene.add.image(0,0,"levels_map","popup/tick"),this.add(this.tick)},n.prototype.addHighscore=function(){this.highscoreBack=this.scene.add.image(0,0,"levels_map","popup/highscore_label_back"),this.add(this.highscoreBack);var e=this.getHighscoreContent(0),t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"33px",color:"#ECD397",align:"center"};this.highscore=this.scene.add.text(0,0,e,t),this.highscore.setOrigin(.5,.5),this.add(this.highscore)},n.prototype.getHighscoreContent=function(e){var t=this.scene.texts.start_level_popup.highscore;return t.replace("#",e.toLocaleString())},n.prototype.addCloseButton=function(){this.closeButton=this.scene.add.button("levels_map","popup/button_close",this),this.closeButton.setScrollFactor(0,0)},n.prototype.addFirefly=function(){this.scene.anims.create({key:"firefly",repeat:-1,frames:this.scene.anims.getFrameNames("levels_map","decor/firefly/firefly"),frameRate:24}),this.firefly=this.scene.add.sprite(0,0,"levels_map","decor/firefly/firefly0002"),this.firefly.play("firefly"),this.firefly.scale=.66,this.add(this.firefly),this.scene.tweens.add({targets:this.firefly,duration:400,ease:Phaser.Math.Easing.Sine.InOut,y:"+=8",repeat:-1,yoyo:!0}),this.scene.tweens.add({targets:this.firefly,duration:600,ease:Phaser.Math.Easing.Sine.InOut,x:"+=8",repeat:-1,yoyo:!0})},n.prototype.align=function(){this.alignBanner(),this.alignBlocksLabel(),this.alignTick(),this.alignFox(),this.alignHighscore(),this.alignCloseButton(),this.alignFirefly()},n.prototype.alignFirefly=function(){var e=Phaser.Display.Align,t=45,i=Phaser.Math.RND.bool()?e.TOP_LEFT:e.TOP_RIGHT;Phaser.Display.Align.In.QuickSet(this.firefly,this.back,i,-t,-t)},n.prototype.alignBanner=function(){this.banner.y=this.back.top-6},n.prototype.alignBlocksLabel=function(){Phaser.Display.Align.In.Center(this.blocksLabel,this.back,0,16)},n.prototype.alignTick=function(){this.tick.x=this.blocksLabel.x+this.blocksLabel.getWidth()/2-7,this.tick.y=this.blocksLabel.y+this.blocksLabel.getHeight()/2-14},n.prototype.alignFox=function(){Phaser.Display.Align.To.TopCenter(this.foxBody,this.blocksLabel),this.foxBody.x=this.blocksLabel.x,this.foxPaws.x=this.foxBody.x-1,this.foxPaws.y=this.foxBody.y},n.prototype.alignHighscore=function(){Phaser.Display.Align.In.BottomCenter(this.highscoreBack,this.back,0,-57),Phaser.Display.Align.In.Center(this.highscore,this.highscoreBack,0,0)},n.prototype.alignCloseButton=function(){var e=this.closeButton.width/2-6;Phaser.Display.Align.In.TopRight(this.closeButton,this.back,e,e)},n.prototype.updateData=function(e){this.bannerText.text=this.getBannerContent(e.levelNumber),this.blocksLabel.updateData(e.blocksType,e.blocksNum),this.tick.visible=e.levelComplete,this.highscore.text=e.levelComplete?this.getHighscoreContent(e.highscore):this.getHighscoreContent(0)},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.displayHeight},n}(Phaser.GameObjects.Container);o.StartLevelPopup=h})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ButtonEvent,r;(function(e){e.SHOW="show",e.HIDE="hide"})(r=o.StartLevelScreenEvent||(o.StartLevelScreenEvent={}));var n=function(e){__extends(t,e);function t(i){var s=e.call(this,i)||this;return s.backgroundAlpha=.75,s.levelNumber=1,s.name="start_level_screen",s.addBack(),s.addStars(),s.addPopup(),s.addPlayButton(),s.bringToTop(s.popup),s}return t.prototype.addBack=function(){this.background=this.scene.add.image(0,0,"levels_map","black_rect"),this.background.alpha=this.backgroundAlpha,this.add(this.background)},t.prototype.addStars=function(){var i={atlas:"levels_map",activeStarFrame:"popup/star_with_glow",inactiveStarFrame:"popup/star_inactive",whiteStarFrame:"popup/star_white"};this.stars=new o.LevelCompleteStars(this.scene,i),this.stars.startFloating(),this.add(this.stars)},t.prototype.addPopup=function(){this.popup=new o.StartLevelPopup(this.scene),this.popup.closeButton.on(h.RELEASE,this.hide,this),this.add(this.popup)},t.prototype.addPlayButton=function(){this.playButton=this.scene.add.button("levels_map","popup/button_play",this),this.playButton.setScrollFactor(0,0)},t.prototype.resize=function(){this.resizeBackground(),this.alignPopup(),this.alignStars(),this.alignPlayButton()},t.prototype.resizeBackground=function(){this.background.setDisplaySize(o.Config.GAME_WIDTH+4,o.Config.GAME_HEIGHT+4),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},t.prototype.alignPopup=function(){var i=o.Config.GAME_WIDTH*.8,s=o.Config.GAME_HEIGHT*.42,a=i/this.popup.getWidth(),l=s/this.popup.getHeight();this.popup.scale=Math.min(a,l),this.popup.x=o.Config.HALF_GAME_WIDTH,this.popup.y=o.Config.HALF_GAME_HEIGHT},t.prototype.alignStars=function(){var i=this.popup.y-this.popup.getHeight()*this.popup.scale/2;this.stars.scale=this.popup.scale,this.stars.x=o.Config.HALF_GAME_WIDTH,this.stars.y=i-200*this.popup.scale},t.prototype.alignPlayButton=function(){var i=this.popup.y+this.popup.getHeight()*this.popup.scale/2;this.playButton.scale=this.popup.scale,this.playButton.x=o.Config.HALF_GAME_WIDTH,this.playButton.y=i+this.playButton.displayHeight/2+50*this.playButton.scale},t.prototype.updateData=function(i){this.levelNumber=i.levelNumber,this.stars.updateData(i.stars),this.stars.showActiveStarsInstant(),this.popup.updateData(i)},t.prototype.kill=function(){this.visible=!1,this.active=!1},t.prototype.revive=function(){this.visible=!0,this.active=!0},t.prototype.show=function(){this.emit(r.SHOW,this),this.alpha=1,this.revive(),this.resize(),this.showBackground(),this.showItems(0)},t.prototype.showBackground=function(){this.background.alpha=0,this.scene.tweens.add({targets:this.background,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.backgroundAlpha})},t.prototype.showItems=function(i){var s=this;i===void 0&&(i=0),[this.stars,this.popup,this.playButton].forEach(function(a,l){var c=l*i;a.alpha=0,s.scene.tweens.add({delay:c,targets:a,alpha:{value:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200}});var u=a.scale;a.scale=u*.85,s.scene.tweens.add({delay:c,targets:a,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.45],scale:u})})},t.prototype.hide=function(){var i=this;this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){i.kill(),i.emit(r.HIDE,i)}})},t.prototype.destroy=function(i){e.prototype.destroy.call(this,i)},t}(Phaser.GameObjects.Container);o.StartLevelScreen=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.originalX=0,t.originalY=0,t.name="fire",t.base=t.scene.add.image(0,0,"levels_map","decor/fire_base"),t.flame=t.scene.add.image(0,0,"levels_map","decor/fire_flame"),t.add([t.base,t.flame]),t.animateFlame(),t}return n.prototype.animateFlame=function(){this.flame.angle=-4,this.scene.tweens.add({targets:this.flame,duration:900,ease:Phaser.Math.Easing.Sine.InOut,angle:Math.abs(this.flame.angle),repeat:-1,yoyo:!0}),this.scene.tweens.add({targets:this.flame,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.02,scaleY:.87,repeat:-1,yoyo:!0})},n}(Phaser.GameObjects.Container);o.LevelsMapFire=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i){var s=r.call(this,e,0,0,"levels_map",t)||this;return s.velocity=0,s.worldWidth=i,s.velocity=Phaser.Math.RND.realInRange(.05,.1),s}return n.prototype.preUpdate=function(e,t){this.x+=this.velocity*t,this.x>this.worldWidth+this.width/2&&(this.x=-this.width/2)},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.LevelMapCloud=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,"levels_map","scrollbar")||this;return t.isDragged=!1,t.scrollTop=0,t.scrollBottom=0,t.scrollHeight=0,t.setInteractive(),t.input.cursor="pointer",t.on(Phaser.Input.Events.GAMEOBJECT_DRAG_START,t.onScrollbarDragStart,t),t.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,t.onScrollbarDragEnd,t),t}return n.prototype.onScrollbarDragStart=function(e){this.isDragged=!0},n.prototype.onScrollbarDragEnd=function(){this.isDragged=!1},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n.prototype.onResize=function(){var e=this.displayHeight/2+6*this.scaleY;this.scrollTop=e,this.scrollBottom=o.Config.GAME_HEIGHT-e,this.scrollHeight=this.scrollBottom-this.scrollTop},n}(Phaser.GameObjects.Image);o.Scrollbar=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.originalScale=1,t.wasInCamera=!1,t.name="fox_avatar",t.addFox(),t.addBack(),t.setInteractive(t.back.getBounds(),Phaser.Geom.Rectangle.Contains),t.input.cursor="pointer",t}return n.prototype.enableInput=function(){this.input.enabled=!0},n.prototype.disableInput=function(){this.input.enabled=!1},n.prototype.addFox=function(){this.fox=this.scene.add.image(0,0,"levels_map","avatar_fox"),this.add(this.fox)},n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","avatar_back"),this.add(this.back)},n.prototype.lookUp=function(){this.back.angle=-180},n.prototype.lookBottom=function(){this.back.angle=0},n.prototype.getDisplayHeight=function(){return(this.fox.height+50)*this.scaleY},n.prototype.scaleTo=function(e){return this.scaleTween&&(this.scaleTween.remove(),this.scaleTween=null),this.scaleTween=this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Linear.Linear,scale:this.originalScale*e}),this.scaleTween},n.prototype.startWiggle=function(){this.wiggleTween=this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:this.originalScale*.9,repeat:-1,yoyo:!0})},n.prototype.stopWiggle=function(){this.wiggleTween&&(this.wiggleTween.remove(),this.wiggleTween=null)},n}(Phaser.GameObjects.Container);o.Avatar=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return t?t.add(i):i.scene.add.existing(i),i.addBack(),i.addArrows(),i.addText(),i}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"levels_map","settings_screen/button_large_base"),this.add(this.back)},n.prototype.addArrows=function(){var e=160,t=-6;this.leftArrow=this.scene.add.button("levels_map","settings_screen/arrow_left",this),this.leftArrow.x=-e,this.rightArrow=this.scene.add.button("levels_map","settings_screen/arrow_right",this),this.rightArrow.x=e;var i=[this.leftArrow,this.rightArrow];i.forEach(function(s){s.setScrollFactor(0),s.y=t})},n.prototype.addText=function(){this.text=this.scene.add.text(0,0,"Language",this.getTextStyle()),this.text.setOrigin(.5,.5),this.text.x=6,this.text.y=-12,this.add(this.text)},n.prototype.getTextStyle=function(){return{color:"#FFFFFF",fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"45px",align:"center",padding:{x:2,y:6},shadow:{fill:!0,blur:0,offsetY:3,color:"rgba(0,0,0,0.2)"}}},n.prototype.updateText=function(e){var t=this;this.scene.tweens.killTweensOf(this.text),this.scene.tweens.add({targets:this.text,duration:66,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){t.text.setText(e),t.adjustTextSize(),t.scene.tweens.add({targets:t.text,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})}})},n.prototype.adjustTextSize=function(){var e=this.leftArrow.right,t=this.rightArrow.left,i=t-e,s=i*.9;this.text.scale=Math.min(1,s/this.text.width)},n}(Phaser.GameObjects.Container);o.LanguagesButton=h})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ToggleButtonState,r=Phaser.GameObjects.ButtonEvent,n=function(e){__extends(t,e);function t(i,s){var a=e.call(this,i)||this;return a.atlasKey=s,a.name="buttons_container",a.addBackground(),a.addButtons(),a.addRoboWhaleInfo(),a.alignItems(),a.settingsContent=[a.soundButton,a.deleteButton,a.fullscreenButton,a.languagesButton],a.settingsContent.forEach(function(l){l.setScrollFactor(0)}),a.creditsContent=[a.robowhaleInfo],a.settingsButton.buttonState=h.STATE_2,a.showSettingsContent(),a}return t.prototype.showContent=function(i){i.forEach(function(s){return s.visible=!0}),this.scene.tweens.add({targets:i,alpha:{from:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200},scale:{from:.75,to:1,ease:Phaser.Math.Easing.Back.Out,duration:400}})},t.prototype.hideContent=function(i){i.forEach(function(s){return s.visible=!1})},t.prototype.showSettingsContent=function(){this.showContent(this.settingsContent),this.hideContent(this.creditsContent),this.settingsButton.disableInteractive(),this.creditsButton.buttonState=h.STATE_1,this.creditsButton.setInteractive()},t.prototype.showCreditsContent=function(){this.showContent(this.creditsContent),this.hideContent(this.settingsContent),this.creditsButton.disableInteractive(),this.settingsButton.buttonState=h.STATE_1,this.settingsButton.setInteractive()},t.prototype.sendCreditsCheckEvent=function(){this.scene.analytics.sendDesignEvent("Credits")},t.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,this.atlasKey,"white_rect"),this.background.displayWidth=465,this.background.displayHeight=485,this.background.alpha=0,this.add(this.background)},t.prototype.addButtons=function(){this.settingsButton=this.scene.add.toggleButton(this.atlasKey,"settings_screen/button_settings","settings_screen/button_settings_inactive",this),this.settingsButton.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.showSettingsContent,this),this.settingsButton.setScrollFactor(0),this.creditsButton=this.scene.add.toggleButton(this.atlasKey,"settings_screen/button_credits","settings_screen/button_credits_inactive",this),this.creditsButton.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.showCreditsContent,this),this.creditsButton.once(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.sendCreditsCheckEvent,this),this.creditsButton.setScrollFactor(0),this.soundButton=this.scene.add.soundButton(this.atlasKey,"settings_screen/button_sound_on","settings_screen/button_sound_off",this),this.deleteButton=this.scene.add.button(this.atlasKey,"settings_screen/button_delete",this),this.deleteButton.on(r.RELEASE,this.onDeleteDataButtonClick,this),this.fullscreenButton=this.scene.add.toggleButton(this.atlasKey,"settings_screen/button_fullscreen_on","settings_screen/button_fullscreen_off",this),this.disableFullscreenButton(),this.addLanguageButton()},t.prototype.addLanguageButton=function(){var i=o.getLanguageTitle(this.scene.game.texts.language);this.languagesButton=new o.LanguagesButton(this.scene,this),this.languagesButton.leftArrow.on(r.PRESS,this.updateLanguage.bind(this,-1)),this.languagesButton.rightArrow.on(r.PRESS,this.updateLanguage.bind(this,1)),this.languagesButton.updateText(i)},t.prototype.updateLanguage=function(i){var s=this.scene.game.texts,a=s.language,l=s.allLanguages,c=l.indexOf(a),u=Phaser.Math.Wrap(c+i,0,l.length),d=l[u];this.scene.game.store.saveValue(o.GameStoreKey.LANGUAGE,d),this.scene.game.texts.setLanguage(d),this.languagesButton.updateText(o.getLanguageTitle(d))},t.prototype.onDeleteDataButtonClick=function(){var i=this;if(this.scene.game.device.os.iOS===!1){this.clearSavedData();return}this.scene.game.audio.suspendAudioContext().finally(function(){i.clearSavedData(),i.scene.game.audio.resumeAudioContext()})},t.prototype.clearSavedData=function(){var i=this.scene.texts.clear_save,s=this.scene.texts.progress_lost_warinig,a=typeof window.confirm!="undefined"?window.confirm(i+"\n"+s):!0;a&&(this.scene.game.store.clear(),this.scene.game.restartScene(this.scene.scene.key))},t.prototype.addRoboWhaleInfo=function(){this.robowhaleInfo=this.scene.add.image(0,0,this.atlasKey,"settings_screen/robowhale_info"),this.add(this.robowhaleInfo)},t.prototype.onRobowhaleClick=function(){window.open("https://robowhale.com/?utm_source=Bouncy_Woods")},t.prototype.alignItems=function(){var i=this.background.getBounds(),s=86,a=i.top+this.settingsButton.displayHeight/2;this.settingsButton.x=i.centerX-s,this.settingsButton.y=a,this.creditsButton.x=i.centerX+s,this.creditsButton.y=a;var l=i.centerY;this.soundButton.x=i.left+this.soundButton.displayWidth/2,this.soundButton.y=l,this.deleteButton.x=i.centerX,this.deleteButton.y=l,this.fullscreenButton.x=i.right-this.fullscreenButton.displayWidth/2,this.fullscreenButton.y=l,this.languagesButton.y=i.bottom-this.languagesButton.getBounds().height/2,this.robowhaleInfo.bottom=i.bottom},t.prototype.disableFullscreenButton=function(){this.fullscreenButton.setFrame("settings_screen/button_fullscreen_disabled"),this.fullscreenButton.removeInteractive()},t.prototype.getWidth=function(){return this.background.displayWidth},t}(Phaser.GameObjects.Container);o.SettingsScreenContent=n})(game||(game={}));var game;(function(o){var h;(function(n){n.SHOW="SettingsScreen_show",n.HIDE="SettingsScreen_hide"})(h=o.SettingsScreenEvent||(o.SettingsScreenEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.atlasKey="levels_map",i.backgroundAlpha=.85,i.name="settings_screen",i.addBackground(),i.addCloseButton(),i.addContent(),i.addBuildInfo(),i}return e.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,this.atlasKey,"black_rect"),this.background.alpha=this.backgroundAlpha,this.add(this.background)},e.prototype.addCloseButton=function(){this.closeButton=this.scene.add.button(this.atlasKey,"settings_screen/button_small_close",this),this.closeButton.setScrollFactor(0)},e.prototype.addContent=function(){this.content=new o.SettingsScreenContent(this.scene,this.atlasKey),this.add(this.content)},e.prototype.addBuildInfo=function(){var t=window.game.config.build_version,i=window.game.config.build_time,s="Build #"+t+" "+i,a={fontFamily:o.GameFont.SOUSES,fontStyle:"normal",fontSize:"24px",color:"#ffffff"},l=.75;this.buildInfo=this.scene.add.text(0,0,s,a),this.buildInfo.setOrigin(.5,1),this.buildInfo.alpha=l,this.buildInfo.setData("originalAlpha",l),this.add(this.buildInfo)},e.prototype.resize=function(t){this.resizeBackground(),this.alignCloseButton(t),this.resizeButtons(),this.alignBuildInfo()},e.prototype.resizeBackground=function(){this.background.setDisplaySize(o.Config.GAME_WIDTH+4,o.Config.GAME_HEIGHT+4),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},e.prototype.alignCloseButton=function(t){this.closeButton.scale=t.scale,this.closeButton.x=t.x,this.closeButton.y=t.y},e.prototype.resizeButtons=function(){var t=o.Config.GAME_WIDTH*.6;this.content.scale=Math.min(1,t/this.content.getWidth()),this.content.x=o.Config.HALF_GAME_WIDTH,this.content.y=o.Config.HALF_GAME_HEIGHT},e.prototype.alignBuildInfo=function(){this.buildInfo.scale=this.content.scale,this.buildInfo.x=o.Config.HALF_GAME_WIDTH,this.buildInfo.y=o.Config.GAME_HEIGHT-25},e.prototype.kill=function(){this.active=!1,this.visible=!1},e.prototype.revive=function(){this.active=!0,this.visible=!0},e.prototype.show=function(){this.revive(),this.alpha=1,this.scene.tweens.add({targets:this.background,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:{from:0,to:this.backgroundAlpha}}),this.scene.tweens.add({targets:this.buildInfo,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:{from:0,to:this.buildInfo.getData("originalAlpha")}});var t=this.content.scale;this.scene.tweens.add({targets:this.content,alpha:{from:0,to:1,duration:200,ease:Phaser.Math.Easing.Cubic.Out},scale:{from:t*.8,to:t,duration:400,ease:Phaser.Math.Easing.Back.Out}}),this.emit(h.SHOW,this)},e.prototype.hide=function(){var t=this;this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){t.kill(),t.emit(h.HIDE,t)}})},e}(Phaser.GameObjects.Container);o.SettingsScreen=r})(game||(game={}));var game;(function(o){var h=Phaser.Cameras.Controls.FixedKeyControl,r=Phaser.GameObjects.ButtonEvent,n=Phaser.Math.EasingString,e;(function(i){i.CLOUD="cloud",i.FIRE="fire",i.FOX="fox",i.FOX_IN_HOLE="fox_in_hole"})(e=o.LevelsMapDecor||(o.LevelsMapDecor={}));var t=function(i){__extends(s,i);function s(){var a=i!==null&&i.apply(this,arguments)||this;return a.pointerWasDragged=!1,a}return s.prototype.init=function(){this.events.once("shutdown",this.shutdown,this),this.config=this.cache.json.get(s.CONFIG_KEY),this.pointerDownPosition={x:0,y:0},this.pointerWasDragged=!1,this.cameraScrollTween=null,this.wheelListener=null},s.prototype.create=function(){this.addMainContainer(),this.addBackgrounds(),this.addFoxInHole(),this.addLevelIcons(),this.addFire(),this.addFireEmitterManager(),this.addAvatar(),this.addClouds(),this.addScrollbar(),this.addSettingsButton(),this.addStartLevelPopup(),this.addSettingsScreen(),this.setupCamera(),this.addCameraKeyboardControl(),this.addCameraScroll(),this.addPointerCallbacks(),this.addKeyboardCallbacks(),this.resize(),this.doInitialCameraScroll(),utils.NetUtil.getParamBool("unlockLevels")&&this.unlockAllLevels()},s.prototype.addMainContainer=function(){this.mainContainer=this.add.container(0,0),this.mainContainer.name="main"},s.prototype.addBackgrounds=function(){var a=this;this.backgrounds=this.config.backgrounds.map(function(l,c){var u=a.add.image(0,0,l);return u.setOrigin(0,0),u.y=c*u.height,a.mainContainer.add(u),u})},s.prototype.addFoxInHole=function(){var a=this.getDecorConfig(e.FOX_IN_HOLE);if(!a)return;this.anims.create({key:e.FOX_IN_HOLE,repeat:-1,repeatDelay:7e3,frames:this.anims.getFrameNames("levels_map","decor/fox_in_hole/FOX_in_HOLE"),frameRate:15}),this.foxInHole=this.add.sprite(0,0,"levels_map","decor/fox_in_hole/FOX_in_HOLE0001"),this.foxInHole.x=a.x,this.foxInHole.y=a.y,this.foxInHole.anims.delayedPlay(1500,e.FOX_IN_HOLE),this.mainContainer.add(this.foxInHole),this.sys.updateList.add(this.foxInHole)},s.prototype.addLevelIcons=function(){var a=this;this.levelIcons=this.config.level_icons.map(function(l){var c=a.getLevelIconData(l.level_number),u=new o.LevelIcon(a,c);return u.x=l.x,u.y=l.y,u.setData("type","LevelIcon"),a.mainContainer.add(u),u}),this.lastUnlockedIcon=this.getLastUnlockedLevelIcon()},s.prototype.getLevelIconData=function(a){var l=this.game.store.getLevelResult(a);return l?{levelNumber:a,complete:!0,locked:!1,stars:l.stars}:{levelNumber:a,complete:!1,locked:this.isLevelLocked(a),stars:0}},s.prototype.isLevelLocked=function(a){if(a===1)return!1;var l=a-1,c=this.game.store.getLevelResult(l);return!c},s.prototype.gotoLevel=function(a){this.game.changeScene(this.scene.key,o.SceneKey.GAMEPLAY_ROOT,{levelNumber:a})},s.prototype.addFire=function(){var a=this.getDecorConfig(e.FIRE);if(!a)return;this.fire=new o.LevelsMapFire(this),this.fire.originalX=a.x,this.fire.originalY=a.y,this.add.existing(this.fire)},s.prototype.getDecorConfig=function(a){return this.config.decor.find(function(l){return l.type===a})},s.prototype.addFireEmitterManager=function(){this.fireEmitterManager=this.add.particles("levels_map","decor/fire_particle")},s.prototype.addAvatar=function(){this.avatar=new o.Avatar(this),this.avatar.on(Phaser.Input.Events.GAMEOBJECT_POINTER_UP,this.onAvatarClick,this),this.add.existing(this.avatar)},s.prototype.onAvatarClick=function(){var a=this;if(this.cameraScrollTween)return;var l=this.lastUnlockedIcon;if(!l)return;this.game.audio.playClickSound(),this.cameraScroll.resetScroll();var c=Phaser.Display.Bounds.GetCenterY(l)*this.mainContainer.scale-o.Config.GAME_HEIGHT/2;this.cameraScrollTween=this.tweens.add({targets:this.camera,duration:500,ease:Phaser.Math.Easing.Quadratic.Out,scrollY:c,onComplete:function(){a.cameraScrollTween=null}})},s.prototype.addClouds=function(){var a=this;this.clouds=this.config.decor.filter(function(l){return l.type===e.CLOUD}).map(function(l){var c=new o.LevelMapCloud(a,l.frame,a.backgrounds[0].width);return c.x=l.x,c.y=l.y,a.mainContainer.add(c),a.sys.updateList.add(c),c})},s.prototype.addScrollbar=function(){this.scrollbar=new o.Scrollbar(this),this.scrollbar.setScrollFactor(0),this.scrollbar.alpha=.5,this.scrollbar.on(Phaser.Input.Events.GAMEOBJECT_DRAG_START,this.onDragStart,this),this.scrollbar.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onDragEnd,this),this.add.existing(this.scrollbar),this.input.setDraggable(this.scrollbar)},s.prototype.onDragStart=function(){var a=this;document.onpointermove=function(l){a.setScrollbarY(a.scale.transformY(l.pageY)),a.updateCameraByScrollbar()}},s.prototype.onDragEnd=function(){document.onpointermove=null},s.prototype.setScrollbarY=function(a){this.scrollbar.y=Phaser.Math.Clamp(a,this.scrollbar.scrollTop,this.scrollbar.scrollBottom)},s.prototype.updateCameraByScrollbar=function(){var a=(this.scrollbar.y-this.scrollbar.scrollTop)/this.scrollbar.scrollHeight,l=this.camera.getBounds(),c=l.y,u=l.bottom-o.Config.GAME_HEIGHT;this.camera.scrollY=(u-c)*a},s.prototype.addStartLevelPopup=function(){this.startLevelPopup=new o.StartLevelScreen(this),this.startLevelPopup.playButton.once(r.PRESS,this.onPlayButtonClick,this),this.startLevelPopup.setScrollFactor(0,0),this.startLevelPopup.on(o.StartLevelScreenEvent.SHOW,this.onStartLevelPopupShow,this),this.startLevelPopup.on(o.StartLevelScreenEvent.HIDE,this.onStartLevelPopupHide,this),this.startLevelPopup.kill(),this.add.existing(this.startLevelPopup)},s.prototype.onPlayButtonClick=function(){var a=this;this.poki.commercialBreak("LevelMap:PlayButton").catch(function(){}).finally(function(){a.gotoLevel(a.startLevelPopup.levelNumber)})},s.prototype.onStartLevelPopupShow=function(){this.settingsButton.enabled=!1,this.disableScroll(),this.disableLevelIcons()},s.prototype.disableScroll=function(){this.cameraScroll.removePointerListeners(),this.cameraScroll.settings.verticalWheel=!1,this.cameraKeyboardControl.active=!1},s.prototype.onStartLevelPopupHide=function(){this.settingsButton.enabled=!0,this.enableScroll(),this.enableLevelIcons()},s.prototype.enableScroll=function(){this.cameraScroll.addPointerListeners(),this.cameraScroll.settings.verticalWheel=!0,this.cameraKeyboardControl.active=!0},s.prototype.enableLevelIcons=function(){this.levelIcons.filter(function(a){return a.iconState!==o.LevelIconState.LOCKED}).forEach(function(a){a.setInteractive()})},s.prototype.disableLevelIcons=function(){this.levelIcons.filter(function(a){return a.iconState!==o.LevelIconState.LOCKED}).forEach(function(a){a.disableInteractive()})},s.prototype.addSettingsButton=function(){this.settingsButton=this.add.button("levels_map","settings_screen/button_small_settings"),this.settingsButton.on(r.PRESS,this.showSettings,this),this.settingsButton.setScrollFactor(0)},s.prototype.addSettingsScreen=function(){this.settingsScreen=new o.SettingsScreen(this),this.settingsScreen.closeButton.on(r.PRESS,this.hideSettings,this),this.settingsScreen.on(o.SettingsScreenEvent.SHOW,this.onSettingsShow,this),this.settingsScreen.on(o.SettingsScreenEvent.HIDE,this.onSettingsHide,this),this.settingsScreen.kill(),this.settingsScreen.setScrollFactor(0),this.add.existing(this.settingsScreen)},s.prototype.onSettingsShow=function(){this.settingsScreen.closeButton.enabled=!0,this.settingsButton.enabled=!1,this.disableScroll(),this.disableLevelIcons()},s.prototype.onSettingsHide=function(){this.settingsScreen.closeButton.enabled=!1,this.settingsButton.enabled=!0,this.enableScroll(),this.enableLevelIcons()},s.prototype.showSettings=function(){this.settingsScreen.visible===!1&&this.settingsScreen.show()},s.prototype.hideSettings=function(){this.settingsScreen.hide()},s.prototype.addPointerCallbacks=function(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on(Phaser.Input.Events.POINTER_UP,this.onPointerUp,this),this.wheelListener=this.onWheel.bind(this),this.game.canvas.parentElement.addEventListener("wheel",this.wheelListener)},s.prototype.onWheel=function(a){if(a.preventDefault(),this.cameraScroll.settings.verticalWheel===!1)return;this.cameraScroll.velocityWheelY=-a.deltaY/2.5},s.prototype.onPointerDown=function(a){this.pointerDownPosition.x=a.x,this.pointerDownPosition.y=a.y},s.prototype.onPointerUp=function(a,l){var c=Phaser.Math.Distance.Between(this.pointerDownPosition.x,this.pointerDownPosition.y,a.x,a.y);if(this.pointerWasDragged=c>5,this.pointerWasDragged)return;var u=l.find(function(d){return d.getData("type")==="LevelIcon"});u&&this.onLevelIconClick(u)},s.prototype.onLevelIconClick=function(a){this.game.audio.playClickSound(),this.openStartLevelPopup(a.levelNumber)},s.prototype.openStartLevelPopup=function(a){var l=this.getStartLevelPopupData(a);if(!l)return;this.startLevelPopup.updateData(l),this.startLevelPopup.show()},s.prototype.getStartLevelPopupData=function(a){var l=this.game.levelConfigs.get(a);if(!l)return""+a,null;var c=this.game.store.getLevelResult(a);return c?{levelNumber:a,levelComplete:!0,highscore:c.highscore,stars:c.stars,blocksNum:l.generator.targetItemsNum,blocksType:l.generator.targetItemType}:{levelNumber:a,levelComplete:!1,highscore:0,stars:0,blocksNum:l.generator.targetItemsNum,blocksType:l.generator.targetItemType}},s.prototype.addKeyboardCallbacks=function(){o.Main.development&&(o.Main.editorEnabled&&this.input.keyboard.on("keydown-E",this.gotoLevelsMapEditor,this),this.input.keyboard.on("keydown-D",this.gotoLevelsMapDev,this),this.input.keyboard.on("keydown-U",this.unlockAllLevels,this),this.input.keyboard.on("keydown-L",this.lockAllLevels,this)),this.input.keyboard.on("keydown-ESC",this.onEscPressed,this),this.input.keyboard.on("keydown-R",this.restart,this),this.input.keyboard.on("keydown-SPACE",this.onSpacePressed,this),this.input.keyboard.on("keydown-PAGE_DOWN",this.onScollPageDown,this),this.input.keyboard.on("keydown-PAGE_UP",this.onScollPageUp,this),this.input.keyboard.on("keydown-HOME",this.scrollToTop,this),this.input.keyboard.on("keydown-END",this.scrollToBottom,this),this.input.keyboard.on("keydown-LEFT",this.scrollToLastUnlockedLevel,this),this.input.keyboard.on("keydown-RIGHT",this.scrollToLastUnlockedLevel,this)},s.prototype.unlockAllLevels=function(){this.levelIcons.filter(function(a){return a.iconState===o.LevelIconState.LOCKED}).forEach(function(a){return a.setUnlocked()}),this.lastUnlockedIcon=this.getLastUnlockedLevelIcon()},s.prototype.lockAllLevels=function(){this.levelIcons.forEach(function(a){return a.setLocked()})},s.prototype.gotoLevelsMapDev=function(){this.game.changeScene(this.scene.key,o.SceneKey.LEVELS_MAP_DEV)},s.prototype.gotoLevelsMapEditor=function(){this.game.changeScene(this.scene.key,o.SceneKey.LEVELS_MAP_EDITOR)},s.prototype.onEscPressed=function(){if(this.startLevelPopup.visible){this.startLevelPopup.hide();return}this.gotoMainMenu()},s.prototype.gotoMainMenu=function(){},s.prototype.restart=function(){this.game.changeScene(this.scene.key,this.scene.key)},s.prototype.onSpacePressed=function(){if(this.settingsScreen.visible)return;if(this.startLevelPopup.visible){this.gotoLevel(this.startLevelPopup.levelNumber);return}var a=this.getLastUnlockedLevelIcon();a&&(this.scrollToLevelIcon(a),this.openStartLevelPopup(a.levelNumber))},s.prototype.onScollPageDown=function(){this.camera.scrollY+=o.Config.GAME_HEIGHT},s.prototype.onScollPageUp=function(){this.camera.scrollY-=o.Config.GAME_HEIGHT},s.prototype.scrollToBottom=function(){this.camera.scrollY=this.mainContainer.getBounds().height},s.prototype.scrollToTop=function(){this.camera.scrollY=0},s.prototype.scrollToLastUnlockedLevel=function(){var a=this.getLastUnlockedLevelIcon();a&&this.scrollToLevelIcon(a)},s.prototype.scrollToLevel=function(a){var l=this.levelIcons.find(function(c){return c.levelNumber===a});l&&this.scrollToLevelIcon(l)},s.prototype.scrollToLevelIcon=function(a){this.camera.scrollY=Phaser.Display.Bounds.GetCenterY(a)*this.mainContainer.scale-o.Config.GAME_HEIGHT/2},s.prototype.resize=function(){this.resizeMainContainer(),this.resizeAvatar(),this.updateFirePositionAndScale(),this.updateFireEmitter(),this.updateCameraBounds(),this.alignScrollbar(),this.alignSettingsButton(),this.settingsScreen.resize(this.settingsButton),this.startLevelPopup.resize()},s.prototype.resizeMainContainer=function(){this.mainContainer.scale=o.Config.GAME_WIDTH/this.backgrounds[0].width},s.prototype.resizeAvatar=function(){this.avatar.scale=this.mainContainer.scale,this.avatar.originalScale=this.avatar.scale},s.prototype.updateFirePositionAndScale=function(){if(!this.fire)return;this.fire.scale=this.mainContainer.scale,this.fire.x=this.fire.originalX*this.fire.scale,this.fire.y=this.fire.originalY*this.fire.scale},s.prototype.updateFireEmitter=function(){this.fireEmitter&&(this.fireEmitter.killAll(),this.fireEmitter.remove()),this.addFireEmitter()},s.prototype.addFireEmitter=function(){var a=this.fire.getWorldPosition(),l=this.mainContainer.scale;this.fireEmitter=this.fireEmitterManager.createEmitter({frame:"decor/fire_particle",x:a.x,y:a.y-45*l,emitZone:{type:"random",source:this.getFireEmitRect(l)},frequency:200,quantity:1,gravityY:-20*l,speedY:{min:-80*l,max:-50*l},speedX:{min:-30*l,max:30*l},scale:{start:l,end:0,ease:n.Cubic},lifespan:3500,on:!0})},s.prototype.getFireEmitRect=function(a){var l=40*a,c=40*a;return new Phaser.Geom.Rectangle(-l/2,-c/2,l,c)},s.prototype.updateCameraBounds=function(){var a=Phaser.Display.Bounds.GetTop(this.backgrounds[0]),l=Phaser.Display.Bounds.GetBottom(this.backgrounds[this.backgrounds.length-1]),c=l-a;this.camera.setBounds(0,0,o.Config.GAME_WIDTH,c*this.mainContainer.scale)},s.prototype.alignScrollbar=function(){var a=this.mainContainer.scale;this.scrollbar.scale=a,this.scrollbar.x=o.Config.GAME_WIDTH-10*a,this.scrollbar.onResize()},s.prototype.alignSettingsButton=function(){var a=o.Config.ASSETS_SCALE,l=60*a;this.settingsButton.scale=a,this.settingsButton.x=o.Config.GAME_WIDTH-l,this.settingsButton.y=l},s.prototype.setupCamera=function(){this.camera=this.cameras.main},s.prototype.addCameraKeyboardControl=function(){var a=this.input.keyboard.createCursorKeys();this.cameraKeyboardControl=new h({camera:this.camera,left:a.left,right:a.right,up:a.up,down:a.down,speed:4})},s.prototype.addCameraScroll=function(){this.cameraScroll=new o.KineticScroll(this,{camera:this.camera,kineticMovement:!0,timeConstantScroll:300,horizontalWheel:!1,horizontalScroll:!1,verticalWheel:!0,verticalScroll:!0,wheelDeceleration:.92,scrollMultiplier:2}),this.cameraScroll.addPointerListeners()},s.prototype.update=function(a,l){i.prototype.update.call(this,a,l),this.cameraKeyboardControl.update(l),this.cameraScroll.update(),this.updateScrollbar(),this.updateAvatar()},s.prototype.updateScrollbar=function(){if(this.scrollbar.isDragged)return;var a=this.camera.getBounds(),l=a.y,c=a.bottom-o.Config.GAME_HEIGHT,u=Math.max(0,this.camera.scrollY),d=Phaser.Math.Clamp(u/(c-l),0,1);this.scrollbar.y=this.scrollbar.scrollTop+(this.scrollbar.scrollBottom-this.scrollbar.scrollTop)*d},s.prototype.updateAvatar=function(){var a=this;if(!this.lastUnlockedIcon)return;var l=this.camera.getBounds(),c=Phaser.Math.Clamp(this.camera.scrollY,0,l.bottom-o.Config.GAME_HEIGHT),u=c+this.camera.height,d=this.lastUnlockedIcon.getWorldPosition(),p=d.y-32*this.mainContainer.scale,f=p>c&&p<u;if(f)this.avatar.y=p-this.avatar.getDisplayHeight()/2,this.avatar.lookBottom();else{var y=u-c,v=c+y/2;p>v?(this.avatar.y=u-this.avatar.getDisplayHeight()/2,this.avatar.lookBottom()):(this.avatar.y=c+this.avatar.getDisplayHeight()/2,this.avatar.lookUp())}this.avatar.wasInCamera&&f===!1?(this.avatar.stopWiggle(),this.avatar.scaleTo(.75),this.avatar.enableInput()):this.avatar.wasInCamera===!1&&f&&(this.avatar.scaleTo(1).on(Phaser.Tweens.Events.TWEEN_COMPLETE,function(){a.avatar.startWiggle()}),this.avatar.disableInput()),this.avatar.x=d.x,this.avatar.wasInCamera=f},s.prototype.getLastUnlockedLevelIcon=function(){var a=this.levelIcons.filter(function(c){return c.iconState===o.LevelIconState.UNLOCKED}).map(function(c){return c.levelNumber}),l=Math.max.apply(Math,a);return this.levelIcons.find(function(c){return c.levelNumber===l})},s.prototype.doInitialCameraScroll=function(){var a=this.getLastUnlockedLevelIcon();a?this.scrollToLevelIcon(a):this.scrollToBottom()},s.prototype.shutdown=function(){document.onpointermove=null,this.wheelListener&&this.game.canvas.parentElement.removeEventListener("wheel",this.wheelListener),this.removeCameraScroll()},s.prototype.removeCameraScroll=function(){this.input.off("pointerdown"),this.input.off("pointerup"),this.input.off("pointermove")},s.CONFIG_KEY="levels_map_config",s}(Phaser.Scene);o.LevelsMap=t})(game||(game={}));var game;(function(o){var h=Phaser.Math.Vector2,r;(function(e){e.SHOW="trail_show",e.HIDE="trail_hide"})(r=o.TrailEvent||(o.TrailEvent={}));var n=function(){function e(t,i,s,a){this._active=!1,this.scene=t,this.canvas=i,this.options=a,this.owner=s,this.owner.on(r.SHOW,this.activate,this),this.owner.on(r.HIDE,this.deactivate,this),this.curve=new Phaser.Curves.Spline,this.tempCurvePoint=new h,this.initTangents()}return Object.defineProperty(e.prototype,"active",{get:function(){return this._active},enumerable:!1,configurable:!0}),e.prototype.initTangents=function(){this.tempTangent=new h,this.leftTangents=_.times(this.options.accuracy+1,function(){return new h}),this.rightTangents=_.times(this.options.accuracy+1,function(){return new h})},e.prototype.activate=function(){if(this._active)return;this.curve.points.length=0,this._active=!0},e.prototype.deactivate=function(){if(!this._active)return;this._active=!1},e.prototype.draw=function(){if(this._active===!1)return;this.curve.points.push({x:this.owner.x,y:this.owner.y});var t=this.curve.points.length;if(t<2)return;t>this.options.length&&(this.curve.points=this.curve.points.slice(-this.options.length)),this.truncate(),this.canvas.fillPoints(this.getDrawingPoints(),!0)},e.prototype.truncate=function(){},e.prototype.getDrawingPoints=function(){for(var t=this.options.accuracy;t>=0;t--){var i=t/this.options.accuracy,s=this.owner.getTrailSize()*i;this.curve.getPoint(i,this.tempCurvePoint),this.curve.getTangentAt(i,this.tempTangent),this.rightTangents[t].copy(this.tempTangent).normalizeRightHand().scale(s).add(this.tempCurvePoint),this.leftTangents[t].copy(this.tempTangent).normalizeRightHand().scale(-s).add(this.tempCurvePoint)}return __spreadArrays(this.rightTangents,this.leftTangents.reverse())},e.prototype.destroy=function(){this.owner.off(r.SHOW,this.activate,this),this.owner.off(r.HIDE,this.deactivate,this),this.owner=null,this.curve=null},e}();o.Trail=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.name="ball_trails_canvas",i.defaultOptions=t,i.trails=[],i.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,i.onPostUpdate,i),i}return n.prototype.addTrail=function(e,t){var i=new o.Trail(this.scene,this,e,__assign(__assign({},this.defaultOptions),t));return this.trails.push(i),e.on(o.TrailEvent.SHOW,this.onTrailShow,this),e.on(o.TrailEvent.HIDE,this.onTrailHide,this),e.once(Phaser.GameObjects.Events.DESTROY,this.onOwnerDestroy.bind(this,i,e)),i},n.prototype.onTrailShow=function(){if(!this.scene)return;this.hasActiveTrails()&&this.revive()},n.prototype.onTrailHide=function(){if(!this.scene)return;var e=this.hasActiveTrails()===!1;e&&(this.clear(),this.kill())},n.prototype.hasActiveTrails=function(){return this.trails.some(function(e){return e.active})},n.prototype.onOwnerDestroy=function(e,t){if(!this.scene)return;var i=this.trails.indexOf(e);i>-1&&(this.trails.splice(i,1),t.off(o.TrailEvent.SHOW,this.onTrailShow,this),t.off(o.TrailEvent.HIDE,this.onTrailHide,this),e.destroy())},n.prototype.onPostUpdate=function(e,t){var i=this;this.clear(),this.trails.forEach(function(s){i.fillStyle(s.options.color,s.options.alpha),s.draw()})},n.prototype.destroy=function(e){if(!this.scene)return;this.trails.forEach(function(t){return t.destroy()}),this.trails=null,this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.onPostUpdate,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Graphics);o.TrailsCanvas=h})(game||(game={}));var game;(function(o){var h;(function(n){n.IDLE="fox_idle",n.HAPPY="fox_happy",n.AIM="fox_aim",n.SHOT="fox_shot"})(h=o.FoxAnimation||(o.FoxAnimation={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,0,0,e.ATLAS_KEY,"FOX_IDLE0001")||this;return i.setOrigin(.45,.8),i.createAnimations(),i.resetAnimationOrigins(),i.on("animationcomplete-"+h.SHOT,i.onShotAnimationComplete,i),i}return e.prototype.createAnimations=function(){this.scene.anims.create({key:h.IDLE,frames:this.getAnimationFrames("FOX_IDLE"),repeat:-1}),this.scene.anims.create({key:h.AIM,frames:this.getAnimationFrames("FOX_AIM"),repeat:-1}),this.scene.anims.create({key:h.SHOT,frames:this.getAnimationFrames("FOX_SHOT"),frameRate:60}),this.scene.anims.create({key:h.HAPPY,frames:this.getAnimationFrames("FOX_HAPPY"),repeat:-1,frameRate:30})},e.prototype.getAnimationFrames=function(t){return this.scene.anims.getFrameNames(e.ATLAS_KEY,t)},e.prototype.resetAnimationOrigins=function(){var t=this,i=Object.values(h);i.forEach(function(s){t.scene.anims.get(s).frames.forEach(function(a){a.frame.customPivot=!1})})},e.prototype.onShotAnimationComplete=function(){this.play(h.IDLE)},e.prototype.getHandsPosition=function(t){var i=t||{x:0,y:0};return i.x=this.x,i.y=this.y-this.height*.28,i},e.prototype.moveTo=function(t){var i=Math.abs(t-this.x)*2;this.scene.tweens.add({targets:this,x:t,duration:Math.min(400,i),ease:Phaser.Math.Easing.Cubic.Out})},e.prototype.playIdleAnimation=function(){this.play(h.IDLE)},e.prototype.playHappyAnimation=function(){this.play(h.HAPPY)},e.prototype.playShotAnimation=function(){this.play(h.SHOT)},e.prototype.showLoseFrame=function(){this.play(h.AIM),this.anims.currentAnim.pause()},e.prototype.showWorriedFrame=function(){var t=this;this.play(h.AIM),this.anims.currentAnim.pause(),this.scene.time.delayedCall(1600,function(){t.playIdleAnimation()})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0)},e.ATLAS_KEY="gameplay",e}(Phaser.GameObjects.Sprite);o.Fox=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="fox_talk_bubble",t.addBubble(),t.addContent(),t}return n.prototype.addBubble=function(){this.bubble=this.scene.add.image(0,0,"gameplay","fox_bubble_talk"),this.add(this.bubble)},n.prototype.addContent=function(){this.content=this.scene.add.image(0,0,"gameplay","fox_bubble_talk_content"),this.content.x=this.bubble.x-46,this.content.y=this.bubble.y-62,this.content.originalX=this.content.x,this.content.originalY=this.content.y,this.add(this.content)},n.prototype.show=function(){this.alpha=0,this.scale=.75,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({targets:this,duration:800,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1,completeDelay:900,onComplete:this.hide.bind(this)}),this.content.x=this.content.originalX,this.scene.tweens.add({targets:this.content,duration:66,ease:Phaser.Math.Easing.Sine.InOut,x:"-=4",yoyo:!0,repeat:3})},n.prototype.hide=function(){this.scene.tweens.killTweensOf(this.content),this.scene.tweens.add({targets:this,duration:133,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,scale:.5,onComplete:this.kill.bind(this)})},n}(Phaser.GameObjects.Container);o.FoxTalkBubble=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){return r.call(this,e,0,0,t.texture.key,t.name,{ignoreGravity:!1,isSensor:!0,render:{sprite:{xOffset:t.pivotX-.5,yOffset:t.pivotY-.5}}})||this}return n.prototype.throw=function(){var e=16.66667/this.scene.game.loop.delta,t=Phaser.Math.RND.sign()*.25*e,i=-5.45*e;this.applyForce({x:t,y:i}),this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Back.Out,scale:1.2})},n.prototype.preUpdate=function(e,t){this.angle+=.25*t*Phaser.Math.Sign(this.body.velocity.x)},n.prototype.destroyAfter=function(e){this.scene.time.delayedCall(e,this.destroy,null,this)},n}(Phaser.Physics.Matter.Image);o.ThrownFox=h})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.isEnabled=!1,this.showTimestamp=0,this.scene=n,this.sound=this.scene.sound,this.isEnabled=this.scene.game.audioType===o.SoundManagerType.WEB_AUDIO,this.addSounds()}return r.prototype.addSounds=function(){if(this.isEnabled===!1)return;this.allSounds=this.createSounds()},r.prototype.createSounds=function(){var n=this,e=[{key:o.GameSoundKey.AIM_1,volume:1},{key:o.GameSoundKey.AIM_2,volume:.5},{key:o.GameSoundKey.AIM_3,volume:.5}];return e.map(function(t){var i=n.scene.cache.audio.has(t.key);if(i)return n.sound.add(t.key,{volume:t.volume})})},r.prototype.onShow=function(){var n;if(this.isEnabled===!1)return;this.showTimestamp=Date.now(),this.scene.input.on(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this),(n=this.allSounds[0])===null||n===void 0||n.play()},r.prototype.onPointerMove=function(){var n=Date.now()-this.showTimestamp;if(n>1e3){var e=Phaser.Math.RND.bool()?this.allSounds[1]:this.allSounds[2];e&&e.play(),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)}},r.prototype.onHide=function(){if(this.isEnabled===!1)return;this.allSounds.forEach(function(n){return n==null?void 0:n.stop()}),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)},r.prototype.destroy=function(){this.allSounds&&(this.allSounds.forEach(function(n){return n==null?void 0:n.destroy()}),this.allSounds=null),this.scene&&this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)},r}();o.TrajectorySounds=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t._bouncesNum=1,t.isHidden=!1,t.name="trajectory",t.gameplay=t.scene,t.worldCopy=t.gameplay.worldCopy,t.trajectoryStart={x:0,y:0},t.trajectoryEnd={x:0,y:0},t.cameraPointerPosition={x:0,y:0},t.sounds=new o.TrajectorySounds(t.scene),t.addDots(),t.addPointer(),t}return n.prototype.addDots=function(){var e=this;this.dots=_.times(100,function(t){var i=e.scene.add.image(0,0,"gameplay","trajectory_dot");return e.add(i),i})},n.prototype.addPointer=function(){this.pointer=this.scene.add.image(0,0,"gameplay","trajectory_pointer"),this.add(this.pointer)},n.prototype.setBounces=function(e){this._bouncesNum=Phaser.Math.Clamp(e,1,5)},n.prototype.show=function(){this.revive(),this.playShowTween(),this.sounds.onShow(),this.isHidden=!1;var e=this.gameplay.items.some(function(t){return t.itemType.includes("ice")});e?this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.draw,this):(this.draw(),this.scene.input.on(Phaser.Input.Events.POINTER_MOVE,this.draw,this))},n.prototype.playShowTween=function(){this.alpha=0,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},n.prototype.hide=function(){this.kill(),this.removeSceneEventListeners(),this.sounds.onHide()},n.prototype.removeSceneEventListeners=function(){this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.draw,this),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.draw,this)},n.prototype.kill=function(){this.visible=!1,this.active=!1},n.prototype.revive=function(){this.visible=!0,this.active=!0},n.prototype.draw=function(){this.trajectoryStart=this.gameplay.fox.getHandsPosition(this.trajectoryStart),this.trajectoryEnd=this.getEndPoint(),this.doDraw(this.trajectoryStart.x,this.trajectoryStart.y,this.trajectoryEnd.x,this.trajectoryEnd.y)},n.prototype.getEndPoint=function(){this.scene.input.activePointer.positionToCamera(this.scene.cameras.main,this.cameraPointerPosition);var e=1,t=this.trajectoryEnd.x+(this.cameraPointerPosition.x-this.trajectoryEnd.x)*e,i=this.trajectoryEnd.y+(this.cameraPointerPosition.y-this.trajectoryEnd.y)*e;return{x:t,y:i}},n.prototype.doDraw=function(e,t,i,s){var a=Math.atan2(s-t,i-e);if(a>0){this.isHidden===!1&&(this.isHidden=!0,this.sounds.onHide(),this.hideDots());return}var l=this.worldCopy.getTrajectoryPoints(e,t,a,this._bouncesNum);l.length>0&&(l=__spreadArrays([{x:e,y:t}],l),this.showDots(l),this.showPointer(l),this.isHidden=!1)},n.prototype.hideDots=function(){this.dots.forEach(function(e){return e.visible=!1}),this.pointer.visible=!1},n.prototype.showDots=function(e){for(var t=0,i=0,s=22,a=0;a<e.length-1;a++){var l=e[a],c=e[a+1];if(c)for(var u=Phaser.Math.Distance.BetweenPoints(l,c),d=Phaser.Math.Angle.BetweenPoints(l,c),p=Math.floor(u/s),f=0;f<=p;f++){i=f*s;var y=this.dots[t++];if(y)y.visible=!0,y.x=l.x+Math.cos(d)*i,y.y=l.y+Math.sin(d)*i;else break}}this.hideRemainingDots(t)},n.prototype.hideRemainingDots=function(e){this.dots.forEach(function(t,i){i>=e&&(t.visible=!1)})},n.prototype.showPointer=function(e){var t=e[e.length-1],i=e[e.length-2],s=Phaser.Math.Angle.BetweenPoints(i,t),a=o.Ball.RADIUS;this.pointer.visible=!0,this.pointer.x=t.x+Math.cos(s)*a,this.pointer.y=t.y+Math.sin(s)*a,this.pointer.rotation=s+Math.PI/2},n.prototype.destroy=function(e){this.scene&&this.removeSceneEventListeners(),this.sounds.destroy(),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Container);o.Trajectory=h})(game||(game={}));var game;(function(o){var h=function(){function r(n,e,t){this.justReturned=!1,this.scene=n,this.ball=e,this.ballBody=this.ball.body,this.worldBounds=t,this.positions=[],this.velocities=[]}return r.prototype.saveInitialPositionAndVelocity=function(){this.initialPosition={x:this.ball.x,y:this.ball.y},this.initialVelocity={x:this.ballBody.velocity.x,y:this.ballBody.velocity.y},this.positions=[this.initialPosition],this.velocities=[this.initialVelocity],this.justReturned=!1},r.prototype.keepInsideWorld=function(){var n=this.worldBounds.contains(this.ball.x,this.ball.y);if(n){if(this.justReturned){this.justReturned=!1;return}this.positions.push({x:this.ball.x,y:this.ball.y}),this.velocities.push({x:this.ballBody.velocity.x,y:this.ballBody.velocity.y})}else{if(this.ball.y>this.worldBounds.bottom){var e=10,t=Phaser.Math.Clamp(this.ball.x,this.worldBounds.left+e,this.worldBounds.right-e);this.ball.setPosition(t,this.worldBounds.bottom-e),this.ball.setVelocity(0,0);return}this.returnToLastValidPosition()}},r.prototype.returnToLastValidPosition=function(){var n,e;if(this.positions.length===0)n=this.initialPosition,e=this.initialVelocity;else{n=this.positions.pop(),e=this.velocities.pop();var t=o.Ball.RADIUS;n.y<this.worldBounds.top&&(e.y*=-1,n.y=this.worldBounds.top+t),n.x>this.worldBounds.right&&(e.x*=-1,e.y*=-1,n.x=this.worldBounds.right-t),n.x<this.worldBounds.left&&(e.x*=-1,e.y*=-1,n.x=this.worldBounds.left+t)}this.ball.setPosition(n.x,n.y),this.ball.setVelocity(e.x,e.y),this.justReturned=!0},r.prototype.onBallLanded=function(){this.positions.length=0,this.velocities.length=0},r}();o.BallKeeper=h})(game||(game={}));var game;(function(o){var h;(function(e){e.CHARGE="charge",e.DISCHARGE="discharge",e.SPIN="spin",e.DROP="drop",e.THROW="throw",e.LAND="land"})(h=o.BallEvent||(o.BallEvent={}));var r;(function(e){e.ORIGINAL="ball_idle_2",e.SURPRISED="ball_surprised",e.CHARGED="ball_lightning_3"})(r=o.BallFrame||(o.BallFrame={}));var n=function(e){__extends(t,e);function t(i,s){var a=e.call(this,i.matter.world,0,0,"gameplay",r.ORIGINAL)||this;return a._damage=t.INITIAL_DAMAGE,a._isCharged=!1,a.isDropping=!1,a.isThown=!1,a.subDepth=0,a.savedInertia=0,a.subDepth=s.subDepth,a.setDepth(s.depth),a.setCircle(t.RADIUS,t.BODY_CONFIG),a.setCollisionGroup(s.collisionGroup),a.setCollisionCategory(s.collisionCategory),a.saveCollisionFilter(),a.setFixedRotation(),a.setToSleep(),a.body.plugin[o.COLLISION_TAG]=o.CollisionTag.BALL,a.keeper=new o.BallKeeper(a.scene,a,s.worldBounds),a.createHorizontalMovementTracker(),a}return Object.defineProperty(t.prototype,"isCharged",{get:function(){return this._isCharged},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"damage",{get:function(){return this._damage},enumerable:!1,configurable:!0}),t.prototype.setFixedRotation=function(){return this.savedInertia=this.body.inertia,e.prototype.setFixedRotation.call(this)},t.prototype.resetFixedRotation=function(){return this.scene.matter.body.setInertia(this.body,this.savedInertia),this},t.prototype.createHorizontalMovementTracker=function(){this.movementTracker={positionsY:[],timer:0}},t.prototype.show=function(){this.visible=!0,this.active=!0,this.alpha=0,this.scene.tweens.add({targets:this,duration:50,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},t.prototype.throw=function(i){if(this.isThown)return;this.isThown=!0,this.resetMovementTracker(),this.setAwake(),this.setVelocityByRotation(i,t.THROW_FORCE),this.keeper.saveInitialPositionAndVelocity(),this.emit(h.THROW,this)},t.prototype.resetMovementTracker=function(){this.movementTracker.positionsY.length=0,this.movementTracker.timer=0},t.prototype.setVelocityByRotation=function(i,s){var a=Math.cos(i)*s,l=Math.sin(i)*s;this.setVelocity(a,l)},t.prototype.preUpdate=function(i,s){this.checkForHorizontalMovement(s),this.isThown&&this.keeper.keepInsideWorld()},t.prototype.checkForHorizontalMovement=function(i){if(this.isThown===!1)return;if(this.isDropping)return;this.movementTracker.positionsY.push(this.y),this.movementTracker.timer+=i;var s=1e3;if(this.movementTracker.timer>s){var a=Math.min.apply(Math,this.movementTracker.positionsY),l=Math.max.apply(Math,this.movementTracker.positionsY),c=Math.abs(l-a);c<15&&this.fixHorizontalMovement(),this.movementTracker.timer-=s,this.movementTracker.positionsY.length=0}},t.prototype.fixHorizontalMovement=function(){var i=3,s=Phaser.Math.DegToRad(i),a=this.getVelocityRotation(),l=a+s;this.setVelocityByRotation(l,t.THROW_FORCE)},t.prototype.maintainConstantFlyingSpeed=function(i){if(this.isThown===!1)return;if(this.isDropping)return;var s=this.getVelocityRotation(),a=t.THROW_FORCE*(i/16.6667);this.setVelocityByRotation(s,a),this.rotation=s+Math.PI/2},t.prototype.getVelocityRotation=function(){var i=this.body.velocity.x,s=this.body.velocity.y;return Math.atan2(s,i)},t.prototype.onTouchedTheFloor=function(){this.setToSleep(),this.setIgnoreGravity(!0),this.setFixedRotation(),this.restoreCollisionFilter(),this.resetCharge(),this.keeper.onBallLanded(),this.isThown=!1,this.isDropping=!1,this.visible=!1,this.active=!1,this.emit(o.TrailEvent.HIDE,this),this.emit(h.LAND,this)},t.prototype.setCharge=function(){if(this._isCharged)return;this._isCharged=!0,this._damage*=2,this.setFrame(r.CHARGED),this.emit(h.CHARGE,this)},t.prototype.resetCharge=function(){this._isCharged=!1,this._damage=t.INITIAL_DAMAGE,this.setFrame(r.ORIGINAL),this.emit(h.DISCHARGE,this)},t.prototype.spin=function(){this.setVelocityByRotation(Phaser.Math.RND.rotation(),t.THROW_FORCE),this.emit(h.SPIN,this),this._isCharged===!1&&this.setSurprisedFrame()},t.prototype.setSurprisedFrame=function(){this.setFrame(r.SURPRISED),this.resetFrame()},t.prototype.resetFrame=function(i){var s=this;i===void 0&&(i=300),this.resetFrameEvent&&(this.resetFrameEvent.remove(),this.resetFrameEvent=null),this.resetFrameEvent=this.scene.time.delayedCall(i,function(){s._isCharged?s.setFrame(r.CHARGED):s.setFrame(r.ORIGINAL)})},t.prototype.dropToFloor=function(i){if(this.isThown===!1)return;if(this.isDropping)return;this.isDropping=!0,this.setIgnoreGravity(!1),this.saveCollisionFilter(),this.setCollidesWith(i),this.resetFixedRotation();var s=.1*Phaser.Math.Sign(this.body.velocity.x);this.setAngularVelocity(s);var a=Phaser.Math.RND.realInRange(0,.05)*Phaser.Math.RND.sign();this.applyForce({x:a,y:0}),this.emit(o.TrailEvent.SHOW,this),this.emit(h.DROP,this)},t.prototype.saveCollisionFilter=function(){this.savedCollisionFilter=__assign({},this.body.collisionFilter)},t.prototype.restoreCollisionFilter=function(){this.savedCollisionFilter&&(this.body.collisionFilter=__assign({},this.savedCollisionFilter))},t.prototype.getTrailSize=function(){return t.RADIUS-1},t.prototype.destroy=function(){this.isThown=!1,this.isDropping=!1,e.prototype.destroy.call(this)},t.INITIAL_DAMAGE=1,t.THROW_FORCE=20,t.RADIUS=29,t.BODY_CONFIG={restitution:1,friction:0,frictionAir:0,frictionStatic:0,isStatic:!1,ignoreGravity:!0,circleRadius:t.RADIUS},t}(Phaser.Physics.Matter.Image);o.Ball=n})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){this.ball=n,this.ball.on(o.BallEvent.CHARGE,this.show,this),this.ball.on(o.BallEvent.DISCHARGE,this.hide,this),this.emitter=e}return r.prototype.show=function(){this.emitter.on=!0},r.prototype.hide=function(){this.emitter.on=!1},r}();o.BallChargedEmitter=h})(game||(game={}));var game;(function(o){var h=function(){function r(n,e,t){this.scene=n,this.ball=e,this.ball.on(o.BallEvent.SPIN,this.show,this),this.ball.on(o.BallEvent.LAND,this.onBallLanded,this),this.emitter=t}return r.prototype.show=function(){var n=this;this.emitter.on=!0,this.scene.time.delayedCall(1e3,function(){n.hide()})},r.prototype.onBallLanded=function(){this.emitter.killAll(),this.emitter.on=!1},r.prototype.hide=function(){this.emitter.on=!1},r}();o.BallSpinnedEmitter=h})(game||(game={}));var game;(function(o){var h=Phaser.Geom.Line,r=function(){function n(e){this.scene=e,this.grid=this.scene.grid,this.fox=this.scene.fox,this.idleBalls=this.scene.idleBalls}return n.prototype.getPoints=function(e){var t=this.scene.idleBalls.length,i=this.fox.displayWidth*.33,s=e-i,a=e+i,l=o.GameGrid.CELL_SIZE/2,c=l,u=this.grid.getWidth()-l,d=s<c?c:s,p=new Phaser.Geom.Line(d,0,c,0),f=Phaser.Geom.Line.Length(p),y=a>u?u:a,v=new Phaser.Geom.Line(y,0,u,0),g=Phaser.Geom.Line.Length(v),m=Math.round(f/(f+g)*t),E=t-m,b=this.getPointsFromLine(p,m),C=this.getPointsFromLine(v,E),S=t,T=_.times(S,function(w){return w<m?b.shift():C.shift()});return T},n.prototype.getPointsFromLine=function(e,t){if(t===0)return[];var i=40,s=t*i,a=h.Length(e);return s>a?e.getPoints(t):e.getPoints(0,i)},n.prototype.placeIdleBallsAround=function(e,t){var i=this;Phaser.Math.RND.shuffle(e),this.getPoints(t).forEach(function(s,a){i.scene.tweens.add({targets:e[a],duration:200,ease:Phaser.Math.Easing.Cubic.Out,x:s.x})})},n.prototype.placeIdleBallsAroundInstant=function(e,t){Phaser.Math.RND.shuffle(e),this.getPoints(t).forEach(function(i,s){e[s].x=i.x})},n}();o.IdleBallsAligner=r})(game||(game={}));var game;(function(o){var h;(function(n){n.SHOW="IdleBall_SHOW",n.HIDE="IdleBall_HIDE"})(h=o.IdleBallEvent||(o.IdleBallEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,0,0,"gameplay",o.BallFrame.ORIGINAL)||this;return i._baseY=0,i.isHiding=!1,i.scheduledForLaunch=!1,i.setOrigin(.5,1),i.updateJumpHeight(),i}return Object.defineProperty(e.prototype,"jumpHeight",{get:function(){return this._jumpHeight},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"baseY",{get:function(){return this._baseY},enumerable:!1,configurable:!0}),e.prototype.show=function(){this.visible=!0,this.active=!0,this.alpha=0,this._baseY=this.y,this.playShowTween(),this.updateJumpHeight(),this.playJumpAnimation(),this.emit(h.SHOW,this)},e.prototype.playShowTween=function(){this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},e.prototype.updateJumpHeight=function(){this._jumpHeight=Phaser.Math.RND.between(35,45),this.jumpDuration=this._jumpHeight*5.3},e.prototype.playJumpAnimation=function(){var t=this;this.scale=1;var i=.15;this.scene.tweens.add({targets:this,duration:this.jumpDuration*.66,ease:Phaser.Math.Easing.Sine.InOut,scaleX:this.scale+i,scaleY:this.scale-i,yoyo:!0}),this.scene.tweens.add({targets:this,duration:this.jumpDuration,ease:Phaser.Math.Easing.Quadratic.Out,y:this.y-this._jumpHeight,completeDelay:33,onComplete:function(){t.scene.tweens.add({targets:t,duration:t.jumpDuration,ease:Phaser.Math.Easing.Linear.Linear,y:t.y+t._jumpHeight,onComplete:function(){t.playJumpAnimation()}})}})},e.prototype.hide=function(){this.stopJumpAnimation(),this.playHideTween(),this.emit(h.HIDE,this)},e.prototype.stopJumpAnimation=function(){this.scene.tweens.killTweensOf(this)},e.prototype.playHideTween=function(){var t=this;this.isHiding=!0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){t.isHiding=!1,t.active=!1,t.visible=!1}})},e.prototype.stopHideTween=function(){this.scene.tweens.killTweensOf(this),this.isHiding=!1},e.prototype.kill=function(){this.stopJumpAnimation(),this.emit(h.HIDE,this),n.prototype.kill.call(this)},e.prototype.revive=function(){this.y=this._baseY,this.playJumpAnimation(),this.emit(h.SHOW,this),n.prototype.revive.call(this)},e.prototype.slightlyMoveAside=function(t,i){var s=50,a=s,l=i.getWidth()-s,c=t+Phaser.Math.RND.between(-100,100),u=Phaser.Math.Clamp(c,a,l);return this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,x:u})},e.prototype.destroy=function(){n.prototype.destroy.call(this,!0)},e}(Phaser.GameObjects.Image);o.IdleBall=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s){i===void 0&&(i="gameplay"),s===void 0&&(s="ball_idle_shadow");var a=r.call(this,e,0,0,i,s)||this;return a.visible=!1,a.active=!1,a.ball=t,a.ball.on(o.IdleBallEvent.SHOW,a.show,a),a.ball.on(o.IdleBallEvent.HIDE,a.hide,a),a.scene.events.on("postupdate",a.postUpdate,a),a}return n.prototype.show=function(){this.visible=!0,this.active=!0,this.y=this.ball.baseY},n.prototype.hide=function(){this.visible=!1,this.active=!1},n.prototype.postUpdate=function(){if(!this.visible)return;var e=this.ball.baseY,t=this.ball.baseY-this.ball.jumpHeight;this.x=this.ball.x+3,this.updateScale(e,t),this.updateAlpha(e,t)},n.prototype.updateScale=function(e,t){var i=1,s=1.5;this.scale=Phaser.Math.MapLinear(this.ball.y,e,t,i,s)},n.prototype.updateAlpha=function(e,t){var i=.66,s=.33;this.alpha=Phaser.Math.MapLinear(this.ball.y,e,t,i,s)},n.prototype.destroy=function(e){this.scene&&this.scene.events.removeListener("postupdate",this.postUpdate,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.JumpingBallShadow=h})(game||(game={}));var game;(function(o){var h;(function(n){n.LAUNCH="launch",n.EXPLODE="explode"})(h=o.WinningBallEvent||(o.WinningBallEvent={}));var r=function(n){__extends(e,n);function e(t){return n.call(this,t,0,0,"gameplay","ball_idle")||this}return e.prototype.launch=function(t,i){var s=this,a=i===Phaser.LEFT?-1:1,l=o.GameGrid.CELL_SIZE,c=this.x+Phaser.Math.RND.between(0,200)*a,u=this.y-Phaser.Math.RND.between(4*l,7*l),d=Phaser.Math.Distance.Between(this.x,this.y,c,u),p=d*1.2;this.scene.tweens.add({delay:t,targets:this,x:c,y:u,duration:p,ease:Phaser.Math.Easing.Back.Out,easeParams:[.66],onStart:function(){s.emit(h.LAUNCH)}}),this.scene.time.delayedCall(t+p*.47,function(){s.explode()})},e.prototype.explode=function(t){var i=this;t===void 0&&(t=0),this.scene.tweens.add({targets:this,delay:t+250,duration:50,ease:Phaser.Math.Easing.Cubic.Out,alpha:0}),this.scene.tweens.add({targets:this,delay:t,duration:300,ease:Phaser.Math.Easing.Back.In,scale:2,onComplete:function(){i.emit(h.EXPLODE,i),i.destroy()}})},e}(Phaser.GameObjects.Image);o.WinningBall=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e.matter.world,0,0,t.texture.key,t.frame.name)||this;return i.setCircle(o.Ball.RADIUS,__assign(__assign({},o.Ball.BODY_CONFIG),{ignoreGravity:!1,isSensor:!0})),i}return n.prototype.throw=function(e){var t=e===Phaser.LEFT?-1:1,i=Phaser.Math.RND.realInRange(.022,.05)*t,s=Phaser.Math.RND.realInRange(-.38,-.22),a=16.66667/this.scene.game.loop.delta;this.applyForce({x:i*a,y:s*a}),this.setAngularVelocity(.1*t),this.playScaleTween()},n.prototype.playScaleTween=function(){this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Back.Out,scale:1.2})},n.prototype.destroyAfter=function(e){this.scene.time.delayedCall(e,this.destroy,null,this)},n}(Phaser.Physics.Matter.Image);o.LosingBall=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s,a){var l=r.call(this,e,0,0,t,i)||this;return l.originalAlpha=1,l._column=s,l._row=a,l.setData("object_type","game_cell"),l}return Object.defineProperty(n.prototype,"row",{get:function(){return this._row},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"column",{get:function(){return this._column},enumerable:!1,configurable:!0}),n.prototype.destroy=function(){},n.prototype.toString=function(){return"[column: "+this._column+", row: "+this._row+"]"},n}(Phaser.GameObjects.Image);o.Cell=h})(game||(game={}));var game;(function(o){var h;(function(n){n[n.TOP=0]="TOP",n[n.RIGHT=1]="RIGHT",n[n.BOTTOM=2]="BOTTOM",n[n.LEFT=3]="LEFT"})(h=o.GridDirection||(o.GridDirection={}));var r=function(n){__extends(e,n);function e(t,i,s){var a=n.call(this,t)||this;return a.debug=!1,t.add.existing(a),a.name="grid",a._columns=i,a._rows=s,a.testRect=a.createTestRect(),a.addCells(),a.addRowLabels(),a}return Object.defineProperty(e.prototype,"columns",{get:function(){return this._columns},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),e.prototype.createTestRect=function(){var t=e.CELL_SIZE*.9;return new Phaser.Geom.Rectangle(0,0,t,t)},e.prototype.addCells=function(){this.cells=[];for(var t=0,i=.1/(this._rows-1),s=0;s<this._rows;s++)for(var a=0;a<this._columns;a++){var l=new o.Cell(this.scene,"gameplay","cell",a,s);l.x=e.CELL_SIZE/2+a*e.CELL_SIZE,l.y=this.getRowY(s),l.alpha=t+i*s,l.originalAlpha=l.alpha,this.cells.push(l),this.add(l)}},e.prototype.addRowLabels=function(){var t=this;this.rowLabels=_.times(this._rows,function(i){var s=i.toString(),a=t.scene.add.bitmapText(0,0,o.BitmapGameFont.INGAME_GUI_DIGITS,s,28,Phaser.RIGHT);a.setOrigin(0,.5),a.setData("row",i),a.visible=t.debug,t.add(a);var l=t.getCellAt(i,0);return Phaser.Display.Align.In.BottomLeft(a,l,-6,6),a})},e.prototype.getRowY=function(t){var i=this._rows-t-1;return e.CELL_SIZE/2+i*e.CELL_SIZE},e.prototype.getRowByY=function(t){var i=Math.floor(t/e.CELL_SIZE),s=this._rows-i-1;return s},e.prototype.getWidth=function(){return this._columns*e.CELL_SIZE},e.prototype.getHeight=function(){return this._rows*e.CELL_SIZE},e.prototype.getCenter=function(){return{x:this.x+this.getWidth()/2,y:this.y+this.getHeight()/2}},e.prototype.getCellAt=function(t,i){return this.cells.find(function(s){return s.row===t&&s.column===i})},e.prototype.getCellAtXY=function(t,i){var s=this.getRowByY(i),a=Math.floor(t/e.CELL_SIZE);return this.getCellAt(s,a)},e.prototype.getCellNeighbour=function(t,i){switch(i){case h.TOP:return this.getCellAt(t.row-1,t.column);case o.GridDirection.RIGHT:return this.getCellAt(t.row,t.column+1);case o.GridDirection.BOTTOM:return this.getCellAt(t.row+1,t.column);case o.GridDirection.LEFT:return this.getCellAt(t.row,t.column-1)}},e.prototype.getCellNeighbours=function(t){return[this.getCellNeighbour(t,h.TOP),this.getCellNeighbour(t,h.RIGHT),this.getCellNeighbour(t,h.BOTTOM),this.getCellNeighbour(t,h.LEFT)]},e.prototype.isCellFree=function(t,i,s){var a=this.getCellAt(i,t);if(!a)return!1;var l=e.CELL_SIZE*.9;this.testRect.x=a.x-l/2,this.testRect.y=a.y-l/2,this.testRect.setSize(l);var c=s||this.scene.matter.world.getAllBodies().filter(function(u){return u.isStatic});return this.scene.matter.intersectRect(this.testRect.x,this.testRect.y,this.testRect.width,this.testRect.height,!1,c).length===0},e.prototype.toggleDebug=function(){var t=this;this.debug=!this.debug,this.rowLabels.forEach(function(i){return i.visible=t.debug}),this.cells.forEach(function(i){i.alpha=t.debug?.33:i.originalAlpha})},e.prototype.showClearGridFx=function(t,i){var s=this;i===void 0&&(i=0);var a=Object.values(_.groupBy(this.cells,"column"));a.forEach(function(l,c){var u=i+c*33;s.scene.tweens.add({delay:u,targets:l,duration:300,ease:Phaser.Math.Easing.Sine.InOut,alpha:t,yoyo:!0})})},e.prototype.highlightRow=function(t,i,s){var a=this,l=this.cells.filter(function(c){return c.row===t});l.forEach(function(c){a.scene.tweens.add({delay:s,targets:c,duration:250,ease:Phaser.Math.Easing.Sine.InOut,alpha:i,yoyo:!0,hold:100})})},e.LOSE_ROW=2,e.CELL_SIZE=100,e.COLUMNS=7,e.ROWS=9,e}(Phaser.GameObjects.Container);o.GameGrid=r})(game||(game={}));var game;(function(o){var h=function(){function r(n,e,t){this.scene=n,this.matter=this.scene.matter,this.createWalls(e,t)}return r.prototype.createWalls=function(n,e){var t=n+r.THICKNESS*2,i=e+r.THICKNESS*2,s={restitution:1,isStatic:!0,friction:0,frictionAir:0,frictionStatic:0,label:o.CollisionTag.WALL};this.top=this.matter.add.rectangle(0,0,t,r.THICKNESS,s),this.right=this.matter.add.rectangle(0,0,r.THICKNESS,i,s),this.bottom=this.matter.add.rectangle(0,0,t,r.THICKNESS,__assign(__assign({},s),{label:o.CollisionTag.FLOOR})),this.left=this.matter.add.rectangle(0,0,r.THICKNESS,i,s),this.all=[this.top,this.right,this.bottom,this.left],this.all.forEach(function(a){a.plugin[o.COLLISION_TAG]=o.CollisionTag.WALL}),this.bottom.plugin[o.COLLISION_TAG]=o.CollisionTag.FLOOR},r.prototype.align=function(n){var e=r.THICKNESS/2,t=n.x+n.getWidth()/2,i=n.y+n.getHeight()/2;this.matter.body.setPosition(this.top,{x:t,y:n.y-e}),this.matter.body.setPosition(this.right,{x:n.getWidth()+e,y:i}),this.matter.body.setPosition(this.bottom,{x:t,y:n.getHeight()+e}),this.matter.body.setPosition(this.left,{x:-e,y:i})},r.THICKNESS=160,r}();o.GridWalls=h})(game||(game={}));var game;(function(o){var h;(function(r){r.PRE_DESTROY="GameItem_PRE_DESTROY"})(h=o.GameItemEvent||(o.GameItemEvent={}))})(game||(game={}));var game;(function(o){var h;(function(n){n.KILL_START="kill_start",n.ACTIVATE="activate"})(h=o.LightningEvent||(o.LightningEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t,0,0,i.frames[0].textureKey,i.frames[0].frame.name)||this;return s._wasActivated=!1,s.animation=i,s.setCircle(30,{isStatic:!0,isSensor:!0}),s.body.plugin[o.COLLISION_TAG]=o.CollisionTag.LIGHTNING,s._itemType=o.ItemType.LIGHTNING,s.name="lightning",s.grid=new o.GridComponent(s),s.killTweens=new o.KillTweens(s.scene,s),s.hideComponent=new o.HideComponent(s.scene,s),s}return Object.defineProperty(e.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"wasActivated",{get:function(){return this._wasActivated},enumerable:!1,configurable:!0}),e.prototype.startIdleTweensAndAnimation=function(){var t=this,i=Phaser.Math.RND.between(0,300);this.scene.time.delayedCall(i,function(){t.play(t.animation.key),t.playIdleTweens()})},e.prototype.playIdleTweens=function(){var t=this,i=4*Phaser.Math.RND.sign(),s=600;this.scene.tweens.add({targets:this,duration:s/2,ease:Phaser.Math.Easing.Sine.Out,angle:i,onComplete:function(){t.scene.tweens.add({targets:t,duration:s,ease:Phaser.Math.Easing.Sine.InOut,angle:t.angle*-1,yoyo:!0,repeat:-1})}}),this.scene.tweens.add({targets:this,duration:s*1.5,ease:Phaser.Math.Easing.Sine.InOut,scale:1.12,yoyo:!0,repeat:-1})},e.prototype.activate=function(){if(this._wasActivated===!1&&(this._wasActivated=!0,this.emit(h.ACTIVATE,this)),this.scaleTween&&this.scaleTween.isPlaying())return;this.playScaleAndAlphaTween()},e.prototype.playScaleAndAlphaTween=function(){this.scale=1,this.alpha=1,this.scaleTween=this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Sine.InOut,scale:1.4,alpha:.5,yoyo:!0})},e.prototype.kill=function(){this.emit(h.KILL_START,this),this.on(o.KillTweensEvent.COMPLETE,this.destroy,this),this.killTweens.play()},e.prototype.hideOnLevelComplete=function(t){this.hideComponent.hide(t)},e.prototype.destroy=function(t){this.scene&&this.scene.tweens.killTweensOf(this),this.emit(o.GameItemEvent.PRE_DESTROY,this,t),n.prototype.destroy.call(this,t),this.grid.destroy()},e}(Phaser.Physics.Matter.Sprite);o.Lightning=r})(game||(game={}));var game;(function(o){var h;(function(n){n.KILL_START="kill_start",n.ACTIVATE="activate"})(h=o.SpinnerEvent||(o.SpinnerEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t,0,0,i.frames[0].textureKey,i.frames[0].frame.name)||this;return s.timeScale=1,s.initialAngularSpeed=.1,s.angularSpeed=0,s.wasActivated=!1,s.name="spinner",s.animation=i,s._itemType=o.ItemType.SPINNER,s.setCircle(30,{isStatic:!0,isSensor:!0}),s.body.plugin[o.COLLISION_TAG]=o.CollisionTag.SPINNER,s.spinnedBalls=[],s.angularSpeed=Phaser.Math.RND.sign()*s.initialAngularSpeed,s.grid=new o.GridComponent(s),s.killTweens=new o.KillTweens(s.scene,s),s.hideComponent=new o.HideComponent(s.scene,s),s}return Object.defineProperty(e.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),e.prototype.startIdleTweensAndAnimation=function(){var t=this,i=Phaser.Math.RND.between(0,500);this.scene.time.delayedCall(i,function(){t.play(t.animation.key),t.playIdleTween()})},e.prototype.playIdleTween=function(){this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:.9,yoyo:!0,repeat:-1})},e.prototype.activate=function(){if(this.wasActivated===!1&&(this.wasActivated=!0,this.emit(h.ACTIVATE,this)),this.scaleTween&&this.scaleTween.isPlaying())return;this.playScaleAndAlphaTween(),this.playAngularSpeedTween()},e.prototype.playScaleAndAlphaTween=function(){this.scale=1,this.alpha=1,this.scaleTween=this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,alpha:.5,yoyo:!0})},e.prototype.playAngularSpeedTween=function(){if(this.angularSpeedTween&&this.angularSpeedTween.isPlaying())return;var t=Phaser.Math.Sign(this.angularSpeed);this.angularSpeed=this.initialAngularSpeed*5*t,this.scene.tweens.add({targets:this,delay:1e3,duration:1e3,ease:Phaser.Math.Easing.Linear.Linear,angularSpeed:this.initialAngularSpeed*t})},e.prototype.preUpdate=function(t,i){n.prototype.preUpdate.call(this,t,i),this.updateSpinnedBalls(t),this.angle+=this.angularSpeed*i*this.timeScale},e.prototype.updateSpinnedBalls=function(t){if(this.spinnedBalls.length===0)return;this.spinnedBalls=this.spinnedBalls.filter(function(i){return t-i.timestamp<133})},e.prototype.kill=function(){this.emit(h.KILL_START,this),this.once(o.KillTweensEvent.COMPLETE,this.destroy,this),this.killTweens.play()},e.prototype.hideOnLevelComplete=function(t){this.hideComponent.hide(t)},e.prototype.destroy=function(t){this.scene&&this.scene.tweens.killTweensOf(this),this.emit(o.GameItemEvent.PRE_DESTROY,this,t),n.prototype.destroy.call(this,t),this.grid.destroy(),this.spinnedBalls=null},e}(Phaser.Physics.Matter.Sprite);o.Spinner=r})(game||(game={}));var game;(function(o){var h=function(){function r(n,e,t){this.isDestroyed=!1,this.scene=n,this.emitter=t,this.emitter.startFollow(e),this.spinner=e,this.spinner.on(o.SpinnerEvent.KILL_START,this.destroy,this),this.spinner.on(o.HideEvent.START,this.hide,this),this.spinner.on(Phaser.GameObjects.Events.DESTROY,this.destroy,this)}return r.prototype.hide=function(){this.emitter.killAll(),this.emitter.on=!1},r.prototype.destroy=function(){if(this.isDestroyed)return;this.isDestroyed=!0,this.emitter.remove()},r}();o.SpinnerIdleEmitter=h})(game||(game={}));var game;(function(o){var h;(function(n){n.START="START",n.STOP="STOP"})(h=o.StompingEvent||(o.StompingEvent={}));var r=function(){function n(e,t){this._isStomping=!1,this.originalY=0,this.scene=e,this.owner=t}return n.prototype.start=function(){if(this._isStomping)return;this._isStomping=!0,this.originalY=this.owner.y,this.owner.body.isStomping=!0,this.owner.body.originalY=this.originalY,this.owner.emit(h.START,this.owner),this.startStompingTween()},n.prototype.startStompingTween=function(){var e=this,t=16;this.stompingTween=this.scene.tweens.add({targets:this.owner,duration:300,ease:Phaser.Math.Easing.Linear.Linear,y:this.originalY-t,onComplete:function(){e.stompingTween=e.scene.tweens.add({targets:e.owner,duration:500,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.2],y:e.originalY,completeDelay:100,onComplete:e.startStompingTween.bind(e)})}})},n.prototype.stop=function(){if(this._isStomping===!1)return;this._isStomping=!1,this.owner.body.isStomping=!1,this.owner.emit(h.STOP,this.owner),this.stopStompingTween()},n.prototype.stopStompingTween=function(){this.stompingTween&&this.stompingTween.stop(),this.scene.tweens.add({targets:this.owner,duration:100,ease:Phaser.Math.Easing.Cubic.Out,y:this.originalY})},n.prototype.destroy=function(){this.owner=null},n}();o.StompingComponent=r})(game||(game={}));var game;(function(o){var h;(function(n){n.HIDE="block_hide",n.FORCE_KILL="force_kill",n.ZAP="zap",n.HIT_BY_CRACKER="hit_by_cracker"})(h=o.BasicBlockEvent||(o.BasicBlockEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t,0,0,i,s,l)||this;return c.wasHitByCracker=!1,c.isReady=!0,c.matterBody=c.body,c.body.plugin[o.COLLISION_TAG]=o.CollisionTag.BASIC_BLOCK,c._itemType=o.ItemType.BASIC_BLOCK,c.name="basic_block",c.grid=new o.GridComponent(c),c.health=new o.HealthComponent(c,a),c.stomping=new o.StompingComponent(c.scene,c),c.hideComponent=new o.HideComponent(c.scene,c),c.on(o.HealthEvent.DAMAGE,c.onHit,c),c.on(o.HealthEvent.KILL,c.kill,c),c}return Object.defineProperty(e.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),e.prototype.onHit=function(){this.playHitTween()},e.prototype.playHitTween=function(){if(this.scaleTween&&this.scaleTween.isPlaying())return;this.scaleTween=this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Sine.InOut,scale:{start:1,from:1,to:.9},yoyo:!0})},e.prototype.kill=function(){var t=this;this.scene.matter.world.remove(this.matterBody),this.scene.tweens.killTweensOf(this);var i=270;this.scene.tweens.add({targets:this,duration:i,ease:Phaser.Math.Easing.Back.In,scale:.2});var s=30,a=i-s;this.scene.tweens.add({targets:this,delay:a,duration:s,ease:Phaser.Math.Easing.Cubic.Out,alpha:{start:1,from:1,to:0},onComplete:function(){t.destroy(!1)}})},e.prototype.hideOnLevelComplete=function(t){this.hideComponent.hide(t)},e.prototype.forceKill=function(){this.emit(h.FORCE_KILL,this),this.visible=!1,this.active=!1},e.prototype.zap=function(){this.emit(h.ZAP,this)},e.prototype.hitByCracker=function(){this.wasHitByCracker=!0,this.emit(h.HIT_BY_CRACKER,this)},e.prototype.startStomping=function(){this.stomping.start()},e.prototype.stopStomping=function(){this.stomping.stop()},e.prototype.destroy=function(t){this.scene&&this.scene.tweens.killTweensOf(this),this.emit(o.GameItemEvent.PRE_DESTROY,this,t),n.prototype.destroy.call(this,t),this.stomping.destroy(),this.health.destroy(),this.grid.destroy()},e}(Phaser.Physics.Matter.Image);o.BasicBlock=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,"gameplay","blocks/block_ground_shadow")||this;return i.block=t,i.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,i.followBlock,i),i}return n.prototype.followBlock=function(){this.x=this.block.x+this.block.displayWidth*(.5-this.block.originX),this.y=this.block.y+this.block.displayHeight*(1-this.block.originY),this.displayWidth=this.getDisplayWidth()},n.prototype.getDisplayWidth=function(){return this.block.itemType===o.ItemType.ICE_RHOMB?this.block.displayWidth*1.1:this.block.displayWidth*1.35},n.prototype.show=function(){this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},n.prototype.destroy=function(e){this.scene&&this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.followBlock,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.BlockShadow=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,"gameplay",t.frame.name+"_face_idle")||this;i.offsetX=0,i.offsetY=0,i.scaleOffset=0,i.idleFrame=t.frame.name+"_face_idle",i.hitFrame=t.frame.name+"_face_hit",i.blinkFrame=t.frame.name+"_face_blink",i.block=t,i.block.on(o.HealthEvent.DAMAGE,i.onBlockDamage,i),i.block.on(o.HealthEvent.KILL,i.onBlockKill,i),i.block.on(o.BasicBlockEvent.FORCE_KILL,i.destroy.bind(i,!1)),i.block.on(o.BasicBlockEvent.HIT_BY_CRACKER,i.hitByCracker,i),i.block.on(o.HideEvent.COMPLETE,i.destroy.bind(i,!1)),i.block.on(Phaser.GameObjects.Events.DESTROY,i.destroy.bind(i,!1)),i.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,i.followBlock,i);var s=i.block.itemType,a=[o.ItemType.BASIC_BLOCK,o.ItemType.ICE_BLOCK,o.ItemType.PINATA_BLOCK];if(a.includes(s)&&i.playFloatAnimation(),s===o.ItemType.DYNAMITE_BLOCK){var l=_.range(0,1e3,200),c=Phaser.Math.RND.pick(l);i.playExplosiveAnimation(c)}if(s===o.ItemType.TRIANGLE){var u=t.frame.name;u.includes("1")||u.includes("2")?i.playFloatAnimation():u==="blocks/triangle_03"?i.playFloatAnimation(-3.5,-3.5):i.playFloatAnimation(3.5,-3.5)}return i}return n.getFaceFrames=function(e){return{idle:e.frame.name+"_face_idle",hit:e.frame.name+"_face_hit",blink:e.frame.name+"_face_blink"}},n.prototype.playExplosiveAnimation=function(e){var t=this,i;e===void 0&&(e=0),(i=this.scene)===null||i===void 0||i.tweens.add({delay:e,targets:this,duration:400,ease:Phaser.Math.Easing.Cubic.Out,scaleOffset:-.2,onComplete:function(){var s;(s=t.scene)===null||s===void 0||s.tweens.add({targets:t,duration:1500,ease:Phaser.Math.Easing.Elastic.Out,scaleOffset:0,onComplete:function(){t.playExplosiveAnimation(2500)}})}})},n.prototype.playFloatAnimation=function(e,t){e===void 0&&(e=0),t===void 0&&(t=-7);var i=_.range(0,400,100),s=Phaser.Math.RND.pick(i);this.scene.tweens.add({delay:s,targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,offsetX:e,offsetY:t,repeat:-1,yoyo:!0})},n.prototype.onBlockDamage=function(){if(this.block.itemType===o.ItemType.DYNAMITE_BLOCK)return;this.setFrame(this.hitFrame),this.resetFrameAfter(300)},n.prototype.resetFrameAfter=function(e){var t=this;this.resetFrameEvent&&(this.resetFrameEvent.remove(),this.resetFrameEvent=null),this.resetFrameEvent=this.scene.time.delayedCall(e,function(){t.setFrame(t.idleFrame)})},n.prototype.onBlockKill=function(){if(!this.scene)return;this.block.wasHitByCracker===!1&&this.setDepth(o.GameplayDepth.DEAD_BLOCK_FACES),this.scene.tweens.killTweensOf(this)},n.prototype.hitByCracker=function(){this.setDepth(o.GameplayDepth.HIT_BY_CRACKER_FACE),this.scene.tweens.killTweensOf(this)},n.prototype.followBlock=function(){this.x=this.block.x+this.offsetX+this.displayWidth*(this.originX-this.block.originX),this.y=this.block.y+this.offsetY+this.displayHeight*(this.originY-this.block.originY),this.scale=this.block.scale+this.scaleOffset},n.prototype.destroy=function(e){this.scene&&(this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.followBlock,this),this.scene.tweens.killTweensOf(this)),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.BlockFace=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,"gameplay","blocks/white_copies/basic_block_01")||this;return t.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,t.postUpdate,t),t}return n.getFrame=function(e){return"blocks/white_copies/"+e.split("/")[1]},n.prototype.postUpdate=function(){if(this.visible===!1)return;if(!this.originalBlock)return;this.x=this.originalBlock.x+this.originalBlock.displayWidth*(.5-this.originalBlock.originX),this.y=this.originalBlock.y+this.originalBlock.displayHeight*(.5-this.originalBlock.originY),this.scale=this.originalBlock.scale,this.angle=this.originalBlock.angle},n.prototype.setBlock=function(e){this.active=!0,this.originalBlock=e,this.originalBlock.on(o.BasicBlockEvent.ZAP,this.show,this),this.originalBlock.on(o.BasicBlockEvent.FORCE_KILL,this.kill,this),this.originalBlock.on(Phaser.GameObjects.Events.DESTROY,this.kill,this),this.setFrame(n.getFrame(this.originalBlock.frame.name))},n.prototype.show=function(){var e=this;if(this.visible)return;this.visible=!0,this.alpha=0,this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:66,ease:Phaser.Math.Easing.Cubic.Out,alpha:.7,onComplete:function(){e.scene.tweens.add({targets:e,duration:400,ease:Phaser.Math.Easing.Quartic.In,alpha:0,onComplete:function(){e.visible=!1}})}})},n.prototype.kill=function(){this.originalBlock.off(o.BasicBlockEvent.ZAP,this.show,this),this.originalBlock.off(o.BasicBlockEvent.FORCE_KILL,this.kill,this),this.originalBlock.off(Phaser.GameObjects.Events.DESTROY,this.kill,this),r.prototype.kill.call(this)},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.BlockWhiteCopy=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,"gameplay","blocks/white_copies/basic_block_01")||this;return t.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,t.followBlock,t),t}return n.getFrame=function(e){return"blocks/red_copies/"+e.split("/")[1]},n.prototype.kill=function(){this.visible=!1,this.active=!1},n.prototype.revive=function(){this.visible=!0,this.active=!0},n.prototype.setBlock=function(e){this.originalBlock=e,this.originalBlock.on(o.StompingEvent.STOP,this.hide,this),this.originalBlock.on(Phaser.GameObjects.Events.DESTROY,this.destroy,this),this.setFrame(o.BlockWhiteCopy.getFrame(this.originalBlock.frame.name)),this.setTint(16711680)},n.prototype.playFadeTween=function(){this.alpha=.1,this.scene.tweens.add({targets:this,duration:500,ease:Phaser.Math.Easing.Sine.InOut,alpha:.5,yoyo:!0,repeat:-1})},n.prototype.hide=function(){var e=this;this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){e.kill()}})},n.prototype.followBlock=function(){if(this.visible===!1)return;this.x=this.originalBlock.x+this.originalBlock.displayWidth*(.5-this.originalBlock.originX),this.y=this.originalBlock.y+this.originalBlock.displayHeight*(.5-this.originalBlock.originY),this.scale=this.originalBlock.scale,this.angle=this.originalBlock.angle},n.prototype.destroy=function(e){this.scene&&this.scene.tweens.killTweensOf(this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.BlockRedCopy=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,o.BitmapGameFont.BLOCK_LIVES,"0",30)||this;return t.setOrigin(.5,.5),t.scene.events.on("postupdate",t.followBlock,t),t}return n.prototype.setBlock=function(e){this.blockOffset=this.getBlockOffset(e),this.block=e,this.block.on(o.HealthEvent.DAMAGE,this.onBlockHit,this),this.block.on(o.HealthEvent.KILL,this.hide,this),this.block.on(o.HideEvent.START,this.hide,this),this.block.on(Phaser.GameObjects.Events.DESTROY,this.hide,this),this.updateLives()},n.prototype.getBlockOffset=function(e){return{x:e.displayWidth*(.5-e.originX)-3,y:-e.displayHeight*e.originY+4}},n.prototype.updateLives=function(){this.block&&this.setText(this.block.health.value.toString())},n.prototype.onBlockHit=function(){this.updateLives()},n.prototype.hide=function(){this.block.off(o.HealthEvent.DAMAGE,this.onBlockHit,this),this.block.off(o.HealthEvent.KILL,this.hide,this),this.block.off(Phaser.GameObjects.Events.DESTROY,this.hide,this),this.kill()},n.prototype.followBlock=function(){if(!this.visible)return;if(!this.block)return;this.x=this.block.x+this.blockOffset.x,this.y=this.block.y+this.blockOffset.y},n.prototype.destroy=function(e){this.scene&&this.scene.events.on("postupdate",this.followBlock,this),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.BitmapText);o.BlockHealthCounter=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s,a){var l=r.call(this,e,t,i,s,a)||this;return l._itemType=o.ItemType.TRIANGLE,l}return n.getFrame=function(e){return"blocks/triangle_0"+e},n.TOP_LEFT_FRAME="blocks/triangle_03",n.TOP_RIGHT_FRAME="blocks/triangle_04",n.BOTTOM_RIGHT_FRAME="blocks/triangle_02",n.BOTTOM_LEFT_FRAME="blocks/triangle_01",n.ALL_FRAMES=[n.TOP_LEFT_FRAME,n.TOP_RIGHT_FRAME,n.BOTTOM_RIGHT_FRAME,n.BOTTOM_LEFT_FRAME],n}(o.BasicBlock);o.TriangleBlock=h})(game||(game={}));var game;(function(o){var h;(function(n){n[n.RIGHT=1]="RIGHT",n[n.LEFT=-1]="LEFT",n[n.NONE=0]="NONE"})(h=o.Direction||(o.Direction={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t,i,s,a,l)||this;return c.timeScale=1,c.isMoving=!1,c.velocityK=1,c.lastDirection=h.NONE,c.direction=h.NONE,c.updateDirectionTimer=0,c.gameplay=c.scene,c.name="ice_block",c.position={x:0,y:0},c.velocity={x:0,y:0},c._itemType=o.ItemType.ICE_BLOCK,c.matterBody.plugin.isMoving=!0,c.collisionPoints=[{x:0,y:0},{x:0,y:0},{x:0,y:0}],c}return e.prototype.startMoving=function(){this.isMoving=!0},e.prototype.preUpdate=function(t,i){this.isMoving&&this.updateMovement(t,i)},e.prototype.updateMovement=function(t,i){this.lastDirection=this.direction,this.updateDirection(i),this.updateVelocityAndPosition(i),this.direction!==this.lastDirection&&(this.velocityK=0,this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear.Linear,velocityK:1}))},e.prototype.updateDirection=function(t){this.updateDirectionTimer+=t,this.updateDirectionTimer>60&&(this.direction=this.getNewDirection(this.direction),this.updateDirectionTimer-=60)},e.prototype.updateVelocityAndPosition=function(t){this.velocity.x=e.MOVING_SPEED*this.direction*this.timeScale*this.velocityK*t,this.position.x=this.x+this.velocity.x,this.position.y=this.y,this.scene.matter.body.setPosition(this.matterBody,this.position),this.scene.matter.body.setVelocity(this.matterBody,this.velocity)},e.prototype.getNewDirection=function(t){var i=t;if(t===h.NONE){var s=Phaser.Math.RND.shuffle([h.LEFT,h.RIGHT]),a=s[0],l=this.isDirectionFree(a);if(l)i=a;else{var c=s[1],u=this.isDirectionFree(c);u&&(i=c)}return i}var d=this.isDirectionFree(t);if(d===!1){var p=this.negateDirection(t),f=this.isDirectionFree(p);f?i=p:i=h.NONE}return i},e.prototype.isDirectionFree=function(t){var i=this,s=this.width/2+1,a=t===h.LEFT?this.x-s:this.x+s,l=this.y-o.GameGrid.CELL_SIZE/2+5,c=this.y,u=this.y+o.GameGrid.CELL_SIZE/2-5;this.collisionPoints[0].x=a,this.collisionPoints[0].y=l,this.collisionPoints[1].x=a,this.collisionPoints[1].y=c,this.collisionPoints[2].x=a,this.collisionPoints[2].y=u;var d=this.getBodiesToCheck();return this.collisionPoints.every(function(p){return i.scene.matter.intersectPoint(p.x,p.y,d).length===0})},e.prototype.negateDirection=function(t){return t===h.NONE?h.NONE:t===h.LEFT?h.RIGHT:h.LEFT},e.prototype.getBodiesToCheck=function(){var t=this,i=this.grid.getRow();return this.scene.matter.world.getAllBodies().filter(function(s){var a=s!==t.matterBody;return a&&s.isStatic&&t.areInSameRow(i,s)})},e.prototype.areInSameRow=function(t,i){var s=this.getGridRow(i);return s===-1?!0:s===t},e.prototype.getGridRow=function(t){var i=t.gameObject;if(!i)return-1;var s=typeof i.grid!="undefined";return s===!1?-1:i.grid.getRow()},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t)},e.MOVING_SPEED=.075,e}(o.BasicBlock);o.IceBlock=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s,a,l){var c=r.call(this,e,i,s,a,l)||this;return c.angularSpeed=.06,c.name="rotating_ice_block",c.matterBody.plugin.isRotating=!0,c._itemType=t,c}return n.prototype.preUpdate=function(e,t){r.prototype.preUpdate.call(this,e,t),this.isMoving&&this.updateRotation(t)},n.prototype.updateRotation=function(e){this.angle+=this.angularSpeed*this.direction*this.timeScale*this.velocityK*e},n}(o.IceBlock);o.RotatingIceBlock=h})(game||(game={}));var game;(function(o){var h;(function(n){n.EXPLODE="explode"})(h=o.DynamiteBlockEvent||(o.DynamiteBlockEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t,i,s,a,l)||this;return c._explosionRadius=o.GameGrid.CELL_SIZE*1.5,c._explosionDamage=5,c._itemType=o.ItemType.DYNAMITE_BLOCK,c}return Object.defineProperty(e.prototype,"explosionDamage",{get:function(){return this._explosionDamage},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"explosionRadius",{get:function(){return this._explosionRadius},enumerable:!1,configurable:!0}),e.prototype.kill=function(){var t=this;this.scene.matter.world.remove(this.matterBody),this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:350,ease:Phaser.Math.Easing.Back.In,scale:0}),this.scene.tweens.add({targets:this,duration:50,delay:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){t.emit(h.EXPLODE,t),t.destroy()}})},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t)},e}(o.BasicBlock);o.DynamiteBlock=r})(game||(game={}));var game;(function(o){var h;(function(n){n.DESTROY="pinata_destroy"})(h=o.PinataEvent||(o.PinataEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t,i,s,a,l)||this;return c.name="pinata_block",c._itemType=o.ItemType.PINATA_BLOCK,c}return e.prototype.kill=function(){var t=this;this.scene.matter.world.remove(this.matterBody),this.scene.tweens.killTweensOf(this);var i=300;this.scene.tweens.add({targets:this,duration:i,ease:Phaser.Math.Easing.Back.In,scale:1.75,onComplete:function(){t.destroy(!1)}})},e.prototype.destroy=function(t){t===!1&&this.emit(h.DESTROY,this),n.prototype.destroy.call(this,t)},e}(o.BasicBlock);o.PinataBlock=r})(game||(game={}));var game;(function(o){var h;(function(n){n.SHATTER="shatter"})(h=o.ShatterBlockEvent||(o.ShatterBlockEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a,l){var c=n.call(this,t,i,s,a,l)||this;return c._itemType=o.ItemType.SHATTER_BLOCK,c}return e.prototype.kill=function(){var t=this;this.emit(h.SHATTER,this),this.scene.matter.world.remove(this.matterBody),this.scene.tweens.add({targets:this,duration:66,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){t.destroy()}})},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t)},e}(o.BasicBlock);o.ShatterBlock=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s,a){var l=r.call(this,e,t,i,s,a)||this;return l._itemType=o.ItemType.SHATTER_BLOCK_PIECE,l}return n.getFrame=function(e){return e===1?n.UP_FRAME:e===2?n.RIGHT_FRAME:e===3?n.DOWN_FRAME:e===4?n.LEFT_FRAME:n.UP_FRAME},n.UP_FRAME="blocks/shatter_block_02_up",n.RIGHT_FRAME="blocks/shatter_block_02_right",n.DOWN_FRAME="blocks/shatter_block_02_down",n.LEFT_FRAME="blocks/shatter_block_02_left",n.ALL_FRAMES=[n.UP_FRAME,n.RIGHT_FRAME,n.DOWN_FRAME,n.LEFT_FRAME],n}(o.BasicBlock);o.ShatterBlockPiece=h})(game||(game={}));var game;(function(o){var h;(function(n){n.START_FALL="start_fall",n.ACTIVATE="activate"})(h=o.CollectableBallEvent||(o.CollectableBallEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s,a=n.call(this,t,0,0,"gameplay",e.ORIGINAL_FRAME)||this;return a.isFalling=!1,a._isDestroyed=!1,a.setCircle(e.RADIUS,{isStatic:!0,isSensor:!0,ignoreGravity:!0,plugin:(s={},s[o.COLLISION_TAG]=o.CollisionTag.COLLECTABLE_BALL,s)}),a._itemType=o.ItemType.COLLECTABLE_BALL,a.name="collectable_ball",a.grid=new o.GridComponent(a),a.killTweens=new o.KillTweens(a.scene,a),a.hideComponent=new o.HideComponent(a.scene,a),a.keeper=new o.BallKeeper(a.scene,a,i),a}return Object.defineProperty(e.prototype,"itemType",{get:function(){return this._itemType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDestroyed",{get:function(){return this._isDestroyed},enumerable:!1,configurable:!0}),e.prototype.startIdleTweens=function(){var t=this,i=Phaser.Math.RND.between(0,300);this.state="activated",this.scene.time.delayedCall(i,function(){t.emit(h.ACTIVATE,t)}),this.scene.tweens.add({delay:i,targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1});var s=Phaser.Math.RND.sign()*6,a=900;this.scene.tweens.add({delay:i,targets:this,duration:a/2,ease:Phaser.Math.Easing.Sine.Out,angle:s,onComplete:function(){t.angleTween=t.scene.tweens.add({duration:a,targets:t,ease:Phaser.Math.Easing.Sine.InOut,angle:t.angle*-1,yoyo:!0,repeat:-1})}})},e.prototype.startFalling=function(){if(this.isFalling)return;this.isFalling=!0,this.scene.tweens.killTweensOf(this),this.keeper.saveInitialPositionAndVelocity(),this.playCollectTween(),this.setSurprisedFrame(),this.setSensor(!1),this.setStatic(!1),this.setIgnoreGravity(!1),this.setAngularVelocity(.15*Phaser.Math.RND.sign()),this.setVelocityY(-22*(this.scene.game.loop.delta/16.6666667)),this.setAwake(),this.emit(h.START_FALL,this)},e.prototype.preUpdate=function(t,i){this.isFalling&&this.keeper.keepInsideWorld()},e.prototype.playCollectTween=function(){var t=this;this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,angle:0}),this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.scale*1.3,onComplete:function(){t.scene.tweens.add({targets:t,duration:150,ease:Phaser.Math.Easing.Linear.Linear,scale:1})}})},e.prototype.kill=function(){this.scene.tweens.killTweensOf(this),this.once(o.KillTweensEvent.COMPLETE,this.destroy,this),this.killTweens.play()},e.prototype.setSurprisedFrame=function(){this.setFrame(e.SURPRISED_FRAME),this.resetFrame(400)},e.prototype.resetFrame=function(t){var i=this;this.resetFrameEvent&&(this.resetFrameEvent.remove(),this.resetFrameEvent=null),this.resetFrameEvent=this.scene.time.delayedCall(t,function(){i.setFrame(e.ORIGINAL_FRAME)})},e.prototype.hideOnLevelComplete=function(t){this.hideComponent.hide(t)},e.prototype.preDestroy=function(){this.scene.tweens.killTweensOf(this),this.angleTween&&this.angleTween.remove()},e.prototype.destroy=function(t){this.emit(o.GameItemEvent.PRE_DESTROY,this,t),n.prototype.destroy.call(this,t),this.grid.destroy(),this._isDestroyed=!0},e.RADIUS=37,e.ORIGINAL_FRAME="ball_collectable",e.SURPRISED_FRAME="ball_collectable_surprised",e}(Phaser.Physics.Matter.Image);o.CollectableBall=r})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.owner=n}return r.prototype.alignToCell=function(n){this.owner.x=n.x,this.owner.y=n.y},r.prototype.getGridPosition=function(){return{x:this.getColumn(),y:this.getRow()}},r.prototype.getColumn=function(){return Math.floor(this.owner.x/o.GameGrid.CELL_SIZE)},r.prototype.getRow=function(){var n=Math.floor(this.owner.y/o.GameGrid.CELL_SIZE),e=o.GameGrid.ROWS-n-1;return e},r.prototype.destroy=function(){this.owner=null},r}();o.GridComponent=h})(game||(game={}));var game;(function(o){var h;(function(n){n.DAMAGE="damage",n.KILL="kill"})(h=o.HealthEvent||(o.HealthEvent={}));var r=function(){function n(e,t){this.invincible=!1,this.owner=e,this._value=t}return Object.defineProperty(n.prototype,"value",{get:function(){return this._value},enumerable:!1,configurable:!0}),n.prototype.kill=function(){if(this.invincible)return;this.damage(this.value)},n.prototype.damage=function(e){if(this.invincible)return;if(this.isAlive()===!1)return;this._value=Phaser.Math.MinSub(this._value,e,0),this.owner.emit(h.DAMAGE,this.owner,e),this._value===0&&this.owner.emit(h.KILL,this.owner,e)},n.prototype.isAlive=function(){return this._value>0},n.prototype.destroy=function(){this.owner=null},n}();o.HealthComponent=r})(game||(game={}));var game;(function(o){var h;(function(n){n.START="start",n.COMPLETE="complete"})(h=o.KillTweensEvent||(o.KillTweensEvent={}));var r=function(){function n(e,t){this.scene=e,this.owner=t}return n.prototype.play=function(){var e=this;this.owner.emit(h.START,this.owner);var t=270;this.scene.tweens.add({targets:this.owner,duration:t,ease:Phaser.Math.Easing.Back.In,scale:.33});var i=30,s=t-i;this.scene.tweens.add({targets:this.owner,delay:s,duration:i,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){e.owner.emit(h.COMPLETE,e.owner)}})},n.prototype.destroy=function(){},n}();o.KillTweens=r})(game||(game={}));var game;(function(o){var h;(function(n){n.START="hide_start",n.COMPLETE="hide_complete"})(h=o.HideEvent||(o.HideEvent={}));var r=function(){function n(e,t){this.scene=e,this.owner=t}return n.prototype.hide=function(e){var t=this;this.owner.emit(h.START,this.owner),this.scene.matter.world.remove(this.owner.body),this.scene.tweens.killTweensOf(this.owner),this.scene.tweens.add({targets:this.owner,duration:e,ease:Phaser.Math.Easing.Back.In,scale:0,onComplete:function(){t.owner.active=!1,t.owner.visible=!1,t.owner.emit(h.COMPLETE,t.owner)}})},n.prototype.destroy=function(){},n}();o.HideComponent=r})(game||(game={}));var game;(function(o){o.COLLISION_TAG="collision_tag";var h;(function(r){r.CRACKER="cracker",r.BOMB="bomb",r.SPINNER="spinner",r.LIGHTNING="lightning",r.BASIC_BLOCK="basic_block",r.BALL="ball",r.WINNING_BALL="winning_ball",r.COLLECTABLE_BALL="collectable_ball",r.WALL="wall",r.FLOOR="floor"})(h=o.CollisionTag||(o.CollisionTag={}))})(game||(game={}));var game;(function(o){var h;(function(r){r[r.GRID=0]="GRID",r[r.BALL_TRAILS=1]="BALL_TRAILS",r[r.IDLE_BALLS_SHADOWS=2]="IDLE_BALLS_SHADOWS",r[r.IDLE_BALLS=3]="IDLE_BALLS",r[r.DEAD_BLOCKS=4]="DEAD_BLOCKS",r[r.DEAD_BLOCK_FACES=5]="DEAD_BLOCK_FACES",r[r.ICE_BLOCK_PARTICLES=6]="ICE_BLOCK_PARTICLES",r[r.SPINNERS=7]="SPINNERS",r[r.LIGHTNINGS=8]="LIGHTNINGS",r[r.BALLS_LIGHTNING_PARTICLES=9]="BALLS_LIGHTNING_PARTICLES",r[r.BALLS=10]="BALLS",r[r.BLOCK_HINT=11]="BLOCK_HINT",r[r.ITEMS=12]="ITEMS",r[r.STOMPING_BLOCKS=13]="STOMPING_BLOCKS",r[r.BLOCK_FACES=14]="BLOCK_FACES",r[r.BLOCK_WHITE_COPIES=15]="BLOCK_WHITE_COPIES",r[r.BLOCK_RED_COPIES=16]="BLOCK_RED_COPIES",r[r.NUDGED_ITEMS=17]="NUDGED_ITEMS",r[r.DROPPED_COLLECTABLE_BALLS=18]="DROPPED_COLLECTABLE_BALLS",r[r.TRAJECTORY=19]="TRAJECTORY",r[r.BLOCK_HEALTH_COUNTER=20]="BLOCK_HEALTH_COUNTER",r[r.BLOCK_DAMAGE_FX=21]="BLOCK_DAMAGE_FX",r[r.HIT_BY_CRACKER=22]="HIT_BY_CRACKER",r[r.HIT_BY_CRACKER_FACE=23]="HIT_BY_CRACKER_FACE",r[r.LOSE_TUTORIAL=24]="LOSE_TUTORIAL",r[r.BOOSTER_BELOW_PARTICLES=25]="BOOSTER_BELOW_PARTICLES",r[r.BOOSTER=26]="BOOSTER",r[r.BOOSTER_ABOVE_PARTICLES=27]="BOOSTER_ABOVE_PARTICLES",r[r.WINNING_BALLS=28]="WINNING_BALLS",r[r.PLUS_DUCK_FX=29]="PLUS_DUCK_FX",r[r.TURN_POINTS_FX=30]="TURN_POINTS_FX",r[r.PARTICLES=31]="PARTICLES",r[r.JUMP_ON_FOX_BLOCK=32]="JUMP_ON_FOX_BLOCK",r[r.JUMP_ON_FOX_BLOCK_DUST=33]="JUMP_ON_FOX_BLOCK_DUST",r[r.FOX_THROWN=34]="FOX_THROWN",r[r.LOSING_BALLS=35]="LOSING_BALLS",r[r.LEVEL_COMPLETE_FX_PARTICLES=36]="LEVEL_COMPLETE_FX_PARTICLES",r[r.LEVEL_COMPLETE_FX=37]="LEVEL_COMPLETE_FX",r[r.EXPLOSION=38]="EXPLOSION"})(h=o.GameplayDepth||(o.GameplayDepth={}))})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,"gameplay","ball_lightning_3")||this;return i.subDepth=0,i.ball=t,i.kill(),i}return n.prototype.show=function(){this.revive(),this.alpha=0,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:.75})},n.prototype.kill=function(){this.scene.tweens.killTweensOf(this),this.visible=!1,this.active=!1},n.prototype.revive=function(){this.visible=!0,this.active=!0},n.prototype.followBall=function(){if(!this.visible)return;this.x=this.ball.x,this.y=this.ball.y,this.angle=this.ball.angle,this.scale=this.ball.scale},n.prototype.destroy=function(e){this.ball=null,this.scene&&(this.scene.tweens.killTweensOf(this),this.scene.events.off("postupdate",this.followBall,this)),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.BallCharged=h})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){this.rowPointer=0,this.scene=n,this.levelConfig=e,this.generatorConfig=e.generator,this.itemsGenerator=new o.ItemsGenerator(n,this.levelConfig);var t=this.createPredefinedItems(e.items),i=[];this.items=__spreadArrays(t,i),this.items=this.items.sort(this.sortByGridPosition.bind(this))}return r.prototype.sortByGridPosition=function(n,e){return n.row===e.row?n.column-e.column:n.row-e.row},r.prototype.createPredefinedItems=function(n){return n.map(function(e){return{type:e.type,column:e.column,row:e.row,config:__assign({},e.params)}})},r.prototype.getInitialItems=function(n){return this.rowPointer+=n,this.items.filter(function(e){return e.row<n})},r.prototype.getNextRows=function(n){var e=this.rowPointer,t=this.rowPointer+n,i=this.items.filter(function(s){return s.row>=e&&s.row<t});return this.rowPointer+=n,i},r.prototype.moveRowPointer=function(n){this.rowPointer+=n},r}();o.LevelGenerator=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,t.frames[0].textureKey,t.frames[0].frame.name)||this;return i.on("animationcomplete-"+t.key,i.destroy,i),i.play(t.key),i}return n.prototype.playScaleTween=function(){this.scene.tweens.add({targets:this,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:this.scale*1.5})},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Sprite);o.Explosion=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,o.BitmapGameFont.BLOCK_DAMAGE_FX,"0",30)||this;return t.setOrigin(.5,.5),t}return n.prototype.reset=function(){this.active=!0,this.visible=!0,this.scene.tweens.killTweensOf(this)},n.prototype.show=function(){this.alpha=0,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,completeDelay:700,onComplete:this.hide.bind(this)}),this.scale=.66,this.scene.tweens.add({targets:this,scale:{value:1,duration:600,ease:Phaser.Math.Easing.Back.Out},x:{value:this.getTargetX(),duration:500,ease:Phaser.Math.Easing.Back.Out},y:{value:"-=20",duration:1200,ease:Phaser.Math.Easing.Linear.Linear}})},n.prototype.getTargetX=function(){return this.x+Phaser.Math.RND.sign()*Phaser.Math.RND.between(7,14)},n.prototype.hide=function(){var e=this;this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){e.visible=!1,e.active=!1}})},n}(Phaser.GameObjects.BitmapText);o.BlockDamageFx=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,t,n.getTextStyle())||this;return i.setOrigin(.5,.5),i}return n.getTextStyle=function(){return{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"29px",color:"#C62324",strokeThickness:8,stroke:"#EED898",shadow:{blur:0,offsetY:4,color:"rgba(0,0,0,0.2)",stroke:!0,fill:!1}}},n.prototype.show=function(){var e=this;this.alpha=0,this.scene.tweens.add({targets:this,alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out},completeDelay:800,onComplete:function(){e.hide()}}),this.scale=.66,this.scene.tweens.add({targets:this,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.33],scale:1}),this.angle=Phaser.Math.RND.sign()*5,this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,angle:this.angle*-1,repeat:-1,yoyo:!0})},n.prototype.hide=function(){var e=this;this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,scale:1.2,onComplete:function(){e.destroy()}})},n.prototype.preUpdate=function(e,t){this.y-=t*.035},n}(Phaser.GameObjects.Text);o.PlusBallFx=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,t,n.getTextStyle())||this;return i.setLineSpacing(-25),i.setOrigin(.5,.5),i}return n.getTextStyle=function(){return{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"80px",color:"#C62324",strokeThickness:14,stroke:"#EED898",align:"center",shadow:{blur:0,offsetY:10,color:"rgba(0,0,0,0.2)",stroke:!0,fill:!1}}},n.prototype.show=function(){this.alpha=0,this.scene.tweens.add({targets:this,alpha:{value:1,duration:200,ease:Phaser.Math.Easing.Quintic.In}});var e=80;this.y+=e,this.scene.tweens.add({targets:this,duration:1500,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.5],y:this.y-e}),this.scene.tweens.add({targets:this,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:{from:2.5,to:1}})},n}(Phaser.GameObjects.Text);o.LevelCompleteText=h})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t)||this;return s.emitterParticlesNum=40,s.name="level_complete",s.addCircleFx(),s.addText(i),s.addEmitter(),s}return e.prototype.addCircleFx=function(){this.circleFx=this.scene.add.image(0,0,"gameplay","circle_fx_beige"),this.circleFx.scale=.5,this.circleFx.alpha=0,this.add(this.circleFx)},e.prototype.addText=function(t){var i=t?this.scene.texts.game_complete:this.scene.texts.level_complete;this.text=new o.LevelCompleteText(this.scene,i),this.add(this.text)},e.prototype.addEmitter=function(){if(this.scene.game.rendererType===o.RendererType.CANVAS)return;var t=this.scene.add.particles("gameplay").setDepth(o.GameplayDepth.LEVEL_COMPLETE_FX_PARTICLES);this.emitter=t.createEmitter({emitZone:this.getEmitZone(),frame:"particles_spark_3",lifespan:900,radial:!0,angle:{start:0,end:360,steps:this.emitterParticlesNum},scale:{start:.5,end:0,ease:h.ExpoEaseIn},alpha:{start:.8,end:0},speed:{min:150,max:400},on:!1})},e.prototype.getEmitZone=function(){return{source:new Phaser.Geom.Circle(0,0,40),quantity:this.emitterParticlesNum,type:"edge"}},e.prototype.show=function(){var t=this;this.scene.tweens.add({delay:400,targets:this,duration:900,ease:Phaser.Math.Easing.Sine.InOut,y:"-=30",yoyo:!0,repeat:-1}),this.scene.tweens.add({delay:300,targets:this,duration:266,ease:Phaser.Math.Easing.Sine.InOut,scale:1.2,yoyo:!0,onComplete:this.playWiggleTween.bind(this)}),this.text.show(),this.scene.time.delayedCall(170,function(){t.showCircle()}),this.scene.time.delayedCall(200,function(){t.playCameraZoomTween()}),this.scene.time.delayedCall(200,function(){t.emitter&&t.emitter.explode(t.emitterParticlesNum,t.x,t.y)})},e.prototype.playWiggleTween=function(){this.scene.tweens.add({targets:this,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.04,scaleY:.955,yoyo:!0,repeat:-1})},e.prototype.showCircle=function(){var t=this;this.scene.tweens.add({targets:this.circleFx,duration:150,ease:Phaser.Math.Easing.Expo.In,alpha:1,onComplete:function(){t.scene.tweens.add({delay:150,targets:t.circleFx,duration:350,ease:Phaser.Math.Easing.Cubic.Out,alpha:0})}}),this.scene.tweens.add({targets:this.circleFx,duration:650,ease:Phaser.Math.Easing.Linear.Linear,scale:2.1})},e.prototype.playCameraZoomTween=function(){var t=this.scene.cameras.main;this.cameraFilter=t.id;var i=this.createCustomCamera(t),s=i.zoom*1.3;this.scene.tweens.add({targets:i,duration:366,ease:Phaser.Math.Easing.Sine.InOut,zoom:s,scrollY:i.scrollY-70*s,yoyo:!0,onComplete:this.onCameraTweenZoomComplete.bind(this,i)})},e.prototype.createCustomCamera=function(t){var i=this,s=this.scene.cameras.add();return s.setZoom(t.zoom),s.setScroll(t.scrollX,t.scrollY),s.ignore(this.scene.sys.displayList.list.filter(function(a){return a!==i})),s},e.prototype.onCameraTweenZoomComplete=function(t){this.scene.cameras.remove(t),this.cameraFilter=0},e}(Phaser.GameObjects.Container);o.LevelCompleteFx=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0,"gameplay","dust_cloud0001")||this;return t.animationKey="dust",t.createAnimation(),t.play(t.animationKey),t.on("animationcomplete-"+t.animationKey,t.destroy,t),t}return n.prototype.createAnimation=function(){this.scene.anims.create({key:this.animationKey,frames:this.scene.anims.getFrameNames("gameplay","dust_cloud"),frameRate:20})},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Sprite);o.DustCloud=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="clear_field_fx",t.textStyle=t.createTextStyle(),t.addTitle(),t.addSubtitle(),t}return n.prototype.createTextStyle=function(){return{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"22px",color:"#FFFFD7",align:"center",shadow:{blur:0,offsetY:4,color:"rgba(0,0,0,0.2)",stroke:!1,fill:!0}}},n.prototype.addTitle=function(){var e=this.scene.texts.clear_field,t=__assign(__assign({},this.textStyle),{fontSize:"50px"});this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.y-=30,this.add(this.title)},n.prototype.addSubtitle=function(){var e="x2",t=__assign(__assign({},this.textStyle),{fontSize:"90px"});this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.y+=35,this.add(this.subtitle)},n}(Phaser.GameObjects.Container);o.ClearFieldFx=h})(game||(game={}));var game;(function(o){var h;(function(n){n.CLEAR_BONUS_SHOW="TurnCompleteFx_CLEAR_BONUS_SHOW"})(h=o.TurnCompleteFxEvent||(o.TurnCompleteFxEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.name="turn_complete_fx",i.textStyle=i.createTextStyle(),i.addCheer(),i.addPoints(),i.addClearBonus(),i}return e.prototype.createTextStyle=function(){return{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"62px",color:"#C62324",strokeThickness:14,stroke:"#EED898",align:"center",shadow:{blur:0,offsetY:4,color:"rgba(0,0,0,0.2)",stroke:!0,fill:!1}}},e.prototype.addCheer=function(){var t=this.scene.texts.cheers[0];this.cheer=this.scene.add.text(0,0,t,this.textStyle),this.cheer.setOrigin(.5,.5),this.add(this.cheer)},e.prototype.addPoints=function(){var t="+0",i=__assign(__assign({},this.textStyle),{strokeThickness:12});this.points=this.scene.add.text(0,0,t,i),this.points.setOrigin(.5,.5),this.points.y=this.cheer.y+75,this.add(this.points)},e.prototype.addClearBonus=function(){this.clearBonus=new o.ClearFieldFx(this.scene),this.clearBonus.y=this.points.y+150,this.add(this.clearBonus)},e.prototype.reset=function(){this.alpha=1,this.cheer.x=0,this.points.x=-12,this.clearBonus.x=0,this.clearBonus.y=this.points.y+150,this.clearBonus.scale=1,this.clearBonus.alpha=1},e.prototype.updateData=function(t,i,s){this.updateCheerText(t),this.updatePoints(i),this.clearBonus.visible=s},e.prototype.updateCheerText=function(t){var i=this.getCompleteCheerContent(t);this.cheer.setText(i),this.cheer.visible=t>=3},e.prototype.getCompleteCheerContent=function(t){var i=this.scene.texts.cheers,s=Phaser.Math.Clamp(t-3,0,i.length-1);return i[s]},e.prototype.updatePoints=function(t){var i="+"+t.toString();this.points.setText(i),this.points.visible=t>0},e.prototype.show=function(){var t=40;this.showText(this.cheer,-t),this.showText(this.points,t),this.clearBonus.visible?(this.showClearBonus(),this.bumpPointsAndCheer(900),this.scene.poki.sdk.happyTime(.33)):this.scene.time.delayedCall(1400,this.hide,null,this)},e.prototype.showText=function(t,i){t.x-=i,this.scene.tweens.add({targets:t,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],x:t.x+i}),t.alpha=0,this.scene.tweens.add({targets:t,alpha:{value:1,duration:300,ease:Phaser.Math.Easing.Cubic.Out}})},e.prototype.hideText=function(t,i){this.scene.tweens.add({targets:t,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,x:{value:t.x+50*Phaser.Math.Sign(i),ease:Phaser.Math.Easing.Cubic.In}})},e.prototype.showClearBonus=function(){var t=this,i=400;this.scene.time.delayedCall(i,function(){t.emit(h.CLEAR_BONUS_SHOW,t)}),this.clearBonus.alpha=0,this.scene.tweens.add({targets:this.clearBonus,delay:i,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.clearBonus.scale=.8,this.scene.tweens.add({targets:this.clearBonus,delay:i,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[.1,.4],scale:1})},e.prototype.bumpPointsAndCheer=function(t){var i=this;this.scene.tweens.add({delay:t,targets:this.points,duration:300,ease:Phaser.Math.Easing.Sine.InOut,y:"-=35",scale:1.33,yoyo:!0,onStart:function(){var s=i.points.text.slice(1),a=parseInt(s);i.points.setText("+"+a*2)}}),this.scene.tweens.add({delay:t,targets:this.cheer,duration:350,ease:Phaser.Math.Easing.Sine.InOut,y:"-=30",yoyo:!0,onComplete:function(){i.hide()}})},e.prototype.hide=function(){this.hideText(this.cheer,50),this.hideText(this.points,-50),this.hideClearBonus(),this.scene.time.delayedCall(200,this.kill,null,this)},e.prototype.hideClearBonus=function(){this.scene.tweens.add({targets:this.clearBonus,duration:200,ease:Phaser.Math.Easing.Cubic.Out,scale:.8,alpha:0})},e.prototype.preUpdate=function(t,i){if(this.visible===!1)return;this.y-=i*.035},e}(Phaser.GameObjects.Container);o.TurnCompleteFx=r})(game||(game={}));var game;(function(o){var h=function(){function r(n,e,t){this.isDestroyed=!1,this.scene=n,this.emitter=t,this.emitter.startFollow(e),this.lightning=e,this.lightning.on(o.LightningEvent.KILL_START,this.destroy,this),this.lightning.on(o.HideEvent.START,this.hide,this),this.lightning.on(Phaser.GameObjects.Events.DESTROY,this.destroy,this)}return r.prototype.hide=function(){this.emitter.killAll(),this.emitter.on=!1},r.prototype.destroy=function(){if(this.isDestroyed)return;this.isDestroyed=!0,this.emitter.remove()},r}();o.LightningIdleEmitter=h})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r=function(){function n(e){this.scene=e,this.isCanvasRenderer=this.scene.game.rendererType===o.RendererType.CANVAS,this.allManagers=[],this.mainManager=this.createManager(),this.ballEmittersManager=this.createManager("gameplay",o.GameplayDepth.BALLS_LIGHTNING_PARTICLES),this.belowBlocksManager=this.createManager("gameplay",o.GameplayDepth.ICE_BLOCK_PARTICLES),this.isCanvasRenderer?this.createDummyEmitters():this.createEmitters()}return n.prototype.createManager=function(e,t){e===void 0&&(e="gameplay"),t===void 0&&(t=o.GameplayDepth.PARTICLES);var i=this.scene.add.particles(e);return i.setDepth(t),this.allManagers.push(i),i},n.prototype.createEmitters=function(){this.feathers=this.mainManager.createEmitter({gravityY:100,frame:["particle_feather_1","particle_feather_2"],lifespan:{min:300,max:500},radial:!0,angle:{min:0,max:360},rotate:{min:0,max:180},scale:{min:.1,max:1},alpha:{start:1,end:0,ease:"Power5"},speed:{min:50,max:100},on:!1}),this.zappedBlock=this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(40,360)),{frame:"particle_lightning",speed:200,scale:{start:.75,end:.2},lifespan:300,alpha:{start:1,end:0},on:!1})),this.collectableBallFeathers=this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(40,360)),{frame:["particle_feather_1","particle_feather_2"],scale:{start:.25,end:1.33,random:!0},speed:{start:120,end:240,random:!0},lifespan:{start:250,end:500,random:!0},alpha:{start:1,end:0},on:!1})),this.lightning=this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(40,360)),{frame:"particle_lightning",speed:200,scale:{start:.4,end:.1},lifespan:300,alpha:{start:1,end:0},on:!1})),this.spinner=this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(40,360)),{frame:"particle_spark",speed:200,scale:{start:.33,end:.1},lifespan:300,alpha:{start:1,end:0},on:!1})),this.pinata=this.mainManager.createEmitter({frame:"circle_fx",lifespan:400,scale:{start:.66,end:3.5,ease:h.QuintEaseOut},alpha:{start:.85,end:0,ease:h.QuadEaseOut},on:!1}),this.pinataConfetti=this.createPinataConfettiEmitter(),this.newPinataItem=this.mainManager.createEmitter({emitZone:{source:new Phaser.Geom.Circle(0,0,o.GameGrid.CELL_SIZE/2),type:"random"},speed:66,frame:"particle_star_01",lifespan:{min:500,max:900},scale:{start:1,end:.5},alpha:{start:1,end:0},on:!1}),this.blockKill=this.belowBlocksManager.createEmitter({frame:"circle_fx_2",lifespan:200,scale:{start:.5,end:1.5,ease:Phaser.Math.EasingString.Cubic},alpha:{start:.5,end:0},on:!1}),this.blockKillParticles=this.belowBlocksManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(23,8,!1)),{frame:"particle_circle",speed:240,lifespan:300,scale:{start:.7,end:.15,ease:Phaser.Math.EasingString.Cubic},alpha:{start:.5,end:0},on:!1}))},n.prototype.createPinataConfettiEmitter=function(){var e=function(i,s,a,l){return isNaN(i.scaleY)&&(l=1,i.deltaScale=Phaser.Math.RND.sign()*.12),l+=i.deltaScale,l<-1?(l=-1,i.deltaScale*=-1):l>1&&(l=1,i.deltaScale*=-1),l},t={source:new Phaser.Geom.Circle(0,0,o.GameGrid.CELL_SIZE*.5),type:"random"};return this.mainManager.createEmitter({frame:["red","blue","yellow","green"].map(function(i){return"confetti_"+i}),lifespan:{min:600,max:900},speedX:{min:-350,max:350},speedY:{min:-600,max:100},rotate:{min:0,max:360},alpha:{start:1,end:0,ease:h.ExpoEaseIn},gravityY:1e3,scaleY:{onUpdate:e},emitZone:t,on:!1})},n.prototype.createDummyEmitters=function(){this.feathers=this.createDummyEmitter(),this.zappedBlock=this.createDummyEmitter(),this.collectableBallFeathers=this.createDummyEmitter(),this.lightning=this.createDummyEmitter(),this.spinner=this.createDummyEmitter(),this.pinata=this.createDummyEmitter(),this.newPinataItem=this.createDummyEmitter(),this.pinata=this.createDummyEmitter(),this.pinataConfetti=this.createDummyEmitter(),this.blockKill=this.createDummyEmitter(),this.blockKillParticles=this.createDummyEmitter()},n.prototype.createLightningIdleEmitter=function(){return this.isCanvasRenderer?this.createDummyEmitter():this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(26)),{frame:"particle_lightning",speed:55,scale:{start:.3,end:.1},lifespan:550,alpha:{start:1,end:0},frequency:166,quantity:1,on:!0}))},n.prototype.createSpinnerIdleEmitter=function(e){return this.isCanvasRenderer?this.createDummyEmitter():this.mainManager.createEmitter(__assign(__assign({},utils.ParticleUtil.getCircleEdgeEmitZone(26)),{frame:"particle_spark",speed:55,scale:{start:.24,end:.1},lifespan:550,alpha:{start:1,end:0},frequency:166,quantity:1,on:!0}))},n.prototype.createBallChargedEmitter=function(e){return this.isCanvasRenderer?this.createDummyEmitter():this.ballEmittersManager.createEmitter({frame:"particle_circle",speed:300,emitZone:{source:new Phaser.Geom.Circle(0,0,o.Ball.RADIUS*.9),type:"random"},scale:.8,alpha:{start:1,end:0},lifespan:{min:150,max:300},frequency:33,quantity:1,follow:e,on:!1})},n.prototype.createIceBlockEmitter=function(e){if(this.isCanvasRenderer)return this.createDummyEmitter();var t=_.range(1,4).map(function(i){return"particle_snowflake_0"+i});return this.belowBlocksManager.createEmitter({frame:t,speedX:{onEmit:function(i){return Phaser.Math.Sign(e.matterBody.velocity.x)*-10}},speedY:{min:-10,max:10},rotate:{start:0,end:90*Phaser.Math.RND.sign()},emitZone:{source:new Phaser.Geom.Circle(0,0,40),type:"random"},scale:{start:.75,end:.3,ease:Phaser.Math.EasingString.Cubic},lifespan:{min:1400,max:1800},alpha:{start:1,end:0},frequency:100,quantity:1,follow:e})},n.prototype.createCollectableBallEmitter=function(e){return this.isCanvasRenderer?this.createDummyEmitter():this.belowBlocksManager.createEmitter({emitZone:{source:new Phaser.Geom.Circle(0,0,o.CollectableBall.RADIUS),type:"random"},frame:"particle_star_01",lifespan:1e3,scale:{start:1.5,end:.1},alpha:{start:0,end:1,ease:h.ExpoEaseOut},rotate:{onEmit:function(){return Phaser.Math.RND.between(0,360)},onUpdate:function(t,i,s,a){return a+=1}},follow:e,frequency:600,on:!1})},n.prototype.setTimescale=function(e){this.allManagers.forEach(function(t){return t.timeScale=e})},n.prototype.createDummyEmitter=function(){return this.mainManager.createEmitter({maxParticles:0,on:!1,active:!1,visible:!1})},n.prototype.destroy=function(){},n}();o.GameplayEmitters=r})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.scene=n,this.matter=this.scene.matter,this.world=this.scene.matter.world,this.world.drawDebug=!1,this.world.autoUpdate=!1,this.world.resetCollisionIDs(),this.initCollisionGroups(),this.initCollisionCategories(),this.initCollisionPairs(),this.addWorldEventListeners()}return r.prototype.initCollisionGroups=function(){this.collisionGroups={balls:this.world.nextGroup(!0),collectableBalls:this.world.nextGroup(!0)}},r.prototype.initCollisionCategories=function(){this.collisionCategories={ceiling:this.world.nextCategory(),floor:this.world.nextCategory(),walls:this.world.nextCategory(),balls:this.world.nextCategory(),boosterBomb:this.world.nextCategory(),boosterCracker:this.world.nextCategory()}},r.prototype.initCollisionPairs=function(){this.collisionPairs=[{tagA:o.CollisionTag.BALL,tagB:o.CollisionTag.SPINNER,callback:this.scene.onBallSpinnerTouched,callbackContext:this.scene},{tagA:o.CollisionTag.BALL,tagB:o.CollisionTag.LIGHTNING,callback:this.scene.onBallLightningTouched,callbackContext:this.scene},{tagA:o.CollisionTag.BALL,tagB:o.CollisionTag.FLOOR,callback:this.scene.onBallFloorCollide,callbackContext:this.scene},{tagA:o.CollisionTag.BALL,tagB:o.CollisionTag.WALL,callback:this.scene.onBallWallsCollide,callbackContext:this.scene},{tagA:o.CollisionTag.BALL,tagB:o.CollisionTag.BASIC_BLOCK,callback:this.scene.onBallBlocksCollide,callbackContext:this.scene},{tagA:o.CollisionTag.COLLECTABLE_BALL,tagB:o.CollisionTag.BALL,callback:this.scene.onCollectableBallHit,callbackContext:this.scene},{tagA:o.CollisionTag.COLLECTABLE_BALL,tagB:o.CollisionTag.FLOOR,callback:this.scene.onCollectableBallLand,callbackContext:this.scene}]},r.prototype.addWorldEventListeners=function(){this.world.on("afterupdate",this.onWorldAfterUpdate,this),this.world.on("beforeadd",this.onBeforeBodyAdd,this),this.world.on("beforeremove",this.onBeforeBodyRemove,this),this.world.on("collisionstart",this.onCollisionStart,this)},r.prototype.onWorldAfterUpdate=function(){var n=this;this.scene.balls.forEach(function(e){return e.maintainConstantFlyingSpeed(n.scene.game.loop.delta)})},r.prototype.onBeforeBodyAdd=function(n){this.scene.worldCopy.addBody(n.object)},r.prototype.onBeforeBodyRemove=function(n){this.scene.worldCopy.removeBody(n.object)},r.prototype.onCollisionStart=function(n){var e=this;n.pairs.forEach(function(t){var i=t.bodyA,s=t.bodyB,a=i.plugin[o.COLLISION_TAG],l=s.plugin[o.COLLISION_TAG];e.collisionPairs.some(function(c){c.tagA==a&&c.tagB===l?e.executeCollisionCallback(c,i,s,t,n):c.tagB===a&&c.tagA===l&&e.executeCollisionCallback(c,s,i,t,n)})})},r.prototype.executeCollisionCallback=function(n,e,t,i,s){var a,l,c=(a=e.gameObject)!==null&&a!==void 0?a:e,u=(l=t.gameObject)!==null&&l!==void 0?l:t;return n.callback.call(n.callbackContext,c,u,i,s)},r.prototype.toggleDebug=function(){if(this.matter.config.debug===!1)return;this.world.drawDebug=!this.world.drawDebug,this.world.drawDebug===!1&&this.world.debugGraphic.clear()},r.prototype.update=function(n){for(var e=0;e<this.scene.fastForward.timeScale;e++)this.world.step(n)},r}();o.GameplayPhysics=h})(game||(game={}));var game;(function(o){var h=utils.AnimationsPool,r=function(){function n(e){this.scene=e,this.lightnings=this.createLightningAnimations(),this.spinners=this.createSpinnerAnimations(),this.explosions=this.createExplosionAnimations()}return n.prototype.createLightningAnimations=function(){return new h(this.scene,{name:"lightnings",initialNum:10,atlas:"gameplay",prefix:"lightning/lightning",animationConfig:{repeat:-1,repeatDelay:2e3,frameRate:10}})},n.prototype.createSpinnerAnimations=function(){return new h(this.scene,{name:"spinners",initialNum:10,atlas:"gameplay",prefix:"spinner/spinner",animationConfig:{repeat:-1,repeatDelay:2e3,frameRate:10}})},n.prototype.createExplosionAnimations=function(){return new h(this.scene,{name:"explosions",initialNum:10,atlas:"gameplay",prefix:"BOOM",animationConfig:{frameRate:30}})},n.prototype.recycle=function(){this.spinners.recycleAll(),this.lightnings.recycleAll(),this.explosions.recycleAll()},n}();o.GameplayAnimationPools=r})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.scene=n,this.levelConfig=this.scene.levelConfig,this.createIdleBalls(),this.createIdleBallsShadows(),this.createBlockWhiteCopies(),this.createBlockRedCopies(),this.createBlockHealthCounters(),this.createBlockDamageFx()}return r.prototype.createIdleBalls=function(){var n=this,e=this.levelConfig.balls,t=this.levelConfig.items.filter(function(s){return s.type===o.ItemType.COLLECTABLE_BALL}).length,i=e+t;this.idleBalls=_.times(i,function(){return n.createNewIdleBall()})},r.prototype.createNewIdleBall=function(){var n=new o.IdleBall(this.scene);return n.setDepth(o.GameplayDepth.IDLE_BALLS),n.visible=!1,n.active=!1,this.scene.add.existing(n),n},r.prototype.createIdleBallsShadows=function(){var n=this;this.idleBallsShadows=_.times(this.idleBalls.length,function(e){var t=n.idleBalls[e];return n.createNewIdleBallShadow(t)})},r.prototype.createNewIdleBallShadow=function(n){var e=new o.JumpingBallShadow(this.scene,n);return e.setDepth(o.GameplayDepth.IDLE_BALLS_SHADOWS),e.visible=!1,e.active=!1,this.scene.add.existing(e),e},r.prototype.createBlockWhiteCopies=function(){this.blockWhiteCopies=this.scene.add.group({name:"block_white_copies",classType:o.BlockWhiteCopy,createCallback:function(i){i.setDepth(o.GameplayDepth.BLOCK_WHITE_COPIES),i.visible=!1,i.active=!1}});for(var n=o.GameGrid.COLUMNS*(o.GameGrid.ROWS-2),e=Math.round(n*.66),t=0;t<e;t++)this.blockWhiteCopies.create()},r.prototype.createBlockRedCopies=function(){this.blockRedCopies=this.scene.add.group({name:"block_red_copies",classType:o.BlockRedCopy,createCallback:function(t){t.setDepth(o.GameplayDepth.BLOCK_RED_COPIES),t.kill()}});for(var n=o.GameGrid.COLUMNS,e=0;e<n;e++)this.blockRedCopies.create()},r.prototype.createBlockHealthCounters=function(){this.blockHealthCounters=this.scene.add.group({name:"block_health_counters",classType:o.BlockHealthCounter,createCallback:function(i){i.setDepth(o.GameplayDepth.BLOCK_HEALTH_COUNTER),i.visible=!1,i.active=!1}});for(var n=o.GameGrid.COLUMNS*(o.GameGrid.ROWS-2),e=Math.round(n*.66),t=0;t<e;t++)this.blockHealthCounters.create()},r.prototype.createBlockDamageFx=function(){this.blockDamageFXs=this.scene.add.group({name:"block_damage_fxs",classType:o.BlockDamageFx,createCallback:function(s){s.setDepth(o.GameplayDepth.BLOCK_DAMAGE_FX),s.visible=!1,s.active=!1}});for(var n=this.scene.balls.length,e=this.levelConfig.items.filter(function(s){return s.type===o.ItemType.COLLECTABLE_BALL}).length,t=(n+e)*2,i=0;i<t;i++)this.blockDamageFXs.create()},r}();o.GameplayPools=h})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.scene=n}return r.prototype.create=function(n){_.defaults(n,{texture:"gameplay",frame:this.getDefaultItemFrame(n.itemType)});var e=this.createItemByType(n);return this.setupItem(e,n),this.scene.add.existing(e),this.scene.addItem(e),this.alignItemToGrid(e,n.column,n.row),e},r.prototype.getDefaultItemFrame=function(n){var e=o.ItemTypeUtil.getFrameName(n);return!e,e},r.prototype.alignItemToGrid=function(n,e,t){var i=this.scene.grid.getCellAt(t,e),s=this.getAlignPosition(n);Phaser.Display.Align.In.QuickSet(n,i,s)},r.prototype.getAlignPosition=function(n){var e=n.itemType,t=n.frame.name;return e===o.ItemType.TRIANGLE?this.getTriangleAlign(t):e===o.ItemType.SHATTER_BLOCK_PIECE?this.getShatterPieceAlign(t):Phaser.Display.Align.CENTER},r.prototype.getTriangleAlign=function(n){var e,t=Phaser.Display.Align,i=(e={},e[o.TriangleBlock.BOTTOM_LEFT_FRAME]=t.BOTTOM_LEFT,e[o.TriangleBlock.BOTTOM_RIGHT_FRAME]=t.BOTTOM_RIGHT,e[o.TriangleBlock.TOP_LEFT_FRAME]=t.TOP_LEFT,e[o.TriangleBlock.TOP_RIGHT_FRAME]=t.TOP_RIGHT,e);return i[n]||t.CENTER},r.prototype.getShatterPieceAlign=function(n){var e,t=Phaser.Display.Align,i=(e={},e[o.ShatterBlockPiece.UP_FRAME]=t.LEFT_TOP,e[o.ShatterBlockPiece.RIGHT_FRAME]=t.RIGHT_CENTER,e[o.ShatterBlockPiece.DOWN_FRAME]=t.BOTTOM_CENTER,e[o.ShatterBlockPiece.LEFT_FRAME]=t.LEFT_CENTER,e);return i[n]||t.CENTER},r.prototype.createItemByType=function(n){switch(n.itemType){case o.ItemType.BASIC_BLOCK:case o.ItemType.TRIANGLE:case o.ItemType.DYNAMITE_BLOCK:case o.ItemType.ICE_BLOCK:case o.ItemType.ICE_RHOMB:case o.ItemType.ICE_OCTAGON:case o.ItemType.PINATA_BLOCK:case o.ItemType.SHATTER_BLOCK:case o.ItemType.SHATTER_BLOCK_PIECE:return this.createBlock(n);case o.ItemType.COLLECTABLE_BALL:return new o.CollectableBall(this.scene.matter.world,this.scene.getWorldBounds());case o.ItemType.LIGHTNING:return new o.Lightning(this.scene.matter.world,this.scene.animsPools.lightnings.getInactive());case o.ItemType.SPINNER:return new o.Spinner(this.scene.matter.world,this.scene.animsPools.spinners.getInactive());default:return null}},r.prototype.createBlock=function(n){var e={isStatic:!0,restitution:1,friction:0,frictionAir:0,frictionStatic:0};_.defaults(n,{health:Phaser.Math.RND.between(1,10),bodyConfig:__assign({},e)});var t=this.scene.physicsShapes[n.frame];if(t){var i=this.convertToPhaserTracer(t),s=this.getSpriteOffset(i,n.texture,n.frame);n.bodyConfig.shape=__assign({},i),n.bodyConfig.render={visible:!0,opacity:1,sprite:{xOffset:s.x,yOffset:s.y}}}switch(n.itemType){case o.ItemType.BASIC_BLOCK:return new o.BasicBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.TRIANGLE:return new o.TriangleBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.SHATTER_BLOCK:return new o.ShatterBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.SHATTER_BLOCK_PIECE:return new o.ShatterBlockPiece(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.ICE_BLOCK:return new o.IceBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.ICE_RHOMB:case o.ItemType.ICE_OCTAGON:return new o.RotatingIceBlock(this.scene.matter.world,n.itemType,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.DYNAMITE_BLOCK:return new o.DynamiteBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);case o.ItemType.PINATA_BLOCK:return new o.PinataBlock(this.scene.matter.world,n.texture,n.frame,n.health,n.bodyConfig);default:return null}},r.prototype.convertToPhaserTracer=function(n){var e=n.fixtures.flatMap(function(t){return t.vertices});return{type:"fromPhysicsTracer",label:n.label,vertices:e}},r.prototype.getSpriteOffset=function(n,e,t){var i=n.vertices.flat(),s=_.minBy(i,"x").x,a=_.minBy(i,"y").y,l=this.scene.textures.getFrame(e,t);return{x:s/l.width*l.pivotX,y:a/l.height*l.pivotY}},r.prototype.setupItem=function(n,e){switch(e.itemType){case o.ItemType.BASIC_BLOCK:case o.ItemType.TRIANGLE:case o.ItemType.SHATTER_BLOCK_PIECE:this.setupBlock(n,e);break;case o.ItemType.ICE_BLOCK:case o.ItemType.ICE_RHOMB:case o.ItemType.ICE_OCTAGON:this.setupBlock(n,e),this.setupIceBlock(n,e);break;case o.ItemType.PINATA_BLOCK:this.setupBlock(n,e),this.setupPinataBlock(n,e);break;case o.ItemType.DYNAMITE_BLOCK:this.setupBlock(n,e),this.setupDynamiteBlock(n,e);break;case o.ItemType.SHATTER_BLOCK:this.setupBlock(n,e),this.setupShatterBlock(n);return;case o.ItemType.SPINNER:this.setupSpinner(n,e);break;case o.ItemType.LIGHTNING:this.setupLightning(n,e);break;case o.ItemType.COLLECTABLE_BALL:this.setupCollectableBall(n,e);break;default:break}return n},r.prototype.setupBlock=function(n,e){return n.on(o.BasicBlockEvent.ZAP,this.scene.onBlockZap,this.scene),n.on(o.StompingEvent.START,this.scene.onBlockStartStomping,this.scene),n.on(o.StompingEvent.STOP,this.scene.onBlockStopStomping,this.scene),n.on(o.HealthEvent.DAMAGE,this.scene.onBlockDamage,this.scene),n.on(o.HealthEvent.KILL,this.scene.onBlockKill,this.scene),n.setDepth(o.GameplayDepth.ITEMS),this.scene.addBlockWhiteCopy(n),this.scene.addBlockHealthCounter(n),this.scene.addBlockFace(n),n},r.prototype.setupIceBlock=function(n,e){n.once(Phaser.GameObjects.Events.DESTROY,this.scene.fastForward.removeItem,this.scene.fastForward),this.scene.addIceBlockEmitter(n),this.scene.fastForward.addItem(n)},r.prototype.setupPinataBlock=function(n,e){n.on(o.PinataEvent.DESTROY,this.scene.onPinataDestroyed,this.scene)},r.prototype.setupDynamiteBlock=function(n,e){n.on(o.DynamiteBlockEvent.EXPLODE,this.scene.onDynamiteBlockExplode,this.scene)},r.prototype.setupShatterBlock=function(n){n.on(o.ShatterBlockEvent.SHATTER,this.scene.onShatterBlockShatter,this.scene)},r.prototype.setupSpinner=function(n,e){n.setDepth(o.GameplayDepth.SPINNERS),n.once(Phaser.GameObjects.Events.DESTROY,this.scene.fastForward.removeItem,this.scene.fastForward),n.once(Phaser.GameObjects.Events.DESTROY,this.recycleSpinnerAnimation,this),this.scene.addSpinnerIdleEmitter(n),this.scene.fastForward.addItem(n)},r.prototype.recycleSpinnerAnimation=function(n){this.scene.animsPools.spinners.recycleActive(n.animation)},r.prototype.setupLightning=function(n,e){n.setDepth(o.GameplayDepth.LIGHTNINGS),n.once(Phaser.GameObjects.Events.DESTROY,this.scene.onLightningDestroy,this.scene),this.scene.addLightningIdleEmitter(n)},r.prototype.setupCollectableBall=function(n,e){n.setCollisionGroup(this.scene._physics.collisionGroups.collectableBalls),this.scene.addCollectableBallEmitter(n)},r.prototype.postCreationCallback=function(n){var e=n.itemType;if(typeof e=="undefined")return;switch(e){case o.ItemType.ICE_BLOCK:case o.ItemType.ICE_RHOMB:case o.ItemType.ICE_OCTAGON:n.startMoving();break;case o.ItemType.LIGHTNING:n.startIdleTweensAndAnimation();break;case o.ItemType.SPINNER:n.startIdleTweensAndAnimation();break;case o.ItemType.COLLECTABLE_BALL:n.startIdleTweens();break;default:break}},r}();o.GameplayItemsFactory=h})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.scene=n,this.camera=this.scene.cameras.main}return r.prototype.resize=function(){var n=this.calculateScale(),e=this.scene.getFieldWidth(),t=this.scene.getFieldHeight();this.camera.setViewport(0,0,o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT),this.camera.setZoom(n),this.camera.scrollX=-(o.Config.GAME_WIDTH-e)/2,this.camera.scrollY=-(o.Config.GAME_HEIGHT-t)/2},r.prototype.calculateScale=function(){var n=o.Config.GAME_WIDTH*.9,e=this.getGameplayMaxHeight(),t=n/this.scene.getFieldWidth(),i=e/this.scene.getFieldHeight();return Math.min(t,i)},r.prototype.getGameplayMaxHeight=function(){var n=this.scene.gui.topPanel.getDisplayHeight(),e=o.Config.GAME_HEIGHT-n,t=e-n;return t*.96},Object.defineProperty(r.prototype,"zoom",{get:function(){return this.camera.zoom},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"x",{get:function(){return this.camera.x},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"y",{get:function(){return this.camera.y},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"height",{get:function(){return this.camera.height},enumerable:!1,configurable:!0}),r.prototype.getPadding=function(){var n=(o.Config.GAME_WIDTH-this.scene.getFieldWidth()*this.zoom)/2,e=(o.Config.GAME_HEIGHT-this.scene.getFieldHeight()*this.zoom)/2;return{x:n,y:e}},r}();o.GameplayCamera=h})(game||(game={}));var game;(function(o){var h=Phaser.Physics.Matter.Matter,r=h.Body,n=h.Bodies,e=h.Resolver,t=h.Plugin,i=h.Events,s=h.Sleeping,a=function(){function l(c){this.ballSpeed=o.Ball.THROW_FORCE/5,this.scene=c,this.enableCollisionEventsPlugin(),this.setupResolver(),this.addWorld(),this.removeUpdateEventListeners(),this.addBall(),this.bodies=[],this.ballCollisionPoints=[]}return l.prototype.enableCollisionEventsPlugin=function(){var c=h.uses[0];t.register(c),t.use(h,c)},l.prototype.setupResolver=function(){e._restingThresh=0,e._restingThreshTangent=0},l.prototype.addWorld=function(){var c=__assign(__assign({},o.GameplayRoot.getPhysicsConfig().matter),{positionIterations:2,velocityIterations:2});this.world=new Phaser.Physics.Matter.World(this.scene,c),this.world.autoUpdate=!1,this.world.drawDebug=!1,this.scene.events.on(Phaser.Scenes.Events.UPDATE,this.world.update,this.world),this.scene.events.on(Phaser.Scenes.Events.POST_UPDATE,this.world.postUpdate,this.world)},l.prototype.removeUpdateEventListeners=function(){i.off(this.world.engine,"beforeUpdate"),i.off(this.world.engine,"afterUpdate"),i.off(this.world.engine,"collisionActive"),i.off(this.world.engine,"collisionEnd")},l.prototype.addBall=function(){this.ball=n.circle(0,0,o.Ball.RADIUS,o.Ball.BODY_CONFIG),this.ball.onCollideCallback=this.onBallCollide.bind(this),this.world.add(this.ball),r.setInertia(this.ball,Infinity),this.ballSpeed=o.Ball.THROW_FORCE*.1,this.ballVelocity={x:0,y:0}},l.prototype.onBallCollide=function(c){if(this.ballCollidedNum++>0)return;this.ballCollisionPoints.push({x:this.ball.position.x,y:this.ball.position.y});var u=c.bodyA.label,d=c.bodyB.label;if(u===o.CollisionTag.FLOOR||d===o.CollisionTag.FLOOR){this.endSimulation=!0;return}if(u!==o.CollisionTag.WALL&&d!==o.CollisionTag.WALL){this.endSimulation=!0;return}},l.prototype.addBody=function(c){if(c.isStatic===!1||c.isSensor)return;var u=n.fromVertices(c.position.x,c.position.y,c.vertices,{restitution:c.restitution,isStatic:c.isStatic,friction:c.friction,frictionAir:c.frictionAir,frictionStatic:c.frictionStatic,circleRadius:c.circleRadius,scale:c.scale,chamfer:c.chamfer,label:c.label});u.originalBody=c,this.world.add(u),this.bodies.push(u)},l.prototype.removeBody=function(c){var u=this.bodies.findIndex(function(d){return d.originalBody===c});u>-1&&(this.world.remove(this.bodies[u]),this.bodies[u].originalBody=null,this.bodies.splice(u,1))},l.prototype.getTrajectoryPoints=function(c,u,d,p){r.setPosition(this.ball,{x:c,y:u}),r.setVelocity(this.ball,{x:Math.cos(d)*this.ballSpeed,y:Math.sin(d)*this.ballSpeed}),this.endSimulation=!1,this.ballCollisionPoints.length=0,this.sync(),this.wakeBodies();for(var f=1e4;--f>0&&!(this.ballCollidedNum=0,this.world.step(),this.endSimulation);)if(this.ballCollisionPoints.length>=p)break;return this.ballCollisionPoints},l.prototype.sync=function(){var c=this;this.bodies.forEach(function(u){var d=u.originalBody,p=c.areVectorsEqual(d.position,u.position)===!1;p&&(d.isStomping?r.setPosition(u,{x:d.position.x,y:d.originalY}):r.setPosition(u,d.position)),d.plugin.isMoving&&r.setVelocity(u,d.velocity),d.plugin.isRotating&&r.setAngle(u,d.angle)})},l.prototype.areVectorsEqual=function(c,u){return Phaser.Math.Fuzzy.Equal(c.x,u.x)&&Phaser.Math.Fuzzy.Equal(c.y,u.y)},l.prototype.wakeBodies=function(){this.bodies.forEach(function(c){return s.set(c,!1)})},l.prototype.maintainBallVelocity=function(){var c=Math.atan2(this.ball.velocity.y,this.ball.velocity.x);this.ballVelocity.x=Math.cos(c)*this.ballSpeed,this.ballVelocity.y=Math.sin(c)*this.ballSpeed,r.setVelocity(this.ball,this.ballVelocity)},l.prototype.toggleSimulation=function(){if(this.world.autoUpdate)this.stopSimulation();else{var c=this.scene.fox.getHandsPosition(),u=this.scene.input.activePointer.positionToCamera(this.scene.camera.camera),d=Phaser.Math.Angle.BetweenPoints(c,u);this.startSimulation(c.x,c.y,d)}},l.prototype.startSimulation=function(c,u,d){var p={x:Math.cos(d)*this.ballSpeed,y:Math.sin(d)*this.ballSpeed};r.setPosition(this.ball,{x:c,y:u}),r.setVelocity(this.ball,p),this.world.autoUpdate=!0,this.world.drawDebug=!0},l.prototype.stopSimulation=function(){this.world.autoUpdate=!1,this.world.drawDebug=!1,this.world.debugGraphic.clear()},l.prototype.destroy=function(){this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.world.update,this.world),this.scene.events.off(Phaser.Scenes.Events.POST_UPDATE,this.world.postUpdate,this.world),this.world.destroy()},l}();o.GameplayWorldCopy=a})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.scene=n,this.sound=this.scene.sound,this.audioCache=this.scene.cache.audio,this.isEnabled=this.scene.game.audioType===o.SoundManagerType.WEB_AUDIO,this.ballHitSounds=this.getBallHitSoundKeys(),this.initThrottledSounds()}return r.prototype.getBallHitSoundKeys=function(){var n=this,e=[o.GameSoundKey.BALL_HIT_1,o.GameSoundKey.BALL_HIT_2,o.GameSoundKey.BALL_HIT_3];return e.filter(function(t){return n.scene.cache.audio.has(t)})},r.prototype.initThrottledSounds=function(){this.ballThrow=this.throttleSound(o.GameSoundKey.BALL_THROW,{volume:.33}),this.ballHit=_.throttle(this.playBallHit.bind(this),100,{trailing:!1}),this.collectableBallHit=this.throttleSound(o.GameSoundKey.NEW_BALL_HIT,{volume:.33}),this.collectableBallLand=this.throttleSound(o.GameSoundKey.NEW_BALL_LANDED,{volume:.33}),this.blockHit=this.throttleSound(o.GameSoundKey.BLOCK_HIT,{volume:.66},{wait:200}),this.blockZap=this.throttleSound(o.GameSoundKey.BLOCK_ZAPPED,{volume:.22}),this.blockCollectWhoosh=this.throttleSound(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH,{volume:.4}),this.blockCollectComplete=this.throttleSound(o.GameSoundKey.BLOCK_COLLECTED,{volume:.15}),this.pinata=this.throttleSound(o.GameSoundKey.PINATA,{volume:1.33}),this.explosion=this.throttleSound(o.GameSoundKey.EXPLOSION,{volume:.7}),this.spinner=this.throttleSound(o.GameSoundKey.SPINNER,{volume:.33}),this.lightning=this.throttleSound(o.GameSoundKey.LIGHTNING,{volume:.33}),this.winningBallExplode=this.throttleSound(o.GameSoundKey.POP_1,{volume:1},{trailing:!0}),this.crackerPunch=this.throttleSound(o.GameSoundKey.BOOSTER_CRACKER_PUNCH,{volume:.5})},r.prototype.playBallHit=function(){if(this.isEnabled===!1)return;if(this.ballHitSounds.length===0)return;var n=Phaser.Math.RND.pick(this.ballHitSounds);this.sound.play(n,{volume:.66})},r.prototype.throttleSound=function(n,e,t){var i=this;return this.isEnabled===!1?_.noop:(t=__assign({wait:100,trailing:!1},t),_.throttle(function(){i.playSound(n,e)},t.wait,t))},r.prototype.playSound=function(n,e){var t=this.audioCache.has(n);t&&this.sound.play(n,e)},r.prototype.destroy=function(){},r}();o.GameplayAudio=h})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r;(function(e){e.COMPLETE="Cracker_COMPLETE"})(r=o.CrackerEvent||(o.CrackerEvent={}));var n=function(e){__extends(t,e);function t(i){var s=e.call(this,i.matter.world,0,0,"gameplay","booster_cracker_big")||this;s.isLaunched=!1,s.hasHitSomething=!1,s.name="cracker",s.gameplay=s.scene,s.hittedItems=[],s.setupBody(),s.addParticles();var a=s.gameplay._physics.collisionCategories;return s.ignoreCollisionCategory(a.balls),s.ignoreCollisionCategory(a.walls),s}return t.prototype.setupBody=function(){var i=30;this.setCircle(i,{isSensor:!0,ignoreGravity:!0,friction:0,frictionAir:0,frictionStatic:0,render:{sprite:{xOffset:-this.originX+i/this.width}}})},t.prototype.addParticles=function(){if(this.particles=this.scene.add.particles("gameplay"),this.particles.setDepth(o.GameplayDepth.BOOSTER_ABOVE_PARTICLES),this.scene.game.rendererType===o.RendererType.CANVAS){this.sparksEmitter=this.gameplay.emitters.createDummyEmitter(),this.smokeEmitter=this.gameplay.emitters.createDummyEmitter();return}this.sparksEmitter=this.particles.createEmitter({frame:["bomb_spark"],lifespan:{min:300,max:500},scale:{start:2,end:0,ease:h.Linear},alpha:{start:1,end:0,ease:h.ExpoEaseIn},quantity:3,frequency:16,speedX:{min:300,max:500},speedY:{min:-300,max:300},on:!1}),this.smokeEmitter=this.particles.createEmitter({frame:["craker_smoke"],lifespan:1e3,scale:{start:.4,end:1,ease:h.Linear},alpha:{start:1,end:0,ease:h.CubicEaseOut},quantity:1,rotate:{min:0,max:360},frequency:33,speedX:{min:100,max:150},speedY:{min:-133,max:133}}),this.smokeEmitter.startFollow(this,this.width*.66)},t.prototype.launch=function(){this.isLaunched=!0,this.originalY=this.y;var i=16.66667/this.scene.game.loop.delta;this.setVelocityX(-20/i),this.startFloat()},t.prototype.startFloat=function(){var i=10;this.y-=i,this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Sine.InOut,y:this.y+i*2,yoyo:!0,repeat:-1})},t.prototype.preUpdate=function(i,s){var a=this;if(this.isLaunched===!1)return;this.sparksEmitter.explode(1,this.x+this.displayWidth/2,this.y),this.x<-this.gameplay.camera.getPadding().x-100&&(this.smokeEmitter.on=!1,this.smokeEmitter.stopFollow(),this.isLaunched=!1,this.emit(r.COMPLETE,this),this.scene.time.delayedCall(800,function(){a.destroy()}))},t.prototype.destroy=function(i){this.scene&&this.scene.tweens.killTweensOf(this),this.particles.destroy(i),this.hittedItems.length=0,e.prototype.destroy.call(this,i)},t}(Phaser.Physics.Matter.Image);o.Cracker=n})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r;(function(e){e.LANDED="Bomb_LANDED"})(r=o.BombEvent||(o.BombEvent={}));var n=function(e){__extends(t,e);function t(i){var s=e.call(this,i.matter.world,0,0,"gameplay","booster_bomb_big")||this;return s.isLaunched=!1,s.explosionRadius=o.GameGrid.CELL_SIZE*1.75,s.gameplay=s.scene,s.name="cracker",s.setupBody(),s.addParticles(),s}return t.prototype.setupBody=function(){var i,s=36;this.setCircle(s,{plugin:(i={},i[o.COLLISION_TAG]=o.CollisionTag.BOMB,i),collisionFilter:{mask:this.gameplay._physics.collisionCategories.boosterBomb},friction:0,frictionAir:0,frictionStatic:0,render:{sprite:{xOffset:-this.originX+.465,yOffset:this.originY-s/this.height-.01}}})},t.prototype.addParticles=function(){this.particles=this.scene.add.particles("gameplay"),this.sparksEmitter=this.particles.createEmitter({frame:["bomb_spark"],lifespan:400,scale:{start:2,end:0,ease:h.Linear},alpha:{start:1,end:0,ease:h.ExpoEaseIn},quantity:1,frequency:33,speed:300,on:!1}),this.particlesContainer=this.scene.add.container(0,0,[this.particles]),this.particlesContainer.setDepth(o.GameplayDepth.BOOSTER_ABOVE_PARTICLES)},t.prototype.launchAt=function(i,s){this.isLaunched=!0,this.target={x:i,y:s},this.safetyTimer=0,this.updateEmitterPosition(),this.sparksEmitter.on=!0,this.playAlphaTween(),this.launchBody()},t.prototype.playAlphaTween=function(){this.alpha=0,this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:1})},t.prototype.launchBody=function(){var i=Phaser.Math.RND.sign();this.setAngularVelocity(-.05*i),this.setAngle(150*i);var s=16.66667/this.scene.game.loop.delta;this.applyForce({x:0,y:-.75*s})},t.prototype.preUpdate=function(i,s){if(this.isLaunched===!1)return;this.updateScale(),this.updateEmitterPosition(),this.checkIfReachTarget(),this.updateSafetyTimer(s)},t.prototype.updateScale=function(){var i=1.2,s=3;this.scale=Phaser.Math.MapLinear(this.body.velocity.y,-40,0,s,i),this.scale=Phaser.Math.Clamp(this.scale,i,s)},t.prototype.updateEmitterPosition=function(){var i=58*this.scale,s=Phaser.Math.DegToRad(this.angle-48),a=i*Math.cos(s),l=i*Math.sin(s),c=this.x+a,u=this.y+l;this.particlesContainer.x=c,this.particlesContainer.y=u,this.particlesContainer.scale=this.scale},t.prototype.checkIfReachTarget=function(){this.y>this.target.y&&this.body.velocity.y>0&&(this.isLaunched=!1,this.emit(r.LANDED,this),this.destroy())},t.prototype.updateSafetyTimer=function(i){this.safetyTimer+=i,this.safetyTimer>1e3&&(this.isLaunched=!1,this.emit(r.LANDED,this),this.destroy())},t.prototype.destroy=function(i){this.scene&&this.scene.tweens.killTweensOf(this),this.particles.destroy(i),e.prototype.destroy.call(this,i)},t}(Phaser.Physics.Matter.Image);o.Bomb=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.turnsLeft=3,t.name="stop",t.addCircleFx(),t.addIcon(),t.addText(),t}return n.prototype.addCircleFx=function(){this.circleFx=this.scene.add.image(0,0,"gameplay","circle_fx"),this.add(this.circleFx)},n.prototype.showCircleFx=function(){var e=this;this.circleFx.revive(),this.circleFx.scale=.5,this.circleFx.alpha=1,this.scene.tweens.add({targets:this.circleFx,duration:1e3,alpha:{value:0,ease:Phaser.Math.Easing.Expo.Out},scale:{value:1.8,ease:Phaser.Math.Easing.Expo.Out},onComplete:function(){e.circleFx.kill()}})},n.prototype.addIcon=function(){this.icon=this.scene.add.image(0,0,"gameplay","booster_stop_big"),this.add(this.icon)},n.prototype.addText=function(){var e=this.turnsLeft.toString();this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.GAMEPLAY_BOOSTERS,e,32),this.text.setOrigin(.5,.5),this.text.x=this.icon.right+1,this.text.y=this.icon.bottom-12,this.text.originalY=this.text.y,this.add(this.text)},n.prototype.updateTurnsNum=function(e){this.turnsLeft=e,this.playUpdateTween(),this.playTextUpdateTween()},n.prototype.playUpdateTween=function(){var e=this;this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Sine.InOut,scale:1.3,yoyo:!0,onComplete:function(){e.showCircleFx()}})},n.prototype.playTextUpdateTween=function(){var e=this;this.scene.tweens.add({targets:this.text,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,completeDelay:400,onComplete:function(){e.text.setText(e.turnsLeft.toString()),e.text.scale=.66,e.scene.tweens.add({targets:e.text,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1}),e.scene.tweens.add({targets:e.text,duration:200,ease:Phaser.Math.Easing.Linear.Linear,alpha:1})}})},n.prototype.show=function(){this.scale=.75,this.alpha=0,this.angle=Phaser.Math.RND.sign()*10,this.scene.tweens.add({targets:this,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1,angle:0}),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:1}),this.showCircleFx()},n.prototype.flyTo=function(e,t){var i=this,s=Phaser.Math.Distance.Between(this.x,this.y,e.x,e.y),a=Math.max(700,s/o.Config.ASSETS_SCALE);this.scene.tweens.add({targets:this,delay:t,duration:a,ease:Phaser.Math.Easing.Back.InOut,easeParams:[1],x:e.x,y:e.y,onComplete:function(){i.onFlyComplete()}}),this.playWhooshSound(t,a)},n.prototype.playWhooshSound=function(e,t){if(this.scene.cache.audio.has(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH)){var i=(e+t*.25)/1e3;this.scene.sound.play(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH,{volume:1,delay:i})}},n.prototype.onFlyComplete=function(){this.scene.tweens.add({targets:this.list,duration:800,ease:Phaser.Math.Easing.Sine.InOut,y:"+=10",yoyo:!0,repeat:-1,delay:this.scene.tweens.stagger(100)})},n.prototype.hide=function(){var e=this;this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,scale:1.33,onComplete:function(){e.destroy()}})},n.prototype.preDestroy=function(){this.scene.tweens.killTweensOf(this.list),r.prototype.preDestroy.call(this)},n}(Phaser.GameObjects.Container);o.Stopper=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="bomb_aim_spot",t.addCircles(),t.addTimerEvent(),t}return n.prototype.addCircles=function(){var e=this;this.circles=_.times(10,function(){var t=e.scene.add.image(0,0,"gameplay","circle_fx");return t.kill(),t}),this.add(this.circles)},n.prototype.addTimerEvent=function(){this.showCirclesTimerEvent=this.scene.time.addEvent({loop:!0,delay:300,startAt:280,callback:this.showCircle.bind(this),paused:!0})},n.prototype.show=function(){this.revive(),this.showCirclesTimerEvent.paused=!1},n.prototype.hide=function(){this.kill(),this.showCirclesTimerEvent.paused=!0},n.prototype.showCircle=function(){var e=this.circles.find(function(t){return t.visible===!1});e&&(e.revive(),e.scale=2,e.alpha=0,this.scene.tweens.add({targets:e,duration:700,alpha:{value:.85,ease:Phaser.Math.Easing.Expo.Out},scale:{value:0,ease:Phaser.Math.Easing.Linear.Linear},onComplete:function(){e.kill()}}))},n.prototype.destroy=function(e){this.showCirclesTimerEvent.destroy(),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Container);o.BombAimSpot=h})(game||(game={}));var game;(function(o){var h=Phaser.Events.EventEmitter,r=Phaser.Math.EasingString,n=Phaser.GameObjects.ButtonEvent,e;(function(i){i.SELECT="GameplayBoosters_SELECT",i.CANCEL="GameplayBoosters_CANCEL",i.ACTIVATE="GameplayBoosters_ACTIVATE",i.COMPLETE="GameplayBoosters_COMPLETE",i.GET_FREE_BOOSTER="GameplayBoosters_GET_FREE_BOOSTER"})(e=o.GameplayBoostersEvent||(o.GameplayBoostersEvent={}));var t=function(i){__extends(s,i);function s(a,l){var c=i.call(this)||this;return c.foxHitNum=0,c.isCanvasRenderer=a.game.rendererType===o.RendererType.CANVAS,c.scene=a,c.gui=l,c.gui.events.on(e.SELECT,c.onBoosterSelect,c),c.gui.events.on(e.CANCEL,c.onBoosterCancel,c),c.gui.events.on(e.GET_FREE_BOOSTER,c.onGetFreeBoostersClick,c),c.freeBoostersScreen=c.gui.freeBoostersScreen,c.boosterHint=c.gui.boosterHintScreen,c.boostersPanel=c.gui.boostersPanel,c.addBombAimSpot(),c.addParticles(),c}return s.prototype.testBooster=function(a,l){var c=this;l=l!=null?l:{x:Phaser.Math.RND.between(0,o.GameGrid.COLUMNS),y:Phaser.Math.RND.between(0,o.GameGrid.ROWS)};var u=this.scene.grid.getCellAt(l.y,l.x);u&&this.scene.time.delayedCall(100,function(){c.activateBooster(c.getBooster(a),u.x,u.y)})},s.prototype.testBoosterByClick=function(a){var l=this;this.scene.removePointerCallbacks(),this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,function(c){var u=l.scene.grid.getCellAtXY(c.worldX,c.worldY);u&&l.activateBooster(l.getBooster(a),u.x,u.y)})},s.prototype.addBombAimSpot=function(){this.bombAimSpot=new o.BombAimSpot(this.scene),this.bombAimSpot.setDepth(o.GameplayDepth.BOOSTER_BELOW_PARTICLES),this.scene.add.existing(this.bombAimSpot)},s.prototype.addParticles=function(){this.particles=this.scene.add.particles("gameplay"),this.particles.setDepth(o.GameplayDepth.BOOSTER_BELOW_PARTICLES),this.bombShockwave=this.isCanvasRenderer?this.scene.emitters.createDummyEmitter():this.createBombShockwaveEmitter()},s.prototype.createBombShockwaveEmitter=function(){return this.particles.createEmitter({frame:"circle_fx",lifespan:800,alpha:{start:1,end:0,ease:r.ExpoEaseOut},scale:{start:.5,end:6,ease:r.ExpoEaseOut},on:!1})},s.prototype.showBombAimSpot=function(a,l){this.bombAimSpot.setPosition(a,l),this.bombAimSpot.show()},s.prototype.hideBombAimSpot=function(){this.bombAimSpot.hide()},s.prototype.onBoosterSelect=function(a){this.addPointerDownCallback(a),this.scene.removePointerCallbacks(),this.boosterHint.updateData(a),this.boosterHint.show(),this.gui.topPanel.hide(),this.gui.pauseButton.kill(),this.boostersPanel.highlight(a.type)},s.prototype.addPointerDownCallback=function(a){this.onPointerDownCallback=this.onFieldClick.bind(this,a),this.scene.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDownCallback)},s.prototype.removePointerDownCallback=function(){this.onPointerDownCallback&&(this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDownCallback),this.onPointerDownCallback=null)},s.prototype.onFieldClick=function(a,l){var c=this.scene.grid.getBounds().contains(l.worldX,l.worldY);c&&(this.removePointerDownCallback(),this.activateBooster(a,l.worldX,l.worldY))},s.prototype.activateBooster=function(a,l,c){this.scene.analytics.sendBoosterUseEvent(this.scene.levelNumber,a.type),this.scene.raven.addExtraContext({lastBooster:a.type,lastBoosterCell:this.scene.grid.getCellAtXY(l,c).toString()}),this.onBoosterActivate(a);switch(a.type){case o.BoosterType.STOP:this.activateStop(a,l,c);break;case o.BoosterType.BOMB:this.activateBomb(a,l,c);break;case o.BoosterType.CRACKER:this.activateCracker(a,l,c);break;default:break}},s.prototype.onBoosterActivate=function(a){a.num-=1,this.boosterHint.hide(),this.gui.topPanel.show(),this.gui.pauseButton.revive(),this.boostersPanel.resetHighlight(),a.type===o.BoosterType.CRACKER||a.type===o.BoosterType.BOMB?(this.boostersPanel.disableInput(),this.boostersPanel.hide(),this.scene.turn.start(),this.scene.stopStomping(),this.scene.hideWarningLine(),this.scene.wakeItems()):(this.boostersPanel.getIconByType(o.BoosterType.STOP).lock(),this.scene.addPointerCallbacks()),this.emit(e.ACTIVATE,a)},s.prototype.activateStop=function(a,l,c){var u=new o.Stopper(this.scene);u.setDepth(o.GameplayDepth.BOOSTER),u.x=l,u.y=c,u.show(),u.flyTo({x:15,y:10},500),this.scene.add.existing(u),this.playStopRevealSound(),this.addTurnCompleteCallback(u)},s.prototype.addTurnCompleteCallback=function(a){this.onTurnCompleteCallback=this.onTurnComplete.bind(this,a),this.scene.events.on(o.GameplayEvent.TURN_FULLY_COMPLETE,this.onTurnCompleteCallback)},s.prototype.removeTurnCompleteCallback=function(){this.onTurnCompleteCallback&&(this.scene.events.off(o.GameplayEvent.TURN_FULLY_COMPLETE,this.onTurnCompleteCallback),this.onTurnCompleteCallback=null)},s.prototype.playStopRevealSound=function(){this.scene.cache.audio.has(o.GameSoundKey.FANCY_TAP)&&this.scene.sound.play(o.GameSoundKey.FANCY_TAP,{volume:.66})},s.prototype.onTurnComplete=function(a){var l=--a.turnsLeft===0;l?(a.hide(),this.onBoosterComplete(this.getBooster(o.BoosterType.STOP)),this.removeTurnCompleteCallback()):a.updateTurnsNum(a.turnsLeft)},s.prototype.activateBomb=function(a,l,c){var u=this;this.playIgniteSound();var d=this.scene.grid.getCellAtXY(l,c);this.showBombAimSpot(d.x,d.y),this.scene.time.delayedCall(300,function(){u.playBombWhooshSound(),u.throwBomb(a,d.x,d.y)})},s.prototype.playIgniteSound=function(){this.scene.cache.audio.has(o.GameSoundKey.BOOSTER_BOMB_IGNITE)&&this.scene.sound.play(o.GameSoundKey.BOOSTER_BOMB_IGNITE,{volume:1})},s.prototype.throwBomb=function(a,l,c){var u=new o.Bomb(this.scene);u.x=l,u.y=c+o.GameGrid.CELL_SIZE*4,u.setDepth(o.GameplayDepth.BOOSTER),u.on(o.BombEvent.LANDED,this.onBombLanded.bind(this,u,a)),u.launchAt(l,c),this.scene.add.existing(u),this.scene.turn.pendingBoosters.push(u)},s.prototype.playBombWhooshSound=function(){this.scene.cache.audio.has(o.GameSoundKey.WINNING_BALL_WHOOSH)&&this.scene.sound.play(o.GameSoundKey.WINNING_BALL_WHOOSH,{volume:1})},s.prototype.onBombLanded=function(a,l){a.x=a.target.x,a.y=a.target.y,this.scene.showExplosion(a.x,a.y,1.5),this.scene.damageNearbyBlocks(a),this.scene.destroyNearbyItems(a),this.scene.audio.explosion(),this.scene.cameras.main.shake(600,.014,!0),this.checkBombFoxOverlap(a),this.hideBombAimSpot(),this.bombShockwave.explode(1,a.x,a.y);var c=this.scene.turn.pendingBoosters.indexOf(a);c>-1&&(this.scene.turn.pendingBoosters.splice(c,1),this.scene.turn.pendingBoosters.length===0&&(this.onBoosterComplete(l),this.scene.turn.checkComplete()&&this.scene.onTurnComplete()))},s.prototype.checkBombFoxOverlap=function(a){var l=this.scene.fox,c=Phaser.Math.Distance.Between(a.x,a.y,l.x,l.y);c<o.GameGrid.CELL_SIZE*2&&this.onFoxHit()},s.prototype.onFoxHit=function(){this.scene.showFoxTalkBubble(),this.scene.fox.showWorriedFrame(),this.foxHitNum++,this.foxHitNum%2===0?this.playCatchYouShout():this.playStopShout()},s.prototype.playCatchYouShout=function(){this.scene.cache.audio.has(o.GameSoundKey.CATCH_YOU_SHOUT)&&this.scene.sound.play(o.GameSoundKey.CATCH_YOU_SHOUT,{volume:1})},s.prototype.playStopShout=function(){this.scene.cache.audio.has(o.GameSoundKey.STOP_SHOUT)&&this.scene.sound.play(o.GameSoundKey.STOP_SHOUT,{volume:1})},s.prototype.activateCracker=function(a,l,c){var u=this;this.playIgniteSound(),this.scene.time.delayedCall(300,function(){u.playCrackerSound(),u.launchCracker(a,l,c),u.scene.camera.camera.shake(2e3,.005,!0)})},s.prototype.playCrackerSound=function(){this.scene.cache.audio.has(o.GameSoundKey.BOOSTER_CRACKER)&&this.scene.sound.play(o.GameSoundKey.BOOSTER_CRACKER,{volume:1})},s.prototype.launchCracker=function(a,l,c){var u=this.scene.grid.getCellAtXY(l,c),d=new o.Cracker(this.scene);d.x=this.scene.getFieldWidth()+this.scene.camera.getPadding().x,d.y=u.y,d.setDepth(o.GameplayDepth.BOOSTER),d.setOnCollide(this.onCrackerCollide.bind(this)),d.once(o.CrackerEvent.COMPLETE,this.onCrackerOutOfWorld.bind(this,a)),d.launch(),this.scene.add.existing(d),this.scene.turn.pendingBoosters.push(d),this.scene.grid.highlightRow(u.row,.77,0),u.row<2&&this.onFoxHit()},s.prototype.onCrackerCollide=function(a){var l=a.bodyA.gameObject,c=a.bodyB.gameObject;if(c&&l){var u=c.hittedItems.includes(l);if(u)return;c.hasHitSomething=!0,c.hittedItems.push(l),this.moveItemByCracker(l)}},s.prototype.moveItemByCracker=function(a){var l=this,c=Phaser.Math.RND.between(60,100),u=Math.max(0,a.x-c),d=o.GameGrid.CELL_SIZE/2,p=a.grid.getColumn()%2===0?-1:1,f=(o.GameGrid.ROWS-o.GameGrid.LOSE_ROW)*o.GameGrid.CELL_SIZE,y=Phaser.Math.Clamp(a.y+d*p,0,f);this.scene.tweens.add({targets:a,duration:300,ease:Phaser.Math.Easing.Back.Out,x:u,y:y,onStart:function(){l.onMoveByCrackerStart(a)},onComplete:function(){l.onMoveByCrackerComplete(a)}})},s.prototype.onMoveByCrackerStart=function(a){a.setDepth(o.GameplayDepth.HIT_BY_CRACKER);var l=o.ItemTypeUtil.isBlockType(a.itemType);if(l){var c=a;c.hitByCracker(),this.scene.audio.crackerPunch()}},s.prototype.onMoveByCrackerComplete=function(a){var l=o.ItemTypeUtil.isBlockType(a.itemType);if(l){var c=a;c.health.kill()}else a.once(o.HideEvent.COMPLETE,function(){a.destroy()}),a.hideOnLevelComplete(300)},s.prototype.onCrackerOutOfWorld=function(a,l){var c=this;this.scene.camera.camera.shakeEffect.reset(),l.hasHitSomething===!1?(this.onBoosterComplete(a),this.scene.turn.pendingBoosters.length=0,this.scene.onTurnComplete()):l.once(Phaser.GameObjects.Events.DESTROY,function(){c.onBoosterComplete(a),c.scene.turn.pendingBoosters.length=0,c.scene.turn.checkComplete()&&c.scene.onTurnComplete()})},s.prototype.onBoosterComplete=function(a){this.emit(e.COMPLETE,a),a.type===o.BoosterType.STOP?this.boostersPanel.getIconByType(o.BoosterType.STOP).unlock():(this.boostersPanel.enableInput(),this.scene.addPointerCallbacks())},s.prototype.onBoosterCancel=function(a){this.removePointerDownCallback(),this.scene.addPointerCallbacks(),this.boosterHint.hide(),this.gui.topPanel.show(),this.gui.pauseButton.revive(),this.boostersPanel.resetHighlight()},s.prototype.onGetFreeBoostersClick=function(a){if(!this.freeBoostersScreen)return;this.onFreeBoostersScreenShow(a.type),this.freeBoostersScreen.closeButton.on(n.PRESS,this.onFreeBoosterScreenClose.bind(this,a.type)),this.freeBoostersScreen.playButton.on(n.PRESS,this.showRewardAd,this),this.freeBoostersScreen.once(o.FreeBoostersScreenEvent.HIDE_START,this.onFreeBoostersScreenHide,this),this.freeBoostersScreen.updateData(a.type,this.getBoosterRewardNum()),this.freeBoostersScreen.revive(),this.freeBoostersScreen.show()},s.prototype.getBoosterRewardNum=function(){var a=this.scene.game.analytics.getRemoteConfigValue(o.RemoteConfigKey.BOOSTERS_NUM,"1");return parseInt(a)},s.prototype.onFreeBoostersScreenShow=function(a){this.scene.removePointerCallbacks(),this.gui.bottomPanel.disableInput()},s.prototype.showRewardAd=function(){var a=this,l=this.freeBoostersScreen.currentBooster,c=this.getBoosterRewardNum();this.scene.analytics.sendRewardedAd("free_booster",l,"request"),this.scene.poki.rewardedBreak("Booster:"+l,{onSuccess:function(){a.scene.time.delayedCall(200,function(){a.onRewardAdSuccess(l,c),a.freeBoostersScreen.hide(),a.scene.analytics.sendRewardedAd("free_booster",l,"receive")})},onFail:function(){a.scene.analytics.sendRewardedAd("free_booster",l,"fail")}}).catch(function(){})},s.prototype.onRewardAdSuccess=function(a,l){this.boostersPanel.getIconByType(a).onGiftArrive(l),this.scene.boosters.getBooster(a).num+=l,this.scene.analytics.sendRewardedAd("free_booster",a,"receive")},s.prototype.onFreeBoosterScreenClose=function(a){this.gui.freeBoostersScreen.hide()},s.prototype.onFreeBoostersScreenHide=function(){this.scene.addPointerCallbacks(),this.gui.bottomPanel.enableInput(),this.freeBoostersScreen.closeButton.off(n.PRESS,this.onFreeBoosterScreenClose,this),this.freeBoostersScreen.playButton.off(n.PRESS,this.showRewardAd,this)},s.prototype.getBooster=function(a){return this.scene.game.boosters.getByType(a)},s.prototype.destroy=function(){this.particles.destroy(),this.removeTurnCompleteCallback(),this.removePointerDownCallback(),this.scene.events.off(e.ACTIVATE,this.onBoosterActivate,this),this.scene.events.off(e.COMPLETE,this.onBoosterComplete,this),this.gui.events.off(e.SELECT,this.onBoosterSelect,this),this.gui.events.off(e.CANCEL,this.onBoosterCancel,this),this.gui.events.off(e.GET_FREE_BOOSTER,this.onGetFreeBoostersClick,this)},s}(h);o.GameplayBoosters=t})(game||(game={}));var game;(function(o){var h=Phaser.Events.EventEmitter,r;(function(e){e.COMPLETE="SecondChance_COMPLETE"})(r=o.SecondChanceEvent||(o.SecondChanceEvent={}));var n=function(e){__extends(t,e);function t(i){var s=e.call(this)||this;return s.wasUsed=!1,s.scene=i,s}return t.prototype.apply=function(){var i=this;this.wasUsed=!0,this.removeBlockKing();var s=100;this.scene.time.delayedCall(s+100,function(){i.reviveFox(),i.reviveBalls()}),this.scene.time.delayedCall(s+300,function(){i.destroyTopItems()})},t.prototype.removeBlockKing=function(){var i=this.scene.sys.displayList.getByName(o.BlockKing.NAME);i&&this.scene.tweens.add({targets:i,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){i.destroy()}})},t.prototype.reviveFox=function(){var i=this.scene.fox;i.playIdleAnimation(),i.revive(),i.alpha=0,i.scale=.8,this.scene.tweens.add({targets:i,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:1}),this.scene.tweens.add({targets:i,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1})},t.prototype.reviveBalls=function(){this.scene.idleBalls.forEach(function(i){return i.revive()})},t.prototype.destroyTopItems=function(){var i=this,s=this.scene.items.filter(function(l){return l.grid.getRow()>=o.GameGrid.ROWS-t.ROWS-1}),a=s.length;if(a===0){this.moveItemsUp(t.ROWS);return}s.forEach(function(l){l.on(Phaser.GameObjects.Events.DESTROY,function(){--a===0&&i.moveItemsUp(t.ROWS)}),l.on(o.HideEvent.COMPLETE,function(){l.destroy()}),l.hideOnLevelComplete(150)})},t.prototype.moveItemsUp=function(i){var s=this;this.playMoveItemsUpSound(),this.scene.tweens.add({targets:this.scene.items,duration:200,ease:Phaser.Math.Easing.Cubic.Out,y:"-="+o.GameGrid.CELL_SIZE,completeDelay:66}).once(Phaser.Tweens.Events.TIMELINE_COMPLETE,function(){--i===0?s.onMoveUpComplete():s.moveItemsUp(i)})},t.prototype.playMoveItemsUpSound=function(){this.scene.cache.audio.has(o.GameSoundKey.MOVE_ITEMS_UP)&&this.scene.sound.play(o.GameSoundKey.MOVE_ITEMS_UP,{volume:.66})},t.prototype.onMoveUpComplete=function(){this.scene.completeTurn(),this.adjustLevelGenerator(),this.emit(r.COMPLETE,this)},t.prototype.adjustLevelGenerator=function(){this.scene.generator.moveRowPointer(-t.ROWS)},t.ROWS=3,t}(h);o.SecondChance=n})(game||(game={}));var game;(function(o){var h=function(){function r(n){this._timeScale=1,this.isEnabled=!1,this.scene=n,this.items=[]}return Object.defineProperty(r.prototype,"timeScale",{get:function(){return this._timeScale},enumerable:!1,configurable:!0}),r.prototype.addItem=function(n){this.items.push(n)},r.prototype.removeItem=function(n){var e=this.items.indexOf(n);e>-1&&this.items.splice(e,1)},r.prototype.enable=function(){if(this.scene.turn.inProgress()===!1)return;if(this.isEnabled)return;this.scene.turn.fastForwarded=!0;var n=3;this._timeScale=n,this.isEnabled=!0,this.scene.anims.globalTimeScale=n,this.scene.tweens.timeScale=n,this.scene.time.timeScale=n,this.scene.emitters.setTimescale(n),this.items.forEach(function(e){return e.timeScale=n}),this.scene.gui.tweens.timeScale=n,this.scene.gui.fastForwardButton.disable(),this.scene.gui.fastForwardButton.playAnimation(),this.scene.gui.fastForward.show(),this.scene.sound.setRate(n),this.playSound(),this.scene.game.store.saveValue(o.GameStoreKey.FAST_FORWARD_WAS_USED,!0),this.scene.events.emit(o.GameplayEvent.FAST_FORWARD_START,this)},r.prototype.playSound=function(){if(this.sound){this.sound.play();return}this.scene.cache.audio.has(o.GameSoundKey.FAST_FORWARD)&&(this.sound=this.scene.sound.add(o.GameSoundKey.FAST_FORWARD,{volume:1}),this.sound.play())},r.prototype.disable=function(){if(this.isEnabled===!1)return;this._timeScale=1,this.isEnabled=!1,this.scene.anims.globalTimeScale=1,this.scene.tweens.timeScale=1,this.scene.time.timeScale=1,this.scene.emitters.setTimescale(1),this.items.forEach(function(n){return n.timeScale=1}),this.scene.gui.tweens.timeScale=1,this.scene.gui.fastForwardButton.stopAnimation(),this.scene.gui.fastForward.hide(),this.scene.sound.setRate(1),this.sound&&this.sound.stop()},r.prototype.destroy=function(){this.scene.sound.rate!==1&&this.scene.sound.setRate(1),this.scene.anims.globalTimeScale=1,this.items=null},r}();o.FastForward=h})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.isStarted=!1,this.scene=n}return r.prototype.start=function(){this.isStarted=!0,this.startTimestamp=Date.now(),this.ballsDropped=!1,this.fastForwarded=!1,this.points=0,this.blocksKilledNum=0,this.lightningsActivated=[],this.spinnersActivated=[],this.collectableBallsActivated=[],this.futureItems=[],this.pendingDestroyBlocks=[],this.pendingBoosters=[],this.ballsThrownNum=0,this.ballsLandedNum=0,this.firstLandedBall=null},r.prototype.inProgress=function(){return this.isStarted===!0},r.prototype.checkComplete=function(){var n=this.getCompleteReport();return Object.values(n).every(function(e){return e===!0})},r.prototype.getCompleteReport=function(){if(!this.isStarted)return null;var n=this.ballsLandedNum===this.ballsThrownNum,e=this.collectableBallsActivated.every(function(a){return a.isDestroyed}),t=this.futureItems.length===0,i=this.pendingDestroyBlocks.length===0,s=this.pendingBoosters.length===0;return{allBallsLanded:n,allCollectablesLanded:e,allFutureItemsReady:t,allBlocksDestroyed:i,allBoostersComplete:s}},r.prototype.complete=function(){this.isStarted=!1},r}();o.Turn=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e,0,0)||this;return t.addLine(),t.addHand(),t.scene.events.once(o.GameplayEvent.TURN_START,t.hide,t),t.scene.events.once(o.GameplayEvent.TURN_COMPLETE,t.hide,t),t}return n.prototype.addLine=function(){this.line=this.scene.add.image(0,0,"gameplay","tutorial_line"),this.add(this.line)},n.prototype.addHand=function(){this.hand=this.scene.add.image(0,0,"gameplay","tutorial_hand"),this.hand.y=this.line.y+this.hand.height*this.hand.originY-4,this.hand.originalX=this.hand.x,this.hand.originalY=this.hand.y,this.hand.alpha=0,this.add(this.hand)},n.prototype.show=function(e){this.scene.tweens.add({targets:this,delay:e,alpha:{start:0,from:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200},scale:{from:.8,to:1,ease:Phaser.Math.Easing.Back.Out,duration:400},y:{from:this.y+40,to:this.y,ease:Phaser.Math.Easing.Back.Out,duration:500}}),this.playHandMoving(e+300)},n.prototype.playHandMoving=function(e){var t=this;if(e===void 0&&(e=0),!this.scene)return;var i=this.scene.items.find(function(c){return o.ItemTypeUtil.isBlockType(c.itemType)});if(!i)return;this.hand.x=this.hand.originalX,this.hand.y=this.hand.originalY,this.hand.alpha=0,this.hand.scale=1;var s=Phaser.Math.Angle.BetweenPoints(i.getWorldPosition(),this.hand.getWorldPosition()),a=s-Math.PI/2,l=Phaser.Math.RadToDeg(a);this.hand.angle=l>0?-35:44,this.handMoveTimeline=this.scene.tweens.timeline({tweens:[{delay:e,targets:this.hand,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:1,completeDelay:100},{targets:this.hand,duration:500,ease:Phaser.Math.Easing.Linear.Linear,rotation:a,completeDelay:100},{targets:this.hand,duration:300,ease:Phaser.Math.Easing.Sine.InOut,x:function(){return t.getHandX()},y:function(){return t.getHandY()},yoyo:!0,completeDelay:200},{targets:this.hand,duration:200,ease:Phaser.Math.Easing.Linear.Linear,scale:1.33,alpha:0,completeDelay:500}],onComplete:this.playHandMoving.bind(this)})},n.prototype.getTargetHandPosition=function(){var e=30,t=this.hand.rotation-Math.PI/2,i=this.hand.x+Math.cos(t)*e,s=this.hand.y+Math.sin(t)*e;return{x:i,y:s}},n.prototype.getHandX=function(){return this.getTargetHandPosition().x},n.prototype.getHandY=function(){return this.getTargetHandPosition().y},n.prototype.hide=function(){var e=this;if(!this.scene)return;this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){e.destroy()}})},n.prototype.destroy=function(e){this.scene&&(this.scene.tweens.killTweensOf(this),this.scene.tweens.killTweensOf(this.hand),this.scene.events.off(o.GameplayEvent.TURN_START,this.hide,this),this.scene.events.off(o.GameplayEvent.TURN_COMPLETE,this.hide,this)),this.handMoveTimeline&&(this.handMoveTimeline.destroy(),this.handMoveTimeline=null),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Container);o.TutorialHand=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.scene=e,t.block=t.scene.items.find(function(i){return o.ItemTypeUtil.isBlockType(i.itemType)}),t.block.once(o.HealthEvent.KILL,t.hide,t),t.addCircles(),t.show(),t}return n.prototype.addCircles=function(){var e=this;this.circles=_.times(10,function(){var t=e.scene.add.image(0,0,"gameplay","circle_fx");return t.kill(),e.add(t),t})},n.prototype.show=function(){this.showCircleEvent=this.scene.time.addEvent({loop:!0,delay:600,startAt:400,callback:this.showCircle.bind(this)})},n.prototype.showCircle=function(){var e=this.circles.find(function(t){return t.visible===!1});e&&(e.revive(),e.scale=2,e.alpha=0,this.scene.tweens.add({targets:e,duration:1200,alpha:{value:.4,ease:Phaser.Math.Easing.Expo.Out},scale:{value:0,ease:Phaser.Math.Easing.Linear},onComplete:function(){e.kill()}}))},n.prototype.hide=function(){this.block=null,this.destroy()},n.prototype.preUpdate=function(e,t){this.block&&(this.x=this.block.x,this.y=this.block.y)},n.prototype.destroy=function(){this.showCircleEvent&&this.showCircleEvent.destroy()},n}(Phaser.GameObjects.Container);o.BlockHint=h})(game||(game={}));var game;(function(o){var h;(function(n){n.ITEMS_READY="PinataItemsFactory_ITEMS_READY"})(h=o.PinataItemsFactoryEvent||(o.PinataItemsFactoryEvent={}));var r=function(n){__extends(e,n);function e(t,i,s){var a=n.call(this)||this;return a.scene=t,a.grid=i,a.world=a.scene.matter.world,a.emitter=s,a}return e.prototype.createFromPinata=function(t){var i=this.getAvailableCells(t),s=this.createItems(i);s.length===0?this.emit(h.ITEMS_READY,[]):this.showItems(s)},e.prototype.getAvailableCells=function(t){var i=this.grid.getCellAtXY(t.x,t.y),s=this.grid.getCellNeighbours(i);return this.filterCells(s)},e.prototype.filterCells=function(t){var i=this,s=this.world.getAllBodies().filter(function(u){return u.isStatic}),a=function(u){return u&&i.grid.isCellFree(u.column,u.row,s)},l=function(u){return u.row>2},c=function(u){return!i.scene.turn.futureItems.some(function(d){return d.column===u.column&&d.row===u.row})};return t.filter(a).filter(l).filter(c)},e.prototype.createItems=function(t){var i=this;return t.map(function(s){var a=i.createItem(s);return i.onItemCreate(a,s),a})},e.prototype.showItems=function(t){var i=this;this.scene.tweens.add({targets:t,alpha:{from:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:100},scale:{from:.75,to:1,ease:Phaser.Math.Easing.Back.Out,duration:200}}).on(Phaser.Tweens.Events.TWEEN_COMPLETE,function(){i.onAllItemsReady(t)})},e.prototype.onAllItemsReady=function(t){var i=this;t.forEach(function(s){return i.onItemReady(s)}),this.emit(h.ITEMS_READY,t.map(function(s){return s.itemType}))},e.prototype.createItem=function(t){var i=this.scene.generator.itemsGenerator,s=i.getItemTypeForPinata(),a=i.getItemParams(s,this.scene.levelConfig.generator.startRow,t.row);return this.scene.factory.create(__assign({itemType:s,column:t.column,row:t.row},a))},e.prototype.emitParticles=function(t){this.emitter.explode(10,t.x,t.y)},e.prototype.onItemCreate=function(t,i){this.world.remove(t.body),this.addToFutureItems(t,i),this.emitParticles(t),o.ItemTypeUtil.isBlock(t)&&(t.health.invincible=!0)},e.prototype.addToFutureItems=function(t,i){this.scene.turn.futureItems.push({item:t,column:i.column,row:i.row})},e.prototype.onItemReady=function(t){this.removeFromFutureItems(t),this.world.add(t.body),this.scene.factory.postCreationCallback(t),o.ItemTypeUtil.isBlock(t)&&(t.health.invincible=!1)},e.prototype.removeFromFutureItems=function(t){var i=this.scene.turn.futureItems.findIndex(function(s){return s.item===t});i>-1&&this.scene.turn.futureItems.splice(i,1)},e}(Phaser.Events.EventEmitter);o.PinataItemsFactory=r})(game||(game={}));var game;(function(o){var h;(function(n){n.ITEMS_READY="ShatterPiecesFactoryEvent_ITEMS_READY"})(h=o.ShatterPiecesFactoryEvent||(o.ShatterPiecesFactoryEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this)||this;return s.scene=t,s.grid=i,s.world=s.scene.matter.world,s}return e.prototype.createFromParent=function(t){var i=o.ShatterBlockPiece.ALL_FRAMES,s=this.getAvailableCellsAround(t,i),a=this.createPieces(s,i);a.length>0?this.showPieces(t,a):this.onAllPiecesReady(0)},e.prototype.getAvailableCellsAround=function(t,i){var s=this,a=t.grid.getColumn(),l=t.grid.getRow();return i.map(function(c){var u=s.getPieceGridPositionByFrame(c,a,l),d=u.x,p=u.y;if(p<3)return null;var f=s.scene.turn.futureItems.findIndex(function(v){return v.column===d&&v.row===p})>-1;if(f)return null;var y=s.grid.isCellFree(d,p);return y===!1?null:s.grid.getCellAt(p,d)})},e.prototype.getPieceGridPositionByFrame=function(t,i,s){var a,l=(a={},a[o.ShatterBlockPiece.UP_FRAME]={x:i,y:s+1},a[o.ShatterBlockPiece.RIGHT_FRAME]={x:i+1,y:s},a[o.ShatterBlockPiece.DOWN_FRAME]={x:i,y:s-1},a[o.ShatterBlockPiece.LEFT_FRAME]={x:i-1,y:s},a);return l[t]},e.prototype.createPieces=function(t,i){var s=this,a=[];return t.forEach(function(l,c){if(!l)return;var u=s.createPiece(i[c],l.column,l.row);s.world.remove(u.body),s.addToFutureItems(u,l.row,l.column),a.push(u)}),a},e.prototype.createPiece=function(t,i,s){var a=o.ItemType.SHATTER_BLOCK_PIECE,l=this.scene.generator.itemsGenerator.getItemParams(a,this.scene.levelConfig.generator.startRow,s);return this.scene.factory.create(__assign({itemType:a,frame:t,column:i,row:s},l))},e.prototype.showPieces=function(t,i){var s=this,a=0;i.forEach(function(l){l.alpha=0,s.scene.tweens.add({targets:l,duration:200,alpha:1,ease:Phaser.Math.Easing.Cubic.Out});var c=l.x,u=l.y;s.scene.factory.alignItemToGrid(l,t.grid.getColumn(),t.grid.getRow()),s.scene.tweens.add({targets:l,duration:300,ease:Phaser.Math.Easing.Back.Out,x:c,y:u,onComplete:function(){s.onPieceReady(l),++a===i.length&&s.onAllPiecesReady(i.length)}})})},e.prototype.onPieceReady=function(t){this.removeFromFutureItems(t),this.world.add(t.body)},e.prototype.onAllPiecesReady=function(t){this.emit(h.ITEMS_READY,Array(t).fill(o.ItemType.SHATTER_BLOCK))},e.prototype.addToFutureItems=function(t,i,s){this.scene.turn.futureItems.push({item:t,column:s,row:i})},e.prototype.removeFromFutureItems=function(t){var i=this.scene.turn.futureItems.findIndex(function(s){return s.item===t});i>-1&&this.scene.turn.futureItems.splice(i,1)},e}(Phaser.Events.EventEmitter);o.ShatterPiecesFactory=r})(game||(game={}));var game;(function(o){var h;(function(n){n.JUMP_ON_FOX_COMPLETE="BlockKing_JUMP_ON_FOX_COMPLETE"})(h=o.BlockKingEvent||(o.BlockKingEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.name=e.NAME,i.addBlock(),i.addFace(),i.addWhite(),i.addShadow(),i.addCrown(),i}return e.prototype.addBlock=function(){this.block=this.scene.add.image(0,0,"gameplay","block_king/basic_block_01"),this.block.setOrigin(.5,1),this.add(this.block)},e.prototype.addFace=function(){this.face=this.scene.add.image(0,0,"gameplay","block_king/basic_block_01_face_idle"),this.face.setOrigin(.5,1),this.add(this.face)},e.prototype.addWhite=function(){this.blockWhite=this.scene.add.image(0,0,"gameplay","block_king/white_basic_block_01"),this.blockWhite.setOrigin(.5,1),this.add(this.blockWhite)},e.prototype.addShadow=function(){this.shadow=this.scene.add.image(0,0,"gameplay","block_king/block_ground_shadow"),this.shadow.x=3,this.shadow.y=this.block.bottom,this.shadow.scaleX=1.66,this.shadow.kill(),this.addAt(this.shadow,0)},e.prototype.addCrown=function(){this.crown=this.scene.add.image(0,0,"gameplay","block_king/crown"),this.crown.setOrigin(.5,1),this.crown.y=this.block.top-14,this.crown.kill(),this.add(this.crown)},e.prototype.jumpOnFox=function(t,i){var s=this;this.alpha=0,this.scale=1.5,this.blockWhite.alpha=.77,this.scene.tweens.add({targets:this.blockWhite,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:0}),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({targets:this,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,y:this.y-250,completeDelay:100,onComplete:function(){s.doJumpOnFox(t,i)}})},e.prototype.doJumpOnFox=function(t,i){this.scene.cache.audio.has(o.GameSoundKey.BLOCK_STOMP_WHOOSH)&&this.scene.sound.play(o.GameSoundKey.BLOCK_STOMP_WHOOSH,{volume:.75,delay:.24}),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Sine.InOut,angle:this.angle-15,yoyo:!0}),this.scene.tweens.add({targets:this,duration:500,ease:Phaser.Math.Easing.Back.In,x:t,y:i,onComplete:this.onJumpComplete.bind(this)})},e.prototype.onJumpComplete=function(){this.shadow.revive(),this.playIdleTweens(),this.showBlinkFrame(),this.showCrown(500),this.emit(h.JUMP_ON_FOX_COMPLETE,this)},e.prototype.playIdleTweens=function(){if(!this.scene)return;this.scene.tweens.add({targets:[this.block,this.face],duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.04,scaleY:.9,yoyo:!0,repeat:-1}),this.scene.tweens.add({targets:this.crown,duration:600,ease:Phaser.Math.Easing.Sine.InOut,y:"+=12",yoyo:!0,repeat:-1})},e.prototype.showBlinkFrame=function(){var t=this;this.face.setFrame("block_king/basic_block_01_face_blink"),this.face.setOrigin(.5,1),this.scene.time.delayedCall(600,function(){t.face.setFrame("block_king/basic_block_01_face_idle"),t.face.setOrigin(.5,1)})},e.prototype.showCrown=function(t){this.crown.revive(),this.crown.alpha=0,this.crown.scale=.8,this.scene.tweens.add({delay:t,targets:this.crown,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({delay:t,targets:this.crown,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1})},e.prototype.destroy=function(t){this.scene&&this.scene.tweens.killTweensOf([this.crown,this.block,this.face]),n.prototype.destroy.call(this,t)},e.NAME="block_king",e}(Phaser.GameObjects.Container);o.BlockKing=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="lose_tutorial_popover",t.addBack(),t.addSign(),t.addText(),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay","warning_popover"),this.add(this.back)},n.prototype.addSign=function(){this.sign=this.scene.add.image(0,0,"gameplay","warning_sign"),this.sign.x=this.back.left+16,this.sign.y=this.back.top+12,this.add(this.sign)},n.prototype.addText=function(){var e=this.scene.texts.lose_warning,t={fontFamily:o.GameFont.DEFAULT,fontStyle:o.FontWeight.BOLD,fontSize:"24px",color:"#205466",align:"center"},i=100;this.text=this.scene.add.text(0,0,e,t),this.text.setWordWrapWidth(265),this.text.setOrigin(.5,.5),this.text.scale=Math.min(1,i/this.text.height),this.text.y=-74,this.add(this.text)},n}(Phaser.GameObjects.Container);o.LoseTutorialPopover=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this)||this;return t.scene=e,t.addPopover(),t.showPopover(),t.timerEvent=t.scene.time.delayedCall(2e3,t.addPointerListeners,null,t),t.scene.events.once(Phaser.Scenes.Events.SHUTDOWN,t.onSceneShutdown,t),t.scene.events.once(o.GameplayEvent.TURN_START,t.onTurnStart,t),t}return n.prototype.addPopover=function(){this.popover=new o.LoseTutorialPopover(this.scene),this.popover.x=this.scene.getFieldWidth()/2,this.popover.y=this.scene.warningLine.y-10,this.popover.setDepth(o.GameplayDepth.LOSE_TUTORIAL),this.scene.add.existing(this.popover)},n.prototype.showPopover=function(){this.popover.alpha=0,this.scene.tweens.add({targets:this.popover,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.popover.scale=.8,this.scene.tweens.add({targets:this.popover,duration:400,ease:Phaser.Math.Easing.Back.Out,easeParams:[1.6],scale:1})},n.prototype.hideTutorial=function(){var e=this;this.scene.game.store.saveValue(o.GameStoreKey.LOSE_TUTORIAL_COMPLETE,!0),this.scene.tweens.killTweensOf(this.popover),this.scene.tweens.add({targets:this.popover,y:"-15",duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){e.popover.destroy()}})},n.prototype.onPointerDown=function(){this.scene.events.off(o.GameplayEvent.TURN_START,this.onTurnStart,this),this.removePointerListeners(),this.hideTutorial()},n.prototype.onPointerMove=function(e){e.isDown&&(this.scene.events.off(o.GameplayEvent.TURN_START,this.onTurnStart,this),this.removePointerListeners(),this.hideTutorial())},n.prototype.addPointerListeners=function(){this.scene.input.once(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.once(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)},n.prototype.removePointerListeners=function(){this.scene.input.off(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.scene.input.off(Phaser.Input.Events.POINTER_MOVE,this.onPointerMove,this)},n.prototype.onTurnStart=function(){this.timerEvent.remove(),this.removePointerListeners(),this.hideTutorial()},n.prototype.onSceneShutdown=function(){this.removePointerListeners(),this.scene.events.off(o.GameplayEvent.TURN_START,this.onTurnStart,this),this.timerEvent.remove(),this.scene=null},n}(Phaser.Events.EventEmitter);o.LoseTutorial=h})(game||(game={}));var game;(function(o){var h=Phaser.Math.Distance,r=Phaser.GameObjects.ButtonEvent,n;(function(t){t.TURN_START="Gameplay_TURN_START",t.TURN_COMPLETE="Gameplay_TURN_COMPLETE",t.TURN_FULLY_COMPLETE="Gameplay_TURN_FULLY_COMPLETE",t.FAST_FORWARD_START="Gameplay_FAST_FORWARD_START"})(n=o.GameplayEvent||(o.GameplayEvent={}));var e=function(t){__extends(i,t);function i(){return t.call(this,{physics:o.GameplayRoot.getPhysicsConfig()})||this}return i.prototype.init=function(s){this.levelConfig=s,this.levelNumber=this.levelConfig.levelNumber,this.isPointerDown=!1,this.isMoveDownLocked=!1,this.isGameplayStopped=!1,this.physicsShapes=this.cache.json.get("physics"),this.balls=[],this.items=[],this.levelData=this.createLevelData(),this.initAnimationPools(),this.gui=null,this.camera=null,this.worldCopy=null,this.audio=null,this.boosters=null,this.secondChance=null,this.events.once("shutdown",this.shutdown,this),this.analytics.sendLevelStart(this.levelNumber),this.poki.sdk.gameplayStart(),this.game.raven.addExtraContext({level:this.levelNumber})},i.prototype.create=function(){this.generator=new o.LevelGenerator(this,this.levelConfig),this.camera=new o.GameplayCamera(this),this.factory=new o.GameplayItemsFactory(this),this._physics=new o.GameplayPhysics(this),this.pools=new o.GameplayPools(this),this.emitters=new o.GameplayEmitters(this),this.fastForward=new o.FastForward(this),this.turn=new o.Turn(this),this.worldCopy=new o.GameplayWorldCopy(this),this.audio=new o.GameplayAudio(this),this.secondChance=new o.SecondChance(this),this.addGrid(),this.addGridWalls(),this.addInitialItems(),this.addFox(),this.addFoxTalkBubble(),this.addBallTrails(),this.addIdleBalls(this.levelConfig.balls),this.addBalls(this.levelConfig.balls),this.addTrajectory(),this.addTutorial(),this.addWarningLine(),this.addTurnCompleteFx(),this.addLevelCompleteFx(),this.idleBallsAligner=new o.IdleBallsAligner(this),this.idleBallsAligner.placeIdleBallsAroundInstant(this.idleBalls,this.fox.x),this.sleepItems(),this.autoThrow()},i.prototype.testTurnCompleteAnimations=function(){var s=this;this.hideRemainingItems(),this.time.addEvent({loop:!0,delay:4e3,startAt:3700,callback:function(){var a=Phaser.Math.RND.between(3,10),l=Phaser.Math.RND.between(100,1e4),c=Phaser.Math.RND.bool();s.showTurnCompleteFx(a,l,c)}})},i.prototype.addItem=function(s){s.on(o.GameItemEvent.PRE_DESTROY,this.onItemPreDestroy,this),this.items.push(s)},i.prototype.onItemPreDestroy=function(s,a){if(a===!0)return;_.pull(this.items,s),this.tryToDropBalls()},i.prototype.onDynamiteBlockExplode=function(s){this.showExplosion(s.x,s.y,1.5),this.damageNearbyBlocks(s),this.audio.explosion(),this.cameras.main.shake(500,.011,!0)},i.prototype.onLightningDestroy=function(s){this.animsPools.lightnings.recycleActive(s.animation)},i.prototype.onBlockDamage=function(s,a){this.showDamageValueFx(a,s),this.turn.points+=a,this.levelNumber===1&&this.audio.blockHit()},i.prototype.onBlockKill=function(s){s.once(Phaser.GameObjects.Events.DESTROY,this.onBlockDestroy,this),s.setDepth(s.wasHitByCracker?o.GameplayDepth.HIT_BY_CRACKER:o.GameplayDepth.DEAD_BLOCKS),this.turn.pendingDestroyBlocks.push(s),this.turn.blocksKilledNum++;var a=this.isTargetItemType(s.itemType);a&&(this.levelData.targetBlocksKilled++,this.showCollectedBlockFx(s))},i.prototype.onBlockDestroy=function(s){var a=this.turn.pendingDestroyBlocks.indexOf(s);a>-1&&(this.turn.pendingDestroyBlocks.splice(a,1),this.turn.pendingDestroyBlocks.length===0&&this.checkTurnComplete());var l=s.itemType;if(l===o.ItemType.PINATA_BLOCK||l===o.ItemType.DYNAMITE_BLOCK)return;var c=this.isTargetItemType(l);if(c){l===o.ItemType.SHATTER_BLOCK&&this.showItemDestroyFx(s.x,s.y);return}this.showItemDestroyFx(s.x,s.y)},i.prototype.showItemDestroyFx=function(s,a){this.emitters.blockKill.explode(1,s,a),this.emitters.blockKillParticles.setPosition(s,a),this.emitters.blockKillParticles.explode(8,s,a)},i.prototype.addBlockWhiteCopy=function(s){var a=this.pools.blockWhiteCopies.getFirstDead(!0);return a.setBlock(s),a},i.prototype.addBlockHealthCounter=function(s){var a=this.pools.blockHealthCounters.getFirstDead(!0);return a.revive(),a.setBlock(s),a},i.prototype.onBallSpinnerTouched=function(s,a){var l=a.spinnedBalls.some(function(c){return c.ball===s});if(l)return;a.spinnedBalls.push({ball:s,timestamp:this.game.getTime()}),a.activate(),s.spin(),this.audio.spinner(),this.emitters.spinner.setPosition(a.x,a.y),this.emitters.spinner.explode(10,a.x,a.y),this.turn.spinnersActivated.push(a),this.tryToDropBalls()},i.prototype.onBallLightningTouched=function(s,a){a.wasActivated===!1&&this.turn.lightningsActivated.push(a),s.isCharged===!1&&(s.setCharge(),this.emitters.lightning.setPosition(a.x,a.y),this.emitters.lightning.explode(10,a.x,a.y),this.audio.lightning()),a.activate(),this.tryToDropBalls()},i.prototype.onBallFloorCollide=function(s,a){s.onTouchedTheFloor(),this.showIdleBall(s.x),this.audio.ballHit(),this.turn.firstLandedBall===null&&(this.turn.firstLandedBall=s,this.turn.firstLandedBallMark=s.x)},i.prototype.onBallWallsCollide=function(s,a,l){var c=this._physics.world.getContactPoint(l);this.emitFeathers(1,c.x,c.y),this.audio.ballHit()},i.prototype.onBallBlocksCollide=function(s,a,l){if(this.audio.ballHit(),a.health.damage(s.damage),s.isCharged)a.zap();else{var c=this._physics.world.getContactPoint(l);this.emitFeathers(2,c.x,c.y)}},i.prototype.onBlockZap=function(s){this.emitters.zappedBlock.setPosition(s.x,s.y),this.emitters.zappedBlock.explode(4,s.x,s.y),this.audio.blockZap()},i.prototype.onCollectableBallHit=function(s,a,l){s.state="hit_by_ball",s.setDepth(o.GameplayDepth.DROPPED_COLLECTABLE_BALLS),s.startFalling(),s.setCollidesWith([this._physics.collisionCategories.floor,this._physics.collisionCategories.walls]),s.setVelocityX(a.body.velocity.x/2);var c=this._physics.world.getContactPoint(l);this.emitters.collectableBallFeathers.setPosition(c.x,c.y),this.emitters.collectableBallFeathers.explode(25,c.x,c.y),this.turn.collectableBallsActivated.push(s),this.audio.collectableBallHit()},i.prototype.onCollectableBallLand=function(s,a,l){s.state="landed";var c=this._physics.world.getContactPoint(l);this.emitters.feathers.explode(6,c.x,c.y),this.addIdleBall(s.x),this.showPlusBallFx(s),s.destroy(),this.addBall(),this.gui.ballsLabel.updateNum(this.balls.length),this.audio.collectableBallLand(),this.checkTurnComplete()},i.prototype.removePointerCallbacks=function(){this.input.off("pointerdown",this.onPointerDown,this),this.input.off("pointerup",this.onPointerUp,this),this.input.off(Phaser.Input.Events.POINTER_UP_OUTSIDE,this.onPointerUp,this),this.gui.input.off("pointerup",this.onPointerUp,this)},i.prototype.addPointerCallbacks=function(){this.input.on("pointerdown",this.onPointerDown,this),this.input.on("pointerup",this.onPointerUp,this),this.input.on(Phaser.Input.Events.POINTER_UP_OUTSIDE,this.onPointerUp,this),this.gui.input.on("pointerup",this.onPointerUp,this)},i.prototype.getThrowRotation=function(s,a){return Phaser.Math.Angle.Between(s.x,s.y,a.x,a.y)},i.prototype.doResize=function(){this.gui&&this.camera&&this.camera.resize()},i.prototype.getFieldWidth=function(){return o.GameGrid.CELL_SIZE*o.GameGrid.COLUMNS},i.prototype.getFieldHeight=function(){return o.GameGrid.CELL_SIZE*(o.GameGrid.ROWS+1)-o.GameGrid.CELL_SIZE/2},i.prototype.onGuiCreated=function(){this.gui.fastForwardButton.kill(),this.gui.fastForwardButton.on(Phaser.GameObjects.ButtonEvent.PRESS,this.onFastForwardButtonClick,this),this.gui.dropBallsButton.kill(),this.gui.dropBallsButton.on(Phaser.GameObjects.ButtonEvent.PRESS,this.dropBallsToFloorByKey,this),this.addBoosters(),this.addPointerCallbacks(),this.addKeyboardCallbacks()},i.prototype.addBoosters=function(){this.boosters=new o.GameplayBoosters(this,this.gui),this.boosters.on(o.GameplayBoostersEvent.ACTIVATE,this.onBoosterActivate,this),this.boosters.on(o.GameplayBoostersEvent.COMPLETE,this.onBoosterComplete,this)},i.prototype.onBoosterActivate=function(s){s.type===o.BoosterType.STOP&&(this.isMoveDownLocked=!0)},i.prototype.onBoosterComplete=function(s){s.type===o.BoosterType.STOP&&(this.isMoveDownLocked=!1)},i.prototype.onPinataDestroyed=function(s){var a=new o.PinataItemsFactory(this,this.grid,this.emitters.newPinataItem);a.once(o.PinataItemsFactoryEvent.ITEMS_READY,this.onPinataItemsReady,this),a.createFromPinata(s),this.emitters.pinataConfetti.explode(40,s.x,s.y),this.emitters.pinata.explode(1,s.x,s.y),this.audio.pinata(),this.cameras.main.shake(300,.006,!0)},i.prototype.onPinataItemsReady=function(s){this.adjustTargetItemsNum(s),this.checkTurnComplete()},i.prototype.onShatterBlockShatter=function(s){var a=new o.ShatterPiecesFactory(this,this.grid);a.once(o.ShatterPiecesFactoryEvent.ITEMS_READY,this.onShatterPiecesReady,this),a.createFromParent(s),this.cache.audio.has(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH)&&this.sound.play(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH,{volume:1})},i.prototype.onShatterPiecesReady=function(s){this.adjustTargetItemsNum(s),this.checkTurnComplete()},i.prototype.update=function(s,a){this._physics.update(a),this.updateTrajectory(),this.updateWarningLine(a)},i.prototype.updateTrajectory=function(){this.isPointerDown?this.trajectory.visible===!1&&this.turn.inProgress()===!1&&(this.fox.play(o.FoxAnimation.AIM,!0),this.trajectory.show()):this.trajectory.visible&&(this.fox.anims.getCurrentKey()!==o.FoxAnimation.SHOT&&this.fox.play(o.FoxAnimation.IDLE,!0),this.trajectory.hide())},i.prototype.updateWarningLine=function(s){this.warningLine.visible&&(this.warningLine.tilePositionX-=s*.035)},i.prototype.addBlockFace=function(s){var a=[o.ItemType.SHATTER_BLOCK,o.ItemType.SHATTER_BLOCK_PIECE];if(a.includes(s.itemType))return;var l=new o.BlockFace(this,s);l.setDepth(o.GameplayDepth.BLOCK_FACES),this.add.existing(l)},i.prototype.addLightningIdleEmitter=function(s){var a=this.emitters.createLightningIdleEmitter(),l=new o.LightningIdleEmitter(this,s,a)},i.prototype.addSpinnerIdleEmitter=function(s){var a=this.emitters.createSpinnerIdleEmitter(s),l=new o.SpinnerIdleEmitter(this,s,a)},i.prototype.addIceBlockEmitter=function(s){var a=this.emitters.createIceBlockEmitter(s);s.on(o.HideEvent.START,a.remove,a),s.on(o.HealthEvent.KILL,function(){a.remove()}),s.on(Phaser.GameObjects.Events.DESTROY,function(){a.remove()})},i.prototype.addCollectableBallEmitter=function(s){var a=this.emitters.createCollectableBallEmitter(s);s.on(o.CollectableBallEvent.ACTIVATE,function(){a.on=!0}),s.on(o.HideEvent.START,function(){a.remove()}),s.on(o.CollectableBallEvent.START_FALL,function(){a.remove()}),s.on(Phaser.GameObjects.Events.DESTROY,function(){a.remove()})},i.prototype.onBlockStartStomping=function(s){s.setDepth(o.GameplayDepth.STOMPING_BLOCKS),this.showRedCopy(s)},i.prototype.onBlockStopStomping=function(s){s.setDepth(o.GameplayDepth.ITEMS)},i.prototype.createLevelData=function(){return{turnsNum:0,points:0,targetBlocksKilled:0,targetBlocksRequired:this.levelConfig.generator.targetItemsNum}},i.prototype.initAnimationPools=function(){this.animsPools||(this.animsPools=new o.GameplayAnimationPools(this))},i.prototype.addGrid=function(){this.grid=new o.GameGrid(this,o.GameGrid.COLUMNS,o.GameGrid.ROWS),this.grid.alpha=.5,this.grid.setDepth(o.GameplayDepth.GRID)},i.prototype.addGridWalls=function(){this.gridWalls=new o.GridWalls(this,this.grid.getWidth(),this.grid.getHeight()),this.gridWalls.top.collisionFilter.category=this._physics.collisionCategories.ceiling,this.gridWalls.right.collisionFilter.category=this._physics.collisionCategories.walls,this.gridWalls.bottom.collisionFilter.category=this._physics.collisionCategories.floor,this.gridWalls.left.collisionFilter.category=this._physics.collisionCategories.walls,this.gridWalls.align(this.grid)},i.prototype.addInitialItems=function(){var s=this;this.generator.getInitialItems(o.GameGrid.ROWS-1).map(function(a){var l=s.factory.create(__assign({itemType:a.type,row:a.row,column:a.column},a.config));s.factory.postCreationCallback(l)})},i.prototype.addFox=function(){this.fox=new o.Fox(this),this.fox.x=this.grid.x+this.grid.getWidth()/2,this.fox.y=this.grid.y+this.grid.getHeight(),this.add.existing(this.fox)},i.prototype.addFoxTalkBubble=function(){this.foxTalkBubble=new o.FoxTalkBubble(this),this.foxTalkBubble.kill(),this.add.existing(this.foxTalkBubble)},i.prototype.showFoxTalkBubble=function(){this.foxTalkBubble.x=this.fox.x-66,this.foxTalkBubble.y=this.fox.y-134,this.foxTalkBubble.revive(),this.foxTalkBubble.show()},i.prototype.addBallTrails=function(){var s={color:16445887,alpha:.44,length:8,accuracy:12};this.ballTrails=new o.TrailsCanvas(this,s),this.ballTrails.setDepth(o.GameplayDepth.BALL_TRAILS),this.ballTrails.kill(),this.add.existing(this.ballTrails)},i.prototype.addIdleBalls=function(s){var a=this;this.idleBalls=_.times(s,function(){var l=a.pools.idleBalls.pop();return l.y=a.getIdleBallPositionY(),l.show(),l})},i.prototype.addBalls=function(s){var a=this;_.times(s,function(){a.addBall()})},i.prototype.addBall=function(){var s={depth:o.GameplayDepth.BALLS,subDepth:this.balls.length,worldBounds:this.getWorldBounds(),collisionGroup:this._physics.collisionGroups.balls,collisionCategory:this._physics.collisionCategories.balls},a=new o.Ball(this,s);return a.kill(),a.setPosition(this.grid.getWidth()/2,this.grid.getHeight()),this.add.existing(a),this.balls.push(a),this.createBallChargedEmitter(a),this.ballTrails.addTrail(a),a},i.prototype.getWorldBounds=function(){return new Phaser.Geom.Rectangle(0,0,this.grid.getWidth(),this.grid.getHeight())},i.prototype.addTrajectory=function(){var s=this.getTrajectoryBounces();this.trajectory=new o.Trajectory(this),this.trajectory.setBounces(s),this.trajectory.setDepth(o.GameplayDepth.TRAJECTORY),this.add.existing(this.trajectory)},i.prototype.getTrajectoryBounces=function(){var s=utils.NetUtil.getParam("trajectory");return s!==null?parseInt(s)||1:this.levelNumber<5?2:1},i.prototype.addTutorial=function(){if(this.levelNumber!==1)return;var s=new o.TutorialHand(this);s.x=this.getFieldWidth()/2,s.y=this.fox.y-o.GameGrid.CELL_SIZE*4.5,s.show(370),this.add.existing(s);var a=new o.BlockHint(this);this.add.existing(a)},i.prototype.addWarningLine=function(){this.warningLine=this.add.tileSprite(0,0,0,0,"gameplay","warning_line"),this.warningLine.x=this.getFieldWidth()/2,this.warningLine.y=o.GameGrid.CELL_SIZE*7,this.warningLine.setDepth(o.GameplayDepth.LOSE_TUTORIAL),this.warningLine.kill(),this.add.existing(this.warningLine)},i.prototype.addTurnCompleteFx=function(){this.turnCompleteFx=new o.TurnCompleteFx(this),this.turnCompleteFx.setDepth(o.GameplayDepth.TURN_POINTS_FX),this.turnCompleteFx.kill(),this.turnCompleteFx.on(o.TurnCompleteFxEvent.CLEAR_BONUS_SHOW,this.onClearBonusShow,this),this.add.existing(this.turnCompleteFx)},i.prototype.onClearBonusShow=function(){var s=this.levelConfig.background.split("_").pop(),a=parseInt(s)||1,l=a===3?.33:.5;this.grid.showClearGridFx(l,0),this.cache.audio.has(o.GameSoundKey.CLEAR_FIELD)&&this.sound.play(o.GameSoundKey.CLEAR_FIELD,{volume:.33})},i.prototype.addLevelCompleteFx=function(){this.levelCompleteFx=new o.LevelCompleteFx(this,this.isLastLevel()),this.levelCompleteFx.setDepth(o.GameplayDepth.LEVEL_COMPLETE_FX),this.levelCompleteFx.kill(),this.add.existing(this.levelCompleteFx)},i.prototype.isLastLevel=function(){var s=this.game.levelConfigs.getLevelNumbers();return s.indexOf(this.levelNumber)===s.length-1},i.prototype.autoThrow=function(){var s=this;if(!o.Main.development)return;var a=this.levelConfig.autoThrow;if(a.enabled===!1)return;this.time.delayedCall(a.delay,function(){var l=a.x,c=s.grid.getHeight()+a.y;s.startTurn({x:l,y:c}),a.fastForward&&s.time.delayedCall(100,function(){s.fastForward.enable()})})},i.prototype.tryToDropBalls=function(){var s=this.balls.some(function(p){return p.isThown});if(s===!1)return;var a=this.items.length>0;if(a===!1){this.dropBallsToFloor();return}var l=this.getItemsByType(o.ItemType.COLLECTABLE_BALL).length===0,c=this.items.every(function(p){return o.ItemTypeUtil.isBlockType(p.itemType)===!1});if(l&&c){var u=this.items.filter(function(p){return p.itemType===o.ItemType.LIGHTNING||p.itemType===o.ItemType.SPINNER}),d=u.every(function(p){return p.wasActivated});d&&this.dropBallsToFloor()}},i.prototype.getItemsByType=function(s){return this.items.filter(function(a){return a.itemType===s})},i.prototype.showExplosion=function(s,a,l){var c=this,u=this.animsPools.explosions.getInactive(),d=new o.Explosion(this,u);d.once("destroy",function(){return c.animsPools.explosions.recycleActive(u)}),d.x=s,d.y=a,d.scale=l,d.setDepth(o.GameplayDepth.EXPLOSION),d.playScaleTween(),this.add.existing(d)},i.prototype.damageNearbyBlocks=function(s){var a=this;this.items.filter(function(l){return o.ItemTypeUtil.isBlockType(l.itemType)}).filter(function(l){return h.Between(s.x,s.y,l.x,l.y)<=s.explosionRadius}).forEach(function(l){var c=a.turn.futureItems.some(function(u){return u.item===l});if(c)return;l.health.kill()})},i.prototype.destroyNearbyItems=function(s){this.items.filter(function(a){return o.ItemTypeUtil.isBlockType(a.itemType)===!1}).filter(function(a){return h.Between(s.x,s.y,a.x,a.y)<=s.explosionRadius}).forEach(function(a){a.destroy()})},i.prototype.showDamageValueFx=function(s,a){var l=this.pools.blockDamageFXs.getFirstDead(!0);l&&(l.setText(s.toString()),l.x=a.x,l.y=Phaser.Display.Bounds.GetTop(a),l.reset(),l.show())},i.prototype.showCollectedBlockFx=function(s){var a=this,l=[o.ItemType.SHATTER_BLOCK,o.ItemType.PINATA_BLOCK,o.ItemType.DYNAMITE_BLOCK],c=l.includes(s.itemType);if(c){this.gui.blocksLabel.incrementCurrent();return}this.time.delayedCall(200,function(){a.gui.onTargetBlockKilled(s),s.forceKill()})},i.prototype.isTargetItemType=function(s){var a=this.levelConfig.generator.targetItemType;return a===o.ItemType.SHATTER_BLOCK?s===o.ItemType.SHATTER_BLOCK||s===o.ItemType.SHATTER_BLOCK_PIECE:s===a},i.prototype.checkTurnComplete=function(){this.turn.checkComplete()&&this.onTurnComplete()},i.prototype.onTurnComplete=function(){var s=this;if(this.isSceneShutdown())return;this.fastForward.disable(),this.gui.bottomPanel.hideTurnButtons(),this.events.emit(n.TURN_COMPLETE);var a=this.getBlocks().some(function(d){return d.grid.getRow()===o.GameGrid.LOSE_ROW}),l=this.isMoveDownLocked||a?[]:this.clearLastRow(),c=_.uniq(__spreadArrays(l,this.turn.lightningsActivated,this.turn.spinnersActivated));if(c.length===0){this.onTurnFullyComplete();return}var u=0;c.forEach(function(d){d.kill(),d.once(Phaser.GameObjects.Events.DESTROY,function(){++u===c.length&&s.onTurnFullyComplete()})})},i.prototype.getBlocks=function(){return this.items.filter(function(s){return o.ItemTypeUtil.isBlockType(s.itemType)})},i.prototype.onTurnFullyComplete=function(){if(this.isSceneShutdown())return;var s=this.turn.blocksKilledNum>=3&&this.isGridEmpty(),a=this.turn.points*(s?2:1);this.levelData.points+=a,this.gui.pointsLabel.updatePoints(this.levelData.points),this.showTurnCompleteFx(this.turn.blocksKilledNum,this.turn.points,s);var l=s?1800:400;this.time.delayedCall(l,this.onTurnCompleteAnimationsComplete,null,this)},i.prototype.isSceneShutdown=function(){return this.scene.settings.status===Phaser.Scenes.SHUTDOWN},i.prototype.onTurnCompleteAnimationsComplete=function(){var s=this,a=this.isMoveDownLocked===!1&&this.checkForGameOver();if(a){this.onLevelFailed();return}var l=this.checkGameComplete();if(l){this.onLevelComplete();return}if(this.adjustFirstLandedBallMark(),this.fox.moveTo(this.turn.firstLandedBallMark),this.idleBallsAligner.placeIdleBallsAround(this.idleBalls,this.turn.firstLandedBallMark),this.isMoveDownLocked){var c=this.isGridEmpty();if(c){var u=this.calculateMoveDownShift();this.generateNewItems(u),this.completeTurn()}else this.playStopActiveTween(),this.playStopActiveSound(),this.completeTurn()}else{var d=this.calculateMoveDownShift(),p=300;this.playMoveItemsDownSound(),this.moveItemsDown(d,p),this.time.delayedCall(p,function(){s.playAlarmSound(),s.generateNewItems(d),s.completeTurn()})}},i.prototype.playStopActiveTween=function(){this.tweens.add({targets:this.items,duration:200,ease:Phaser.Math.Easing.Sine.InOut,y:"+=30",yoyo:!0})},i.prototype.playStopActiveSound=function(){this.cache.audio.has(o.GameSoundKey.BOOSTER_STOP_ACTIVE)&&this.sound.play(o.GameSoundKey.BOOSTER_STOP_ACTIVE,{volume:.33,delay:.33})},i.prototype.completeTurn=function(){this.sleepItems(),this.turn.complete(),this.gui.showBoostersPanel(),this.events.emit(n.TURN_FULLY_COMPLETE,this)},i.prototype.adjustFirstLandedBallMark=function(){if(this.turn.firstLandedBall===null){this.turn.firstLandedBallMark=this.fox.x;return}var s=o.Ball.RADIUS*2,a=this.grid.x+s,l=this.grid.x+this.grid.getWidth()-s;this.turn.firstLandedBallMark=Phaser.Math.Clamp(this.turn.firstLandedBallMark,a,l)},i.prototype.checkForGameOver=function(){return this.items.filter(function(s){return o.ItemTypeUtil.isBlockType(s.itemType)}).some(function(s){return s.grid.getRow()===o.GameGrid.LOSE_ROW})},i.prototype.checkGameComplete=function(){return this.levelData.targetBlocksKilled>=this.levelData.targetBlocksRequired},i.prototype.onLevelFailed=function(){var s=this,a=390;this.time.delayedCall(a+50,function(){s.showFoxWorried()}),this.time.delayedCall(a,function(){s.playBlockJumpOnFox()}),this.time.delayedCall(a+2400,function(){o.Main.areRewardAdsEnabled===!1||s.secondChance.wasUsed?(s.showLevelFailedScreen(),s.analytics.sendLevelFail(s.levelNumber,s.levelData.targetBlocksRequired-s.levelData.targetBlocksKilled)):(s.gui.secondChanceScreen.closeButton.once(r.PRESS,s.showLevelFailedScreen,s),s.gui.showSecondChanceScreen(s.levelData.targetBlocksKilled,s.levelData.targetBlocksRequired))}),this.time.delayedCall(a+3e3,function(){s.scene.pause()})},i.prototype.showFoxWorried=function(){this.cache.audio.has(o.GameSoundKey.FOX_OOH)&&this.sound.play(o.GameSoundKey.FOX_OOH,{volume:1}),this.fox.showLoseFrame()},i.prototype.playBlockJumpOnFox=function(){var s=new o.BlockKing(this);s.x=this.fox.x,s.y=this.fox.y,s.setDepth(o.GameplayDepth.JUMP_ON_FOX_BLOCK),s.once(o.BlockKingEvent.JUMP_ON_FOX_COMPLETE,this.onJumpOnFoxComplete,this),s.jumpOnFox(this.fox.x,this.fox.y),this.add.existing(s),this.cache.audio.has(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH)&&this.sound.play(o.GameSoundKey.BLOCK_COLLECTED_WHOOSH,{volume:.66,delay:0})},i.prototype.onJumpOnFoxComplete=function(s){this.cache.audio.has(o.GameSoundKey.DUCK_SCREAM)&&this.sound.play(o.GameSoundKey.DUCK_SCREAM,{volume:.66}),this.cache.audio.has(o.GameSoundKey.BLOCK_STOMP_HIT)&&this.sound.play(o.GameSoundKey.BLOCK_STOMP_HIT,{volume:.8}),this.cameras.main.shake(433,.018,!0),this.showDustCloud(s),this.throwFox(s),this.throwLosingBalls(s.x)},i.prototype.showDustCloud=function(s){var a=new o.DustCloud(this);a.x=s.x+s.displayWidth*(.5-s.originX),a.y=s.y+s.displayHeight*(1-s.originY)-20,a.setDepth(o.GameplayDepth.JUMP_ON_FOX_BLOCK_DUST),this.add.existing(a)},i.prototype.throwFox=function(s){this.fox.kill();var a=this.textures.getFrame("gameplay","fox_lost"),l=new o.ThrownFox(this.matter.world,a);l.x=s.x,l.y=s.y,l.setCollidesWith(0),l.setDepth(o.GameplayDepth.FOX_THROWN),l.throw(),l.destroyAfter(1300),this.add.existing(l)},i.prototype.throwLosingBalls=function(s){var a=this;this.idleBalls.forEach(function(l,c){l.kill();var u=l.x>s?Phaser.RIGHT:Phaser.LEFT,d=new o.LosingBall(a,l);d.x=l.x,d.y=l.y-l.height/2,d.setCollidesWith(0),d.setDepth(o.GameplayDepth.LOSING_BALLS),d.throw(u),d.destroyAfter(1300),a.add.existing(d)})},i.prototype.showLevelFailedScreen=function(){var s=this.getLevelFailedData();this.gui.onLevelFailed(s),this.isGameplayStopped=!0,this.poki.sdk.gameplayStop()},i.prototype.getLevelFailedData=function(){return{levelNumber:this.levelNumber,targetBlocksType:this.levelConfig.generator.targetItemType,blocksRequired:this.levelData.targetBlocksRequired,blocksKilled:this.levelData.targetBlocksKilled,score:this.levelData.points}},i.prototype.onLevelComplete=function(){var s=this;this.isGameplayStopped=!0,this.poki.sdk.gameplayStop(),this.analytics.sendLevelComplete(this.levelNumber,this.getEarnedStarsNum(this.levelData.points,this.levelConfig.stars)),this.saveLevelResult(),this.hideRemainingItems(),this.gui.boostersPanel.disableInput();var a=220;this.time.delayedCall(0,function(){s.fox.playHappyAnimation(),s.idleBallsAligner.placeIdleBallsAround(s.idleBalls,s.fox.x)}),this.time.delayedCall(a,function(){s.launchWinningBalls()});var l=500+Math.min(5,this.idleBalls.length)*133,c=a+l;this.time.delayedCall(c,function(){s.showLevelCompleteFx(),s.poki.sdk.happyTime(1)}),this.time.delayedCall(c+1600,function(){s.showLevelCompleteScreen()}),this.time.delayedCall(c+2500,function(){s.scene.pause()})},i.prototype.hideRemainingItems=function(){var s=this;this.items.forEach(function(a){a.on(o.HideEvent.COMPLETE,s.showItemDestroyFx.bind(s,a.x,a.y)),a.hideOnLevelComplete(300)})},i.prototype.launchWinningBalls=function(){var s=this;this.idleBalls.slice(0).forEach(function(a,l){var c=l*133,u=a.x>s.grid.getWidth()/2?Phaser.LEFT:Phaser.RIGHT,d=new o.WinningBall(s);d.x=a.x,d.y=a.y-a.height/2,d.alpha=0,d.once(o.WinningBallEvent.LAUNCH,s.onWinningBallLaunch.bind(s,a,d)),d.once(o.WinningBallEvent.EXPLODE,s.onWinningBallExplode,s),d.setDepth(o.GameplayDepth.WINNING_BALLS),d.launch(c,u),s.add.existing(d)})},i.prototype.onWinningBallLaunch=function(s,a){s.kill(),a.alpha=1,this.cache.audio.has(o.GameSoundKey.WINNING_BALL_WHOOSH)&&this.sound.play(o.GameSoundKey.WINNING_BALL_WHOOSH,{volume:.66,rate:.82})},i.prototype.onWinningBallExplode=function(s){this.emitters.collectableBallFeathers.setPosition(s.x,s.y),this.emitters.collectableBallFeathers.explode(25,s.x,s.y),this.audio.winningBallExplode()},i.prototype.showLevelCompleteFx=function(){this.levelCompleteFx.x=this.grid.getWidth()/2,this.levelCompleteFx.y=this.grid.y+this.grid.getHeight()*.2,this.levelCompleteFx.revive(),this.levelCompleteFx.show(),this.cache.audio.has(o.GameSoundKey.LEVEL_COMPLETE_TEXT)&&this.sound.play(o.GameSoundKey.LEVEL_COMPLETE_TEXT,{volume:1,delay:.1})},i.prototype.saveLevelResult=function(){var s=this.getLevelHighscore(this.levelNumber),a=Math.max(s,this.levelData.points),l={complete:!0,stars:this.getEarnedStarsNum(this.levelData.points,this.levelConfig.stars),highscore:a};this.game.store.saveLevelResult(this.levelNumber,l)},i.prototype.getEarnedStarsNum=function(s,a){return _.findLastIndex(a,function(l){return s>=l})+1},i.prototype.getLevelHighscore=function(s){var a=this.game.store.getLevelResult(s);return a?a.highscore:0},i.prototype.showLevelCompleteScreen=function(){var s={levelNumber:this.levelNumber,stars:this.getEarnedStarsNum(this.levelData.points,this.levelConfig.stars),score:this.levelData.points,highscore:this.getLevelHighscore(this.levelNumber),blocksType:this.levelConfig.generator.targetItemType,blocksNum:this.levelData.targetBlocksKilled};this.gui.onLevelComplete(s)},i.prototype.clearLastRow=function(){var s=[o.ItemType.SPINNER,o.ItemType.LIGHTNING,o.ItemType.COLLECTABLE_BALL];return this.items.filter(function(a){return s.includes(a.itemType)}).filter(function(a){return a.grid.getRow()===o.GameGrid.LOSE_ROW})},i.prototype.calculateMoveDownShift=function(){var s=4,a=this.isGridEmpty();if(a)return s;var l=this.items.some(function(p){return o.ItemTypeUtil.isBlockType(p.itemType)});if(l)return 1;var c=this.getVeryBottomItem(),u=c.grid.getRow(),d=u-o.GameGrid.LOSE_ROW;return Math.min(s,d)},i.prototype.getVeryTopItem=function(){return _.maxBy(this.items,function(s){return s.grid.getRow()})},i.prototype.getVeryBottomItem=function(){return _.minBy(this.items,function(s){return s.grid.getRow()})},i.prototype.playMoveItemsDownSound=function(){if(this.isGridEmpty())return;this.cache.audio.has(o.GameSoundKey.MOVE_ITEMS_DOWN)&&this.sound.play(o.GameSoundKey.MOVE_ITEMS_DOWN,{volume:1})},i.prototype.moveItemsDown=function(s,a){var l=this,c=_.once(function(){l.showWarningLine(),l.addLoseTutorial()});this.items.sort(this.sortGridItems.bind(this)).reverse().forEach(function(u){var d=u.grid.getRow()-s;l.tweens.add({targets:u,duration:a,ease:Phaser.Math.Easing.Cubic.Out,y:u.y+o.GameGrid.CELL_SIZE*s,onComplete:function(){l.onItemMoveDownComplete(u,d,c)}})})},i.prototype.sortGridItems=function(s,a){var l=s.grid.getRow(),c=a.grid.getRow();return l===c?s.grid.getColumn()-a.grid.getColumn():l-c},i.prototype.onItemMoveDownComplete=function(s,a,l){var c=a===2;if(c===!1)return;var u=o.ItemTypeUtil.isBlockType(s.itemType);if(u===!1)return;s.startStomping(),l()},i.prototype.showWarningLine=function(){this.warningLine.revive(),this.warningLine.alpha=0,this.tweens.add({targets:this.warningLine,duration:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},i.prototype.addLoseTutorial=function(){var s=this.game.store.getBoolean(o.GameStoreKey.LOSE_TUTORIAL_COMPLETE);if(s)return;var a=new o.LoseTutorial(this)},i.prototype.playAlarmSound=function(){var s=this.items.filter(function(l){return o.ItemTypeUtil.isBlockType(l.itemType)}),a=s.some(function(l){return l.grid.getRow()===o.GameGrid.LOSE_ROW});a&&(this.cache.audio.has(o.GameSoundKey.FOX_UH_OH_1)&&this.sound.play(o.GameSoundKey.FOX_UH_OH_1,{volume:1}))},i.prototype.generateNewItems=function(s){var a=this,l=this.items.some(function(f){return f.grid.getRow()===o.GameGrid.ROWS-2});if(l)return;var c=this.getTopEmptyRowsNum(),u=Math.min(c,s),d=this.generator.getNextRows(u);if(d.length===0)return;var p=_.minBy(d,"row").row;d.map(function(f){var y=f.row-p,v=o.GameGrid.ROWS-1-u+y,g=a.factory.create(__assign({itemType:f.type,column:f.column,row:v},f.config));return a.showNewlyGeneratedItem(g),g})},i.prototype.getTopEmptyRowsNum=function(){var s=this.getVeryTopItem();if(s){var a=s.grid.getRow();return o.GameGrid.ROWS-2-a}return o.GameGrid.ROWS-2},i.prototype.showNewlyGeneratedItem=function(s){var a=this;s.alpha=0,s.scale=.66,this.tweens.add({targets:s,scale:{value:1,duration:300,ease:Phaser.Math.Easing.Back.Out},alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out},onComplete:function(){a.factory.postCreationCallback(s)}})},i.prototype.isGridEmpty=function(){return this.items.length===0},i.prototype.sleepItems=function(){this.items.forEach(function(s){return s.setToSleep()})},i.prototype.showIdleBall=function(s){var a=this.idleBalls.find(function(l){return l.active===!1&&l.scheduledForLaunch===!1});a||(a=this.idleBalls.find(function(l){return l.isHiding}),a?a.stopHideTween():this.addTurnStateToRavenExtraContext()),a.setPosition(s,this.getIdleBallPositionY()),a.show(),a.slightlyMoveAside(s,this.grid).on(Phaser.Tweens.Events.TWEEN_COMPLETE,this.onIdleBallReady,this)},i.prototype.addTurnStateToRavenExtraContext=function(){var s={inProgress:this.turn.inProgress(),idleBallsTotal:this.idleBalls.length,idleBallsActive:this.idleBalls.filter(function(a){return a.active}).length,idleBallsScheduled:this.idleBalls.filter(function(a){return a.scheduledForLaunch}).length,ballsThrown:this.turn.ballsThrownNum,ballsLanded:this.turn.ballsLandedNum,fastForward:this.turn.fastForwarded,dropBalls:this.turn.ballsDropped};this.raven.addExtraContext({turnState:s})},i.prototype.onIdleBallReady=function(){this.turn.ballsLandedNum++,this.checkTurnComplete()},i.prototype.emitFeathers=function(s,a,l){this.emitters.feathers.explode(s,a,l)},i.prototype.addIdleBall=function(s){var a=this.getIdleBall();a.x=s,a.y=this.getIdleBallPositionY(),a.show(),this.add.existing(a),this.idleBalls.push(a)},i.prototype.getIdleBall=function(){var s=this.pools.idleBalls.length===0;if(s){var a=this.pools.createNewIdleBall(),l=this.pools.createNewIdleBallShadow(a);return a}return this.pools.idleBalls.pop()},i.prototype.getIdleBallPositionY=function(){return this.grid.getHeight()+5},i.prototype.showPlusBallFx=function(s){var a,l=(a=this.game.texts.texts.plus_ball)!==null&&a!==void 0?a:"+DUCK",c=new o.PlusBallFx(this,l);c.x=s.x-5,c.y=this.fox.y-80,c.setDepth(o.GameplayDepth.PLUS_DUCK_FX),c.show(),this.add.existing(c)},i.prototype.onPointerDown=function(s,a){if(a.length>0)return;this.isPointerDown=!0},i.prototype.onPointerUp=function(s){if(this.isPointerDown===!1)return;if(this.isPointerDown=!1,this.turn.inProgress())return;this.startTurn(this.trajectory.trajectoryEnd)},i.prototype.startTurn=function(s){var a=this.fox.getHandsPosition(),l=this.getThrowRotation(a,s);if(l>=0)return;this.events.emit(n.TURN_START),this.levelData.turnsNum++,this.turn.start(),this.stopStomping(),this.hideWarningLine(),this.wakeItems(),this.startThrowingBalls(a,l),this.gui.onTurnStart()},i.prototype.stopStomping=function(){this.items.filter(function(s){return o.ItemTypeUtil.isBlockType(s.itemType)}).forEach(function(s){s.stopStomping()})},i.prototype.hideWarningLine=function(){var s=this;this.tweens.killTweensOf(this.warningLine),this.tweens.add({targets:this.warningLine,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){s.warningLine.kill()}})},i.prototype.wakeItems=function(){this.items.forEach(function(s){s.setAwake()})},i.prototype.startThrowingBalls=function(s,a){var l=this;this.idleBalls.forEach(function(c,u){c.scheduledForLaunch=!0;var d=l.balls[l.balls.length-1-u],p=(u+1)*55;l.time.delayedCall(p,function(){if(c.scheduledForLaunch===!1)return;l.doThrowBall(c,d,s,a),l.turn.ballsThrownNum++,l.fox.playShotAnimation()})})},i.prototype.doThrowBall=function(s,a,l,c){this.audio.ballThrow(),s.scheduledForLaunch=!1,s.hide(),a.setPosition(l.x,l.y),a.show(),a.throw(c)},i.prototype.addKeyboardCallbacks=function(){this.input.keyboard.on("keydown-SPACE",this.fastForward.enable.bind(this.fastForward)),this.input.keyboard.on("keydown-DOWN",this.dropBallsToFloorByKey,this),o.Main.development&&(this.input.keyboard.on("keydown-PAGE_DOWN",this.moveItemsDownByKey,this),this.input.keyboard.on("keydown-D",this._physics.toggleDebug,this._physics),this.input.keyboard.on("keydown-G",this.grid.toggleDebug,this.grid),this.input.keyboard.on("keydown-C",this.testLevelCompleteScreen,this),this.input.keyboard.on("keydown-F",this.testLevelFailedScreen,this),this.input.keyboard.on("keydown-X",this.testCompleteAnimations,this),this.input.keyboard.on("keydown-Z",this.testFailAnimations,this),this.input.keyboard.on("keydown-S",this.worldCopy.toggleSimulation,this.worldCopy),this.input.keyboard.on("keydown-FORWARD_SLASH",this.getTurnCompleteReport,this),this.input.keyboard.on("keydown-UP",this.applySecondChance,this),this.input.keyboard.on("keydown-ONE",this.trajectory.setBounces.bind(this.trajectory,1)),this.input.keyboard.on("keydown-TWO",this.trajectory.setBounces.bind(this.trajectory,2)),this.input.keyboard.on("keydown-THREE",this.trajectory.setBounces.bind(this.trajectory,3)),this.input.keyboard.on("keydown-N",this.putBallsOutsideWorld,this))},i.prototype.putBallsOutsideWorld=function(){if(this.turn.inProgress()===!1)return;var s=this.getWorldBounds();this.balls.forEach(function(a){if(a.isThown===!1)return;var l=a.body.velocity;a.x=s.centerX+1e3*Phaser.Math.Sign(l.x),a.y=s.centerY+1200*Phaser.Math.Sign(l.y)})},i.prototype.getTurnCompleteReport=function(){this.turn.getCompleteReport(),this.turn.futureItems},i.prototype.moveItemsDownByKey=function(){if(this.turn.inProgress())return;this.canMoveItemsDown()&&this.moveItemsDown(1,300)},i.prototype.canMoveItemsDown=function(){var s=_.minBy(this.items,function(a){return a.grid.getRow()});return s.grid.getRow()>2},i.prototype.testFailAnimations=function(){this.onLevelFailed()},i.prototype.testCompleteAnimations=function(){this.onLevelComplete()},i.prototype.dropBallsToFloor=function(){var s=this;return this.turn.inProgress()===!1?!1:(this.turn.ballsDropped=!0,this.idleBalls.forEach(function(a){a.scheduledForLaunch=!1}),this.balls.forEach(function(a){a.dropToFloor([s._physics.collisionCategories.floor,s._physics.collisionCategories.walls,s._physics.collisionCategories.ceiling])}),!0)},i.prototype.onFastForwardButtonClick=function(s){this.fastForward.enable()},i.prototype.dropBallsToFloorByKey=function(){var s=this.dropBallsToFloor();s&&(this.gui.dropBallsButton.disable(),this.cache.audio.has(o.GameSoundKey.DROP_BALLS_DOWN)&&this.sound.play(o.GameSoundKey.DROP_BALLS_DOWN,{volume:1.25,delay:0}))},i.prototype.adjustTargetItemsNum=function(s){var a=this.levelConfig.generator.targetItemType,l=s.filter(function(c){return c===a}).length;this.updateTargetBlockNum(l)},i.prototype.updateTargetBlockNum=function(s){if(s===0)return;this.levelData.targetBlocksRequired+=s,this.gui.blocksLabel.updateTotal(this.levelData.targetBlocksRequired)},i.prototype.showTurnCompleteFx=function(s,a,l){if(a===0)return;this.turnCompleteFx.x=this.grid.getWidth()/2,this.turnCompleteFx.y=o.GameGrid.CELL_SIZE*4,this.turnCompleteFx.revive(),this.turnCompleteFx.reset(),this.turnCompleteFx.updateData(s,a,l),this.turnCompleteFx.show(),this.cache.audio.has(o.GameSoundKey.TURN_COMPLETE_TEXT)&&this.sound.play(o.GameSoundKey.TURN_COMPLETE_TEXT,{volume:.5,delay:.2})},i.prototype.createBallChargedEmitter=function(s){var a=this.emitters.createBallChargedEmitter(s),l=new o.BallChargedEmitter(s,a)},i.prototype.showRedCopy=function(s){var a=this.pools.blockRedCopies.getFirstDead(!0);a.setBlock(s),a.revive(),a.playFadeTween()},i.prototype.testLevelCompleteScreen=function(){var s={levelNumber:this.levelNumber,blocksNum:Phaser.Math.RND.between(5,100),blocksType:this.levelConfig.generator.targetItemType,score:Phaser.Math.RND.between(1,1e4),highscore:Phaser.Math.RND.between(1,1e5),stars:Phaser.Math.RND.between(0,3)};this.scene.pause(),this.gui.onLevelComplete(s)},i.prototype.testLevelFailedScreen=function(){var s=Phaser.Math.RND.between(5,100),a={levelNumber:this.levelNumber,targetBlocksType:this.levelConfig.generator.targetItemType,blocksKilled:Phaser.Math.RND.between(0,s-1),blocksRequired:s,score:Phaser.Math.RND.between(0,1e5)};this.scene.pause(),this.gui.onLevelFailed(a)},i.prototype.applySecondChance=function(){this.secondChance.once(o.SecondChanceEvent.COMPLETE,this.onSecondChanceComplete,this),this.secondChance.apply()},i.prototype.onSecondChanceComplete=function(){this.analytics.sendDesignEvent("SecondChance:Level_"+_.padStart(this.levelNumber.toString(),3,"0"))},i.prototype.onPause=function(){this.scene.pause(),this.isGameplayStopped=!0,this.poki.sdk.gameplayStop()},i.prototype.onResume=function(){this.scene.resume(),this.isGameplayStopped=!0,this.poki.sdk.gameplayStart()},i.prototype.shutdown=function(){this.isGameplayStopped===!1&&this.poki.sdk.gameplayStop(),this.boosters&&(this.boosters.destroy(),this.boosters=null),this.worldCopy&&this.worldCopy.destroy(),this.audio&&this.audio.destroy(),this.fastForward&&this.fastForward.destroy(),this.animsPools.recycle()},i}(Phaser.Scene);o.Gameplay=e})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.verticalMargin=1,t.strokeThickness=6,t.padding=24,t.scene.add.existing(t),t.addBackground(),t.addContainer(),t}return n.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,"gameplay_gui","up_panel"),this.background.setOrigin(.5,0),this.add(this.background)},n.prototype.addContainer=function(){this.container=this.scene.add.image(0,0,"gameplay_gui","white_rect"),this.container.displayWidth=this.background.displayWidth,this.container.displayHeight=this.background.displayHeight,this.container.alpha=0,this.add(this.container)},n.prototype.getWidth=function(){return this.background.width},n.prototype.getHeight=function(){return this.background.height},n.prototype.getDisplayHeight=function(){return this.getHeight()*this.scaleY},n.prototype.getVeticalOffset=function(){return this.container.displayHeight+this.strokeThickness-this.verticalMargin},n}(Phaser.GameObjects.Container);o.IngamePanel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.baseFontSize=24,i.name="level_label",i.style=i.createTextStyle(),i.addTitle(),i.addNumber(t),i}return n.prototype.createTextStyle=function(){return{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:this.baseFontSize+"px",color:o.GameplayGui.FONT_COLOR_STR,align:"center"}},n.prototype.addTitle=function(){var e,t,i=(t=(e=this.scene.texts.level)===null||e===void 0?void 0:e.toUpperCase())!==null&&t!==void 0?t:"LEVEL";this.levelTitle=this.scene.add.text(0,0,i,this.style),this.levelTitle.setOrigin(0),this.add(this.levelTitle);var s=90;this.levelTitle.scale=Math.min(1,s/this.levelTitle.width)},n.prototype.addNumber=function(e){var t=Math.round(this.baseFontSize*1.7),i=__assign(__assign({},this.style),{fontSize:t+"px"});this.levelNumber=this.scene.add.text(0,0,e.toString(),i),this.levelNumber.setOrigin(.5,0),this.levelNumber.x=this.levelTitle.getCenter().x,this.levelNumber.y=this.levelTitle.y+this.levelTitle.getBounds().height/2+8,this.add(this.levelNumber)},n}(Phaser.GameObjects.Container);o.LevelLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="balls_label",t.addBalIcon(),t.addText(),t}return n.prototype.addBalIcon=function(){this.ballIcon=this.scene.add.image(0,0,"gameplay_gui","ball_icon"),this.add(this.ballIcon)},n.prototype.addText=function(){var e="0";this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.BLOCKS_LABEL,e,22),this.text.setTint(o.GameplayGui.FONT_COLOR),this.text.setOrigin(.5,.5),this.text.x=0,this.text.y=this.ballIcon.y+42,this.add(this.text)},n.prototype.updateNum=function(e){this.text.setText(e.toString())},n}(Phaser.GameObjects.Container);o.BasicBallsLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.padding={x:22,y:0},i.name="main_label",i.levelConfig=t,i.addBackground(),i.addLevelLabel(t.levelNumber),i.addFirstSeparator(),i.addBlocksLabel(t.generator.targetItemType,t.generator.targetItemsNum),i.addSecondSeparator(),i.addBallsLabel(t.balls),i.alignItems(),i.bringToTop(i.levelLabel),i}return n.prototype.addBackground=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","main_label_back"),this.add(this.back)},n.prototype.addLevelLabel=function(e){this.levelLabel=new o.LevelLabel(this.scene,e),this.add(this.levelLabel)},n.prototype.addFirstSeparator=function(){this.firstSeparator=this.scene.add.image(0,0,"gameplay_gui","main_label_separator"),this.add(this.firstSeparator)},n.prototype.addBlocksLabel=function(e,t){this.blocksLabel=new o.BasicBlocksLabel(this.scene,e,t),this.add(this.blocksLabel)},n.prototype.addSecondSeparator=function(){this.secondSeparator=this.scene.add.image(0,0,"gameplay_gui","main_label_separator"),this.add(this.secondSeparator)},n.prototype.addBallsLabel=function(e){this.ballsLabel=new o.BasicBallsLabel(this.scene),this.ballsLabel.updateNum(e),this.add(this.ballsLabel)},n.prototype.alignItems=function(){this.alignLevelLabel(),this.alignBallsLabel(),this.alignBlocksLabel(),this.alignFirstSeparator(),this.alignSecondSeparator(),this.blocksLabel.x+=5,this.ballsLabel.x+=11},n.prototype.alignLevelLabel=function(){this.levelLabel.x=this.back.left+this.padding.x,this.levelLabel.y=this.back.y-this.levelLabel.getBounds().height/2},n.prototype.alignBallsLabel=function(){var e=this.ballsLabel.getBounds();this.ballsLabel.x=this.back.right-e.width-this.padding.x/2,this.ballsLabel.y=-13},n.prototype.alignBlocksLabel=function(){var e=this.levelLabel.getBounds().right,t=this.ballsLabel.getBounds().left,i=t-e;this.blocksLabel.x=e+i/2,this.blocksLabel.y=-14},n.prototype.alignFirstSeparator=function(){var e=this.levelLabel.x+this.levelLabel.getBounds().width,t=this.blocksLabel.x-this.blocksLabel.getBounds().width/2,i=t-e;this.firstSeparator.x=e+i/2,this.firstSeparator.y-=3},n.prototype.alignSecondSeparator=function(){var e=this.blocksLabel.x+this.blocksLabel.getBounds().width,t=this.ballsLabel.x-this.ballsLabel.getBounds().width/2,i=t-e;this.secondSeparator.x=e+i/2-2,this.secondSeparator.y-=3},n.prototype.getWidth=function(){return this.back.displayWidth},n}(Phaser.GameObjects.Container);o.MainLabel=h})(game||(game={}));var game;(function(o){var h;(function(n){n.SHOW_START="ProgressBarStar_SHOW_START",n.SHOW_COMPLETE="ProgressBarStar_SHOW_COMPLETE"})(h=o.ProgressBarStarEvent||(o.ProgressBarStarEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a){var l=n.call(this,t)||this;return l._isActive=!0,l.name="star",l.inactiveStar=l.scene.add.image(0,0,i,a),l.activeStar=l.scene.add.image(0,0,i,s),l.circleFx=l.scene.add.image(0,2,i,"star_circle_fx").setVisible(!1),l.hideActiveStar(),l.add(l.inactiveStar),l.add(l.circleFx),l.add(l.activeStar),l}return Object.defineProperty(e.prototype,"isActive",{get:function(){return this._isActive},enumerable:!1,configurable:!0}),e.prototype.showActiveStar=function(){this.activeStar.visible=!0,this.activeStar.active=!0,this._isActive=!0},e.prototype.hideActiveStar=function(){this.activeStar.visible=!1,this.activeStar.active=!1,this._isActive=!1},e.prototype.tweenActiveStar=function(t){var i=this;this.scene.tweens.killTweensOf(this.activeStar),this.activeStar.alpha=0,this.scene.tweens.add({targets:this.activeStar,delay:t,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,onComplete:function(){i.inactiveStar.visible=!1}}),this.activeStar.scale=1,this.scene.tweens.add({targets:this.activeStar,delay:t,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1.5,onComplete:function(){i.scene.tweens.add({targets:i.activeStar,duration:100,ease:Phaser.Math.Easing.Linear.Linear,scale:1,onComplete:function(){i.showCircleFx(),i.emit(h.SHOW_COMPLETE,i)}})}}),this.emit(h.SHOW_START,this)},e.prototype.showCircleFx=function(){this.circleFx.visible=!0,this.circleFx.alpha=.4,this.circleFx.scale=.4,this.scene.tweens.add({targets:this.circleFx,duration:400,ease:Phaser.Math.Easing.Quadratic.Out,scale:1.75}),this.scene.tweens.add({targets:this.circleFx,delay:150,duration:250,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0})},e}(Phaser.GameObjects.Container);o.ProgressBarStar=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.currentPoints=0,i.name="stars_progress_bar",i.props=t,i.initTwinkleSounds(),i.addBack(),i.addProgressBar(),i.addStarLines(),i.addStars(),i}return n.prototype.initTwinkleSounds=function(){var e=this;this.twinkleStartThrottled=_.throttle(function(){e.scene.cache.audio.has(o.GameSoundKey.STAR_TWINKLE_1)&&e.scene.sound.play(o.GameSoundKey.STAR_TWINKLE_1,{volume:.33})},100,{trailing:!1}),this.twinkleCompleteThrottled=_.throttle(function(){e.scene.cache.audio.has(o.GameSoundKey.STAR_TWINKLE_2)&&e.scene.sound.play(o.GameSoundKey.STAR_TWINKLE_2,{volume:.16})},100,{trailing:!1})},n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","stars_progress_bar_outer"),this.back.setOrigin(0,.5),this.add(this.back)},n.prototype.addProgressBar=function(){this.progressBar=this.scene.add.image(0,0,"gameplay_gui","stars_progress_bar_inner"),this.progressBar.setOrigin(0,.5),this.add(this.progressBar),o.Main.development&&(this.progressBar.setInteractive(),this.progressBar.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onClick,this)),Phaser.Display.Align.In.Center(this.progressBar,this.back,0,0)},n.prototype.onClick=function(e,t,i){var s=Phaser.Math.Percent(t,0,this.progressBar.width);this.emit("update_points",s)},n.prototype.addStarLines=function(){var e=this,t=Phaser.Display.Bounds.GetLeft(this.progressBar),i=this.progressBar.getCenter().y;this.starLines=this.props.starsPoints.map(function(s){var a=e.scene.add.image(0,0,"gameplay_gui","star_line");return a.x=t+e.getPositionByPoints(s),a.y=i,e.add(a),a})},n.prototype.addStars=function(){var e=this,t=Phaser.Display.Bounds.GetLeft(this.progressBar),i=Phaser.Display.Bounds.GetTop(this.progressBar)-10;this.stars=this.props.starsPoints.map(function(s){var a=new o.ProgressBarStar(e.scene,"gameplay_gui","star","star_inactive");return a.x=t+e.getPositionByPoints(s),a.y=i,a.setData("points",s),a.on(o.ProgressBarStarEvent.SHOW_START,e.twinkleStartThrottled,e),a.on(o.ProgressBarStarEvent.SHOW_COMPLETE,e.twinkleCompleteThrottled,e),e.add(a),a})},n.prototype.getPositionByPoints=function(e){var t=Phaser.Math.Percent(e,0,this.props.totalPoints);return this.progressBar.width*t},n.prototype.getPercentFromPoints=function(e){return Phaser.Math.Percent(e,0,this.props.totalPoints)},n.prototype.updateProgressInstant=function(e){this.updateProgressBarCrop(this.getPercentFromPoints(e)),this.updateStars(e)},n.prototype.updateProgress=function(e,t){var i=this;this.scene.tweens.add({targets:this,currentPoints:e,duration:t,ease:Phaser.Math.Easing.Circular.Out,onUpdate:function(){i.updateProgressBarCrop(i.getPercentFromPoints(i.currentPoints)),i.updateStars(i.currentPoints)}})},n.prototype.updateProgressBarCrop=function(e){e=Math.max(.001,e),this.progressBar.setCrop(0,0,this.progressBar.width*e,this.progressBar.height)},n.prototype.updateStars=function(e){this.stars.forEach(function(t){var i=t.isActive,s=e>=t.getData("points");s?(t.showActiveStar(),i===!1&&s&&t.tweenActiveStar(0)):t.hideActiveStar()})},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.height},n}(Phaser.GameObjects.Container);o.PointsProgressBar=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.padding={x:18,y:0},i.points=0,i.name="points_label",i.levelConfig=t,i.addBack(),i.addProgressBar(),i.addPointsText(),i}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","points_label_back"),this.back.setOrigin(0),this.add(this.back)},n.prototype.addProgressBar=function(){var e=this,t=this.levelConfig.stars[2],i={totalPoints:t,starsPoints:this.levelConfig.stars.slice(0)};this.starsProgressBar=new o.PointsProgressBar(this.scene,i),this.starsProgressBar.x=this.back.left+this.padding.x,this.starsProgressBar.y=Phaser.Display.Bounds.GetCenterY(this.back)-3,this.starsProgressBar.updateProgressInstant(0),this.starsProgressBar.on("update_points",function(s){e.updatePoints(t*s)}),this.add(this.starsProgressBar)},n.prototype.addPointsText=function(){var e="0";this.pointsText=this.scene.add.bitmapText(0,0,o.BitmapGameFont.INGAME_GUI_DIGITS,e,28),this.pointsText.setTint(o.GameplayGui.FONT_COLOR),this.pointsText.setOrigin(1,.5),this.pointsText.x=this.back.right-this.padding.x-4,this.pointsText.y=this.back.getCenter().y,this.add(this.pointsText)},n.prototype.updatePoints=function(e,t){if(t===void 0&&(t=!1),t){this.points=e,this.updatePointsText(this.points),this.starsProgressBar.updateProgressInstant(this.points);return}var i=800;this.budgePointsText(),this.tweenPointsValue(e,i),this.starsProgressBar.updateProgress(e,i)},n.prototype.tweenPointsValue=function(e,t){var i=this;this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:t,ease:Phaser.Math.Easing.Circular.Out,points:e,onUpdate:function(){i.updatePointsText(Math.round(i.points))}})},n.prototype.budgePointsText=function(){this.scene.tweens.killTweensOf(this.pointsText),this.scene.tweens.add({targets:this.pointsText,duration:166,ease:Phaser.Math.Easing.Sine.InOut,x:"-=8",yoyo:!0})},n.prototype.updatePointsText=function(e){this.pointsText.setText(e.toLocaleString())},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.height},n}(Phaser.GameObjects.Container);o.PointsLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.labelsY=0,i.originalY=0,i.levelConfig=t,i.name="top_panel",Phaser.Display.Align.In.TopCenter(i.container,i.background,0,0),i.labelsY=i.background.height/2-4,i.addShadow(),i.addMainLabel(),i.addPointsLabel(),i.alignItems(),i}return n.prototype.addShadow=function(){this.shadow=this.scene.add.image(0,0,"gameplay_gui","up_panel_shadow"),this.shadow.setOrigin(.5,0),this.shadow.alpha=.08,this.shadow.y=10,this.addAt(this.shadow,0)},n.prototype.addMainLabel=function(){this.mainLabel=new o.MainLabel(this.scene,this.levelConfig),this.add(this.mainLabel)},n.prototype.addPointsLabel=function(){this.pointsLabel=new o.PointsLabel(this.scene,this.levelConfig),this.add(this.pointsLabel)},n.prototype.alignItems=function(){var e=this.mainLabel.getWidth(),t=this.pointsLabel.getWidth(),i=30,s=e+t+i,a=(this.background.width-s)/2;this.pointsLabel.x=this.background.left+a,this.pointsLabel.y=this.labelsY-this.pointsLabel.getHeight()/2,this.mainLabel.x=this.background.right-e/2-a,this.mainLabel.y=this.labelsY},n.prototype.show=function(){this.revive(),this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:this.originalY})},n.prototype.hide=function(){this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:this.originalY-10,onComplete:this.kill.bind(this)})},n}(o.IngamePanel);o.TopPanel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s){var a=r.call(this,e,t,i,s)||this;return a.originalY=0,a.checkIfOver=!1,a}return n.prototype.enable=function(){this.setInteractive()},n.prototype.disable=function(){this.disableInteractive()},n.prototype.tweenAlpha=function(e){this.alphaTween&&this.alphaTween.stop(),this.alphaTween=this.scene.tweens.add({targets:this,alpha:{value:e,ease:Phaser.Math.Easing.Cubic.Out,duration:150}})},n}(Phaser.GameObjects.Button);o.BottomPanelButton=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i,s){var a=r.call(this,e,t,i,s)||this;return a.areTweensEnabled=!1,a}return n.prototype.playAnimation=function(){this.scaleTween=this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Sine.InOut,scale:1.1,yoyo:!0,repeat:-1})},n.prototype.stopAnimation=function(){this.scaleTween&&(this.scaleTween.stop(),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.Out,scale:1}))},n}(o.BottomPanelButton);o.FastForwardButton=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="num_label",t.addBack(),t.addText(),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","boosters/booster_label_num"),this.add(this.back)},n.prototype.addText=function(){this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.BLOCKS_LABEL,"0",25),this.text.setOrigin(.5,.5),this.text.y+=2,this.text.alpha=.9,this.add(this.text)},n.prototype.updateNum=function(e){this.text.setText(e.toString())},n}(Phaser.GameObjects.Container);o.IngameBoosterNumLabel=h})(game||(game={}));var game;(function(o){var h=Phaser.Geom.Rectangle,r=Phaser.Math.EasingString,n=function(e){__extends(t,e);function t(i,s){var a=e.call(this,i)||this;return a._isSelected=!1,a.isLocked=!1,a.originalY=0,a.name="booster_"+s.type,a._booster=s,a._booster.on(o.BoosterEvent.NUM_CHANGED,a.onBoosterNumChanged,a),a.addParticles(),a.addBack(),a.addBackShadow(),a.addIcon(),a.addNumLabel(),a.addPlusButton(),a.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,a.onInputDown,a),a.scene.input.on(Phaser.Input.Events.POINTER_UP,a.onInputUp,a),a.enableInteractive(),a.updateView(),a}return Object.defineProperty(t.prototype,"isSelected",{get:function(){return this._isSelected},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"booster",{get:function(){return this._booster},enumerable:!1,configurable:!0}),t.prototype.onBoosterNumChanged=function(){this.updateView()},t.prototype.updateView=function(){if(o.Main.areRewardAdsEnabled===!1){this.plusButton.kill();return}this._booster.num>0?(this.numLabel.revive(),this.plusButton.kill()):(this.numLabel.kill(),this.plusButton.revive())},t.prototype.enableInteractive=function(){this.setInteractive(this.backBounds,h.Contains),this.input.cursor="pointer"},t.prototype.onInputDown=function(i){this.currentPointer=i,this.scene.tweens.add({targets:this,scale:this.scale*.9,ease:Phaser.Math.Easing.Cubic.Out,duration:50}),this.scene.cache.audio.has(o.GameSoundKey.TAP)&&this.scene.sound.play(o.GameSoundKey.TAP,{volume:1})},t.prototype.onInputUp=function(i){this.currentPointer&&this.currentPointer===i&&(this.currentPointer=null,this.scene.tweens.add({targets:this,scale:1,ease:Phaser.Math.Easing.Back.Out,duration:300}))},t.prototype.addParticles=function(){this.particles=this.scene.add.particles("gameplay_gui"),this.emitter=this.particles.createEmitter({frame:["boosters/circle_fx"],scale:{start:.5,end:2,ease:r.ExpoEaseOut},alpha:{start:1,end:0,ease:r.ExpoEaseOut},lifespan:2e3,frequency:500,on:!1}),this.add(this.particles)},t.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","boosters/booster_back"),this.add(this.back),this.backBounds=this.back.getBounds()},t.prototype.addBackShadow=function(){this.backShadow=this.scene.add.image(0,0,"gameplay_gui","boosters/booster_back_shadow"),this.backShadow.alpha=.15,this.backShadow.y+=6,this.addAt(this.backShadow,0)},t.prototype.addIcon=function(){var i="boosters/booster_"+this._booster.type;this.icon=this.scene.add.image(0,0,"gameplay_gui",i),this.add(this.icon)},t.prototype.addNumLabel=function(){var i=this.back.width/2-15;this.numLabel=new o.IngameBoosterNumLabel(this.scene),this.numLabel.updateNum(this._booster.num),this.numLabel.x=i,this.numLabel.y=i,this.add(this.numLabel)},t.prototype.addPlusButton=function(){this.plusButton=this.scene.add.image(0,0,"gameplay_gui","boosters/plus_button"),this.plusButton.x=this.numLabel.x,this.plusButton.y=this.numLabel.y,this.add(this.plusButton)},t.prototype.getWidth=function(){return this.back.width},t.prototype.getHeight=function(){return this.back.height},t.prototype.onGiftArrive=function(i){this.scene.cache.audio.has(o.GameSoundKey.BLOCK_COLLECTED)&&this.scene.sound.play(o.GameSoundKey.BLOCK_COLLECTED,{volume:.3}),this.numLabel.updateNum(this.booster.num+i),this.emitter.explode(1,0,0),this.scene.tweens.add({targets:[this.back,this.icon],duration:233,ease:Phaser.Math.Easing.Sine.InOut,scale:1.33,yoyo:!0,delay:this.scene.tweens.stagger(50)})},t.prototype.highlight=function(){this._isSelected=!0,this.emitter.flow(800)},t.prototype.dim=function(){this.alpha=.4,this.disableInteractive()},t.prototype.resetHighlight=function(){this._isSelected=!1,this.emitter.on=!1,this.emitter.killAll()},t.prototype.resetDim=function(){this.alpha=1,this.isLocked===!1&&this.enableInteractive()},t.prototype.lock=function(){if(this.isLocked)return;this.isLocked=!0},t.prototype.unlock=function(){if(this.isLocked===!1)return;this.isLocked=!1},t.prototype.preDestroy=function(){this.scene.input.off(Phaser.Input.Events.POINTER_UP,this.onInputUp,this),this._booster.off(o.BoosterEvent.NUM_CHANGED,this.onBoosterNumChanged,this),e.prototype.preDestroy.call(this)},t}(Phaser.GameObjects.Container);o.IngameBoosterIcon=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.originalY=0,i.name="boosters_panel",i.addIcons(t),i.alignIcons(),i.addOverlay(),i}return n.prototype.addIcons=function(e){var t=this;this.icons=e.map(function(i){var s=new o.IngameBoosterIcon(t.scene,i);return s.on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,t.onIconClick.bind(t,s)),t.add(s),s}),this.iconsReversed=this.icons.slice().reverse()},n.prototype.onIconClick=function(e){if(e.booster.num===0){o.Main.areRewardAdsEnabled&&this.scene.events.emit(o.GameplayBoostersEvent.GET_FREE_BOOSTER,e.booster);return}if(e.isLocked)return;e.isSelected?this.scene.events.emit(o.GameplayBoostersEvent.CANCEL,e.booster):this.scene.events.emit(o.GameplayBoostersEvent.SELECT,e.booster)},n.prototype.alignIcons=function(){var e=140;this.gridAlign({cellWidth:e,cellHeight:e,x:e/2,position:Phaser.Display.Align.CENTER,height:1}),this.icons.forEach(function(t){t.originalY=t.y})},n.prototype.addOverlay=function(){var e=this.getBounds();this.overlay=this.scene.add.image(0,0,"gameplay_gui","white_rect"),this.overlay.displayWidth=e.width,this.overlay.displayHeight=e.height,this.overlay.x=e.centerX,this.overlay.y=e.centerY,this.add(this.overlay),this.overlay.alpha=.001,this.overlay.visible=!1,this.overlay.setInteractive()},n.prototype.show=function(){var e=this;this.revive(),this.iconsReversed.forEach(function(t){t.alpha=0,t.y=t.originalY-10,e.scene.tweens.add({delay:150,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:t.originalY})})},n.prototype.hide=function(){var e=this;this.scene.tweens.add({targets:this.icons,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,y:"+=10"}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,function(){e.kill()})},n.prototype.enableInput=function(){this.overlay.visible=!1},n.prototype.disableInput=function(){this.overlay.visible=!0},n.prototype.getIconByType=function(e){return this.icons.find(function(t){return t.booster.type===e})},n.prototype.highlight=function(e){this.icons.forEach(function(t){t.booster.type===e?t.highlight():t.dim()})},n.prototype.resetHighlight=function(){this.icons.forEach(function(e){e.isSelected?e.resetHighlight():e.resetDim()})},n}(Phaser.GameObjects.Container);o.IngameBoostersPanel=h})(game||(game={}));var game;(function(o){var h;(function(n){n.SHOW="FastForwardPopover_SHOw"})(h=o.FastForwardPopoverEvent||(o.FastForwardPopoverEvent={}));var r=function(n){__extends(e,n);function e(t,i){var s=n.call(this,t)||this;return s.originalY=0,s.turnTimer=0,s.isTurnStarted=!1,s.fastForwardWasUsed=!1,s.name="fast_forward_popover",s.addBack(),s.addTip(),s.addText(),s.adjustTextSize(),s.alignItems(),s.gameplay=i,s.gameplay.events.on(o.GameplayEvent.TURN_START,s.onTurnStart,s),s.gameplay.events.on(o.GameplayEvent.TURN_COMPLETE,s.onTurnComplete,s),s.gameplay.events.once(o.GameplayEvent.FAST_FORWARD_START,s.onFastForwardUse,s),s}return e.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","booster_hint_screen/booster_info_popover"),this.back.scaleY=.75,this.back.setOrigin(.5,1),this.add(this.back)},e.prototype.addTip=function(){this.tip=this.scene.add.image(0,0,"gameplay_gui","booster_hint_screen/booster_info_popover_tip"),this.tip.setOrigin(.5,0),this.tip.y=this.back.y-10,this.add(this.tip)},e.prototype.addText=function(){var t=this.scene.texts.fast_forward_hint,i={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"30px",color:"#205466",align:"center"};this.text=this.scene.add.text(0,0,t,i),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(this.back.width*.8),this.text.lineSpacing=-3,this.text.y=-this.back.displayHeight/2,this.add(this.text)},e.prototype.adjustTextSize=function(){var t=this.back.height*.8;this.text.scale=Math.min(1,t/this.text.height)},e.prototype.alignItems=function(){var t=this;this.list.forEach(function(i){i.y-=t.tip.height})},e.prototype.getWidth=function(){return this.back.width},e.prototype.offsetTip=function(t){this.tip.x=-t/this.scale},e.prototype.onTurnStart=function(){if(this.fastForwardWasUsed)return;this.turnTimer=0,this.isTurnStarted=!0},e.prototype.onTurnComplete=function(){this.isTurnStarted=!1,this.hide()},e.prototype.preUpdate=function(t,i){if(this.visible||this.fastForwardWasUsed||this.isTurnStarted===!1)return;this.turnTimer+=i,this.turnTimer>3500&&(this.revive(),this.show())},e.prototype.show=function(){this.emit(h.SHOW,this),this.alpha=0,this.y=this.originalY-12*this.scale,this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:1}),this.scene.tweens.add({targets:this,duration:500,ease:Phaser.Math.Easing.Sine.InOut,y:this.originalY,yoyo:!0,repeat:-1})},e.prototype.hide=function(){var t=this;this.scene.tweens.killTweensOf(this),this.scene.tweens.add({targets:this,duration:66,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){t.kill()}})},e.prototype.onFastForwardUse=function(){this.fastForwardWasUsed=!0,this.destroy()},e.prototype.destroy=function(t){this.gameplay.events.off(o.GameplayEvent.TURN_START,this.onTurnStart,this),this.gameplay.events.off(o.GameplayEvent.TURN_COMPLETE,this.onTurnComplete,this),this.gameplay.events.off(o.GameplayEvent.FAST_FORWARD_START,this.onFastForwardUse,this),n.prototype.destroy.call(this,t)},e}(Phaser.GameObjects.Container);o.FastForwardPopover=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="bottom_panel",t.background.setOrigin(.5,.5),t.background.scaleY=-1,t.background.y+=t.background.height/2+4,t.background.visible=!1,Phaser.Display.Align.In.TopCenter(t.container,t.background,0,-t.strokeThickness-t.verticalMargin),t.padding=30,t.buttonsY=t.background.height/2-5,t.addPauseButton(),t.addFastForwardButton(),t.addDropBallsButton(),t.addBoostersPanel(),t.container.alpha=.001,t.container.visible=!1,t.container.setInteractive(),t.bringToTop(t.container),t.turnButtons=[t.dropBallsButton,t.fastForwardButton],t}return n.prototype.addPauseButton=function(){this.pauseButton=this.scene.add.button("gameplay_gui","button_pause",this),this.pauseButton.x=this.background.left+this.pauseButton.width/2+this.padding,this.pauseButton.y=this.buttonsY+4},n.prototype.addFastForwardButton=function(){this.fastForwardButton=new o.FastForwardButton(this.scene,"gameplay_gui","button_fast_forward_2",this),this.fastForwardButton.x=this.background.right-this.fastForwardButton.width/2-this.padding,this.fastForwardButton.y=this.buttonsY-2,this.fastForwardButton.originalY=this.fastForwardButton.y,this.add(this.fastForwardButton)},n.prototype.addDropBallsButton=function(){this.dropBallsButton=new o.BottomPanelButton(this.scene,"gameplay_gui","button_drop_balls_2",this),this.dropBallsButton.x=this.fastForwardButton.left-this.dropBallsButton.width/2-32,this.dropBallsButton.y=this.fastForwardButton.y,this.dropBallsButton.originalY=this.dropBallsButton.y,this.add(this.dropBallsButton)},n.prototype.addBoostersPanel=function(){this.boostersPanel=new o.IngameBoostersPanel(this.scene,this.scene.game.boosters.boosters),this.boostersPanel.x=this.background.right-this.boostersPanel.getBounds().width-this.padding,this.boostersPanel.y=this.buttonsY-1,this.boostersPanel.originalY=this.boostersPanel.y,this.add(this.boostersPanel)},n.prototype.disableInput=function(){this.container.visible=!0},n.prototype.enableInput=function(){this.container.visible=!1},n.prototype.showTurnButtons=function(){var e=this;this.turnButtons.forEach(function(t){t.revive(),t.enable(),t.alpha=0,t.y=t.originalY-10,e.scene.tweens.add({delay:170,targets:t,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,y:t.originalY})})},n.prototype.hideTurnButtons=function(){var e=this;this.scene.tweens.add({targets:this.turnButtons,duration:150,ease:Phaser.Math.Easing.Linear.Linear,y:"+=10",alpha:0}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,function(){e.turnButtons.forEach(function(t){return t.kill()})}).on(Phaser.Tweens.Events.TWEEN_START,function(){e.turnButtons.forEach(function(t){return t.disable()})})},n}(o.IngamePanel);o.BottomPanel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i){var s=r.call(this,e)||this;return s.blockOriginalScale=.42,s.currentItemsNum=0,s.totalItemsNum=0,s.name="ducks_label",s.addBlock(t),s.addBlockWhiteCopies(),s.addText(),s.updateTotal(i),s}return n.prototype.addBlock=function(e){var t=o.ItemTypeUtil.getFrameName(e);this.block=this.scene.add.image(0,0,"gameplay_gui",t),this.block.scale=this.blockOriginalScale,this.add(this.block)},n.prototype.addBlockWhiteCopies=function(){var e=this;this.blockWhiteCopies=this.scene.add.group({defaultKey:"gameplay_gui",defaultFrame:this.getWhiteBlockFrame(this.block.frame.name),name:"white_copies",createCallback:function(i){i.x=e.block.x,i.y=e.block.y,i.scale=e.blockOriginalScale,i.active=!1,i.visible=!1,e.add(i)}});for(var t=0;t<5;t++)this.blockWhiteCopies.create()},n.prototype.getWhiteBlockFrame=function(e){var t=e.lastIndexOf("/"),i=e.substring(0,t+1)+"white"+e.substring(t,e.length);return i},n.prototype.addText=function(){var e="0";this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.BLOCKS_LABEL,e,22),this.text.setTint(o.GameplayGui.FONT_COLOR),this.text.setOrigin(.5,.5),this.text.y=this.block.y+43,this.add(this.text)},n.prototype.incrementCurrent=function(){this.currentItemsNum++,this.setTextContent(this.currentItemsNum,this.totalItemsNum)},n.prototype.updateTotal=function(e){this.totalItemsNum=e,this.setTextContent(this.currentItemsNum,this.totalItemsNum)},n.prototype.setTextContent=function(e,t){var i=e+"/"+t;this.text.setText(i)},n.prototype.showWhiteCopy=function(){var e=this.blockWhiteCopies.getFirstDead(!0);e.revive(),e.scale=this.block.scale,e.alpha=.5,this.scene.tweens.add({targets:e,duration:500,ease:Phaser.Math.Easing.Quadratic.Out,alpha:0,scale:e.scale*2.66,onComplete:function(){e.kill()}})},n.prototype.tweenBlockIcon=function(){this.block.scale=this.blockOriginalScale,this.scene.tweens.killTweensOf(this.block),this.scene.tweens.add({targets:this.block,duration:250,ease:Phaser.Math.Easing.Sine.InOut,scale:this.blockOriginalScale*1.33,yoyo:!0})},n}(Phaser.GameObjects.Container);o.BasicBlocksLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.props=t,i.name="blocks_label",i.addBack(),i.addBlock(),i.addText(),i.addTick(),i.bringToTop(i.text),i}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui",this.props.backFrame),this.back.setOrigin(.5,0),this.add(this.back)},n.prototype.addBlock=function(){this.block=this.scene.add.image(0,0,"gameplay_gui",o.ItemTypeUtil.getFrameName(o.ItemType.BASIC_BLOCK)),this.block.scale=.94,this.block.y=this.back.top+this.block.displayHeight/2+18,this.add(this.block)},n.prototype.addText=function(){var e="0/0",t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"37px",color:"#"+this.props.textColor.toString(16),align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,1),this.text.y=this.back.bottom-8,this.add(this.text)},n.prototype.addTick=function(){var e=-15;this.tick=this.scene.add.image(0,0,"gameplay_gui",this.props.iconFrame),this.tick.x=this.back.right+e,this.tick.y=this.back.bottom+e,this.add(this.tick)},n.prototype.getHeight=function(){return this.back.displayHeight},n.prototype.getDisplayHeight=function(){return this.back.displayHeight*this.scaleY},n.prototype.updateData=function(e,t,i){this.block.setFrame(o.ItemTypeUtil.getFrameName(e)),this.text.setText(t+"/"+i)},n}(Phaser.GameObjects.Container);o.ComplexBlocksLabel=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="ball_with_shadow",t._jumpHeight=80,t.jumpDuration=t._jumpHeight*3.8,t.addBall(),t.addShadow(),t.ball.emit(o.IdleBallEvent.SHOW),t}return n.prototype.addBall=function(){this.ball=this.scene.add.image(0,0,"gameplay_gui","level_complete/ball_complete"),this.ball.baseY=0,this.ball.jumpHeight=this._jumpHeight,this.ball.setOrigin(.5,1),this.add(this.ball)},n.prototype.addShadow=function(){this.shadow=new o.JumpingBallShadow(this.scene,this.ball,"gameplay_gui","level_complete/ball_complete_shadow"),this.add(this.shadow)},n.prototype.playJumpAnimation=function(){var e=this;this.ball.scale=1;var t=.15;this.scene.tweens.add({targets:this.ball,duration:this.jumpDuration*.66,ease:Phaser.Math.Easing.Sine.InOut,scaleX:this.ball.scale+t,scaleY:this.ball.scale-t,yoyo:!0}),this.scene.tweens.add({targets:this.ball,duration:this.jumpDuration,ease:Phaser.Math.Easing.Quadratic.Out,y:this.ball.y-this._jumpHeight,completeDelay:33,onComplete:function(){e.scene.tweens.add({targets:e.ball,duration:e.jumpDuration,ease:Phaser.Math.Easing.Linear.Linear,y:e.ball.y+e._jumpHeight,onComplete:function(){e.playJumpAnimation()}})}})},n}(Phaser.GameObjects.Container);o.LevelCompleteBall=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="popup",t.addBack(),t.addBanner(),t.addBlocksLabel(),t.addSeparator(),t.addTexts(),t.addFox(),t.addJumpingDucks(),t.align(),t.bringToTop(t.blocksLabel),t.bringToTop(t.texts),t.bringToTop(t.bannerText),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","level_complete/popup_back"),this.add(this.back)},n.prototype.addBanner=function(){this.bannerBack=this.scene.add.image(0,0,"gameplay_gui","level_complete/banner"),this.add(this.bannerBack);var e=360;this.bannerText=this.createBannerText(),this.bannerText.setOrigin(.5,.5),this.bannerText.scale=Math.min(1,e/this.bannerText.width),this.add(this.bannerText)},n.prototype.createBannerText=function(){var e=_.compact(this.scene.texts.level_complete_titles),t=this.scene.make.text({add:!1,text:_.sample(e),style:{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"55px",color:"#FAD353",align:"center"}});return t.setShadow(0,4,"rgba(0,0,0,0.15)"),t},n.prototype.addBlocksLabel=function(){var e={backFrame:"level_complete/blocks_label_back",iconFrame:"level_complete/tick",textColor:12202809};this.blocksLabel=new o.ComplexBlocksLabel(this.scene,e),this.add(this.blocksLabel)},n.prototype.addSeparator=function(){this.separator=this.scene.add.image(0,0,"gameplay_gui","level_complete/separator"),this.separator.scaleY=.75,this.add(this.separator)},n.prototype.addTexts=function(){var e=this.createTexts();e.forEach(function(t){return t.setOrigin(.5,.5)}),this.texts=this.scene.add.container(0,0,e),this.texts.name="texts",this.texts.gridAlign({position:Phaser.Display.Align.TOP_CENTER,width:1,cellWidth:this.back.displayWidth,cellHeight:45}),this.score.y+=6,this.add(this.texts)},n.prototype.createTexts=function(){var e={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"22px",color:"#ffffff",align:"center"};return this.levelNumber=this.scene.make.text({text:this.getLevelNumberTextContent(1),style:__assign(__assign({},e),{fontSize:"42px",color:"#AE6334"}),add:!1}),this.score=this.scene.make.text({text:this.getScoreTextContent(0),style:__assign(__assign({},e),{fontSize:"33px",color:"#B62C35"}),add:!1}),this.highscore=this.scene.make.text({text:this.getHighscoreTextContent(0),style:__assign(__assign({},e),{fontSize:"33px",color:"#B62C35"}),add:!1}),[this.levelNumber,this.score,this.highscore]},n.prototype.getLevelNumberTextContent=function(e){var t=this.scene.texts.level_end.level;return t.replace("#",e.toString())},n.prototype.getScoreTextContent=function(e){var t=this.scene.texts.level_end.score;return t.replace("#",e.toLocaleString())},n.prototype.getHighscoreTextContent=function(e){var t=this.scene.texts.level_end.highscore;return t.replace("#",e.toLocaleString())},n.prototype.addFox=function(){this.fox=this.scene.add.image(0,0,"gameplay_gui","level_complete/fox_win"),this.add(this.fox)},n.prototype.addJumpingDucks=function(){var e=this;this.jumpingDucks=_.times(3,function(){var s=new o.LevelCompleteBall(e.scene);return e.add(s),s});var t=this.jumpingDucks[1],i=this.jumpingDucks[2];this.swap(t,i)},n.prototype.align=function(){this.alignBanner(),this.alignSeparator(),this.alignBlocksLabel(),this.alignTexts(),this.alignFox(),this.alignDucks()},n.prototype.alignBanner=function(){this.bannerBack.y=this.back.top-3,this.bannerText.y=this.bannerBack.y-34},n.prototype.alignSeparator=function(){this.separator.y=this.back.y+16},n.prototype.alignBlocksLabel=function(){var e=this.bannerBack.y,t=this.separator.y,i=t-e;this.blocksLabel.x=this.back.getCenter().x+2,this.blocksLabel.y=e+i/2-this.blocksLabel.getHeight()/2+15},n.prototype.alignTexts=function(){var e=this.separator.y,t=this.back.bottom,i=t-e;this.texts.y=e+i/2-this.texts.getBounds().height/2+12},n.prototype.alignFox=function(){this.fox.x=this.back.displayWidth*.32,this.fox.y=this.back.bottom-70},n.prototype.alignDucks=function(){var e=-this.back.displayWidth*.33,t=this.fox.y,i=55,s=this.jumpingDucks[0];s.x=e-i,s.y=t-20,s.scale=.8;var a=this.jumpingDucks[1];a.x=e,a.y=t,a.scale=1.05;var l=this.jumpingDucks[2];l.x=e+i,l.y=t-30,l.scale=.9},n.prototype.updateData=function(e){this.blocksLabel.updateData(e.blocksType,e.blocksNum,e.blocksNum),this.updateTexts(e.levelNumber,e.score,e.highscore)},n.prototype.updateTexts=function(e,t,i){this.levelNumber.text=this.getLevelNumberTextContent(e),this.score.text=this.getScoreTextContent(t),this.highscore.text=this.getHighscoreTextContent(i)},n.prototype.resize=function(){this.back.displayWidth=(o.Config.GAME_WIDTH+2)/this.scale,this.separator.displayWidth=this.back.displayWidth*.8,this.alignFox(),this.alignDucks()},n.prototype.show=function(e){var t=60,i=this.scale;this.y+=t,this.scale=i*.75,this.alpha=0,this.scene.tweens.add({targets:this,delay:e,y:{value:this.y-t,duration:600,ease:Phaser.Math.Easing.Back.Out},scale:{value:i,duration:500,ease:Phaser.Math.Easing.Back.Out},alpha:{value:1,duration:200,ease:Phaser.Math.Easing.Cubic.Out}}),this.showBanner(e+200),this.showFox(e+350),this.showDucks()},n.prototype.showBanner=function(e){this.bannerBack.alpha=0,this.bannerText.alpha=0,this.scene.tweens.add({targets:[this.bannerBack,this.bannerText],delay:e,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.bannerBack.scale=1.2,this.bannerText.scale=1.2,this.scene.tweens.add({targets:[this.bannerBack,this.bannerText],delay:e,duration:500,ease:Phaser.Math.Easing.Back.Out,scale:1});var t=-30;this.bannerBack.y+=t,this.bannerText.y+=t,this.scene.tweens.add({targets:[this.bannerBack,this.bannerText],delay:e,duration:600,ease:Phaser.Math.Easing.Back.Out,y:"-="+t})},n.prototype.showFox=function(e){this.fox.alpha=0,this.scene.tweens.add({targets:this.fox,delay:e,alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out}}),this.fox.scale=.6,this.scene.tweens.add({targets:this.fox,duration:800,delay:e,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.33],scale:1,onComplete:this.animateFox.bind(this)})},n.prototype.animateFox=function(){this.scene.tweens.add({targets:this.fox,duration:550,ease:Phaser.Math.Easing.Sine.InOut,scaleY:.97,scaleX:1.02,yoyo:!0,repeat:-1})},n.prototype.showDucks=function(){var e=this;this.jumpingDucks.forEach(function(t,i){var s=i*150;e.scene.time.delayedCall(s,function(){t.playJumpAnimation()})})},n.prototype.getWidth=function(){return 750},n.prototype.getHeight=function(){return this.back.displayHeight},n}(Phaser.GameObjects.Container);o.LevelCompletePopup=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;t.cellWidth=190,t.name="buttons",t.restartButton=t.scene.add.button("gameplay_gui","level_complete/button_restart",t),t.nextLevelButton=t.scene.add.button("gameplay_gui","level_complete/button_play",t),t.homeButton=t.scene.add.button("gameplay_gui","level_complete/button_menu",t),t.buttons=[t.restartButton,t.nextLevelButton,t.homeButton],t.add(t.buttons);var i=t.nextLevelButton.height;return t.gridAlign({position:Phaser.Display.Align.CENTER,cellWidth:t.cellWidth,cellHeight:i,width:3,x:t.cellWidth/2}),t}return n.prototype.getWidth=function(){return this.length*this.cellWidth},n.prototype.show=function(e){var t=this;this.list.forEach(function(i,s){var a=60;i.alpha=0,i.scale=.66,i.y+=a,t.scene.tweens.add({targets:i,delay:e+s*133,alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out},scale:{value:1,duration:400,ease:Phaser.Math.Easing.Back.Out},y:{value:i.y-a,duration:500,ease:Phaser.Math.Easing.Back.Out}})})},n.prototype.animatePlayButton=function(){this.scene.time.addEvent({repeat:-1,delay:3e3,callback:this.shakePlayButton,callbackScope:this})},n.prototype.shakePlayButton=function(){this.scene.tweens.add({targets:this.nextLevelButton,duration:266,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.1,scaleY:1.1,repeat:2,yoyo:!0})},n}(Phaser.GameObjects.Container);o.LevelCompleteButtons=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e,0,0,"gameplay_gui",t)||this;return i.angularVelocity=0,i.deltaScale=0,i.speedX=0,i.speedY=0,i}return n.prototype.onEmit=function(){this.active=!0,this.visible=!0,this.scaleY=1,this.angularVelocity=Phaser.Math.RND.realInRange(.1,.15)*Phaser.Math.RND.sign(),this.deltaScale=this.angularVelocity/20,this.speedX=Phaser.Math.RND.realInRange(-.08,.08),this.speedY=Phaser.Math.RND.realInRange(.18,.3)},n.prototype.preUpdate=function(e,t){if(!this.visible)return;this.x+=this.speedX*t,this.y+=this.speedY*t,this.angle+=this.angularVelocity*t,this.updateScale(t),this.checkOutOfBounds()},n.prototype.updateScale=function(e){this.scaleY+=this.deltaScale*e,this.scaleY<-1?(this.scaleY=-1,this.deltaScale*=-1):this.scaleY>1&&(this.scaleY=1,this.deltaScale*=-1)},n.prototype.checkOutOfBounds=function(){var e=50;(this.y>o.Config.GAME_HEIGHT+e||this.x<-e||this.x>o.Config.GAME_WIDTH+e)&&(this.visible=!1,this.active=!1)},n}(Phaser.GameObjects.Image);o.ConfettiParticle=h})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){e===void 0&&(e=100),this.timer=0,this.frequency=66,this.amount=1,this.scene=n,this.frames=[1,2,3].map(function(t){return"level_complete/confetti/particle_Confetti_"+t}),this.createParticles(e)}return r.prototype.createParticles=function(n){var e=this;this.particles=_.times(n,function(t){return e.createNewParticle()})},r.prototype.createNewParticle=function(){var n=Phaser.Math.RND.pick(this.frames),e=new o.ConfettiParticle(this.scene,n);return e.setDepth(o.GameplayGuiDepth.COMPLETE_SCREEN_CONFETTI),e.kill(),this.scene.add.existing(e),e},r.prototype.update=function(n){this.emit(n)},r.prototype.emit=function(n){this.timer+=n,this.timer>this.frequency&&(this.timer-=this.frequency,this.doEmit())},r.prototype.doEmit=function(){for(var n=0;n<this.amount;n++){var e=this.particles.find(function(t){return t.active===!1});e||(e=this.createNewParticle(),this.particles.push(e)),e.x=Phaser.Math.RND.between(0,o.Config.GAME_WIDTH),e.y=0,e.onEmit()}},r.prototype.destroy=function(n){this.particles.forEach(function(e){return e.destroy(n)}),this.particles.length=0},r}();o.LevelCompleteConfetti=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.backgroundAlpha=.75,t.name="complete_screen",t.addBack(),t.addStars(),t.addPopup(),t.addButtons(),t.bringToTop(t.popup),t}return n.prototype.addBack=function(){this.background=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.background.alpha=this.backgroundAlpha,this.add(this.background)},n.prototype.addStars=function(){var e={atlas:"gameplay_gui",activeStarFrame:"level_complete/star_with_glow",inactiveStarFrame:"level_complete/star_inactive",whiteStarFrame:"level_complete/star_white"};this.stars=new o.LevelCompleteStars(this.scene,e),this.stars.addEmitter("gameplay_gui","level_complete/particle_star_4",o.GameplayGuiDepth.COMPLETE_SCREEN_PARTICLES),this.add(this.stars)},n.prototype.addPopup=function(){this.popup=new o.LevelCompletePopup(this.scene),this.add(this.popup)},n.prototype.addButtons=function(){this.buttons=new o.LevelCompleteButtons(this.scene),this.add(this.buttons)},n.prototype.resize=function(){this.resizeBackground(),this.alignPopup(),this.alignStars(),this.alignButtons()},n.prototype.resizeBackground=function(){this.background.setDisplaySize(o.Config.GAME_WIDTH+4,o.Config.GAME_HEIGHT+4),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},n.prototype.alignPopup=function(){var e=o.Config.GAME_WIDTH,t=o.Config.GAME_HEIGHT*.35,i=e/this.popup.getWidth(),s=t/this.popup.getHeight();this.popup.scale=Math.min(i,s),this.popup.resize(),this.popup.x=o.Config.HALF_GAME_WIDTH,this.popup.y=o.Config.HALF_GAME_HEIGHT},n.prototype.alignStars=function(){var e=this.popup.y-this.popup.getHeight()*this.popup.scale/2;this.stars.scale=this.popup.scale,this.stars.x=o.Config.HALF_GAME_WIDTH,this.stars.y=e-225*this.popup.scale},n.prototype.alignButtons=function(){var e=this.popup.y+this.popup.getHeight()*this.popup.scale/2;this.buttons.scale=this.popup.scale,this.buttons.x=(o.Config.GAME_WIDTH-this.buttons.getWidth()*this.buttons.scale)/2,this.buttons.y=e+this.buttons.getBounds().height/2+100*this.buttons.scale},n.prototype.updateData=function(e){this.stars.updateData(e.stars),this.popup.updateData(e)},n.prototype.show=function(){this.revive(),this.resize(),this.playSound();var e=100;this.showBackground(),this.showPopup(e+200),this.showButtons(e+400),this.showStars(e+450),this.fadeOutSound(e+450),this.showConfetti()},n.prototype.playSound=function(){this.scene.cache.audio.has(o.GameSoundKey.LEVEL_COMPLETE)&&(this.sound=this.scene.sound.add(o.GameSoundKey.LEVEL_COMPLETE),this.sound.play("",{volume:1,delay:.45}))},n.prototype.showBackground=function(){this.background.alpha=0,this.scene.tweens.add({targets:this.background,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.backgroundAlpha})},n.prototype.showPopup=function(e){this.popup.show(e)},n.prototype.showStars=function(e){var t=this;this.stars.alpha=0,this.scene.tweens.add({targets:this.stars,delay:e,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1});var i=50;this.stars.y-=i,this.scene.tweens.add({targets:this.stars,delay:e,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.stars.y+i,onComplete:function(){t.stars.startFloating(),t.stars.showActiveStars(0)}})},n.prototype.fadeOutSound=function(e){if(!this.sound||this.stars.activeStarsNum===0)return;this.scene.tweens.add({targets:this.sound,delay:e+350,duration:200,ease:Phaser.Math.Easing.Cubic.Out,volume:.5})},n.prototype.showButtons=function(e){this.buttons.show(e),this.buttons.animatePlayButton()},n.prototype.showConfetti=function(){this.confetti=new o.LevelCompleteConfetti(this.scene)},n.prototype.preUpdate=function(e,t){this.confetti&&this.confetti.update(t)},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e),this.sound&&(this.sound.stop(),this.sound=null),this.confetti&&(this.confetti.destroy(e),this.confetti=null)},n}(Phaser.GameObjects.Container);o.LevelCompleteScreen=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="popup",t.addBack(),t.addBanner(),t.addBlocksLabel(),t.addSeparator(),t.addTexts(),t.addButtons(),t.align(),t.bringToTop(t.texts),t.bringToTop(t.banner),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","level_failed/popup_back"),this.add(this.back)},n.prototype.addBanner=function(){var e=this.scene.make.image({key:"gameplay_gui",frame:"level_failed/banner",add:!1}),t=360,i=this.createBannerText();i.setOrigin(.5,.5),i.scale=Math.min(1,t/i.width),i.y=-60,this.banner=this.scene.add.container(0,0,[e,i]),this.add(this.banner)},n.prototype.createBannerText=function(){var e=this.scene.texts.level_failed_titles,t=this.scene.make.text({add:!1,text:_.sample(e),style:{fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BLACK,fontSize:"55px",color:"#B8B8B8",align:"center"}});return t.setShadow(0,4,"rgba(0,0,0,0.15)"),t},n.prototype.addBlocksLabel=function(){var e={backFrame:"level_failed/blocks_label_back_gray",iconFrame:"level_failed/cross",textColor:4673106};this.blocksLabel=new o.ComplexBlocksLabel(this.scene,e),this.add(this.blocksLabel)},n.prototype.addSeparator=function(){this.separator=this.scene.add.image(0,0,"gameplay_gui","level_failed/separator"),this.separator.scaleY=.75,this.add(this.separator)},n.prototype.addTexts=function(){var e=this.createTexts();e.forEach(function(t){return t.setOrigin(.5,.5)}),this.texts=this.scene.add.container(0,0,e),this.texts.name="texts",this.texts.gridAlign({position:Phaser.Display.Align.TOP_CENTER,width:1,cellWidth:this.back.displayWidth,cellHeight:45}),this.score.y+=6,this.add(this.texts)},n.prototype.createTexts=function(){var e={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"22px",color:"#ffffff",align:"center"};return this.levelNumber=this.scene.make.text({text:this.getLevelNumberTextContent(1),style:__assign(__assign({},e),{fontSize:"42px",color:"#444B4F"}),add:!1}),this.score=this.scene.make.text({text:this.getScoreTextContent(0),style:__assign(__assign({},e),{fontSize:"33px",color:"#676B6E"}),add:!1}),[this.levelNumber,this.score]},n.prototype.getLevelNumberTextContent=function(e){var t=this.scene.texts.level_end.level;return t.replace("#",e.toString())},n.prototype.getScoreTextContent=function(e){var t=this.scene.texts.level_end.score;return t.replace("#",e.toLocaleString())},n.prototype.addButtons=function(){this.homeButton=this.scene.add.button("gameplay_gui","level_failed/button_menu",this),this.restartButton=this.scene.add.button("gameplay_gui","level_failed/button_restart",this)},n.prototype.align=function(){this.alignBanner(),this.alignSeparator(),this.alignBlocksLabel(),this.alignTexts(),this.alignButtons()},n.prototype.alignBanner=function(){this.banner.x=-9,this.banner.y=this.back.top+20},n.prototype.alignSeparator=function(){this.separator.y=this.back.y+54},n.prototype.alignBlocksLabel=function(){var e=Phaser.Display.Bounds.GetBottom(this.banner),t=this.separator.y,i=t-e;this.blocksLabel.x=this.back.getCenter().x,this.blocksLabel.y=e+i/2-this.blocksLabel.getHeight()/2},n.prototype.alignTexts=function(){var e=this.separator.y,t=this.back.bottom,i=t-e;this.texts.y=e+i/2-this.texts.getBounds().height/2+15},n.prototype.alignButtons=function(){var e=this.back.displayWidth*.3,t=this.back.bottom;this.homeButton.x=-e,this.homeButton.y=t,this.restartButton.x=e,this.restartButton.y=t},n.prototype.updateData=function(e){this.blocksLabel.updateData(e.targetBlocksType,e.blocksKilled,e.blocksRequired),this.updateTexts(e.levelNumber,e.score)},n.prototype.updateTexts=function(e,t){this.levelNumber.text=this.getLevelNumberTextContent(e),this.score.text=this.getScoreTextContent(t)},n.prototype.resize=function(){this.back.displayWidth=o.Config.GAME_WIDTH/this.scaleX,this.separator.displayWidth=this.back.displayWidth*.8,this.alignButtons()},n.prototype.show=function(e){var t=50;this.y+=t,this.alpha=0,this.scene.tweens.add({targets:this,delay:e,y:{value:this.y-t,duration:700,ease:Phaser.Math.Easing.Back.Out},alpha:{value:1,duration:200,ease:Phaser.Math.Easing.Cubic.Out}}),this.showButtons(e+600)},n.prototype.showButtons=function(e){var t=this,i=[this.homeButton,this.restartButton];i.forEach(function(s){s.alpha=0,s.scale=1.33}),this.scene.tweens.add({targets:i,delay:e,alpha:{value:1,duration:200,ease:Phaser.Math.EasingString.Cubic},scale:{value:1,duration:560,ease:Phaser.Math.EasingString.Cubic}}).on(Phaser.Tweens.Events.TWEEN_COMPLETE,function(){t.animateRestartButton()})},n.prototype.animateRestartButton=function(){this.scene.time.addEvent({repeat:-1,delay:3500,startAt:3e3,callback:this.shakeRestartButton,callbackScope:this})},n.prototype.shakeRestartButton=function(){this.scene.tweens.add({targets:this.restartButton,duration:320,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.15,scaleY:1.15,repeat:2,yoyo:!0})},n.prototype.getWidth=function(){return 750},n.prototype.getHeight=function(){return this.back.displayHeight},n}(Phaser.GameObjects.Container);o.LevelFailedPopup=h})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r=function(n){__extends(e,n);function e(t){var i=n.call(this,t)||this;return i.backgroundAlpha=.75,i.name="failed_screen",i.addBack(),i.addShine(),i.addCryingFox(),i.addPopup(),i.addTears(),i.createRainEmitter(),i.buttons=[i.restartButton,i.homeButton],i}return Object.defineProperty(e.prototype,"restartButton",{get:function(){return this.popup.restartButton},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"homeButton",{get:function(){return this.popup.homeButton},enumerable:!1,configurable:!0}),e.prototype.addBack=function(){this.background=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.background.alpha=this.backgroundAlpha,this.add(this.background)},e.prototype.addShine=function(){this.shine=this.scene.add.image(0,0,"gameplay_gui","level_failed/gray"),this.add(this.shine)},e.prototype.addCryingFox=function(){this.fox=this.scene.add.image(0,0,"gameplay_gui","level_failed/crying_fox"),this.add(this.fox)},e.prototype.addPopup=function(){this.popup=new o.LevelFailedPopup(this.scene),this.add(this.popup)},e.prototype.addTears=function(){this.particles=this.scene.add.particles("gameplay_gui"),this.tearsEmitter=this.createTearEmitter(),this.rainEmitter=this.createRainEmitter(),this.add(this.particles),this.particles.visible=!1,this.particles.active=!1},e.prototype.createTearEmitter=function(){var t=this,i=1,s=1500;return this.particles.createEmitter({frame:"level_failed/particle_tear",lifespan:s,speedY:50,gravityY:50,frequency:700,quantity:1,x:{onEmit:function(){return i*=-1,t.fox.x+i*18*t.fox.scaleX}},y:{onEmit:function(){return t.fox.y-138*t.fox.scaleY}},emitCallback:function(a){var l=400;t.scene.tweens.add({targets:a,duration:l,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,delay:s-l})},on:!1})},e.prototype.createRainEmitter=function(){return this.particles.createEmitter({frame:"level_failed/particle_rain",lifespan:{onEmit:function(){return o.Config.GAME_HEIGHT*2.5}},scale:{min:.66,max:1},alpha:{start:1,end:.2,ease:h.Cubic},gravityY:1500,frequency:100,quantity:1,y:-938,x:{onEmit:function(){return Phaser.Math.RND.between(0,o.Config.GAME_WIDTH)}}})},e.prototype.resize=function(){this.resizeBackground(),this.alignPopup(),this.alignFox(),this.alignShine()},e.prototype.resizeBackground=function(){this.background.setDisplaySize(o.Config.GAME_WIDTH+4,o.Config.GAME_HEIGHT+4),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},e.prototype.alignPopup=function(){var t=o.Config.GAME_WIDTH,i=o.Config.GAME_HEIGHT*.31,s=t/this.popup.getWidth(),a=i/this.popup.getHeight();this.popup.scale=Math.min(s,a),this.popup.resize(),this.popup.x=o.Config.HALF_GAME_WIDTH,this.popup.y=o.Config.GAME_HEIGHT*.6},e.prototype.alignFox=function(){var t=this.scene.tweens.getTweensOf(this.fox).length>0;t&&this.scene.tweens.killTweensOf(this.fox),this.fox.scale=this.popup.scale,this.fox.x=o.Config.HALF_GAME_WIDTH,this.fox.y=this.popup.y-(this.popup.getHeight()+40)*this.popup.scale/2,t&&this.animateFox(this.fox.scale)},e.prototype.alignShine=function(){this.shine.scale=o.Config.GAME_WIDTH*1.2/this.shine.width,this.shine.x=this.fox.x,this.shine.y=this.fox.getTopCenter().y+70*this.fox.scale},e.prototype.updateData=function(t){this.popup.updateData(t)},e.prototype.show=function(){this.revive(),this.resize(),this.playSound(),this.showBackground(),this.showPopup(200),this.showFox(400),this.showShine(500),this.particles.visible=!0,this.particles.active=!0},e.prototype.playSound=function(){this.scene.cache.audio.has(o.GameSoundKey.LEVEL_FAILED)&&(this.sound=this.scene.sound.add(o.GameSoundKey.LEVEL_FAILED),this.sound.play("",{delay:.33}))},e.prototype.showBackground=function(){this.background.alpha=0,this.scene.tweens.add({targets:this.background,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:this.backgroundAlpha})},e.prototype.showPopup=function(t){this.popup.show(t)},e.prototype.showFox=function(t){var i=this,s=this.fox.scale;this.fox.alpha=0,this.fox.scale=s*.75,this.scene.tweens.add({targets:this.fox,delay:t,alpha:{value:1,duration:150,ease:Phaser.Math.Easing.Cubic.Out},scale:{value:s,duration:800,ease:Phaser.Math.Easing.Back.Out},onComplete:function(){i.tearsEmitter.on=!0,i.animateFox(s)}})},e.prototype.animateFox=function(t){this.scene.tweens.add({targets:this.fox,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:t*1.01,scaleY:t*.97,yoyo:!0,repeat:-1})},e.prototype.showShine=function(t){this.shine.alpha=0,this.scene.tweens.add({targets:this.shine,duration:1e3,ease:Phaser.Math.Easing.Cubic.Out,alpha:1,delay:t})},e.prototype.destroy=function(t){this.sound&&this.sound.stop(),n.prototype.destroy.call(this,t)},e}(Phaser.GameObjects.Container);o.LevelFailedScreen=r})(game||(game={}));var game;(function(o){var h;(function(r){r[r.COLLECTED_BLOCKS=1]="COLLECTED_BLOCKS",r[r.GIFT_SCREEN=2]="GIFT_SCREEN",r[r.BOTTOM_PANEL=3]="BOTTOM_PANEL",r[r.TUTORIAL_SCREEN=4]="TUTORIAL_SCREEN",r[r.PAUSE_SCREEN=5]="PAUSE_SCREEN",r[r.FREE_BOOSTERS_SCREEN=6]="FREE_BOOSTERS_SCREEN",r[r.SECOND_CHANCE_SCREEN=7]="SECOND_CHANCE_SCREEN",r[r.COMPLETE_SCREEN=8]="COMPLETE_SCREEN",r[r.COMPLETE_SCREEN_PARTICLES=9]="COMPLETE_SCREEN_PARTICLES",r[r.COMPLETE_SCREEN_CONFETTI=10]="COMPLETE_SCREEN_CONFETTI",r[r.FAILED_SCREEN=11]="FAILED_SCREEN"})(h=o.GameplayGuiDepth||(o.GameplayGuiDepth={}))})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.backShadowOffset=6,i.name="tutorial_text",i.addFox(),i.addBack(),i.addFoxPaws(),i.addCloseButton(),i.addText(t),i.align(),i}return n.prototype.addFox=function(){this.fox=this.scene.add.image(0,0,"gameplay_gui","tutorial/fox"),this.add(this.fox)},n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","tutorial/back"),this.add(this.back)},n.prototype.addFoxPaws=function(){this.foxPaws=this.scene.add.image(0,0,"gameplay_gui","tutorial/fox_paws"),this.add(this.foxPaws)},n.prototype.addText=function(e){var t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"32px",color:"#B72C35",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(this.back.width*.85),this.text.setLineSpacing(-3),this.text.y-=this.backShadowOffset/2,this.add(this.text)},n.prototype.addCloseButton=function(){this.closeButton=this.scene.add.button("gameplay_gui","tutorial/button_close",this)},n.prototype.align=function(){this.fox.x=this.back.left+110,this.fox.y=this.back.top,this.foxPaws.x=this.fox.x,this.foxPaws.y=this.fox.y+6,this.closeButton.x=this.back.right,this.closeButton.y=this.back.top,this.alignText()},n.prototype.alignText=function(){var e=this.back.height*.7;this.text.scale=1,this.text.scale=Math.min(1,e/this.text.height)},n.prototype.show=function(e){var t=this.text.scale;this.text.scale*=.8,this.scene.tweens.add({targets:this.text,scale:{value:t,ease:Phaser.Math.Easing.Back.Out,duration:500},alpha:{start:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:150},delay:e}),this.playWhooshSound()},n.prototype.playWhooshSound=function(){this.scene.cache.audio.has(o.GameSoundKey.WINNING_BALL_WHOOSH)&&this.scene.sound.play(o.GameSoundKey.WINNING_BALL_WHOOSH,{volume:.66,delay:.33})},n.prototype.getWidth=function(){return this.back.width},n.prototype.getHeight=function(){return this.back.height},n}(Phaser.GameObjects.Container);o.TutorialText=h})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ButtonEvent,r;(function(e){e.COMPLETE="tutorial_complete"})(r=o.TutorialEvent||(o.TutorialEvent={}));var n=function(e){__extends(t,e);function t(i,s){var a=e.call(this,i)||this;a.name="tutorial",a.config=s,a.addBackdrop(),a.addWindow(),a.addText();var l=a.scene.game.rendererType===o.RendererType.CANVAS;return l===!1?(a.backdrop.mask=a.window.createGeometryMask(),a.backdrop.mask.invertAlpha=!0):(a.backdrop.kill(),a.window.kill()),a}return t.prototype.addBackdrop=function(){this.backdrop=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.backdrop.alpha=.8,this.add(this.backdrop)},t.prototype.addWindow=function(){this.window=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}});var i=this.config.width,s=this.config.height;this.window.fillRoundedRect(-i/2,-s/2,i,s)},t.prototype.addText=function(){var i=this.scene.texts.tutorial[this.config.textKey];i||(""+this.config.textKey,i=this.config.text),this.popup=new o.TutorialText(this.scene,i),this.popup.closeButton.once(h.PRESS,this.onCloseButtonClick,this),this.add(this.popup)},t.prototype.onCloseButtonClick=function(){this.emit(r.COMPLETE,this),this.hide()},t.prototype.show=function(i){this.showText(i),this.animateWindow()},t.prototype.showText=function(i){var s=250;this.popup.y+=s,this.scene.tweens.add({targets:this.popup,delay:i,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.popup.y-s});var a=this.popup.scale;this.popup.scale*=.8,this.scene.tweens.add({delay:i,targets:this.popup,duration:400,scale:a,ease:Phaser.Math.Easing.Back.Out}),this.popup.alpha=0,this.scene.tweens.add({delay:i,targets:this.popup,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.popup.show(i+150)},t.prototype.animateWindow=function(){if(!this.config.tweenMask)return;this.scene.tweens.add({targets:this.window,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:this.window.scale*this.config.tweenScale,repeat:-1,yoyo:!0})},t.prototype.hide=function(){this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.In,scale:.33}),this.scene.tweens.add({targets:this.popup,duration:500,ease:Phaser.Math.Easing.Back.In,y:"+=250"}),this.scene.tweens.add({targets:this.popup,duration:200,delay:250,ease:Phaser.Math.Easing.Cubic.In,alpha:0,onComplete:this.onHideComplete.bind(this)}),this.scene.tweens.add({targets:this.backdrop,duration:200,delay:300,ease:Phaser.Math.Easing.Cubic.Out,alpha:0})},t.prototype.onHideComplete=function(){this.visible=!1,this.active=!1,this.scene.tweens.killTweensOf(this.window)},t.prototype.resize=function(i){this.resizeBackdrop(),this.resizeWindow(i),this.resizeText(i)},t.prototype.resizeBackdrop=function(){this.backdrop.setDisplaySize(o.Config.GAME_WIDTH+2,o.Config.GAME_HEIGHT+2),this.backdrop.x=o.Config.HALF_GAME_WIDTH,this.backdrop.y=o.Config.HALF_GAME_HEIGHT},t.prototype.resizeWindow=function(i){var s=i.camera,a=s.getPadding();this.window.x=a.x+this.config.x*s.zoom,this.window.y=a.y+this.config.y*s.zoom,this.window.scale=s.zoom},t.prototype.resizeText=function(i){this.popup.scale=i.cameras.main.zoom,this.popup.x=o.Config.HALF_GAME_WIDTH,this.popup.y=o.Config.GAME_HEIGHT-this.popup.getHeight()/2*this.popup.scale-35},t.prototype.destroy=function(i){this.window.destroy(i),e.prototype.destroy.call(this,i)},t}(Phaser.GameObjects.Container);o.TutorialScreen=n})(game||(game={}));var game;(function(o){var h;(function(n){n.SHOW="PauseScreen_SHOW",n.HIDE="PauseScreen_HIDE"})(h=o.PauseScreenEvent||(o.PauseScreenEvent={}));var r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,{backgroundAlpha:.85,backgroundKey:"gameplay_gui",backgroundFrame:"black_rect"})||this;return i.name="pause_screen",i.background.name="pause_screen_back",i.addResumeButton(),i.addOtherButtons(),i.buttons=[i.resumeButton,i.soundButton,i.homeButton,i.restartButton],i.buttonsContainer=i.scene.add.container(0,0,i.buttons),i.buttonsContainer.setName("buttons_container"),i.add(i.buttonsContainer),i.align(),i}return e.prototype.addResumeButton=function(){this.resumeButton=this.scene.add.button("gameplay_gui","pause_screen/button_resume",this.buttonsContainer)},e.prototype.addOtherButtons=function(){this.soundButton=this.scene.add.soundButton("gameplay_gui","pause_screen/button_sound_on","pause_screen/button_sound_off",this.buttonsContainer),this.homeButton=this.scene.add.button("gameplay_gui","pause_screen/button_home",this.buttonsContainer),this.restartButton=this.scene.add.button("gameplay_gui","pause_screen/button_restart",this.buttonsContainer)},e.prototype.align=function(){var t=100,i=175;this.resumeButton.y=-t;var s=t;this.homeButton.y=s,this.soundButton.x=-i,this.soundButton.y=s,this.restartButton.x=i,this.restartButton.y=s},e.prototype.resize=function(){this.background.displayHeight=(o.Config.GAME_HEIGHT+4)/this.scale},e.prototype.show=function(){this.revive(),this.emit(h.SHOW,this),this.alpha=1,this.scene.tweens.add({targets:this.background,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:{from:0,to:this.options.backgroundAlpha}}),this.scene.tweens.add({targets:this.buttons,duration:900,alpha:{start:0,from:0,to:1,ease:Phaser.Math.Easing.Cubic.Out,duration:200},scale:{from:.75,to:1},ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],delay:this.scene.tweens.stagger(80)})},e.prototype.hide=function(){var t=this;this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:function(){t.kill(),t.emit(h.HIDE,t)}})},e}(Phaser.GameObjects.Screen);o.PauseScreen=r})(game||(game={}));var game;(function(o){var h;(function(n){n.MOVE_IN_MIDDLE="CollectedBlock_MOVE_IN_MIDDLE",n.MOVE_COMPLETE="CollectedBlock_MOVE_COMPLETE"})(h=o.CollectedBlockEvent||(o.CollectedBlockEvent={}));var r=function(n){__extends(e,n);function e(t){return n.call(this,t,0,0,"gameplay_gui","blocks/basic_block_01")||this}return e.prototype.updateFrame=function(t){this.setFrame(t.frame.name),this.setOrigin(t.originX,t.originY)},e.prototype.moveTo=function(t,i){var s=this,a=Phaser.Math.Distance.Between(this.x,this.y,t.x,t.y),l=Math.max(350,a/o.Config.ASSETS_SCALE*.8);this.scene.time.delayedCall(l*.75,function(){s.emit(h.MOVE_IN_MIDDLE,s)}),this.scene.tweens.add({targets:this,duration:l,ease:Phaser.Math.Easing.Back.In,easeParams:[1.1],x:t.x,y:t.y,scale:i,onComplete:function(){s.emit(h.MOVE_COMPLETE,s),s.kill()}})},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t)},e}(Phaser.GameObjects.Image);o.CollectedBlock=r})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="fast_forward",t.addLines(),t}return n.prototype.addLines=function(){var e=this,t=4,i=this.getLineFrames();this.lines=_.times(t,function(){var s=Phaser.Math.RND.pick(i),a=e.scene.add.image(0,0,"gameplay_gui",s);return e.add(a),a})},n.prototype.getLineFrames=function(){return[1,2,3].map(function(e){return"fast_forward/fast_forward_line_"+e})},n.prototype.resize=function(){var e=o.Config.GAME_HEIGHT/(this.lines.length+1);this.lines.forEach(function(t,i){t.scale=o.Config.GAME_WIDTH/t.width,t.x=o.Config.HALF_GAME_WIDTH,t.y=e*(i+1),t.setData("originalY",t.y)})},n.prototype.show=function(){this.resize(),this.revive(),this.tweenLines(),this.alpha=0,this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},n.prototype.tweenLines=function(){var e=this;this.lines.forEach(function(t){t.alpha=.66,e.scene.tweens.add({targets:t,delay:Phaser.Math.RND.between(0,150),duration:300,ease:Phaser.Math.Easing.Sine.InOut,alpha:.3,yoyo:!0,repeat:-1}),e.tweenLine(t)})},n.prototype.tweenLine=function(e){var t=this,i=e.getData("originalY")+Phaser.Math.RND.sign()*Phaser.Math.RND.between(0,30),s=i-this.y,a=s/4;this.scene.tweens.add({targets:e,duration:a,ease:Phaser.Math.Easing.Linear.Linear,y:i,onStart:function(){e.scaleX=e.scaleX*Phaser.Math.RND.sign(),e.scaleY=e.scaleY*Phaser.Math.RND.sign()},onComplete:function(){t.tweenLine(e)}})},n.prototype.hide=function(){this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Cubic.In,alpha:0,onComplete:this.onHideComplete.bind(this)})},n.prototype.onHideComplete=function(){this.stopLineTweens(),this.kill()},n.prototype.stopLineTweens=function(){this.scene.tweens.killTweensOf(this.lines)},n}(Phaser.GameObjects.Container);o.FastForwardFx=h})(game||(game={}));var game;(function(o){var h;(function(n){n.MOVE_COMPLETE="GiftedBooster_MOVE_COMPLETE"})(h=o.GiftedBoosterEvent||(o.GiftedBoosterEvent={}));var r=function(n){__extends(e,n);function e(t,i,s,a){var l=n.call(this,t)||this;return l.name="booster_"+s,l.atlasKey=i,l.boosterType=s,l.num=a,l.addIcon(s),l.addText(a),l}return e.prototype.addIcon=function(t){this.icon=this.scene.add.image(0,0,this.atlasKey,this.getIconFrame(t)),this.add(this.icon)},e.prototype.getIconFrame=function(t){return"gift_screen/"+t},e.prototype.addText=function(t){var i="+"+t;this.text=this.scene.add.bitmapText(0,0,o.BitmapGameFont.GAMEPLAY_GUI_BOOSTERS,i,46),this.text.setOrigin(.5,.5),this.text.y=this.icon.bottom+38,this.add(this.text)},e.prototype.updateData=function(t,i){this.icon.setFrame(this.getIconFrame(t)),this.text.setText("+"+i.toString()),this.text.y=this.icon.bottom+38},e.prototype.startFloat=function(t){this.scene.tweens.add({targets:this.list,duration:600,ease:Phaser.Math.Easing.Sine.InOut,y:"-=18",delay:this.scene.tweens.stagger(100,{start:t}),yoyo:!0,repeat:-1})},e.prototype.stopFloat=function(){this.scene.tweens.killTweensOf(this.list),this.icon.y=0,this.text.y=this.icon.bottom+38},e.prototype.moveToIcon=function(t,i){var s=this;this.hideText(i);var a=t.getWorldPosition(),l=this.parentContainer.pointToContainer(a),c=Phaser.Math.Distance.Between(l.x,l.y,this.x,this.y),u=Math.min(450,c*.8);this.scene.tweens.add({targets:this,delay:i,duration:u,ease:Phaser.Math.Easing.Back.In,easeParams:[1.1],x:l.x,y:l.y,scale:.33,onStart:function(){s.scene.tweens.killTweensOf(s.list)},onComplete:function(){s.emit(h.MOVE_COMPLETE,s),s.kill(),t.onGiftArrive(s.num)}});var d=i+u*.6;this.playWhooshSound(d)},e.prototype.hideText=function(t){this.scene.tweens.add({targets:this.text,delay:t,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:0})},e.prototype.playWhooshSound=function(t){this.scene.cache.audio.has(o.GameSoundKey.WINNING_BALL_WHOOSH)&&this.scene.sound.play(o.GameSoundKey.WINNING_BALL_WHOOSH,{volume:.5,delay:t/1e3})},e.prototype.destroy=function(t){this.scene&&this.scene.tweens.killTweensOf([this,this.text,this.icon]),n.prototype.destroy.call(this,t)},e}(Phaser.GameObjects.Container);o.GiftedBooster=r})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r;(function(e){e.BOOSTERS_SHOW_COMPLETE="GiftScreen_BOOSTERS_SHOW_COMPLETE",e.HIDE_COMPLETE="GiftScreen_HIDE_COMPLETE"})(r=o.GiftScreenEvent||(o.GiftScreenEvent={}));var n=function(e){__extends(t,e);function t(i,s,a,l){var c=e.call(this,i)||this;return c.boostersCollected=0,c.autoPlay=!1,c.name="gift_screen",c.atlasKey=s,c.content=a,c.boostersPanel=l,c.addBackground(),c.addBoosters(),c.addGift(),c.addHintText(),c.addParticlesContainer(),c.addGlowParticles(),c.addCircleParticles(),c.bringToTop(c.gift),c.bringToTop(c.giftWhite),c.bringToTop(c.hintText),c}return t.prototype.addBackground=function(){this.backgroundAlpha=.8,this.background=this.scene.add.image(0,0,this.atlasKey,"black_rect"),this.background.alpha=this.backgroundAlpha,this.background.displayWidth=o.Config.SOURCE_GAME_WIDTH,this.background.displayHeight=o.Config.SOURCE_GAME_HEIGHT,this.add(this.background)},t.prototype.addBoosters=function(){var i=this,s=180,a=Object.entries(this.content).map(function(l){return{type:l[0],num:l[1]}}).filter(function(l){return l.num>0});this.boosters=a.map(function(l,c){var u=new o.GiftedBooster(i.scene,i.atlasKey,l.type,l.num);return u.x=c*s-(a.length-1)*s/2,u.y=0,u.kill(),i.add(u),u})},t.prototype.addGift=function(){this.gift=this.scene.add.image(0,0,this.atlasKey,"gift_screen/gift"),this.gift.y=200,this.add(this.gift),this.giftWhite=this.scene.add.image(0,0,this.atlasKey,"gift_screen/gift_white"),this.giftWhite.x=this.gift.x,this.giftWhite.y=this.gift.y+10,this.giftWhite.setOrigin(this.gift.originX,this.gift.originY),this.giftWhite.kill(),this.add(this.giftWhite)},t.prototype.addHintText=function(){var i=this.scene.texts.open_gift,s={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"40px",color:"#ffffff",align:"center"},a=o.Config.SOURCE_GAME_WIDTH*.75;this.hintText=this.scene.add.text(0,0,i,s),this.hintText.setOrigin(.5,.5),this.hintText.y=this.gift.bottom+80,this.hintText.setWordWrapWidth(a,!0),this.add(this.hintText)},t.prototype.addParticlesContainer=function(){this.particlesContainer=this.scene.add.container(0,0),this.particlesContainer.name="particles_container",this.particlesContainer.x=-2,this.particlesContainer.y=this.gift.y-90,this.add(this.particlesContainer)},t.prototype.addGlowParticles=function(){this.glowParticles=this.scene.add.particles("gameplay_gui"),this.giftWell=this.glowParticles.createGravityWell({power:10,epsilon:250,gravity:200});var i=new Phaser.Geom.Circle(0,0,this.giftWhite.displayWidth);this.giftAttractEmitter=this.glowParticles.createEmitter({frame:["gift_screen/gift_particle_1"],lifespan:800,alpha:{start:0,end:1,ease:h.ExpoEaseOut},scale:{start:1.33,end:.33},quantity:2,on:!1}).setDeathZone({source:new Phaser.Geom.Circle(0,0,i.radius*.25),type:"onEnter"}).setEmitZone({source:i,type:"random"}),this.giftExplodeEmitter=this.glowParticles.createEmitter({frame:["gift_screen/gift_particle_1"],lifespan:3e3,speed:{min:10,max:1200},alpha:{start:1,end:0,ease:h.ExpoEaseOut},scale:{start:1.33,end:0},on:!1}),this.particlesContainer.add(this.glowParticles)},t.prototype.addCircleParticles=function(){this.circleParticles=this.scene.add.particles("gameplay_gui"),this.circlesEmitter=this.circleParticles.createEmitter({frame:["gift_screen/circle_fx"],scale:{start:.5,end:1.5,ease:h.ExpoEaseOut},alpha:{start:1,end:0,ease:h.ExpoEaseOut},lifespan:2e3,frequency:500,on:!1}),this.particlesContainer.add(this.circleParticles)},t.prototype.resize=function(){this.background.displayHeight=(o.Config.GAME_HEIGHT+4)/this.scale},t.prototype.show=function(){this.showGift(200),this.showHintText(400)},t.prototype.showGift=function(i){var s=this;this.gift.alpha=0,this.gift.scale=.8,this.scene.tweens.add({delay:i,targets:this.gift,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({delay:i,targets:this.gift,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:1,onComplete:function(){s.onGiftShowComplete()}}),this.scene.time.delayedCall(200,function(){s.circlesEmitter.flow(1e3)}),this.playGiftRevealSound(i)},t.prototype.playGiftRevealSound=function(i){if(this.scene.cache.audio.has(o.GameSoundKey.GIFT_REVEAL)){var s=i/1e3+.2;this.scene.sound.play(o.GameSoundKey.GIFT_REVEAL,{volume:.5,delay:s})}},t.prototype.onGiftShowComplete=function(){var i=this;this.autoPlay?this.scene.time.delayedCall(300,function(){i.onGiftClick()}):(this.gift.setInteractive(),this.gift.input.cursor="pointer",this.gift.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onGiftClick,this)),this.scene.tweens.add({targets:this.gift,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.06,scaleY:.94,yoyo:!0,repeat:-1})},t.prototype.onGiftClick=function(){var i=this;this.hideHintText(),this.playFancyTapSound(),this.playGiftChargeSound(),this.giftAttractEmitter.on=!0,this.circlesEmitter.setLifespan(500),this.circlesEmitter.setAlpha({start:0,end:.33,ease:h.ExpoEaseOut}),this.circlesEmitter.setScale({start:1.66,end:.5,ease:h.Linear}),this.circlesEmitter.flow(333),this.gift.disableInteractive(),this.scene.tweens.killTweensOf(this.gift),this.giftWhite.scaleX=this.gift.scaleX,this.giftWhite.scaleY=this.gift.scaleY,this.giftWhite.alpha=0,this.giftWhite.revive();var s=1333;this.scene.tweens.add({targets:this.giftWhite,duration:s,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.scene.tweens.add({targets:[this.giftWhite,this.gift],duration:s,ease:Phaser.Math.Easing.Linear.Linear,scale:this.gift.scale*.66}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,function(){i.circlesEmitter.killAll(),i.circlesEmitter.setLifespan(900),i.circlesEmitter.setAlpha({start:1,end:0,ease:h.ExpoEaseOut}),i.circlesEmitter.setScale({start:.5,end:3,ease:h.ExpoEaseOut}),i.circlesEmitter.explode(1,0,0),i.stopChargeSound(),i.disableAttractEmitter(),i.emitExplosionParticles(),i.explodeGift(),i.showBoosters()}),this.scene.tweens.add({targets:[this.giftWhite,this.gift],duration:33,ease:Phaser.Math.Easing.Sine.InOut,x:"-=14",repeat:-1,yoyo:!0})},t.prototype.playFancyTapSound=function(){this.scene.cache.audio.has(o.GameSoundKey.FANCY_TAP)&&this.scene.sound.play(o.GameSoundKey.FANCY_TAP,{volume:1})},t.prototype.playGiftChargeSound=function(){this.scene.cache.audio.has(o.GameSoundKey.GIFT_CHARGE)&&(this.chargeSound=this.scene.sound.add(o.GameSoundKey.GIFT_CHARGE,{volume:.5}),this.chargeSound.play())},t.prototype.stopChargeSound=function(){this.chargeSound&&this.chargeSound.stop()},t.prototype.disableAttractEmitter=function(){this.giftWell.active=!1,this.giftAttractEmitter.active=!1,this.giftAttractEmitter.on=!1,this.giftAttractEmitter.killAll()},t.prototype.emitExplosionParticles=function(){this.giftExplodeEmitter.setEmitZone({source:new Phaser.Geom.Circle(0,0,100),type:"random"}),this.giftExplodeEmitter.explode(100,this.giftWell.x,this.giftWell.y-100)},t.prototype.explodeGift=function(){var i=this;this.gift.kill(),this.playGiftExplodeSound(),this.scene.tweens.killTweensOf([this.gift,this.giftWhite]);var s=.7;this.giftWhite.y-=(this.giftWhite.originY-s)*this.giftWhite.displayHeight,this.giftWhite.setOrigin(.5,s),this.scene.tweens.add({targets:this.giftWhite,duration:200,ease:Phaser.Math.Easing.Linear.Linear,scale:3}),this.scene.tweens.add({targets:this.giftWhite,duration:500,ease:Phaser.Math.Easing.Quintic.Out,alpha:0,onComplete:function(){i.giftWhite.kill()}})},t.prototype.playGiftExplodeSound=function(){this.scene.cache.audio.has(o.GameSoundKey.GIFT_EXPLODE)&&this.scene.sound.play(o.GameSoundKey.GIFT_EXPLODE,{volume:1})},t.prototype.showBoosters=function(){var i=this;this.boosters.forEach(function(s,a){var l=s.x,c=s.y;s.revive(),s.startFloat(a*150),s.x=i.giftWhite.x,s.y=i.giftWhite.y,s.scale=.25,s.alpha=0,i.scene.tweens.add({targets:s,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),i.scene.tweens.add({targets:s,duration:1e3,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],scale:1}),i.scene.tweens.add({targets:s,duration:1200,ease:Phaser.Math.Easing.Elastic.Out,easeParams:[.1,.4],x:l,y:c})}),this.scene.time.delayedCall(600,function(){i.onBoostersShowComplete()})},t.prototype.onBoostersShowComplete=function(){var i=this;this.emit(r.BOOSTERS_SHOW_COMPLETE,this),this.autoPlay?this.scene.time.delayedCall(200,function(){i.onBoostersClick()}):(this.background.setInteractive(),this.background.once(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN,this.onBoostersClick,this))},t.prototype.onBoostersClick=function(){this.background.disableInteractive(),this.playFancyTapSound(),this.collectBoosters()},t.prototype.collectBoosters=function(){var i=this;this.boostersCollected=0,this.boosters.forEach(function(s,a){var l=a*133,c=i.boostersPanel.getIconByType(s.boosterType);s.on(o.GiftedBoosterEvent.MOVE_COMPLETE,i.onBoosterCollectComplete,i),s.moveToIcon(c,l)})},t.prototype.onBoosterCollectComplete=function(){if(++this.boostersCollected<this.boosters.length)return;this.onAllBoostersCollected()},t.prototype.onAllBoostersCollected=function(){this.hide()},t.prototype.hide=function(){var i=this;this.scene.tweens.add({targets:this,duration:300,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){i.emit(r.HIDE_COMPLETE,i),i.destroy()}})},t.prototype.showHintText=function(i){this.hintText.alpha=0,this.scene.tweens.add({targets:this.hintText,delay:i,duration:600,ease:Phaser.Math.Easing.Quadratic.Out,alpha:1}),this.scene.tweens.add({targets:this.hintText,duration:600,ease:Phaser.Math.Easing.Sine.InOut,scale:1.14,yoyo:!0,repeat:-1})},t.prototype.hideHintText=function(){var i=this;this.scene.tweens.killTweensOf(this.hintText),this.scene.tweens.add({targets:this.hintText,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,y:"+=15",onComplete:function(){i.hintText.kill()}})},t.prototype.destroy=function(i){this.circleParticles.destroy(i),this.glowParticles.destroy(i),this.chargeSound&&this.chargeSound.destroy(),e.prototype.destroy.call(this,i)},t}(Phaser.GameObjects.Container);o.GiftScreen=n})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.originalY=0,t.name="booster_info_popover",t.booster=t.scene.game.boosters.getRandom(),t.addBack(),t.addTip(),t.addText(),t.alignItems(),t}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,"gameplay_gui","booster_hint_screen/booster_info_popover"),this.back.setOrigin(.5,1),this.add(this.back)},n.prototype.addTip=function(){this.tip=this.scene.add.image(0,0,"gameplay_gui","booster_hint_screen/booster_info_popover_tip"),this.tip.setOrigin(.5,0),this.tip.y=this.back.y-10,this.add(this.tip)},n.prototype.addText=function(){var e=this.booster.hint,t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"24px",color:"#205466",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setOrigin(.5,.5),this.text.setWordWrapWidth(this.back.width*.8),this.text.lineSpacing=-3,this.text.y=-this.back.height/2,this.add(this.text)},n.prototype.updateText=function(e){this.text.setText(e),this.adjustTextSize()},n.prototype.adjustTextSize=function(){var e=this.back.height*.8;this.text.scale=Math.min(1,e/this.text.height)},n.prototype.alignItems=function(){var e=this;this.list.forEach(function(t){t.y-=e.tip.height})},n.prototype.getWidth=function(){return this.back.width},n.prototype.offsetTip=function(e){this.tip.x=-e/this.scale},n}(Phaser.GameObjects.Container);o.BoosterInfoPopover=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;i.backgroundAlpha=.85,i.name="booster_hint_screen",i.bottomPanel=t,i.boostersPanel=t.boostersPanel,i.addWindow(),i.addBackground(),i.addPopover(),i.addHintText();var s=i.scene.game.rendererType===o.RendererType.CANVAS;return s&&(i.background.kill(),i.window.kill(),i.hintText.setStroke("rgba(0,0,0,0.66)",10)),i}return n.prototype.addWindow=function(){this.window=this.scene.make.graphics({fillStyle:{color:16711680,alpha:1}});var e=100,t=100;this.window.fillRoundedRect(-e/2,-t/2,e,t)},n.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,"gameplay_gui","black_rect"),this.background.alpha=this.backgroundAlpha,this.background.mask=this.window.createGeometryMask(),this.background.mask.invertAlpha=!0,this.background.name="booster_hint_screen_back",this.add(this.background)},n.prototype.addPopover=function(){this.popover=new o.BoosterInfoPopover(this.scene),this.add(this.popover)},n.prototype.addHintText=function(){var e=this.scene.texts.booster_hint,t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"33px",color:"#ffffff",align:"center"};this.hintText=this.scene.add.text(0,0,e,t),this.hintText.setOrigin(.5,.5),this.hintText.setLineSpacing(-6),this.add(this.hintText)},n.prototype.resize=function(e){this.resizeBackground(),this.resizeWindow(e),this.alignWindow(e),this.alignPopover(),this.alignHintText()},n.prototype.resizeBackground=function(){this.background.displayWidth=o.Config.GAME_WIDTH+4,this.background.displayHeight=o.Config.GAME_HEIGHT+4,this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.HALF_GAME_HEIGHT},n.prototype.resizeWindow=function(e){var t=30,i=e.grid.getWidth()+t,s=e.grid.getHeight()+t;this.window.fillRoundedRect(-i/2,-s/2,i,s),this.window.width=i,this.window.height=s},n.prototype.alignWindow=function(e){var t=e.camera,i=t.getPadding();this.window.x=i.x+t.zoom*e.grid.getWidth()/2,this.window.y=i.y+t.zoom*e.grid.getHeight()/2,this.window.scale=t.zoom},n.prototype.alignPopover=function(){var e=this.bottomPanel.scale,t=this.boostersPanel.getIconByType(this.popover.booster.type),i=t.getWorldPosition();this.popover.scale=e,this.popover.y=i.y-65*e,this.popover.originalY=this.popover.y;var s=o.Config.GAME_WIDTH-20*e,a=s-(this.popover.getWidth()-20)*e/2;i.x>a?(this.popover.x=a,this.popover.offsetTip(a-i.x)):(this.popover.x=i.x,this.popover.offsetTip(0))},n.prototype.alignHintText=function(){var e=0,t=this.window.y-this.window.height*this.window.scale/2,i=t-e,s=i*.6,a=this.window.width*this.window.scale*.85;this.hintText.x=o.Config.HALF_GAME_WIDTH,this.hintText.y=e+i/2,this.hintText.setWordWrapWidth(a),this.hintText.scale=Math.min(1,s/this.hintText.height),this.hintText.originalY=this.hintText.y,this.hintText.originalScale=this.hintText.scale},n.prototype.updateData=function(e){this.updatePopover(e)},n.prototype.updatePopover=function(e){this.popover.booster=e,this.popover.updateText(e.hint),this.alignPopover()},n.prototype.show=function(){this.revive(),this.alpha=1,this.showBackground(0),this.showPopover(0),this.showText(200)},n.prototype.showBackground=function(e){this.background.alpha=0,this.scene.tweens.add({targets:this.background,duration:200,ease:Phaser.Math.Easing.Linear.Linear,alpha:this.backgroundAlpha})},n.prototype.showPopover=function(e){this.popover.revive(),this.popover.alpha=0,this.popover.y=this.popover.originalY-20,this.scene.tweens.add({delay:e,targets:this.popover,duration:150,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({delay:e,targets:this.popover,duration:400,ease:Phaser.Math.Easing.Back.Out,y:this.popover.originalY})},n.prototype.showText=function(e){var t=this;this.hintText.alpha=0,this.hintText.scale=this.hintText.originalScale*.8,this.hintText.y=this.hintText.originalY-30,this.scene.tweens.add({delay:e,targets:this.hintText,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:1}),this.scene.tweens.add({delay:e,targets:this.hintText,duration:500,ease:Phaser.Math.Easing.Back.Out,y:this.hintText.originalY}),this.scene.tweens.add({delay:e,targets:this.hintText,duration:400,ease:Phaser.Math.Easing.Back.Out,scale:this.hintText.originalScale,onComplete:function(){t.scene.tweens.add({targets:t.hintText,duration:666,ease:Phaser.Math.Easing.Sine.InOut,scale:t.hintText.originalScale*.9,yoyo:!0,repeat:-1})}})},n.prototype.hide=function(){var e=this;this.popover.kill(),this.scene.tweens.killTweensOf(this.hintText),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){e.kill()}})},n.prototype.destroy=function(e){this.window.destroy(e),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Container);o.BoosterHintScreen=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t,i){return r.call(this,e,0,0,t,i)||this}return n.prototype.show=function(e){var t=this;this.revive(),this.scene.tweens.killTweensOf(this),this.alpha=0,this.scene.tweens.add({targets:this,duration:e.fadeInDuration,ease:Phaser.Math.Easing.Linear.Linear,alpha:e.targetAlpha,onComplete:function(){t.scene.tweens.add({targets:t,duration:e.fadeOutDuration,ease:Phaser.Math.Easing.Quadratic.In,alpha:0,onComplete:function(){t.kill()}})}})},n.prototype.resize=function(){this.displayWidth=o.Config.GAME_WIDTH+4,this.displayHeight=o.Config.GAME_HEIGHT+4,this.x=o.Config.HALF_GAME_WIDTH,this.y=o.Config.HALF_GAME_HEIGHT},n.prototype.destroy=function(e){r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Image);o.Flash=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e,t){var i=r.call(this,e)||this;return i.name="popup",i.atlas=t,i.addBack(),i.addFox(),i.addTitle(),i.addSubtitle(),i.addBlocksLabel(),i.alignBlocksLabel(),i.sendToBack(i.fox),i.bringToTop(i.title),i.bringToTop(i.subtitle),i}return n.prototype.addBack=function(){this.back=this.scene.add.image(0,0,this.atlas,"second_chance/popup_back"),this.add(this.back)},n.prototype.addFox=function(){this.fox=this.scene.add.image(0,0,this.atlas,"second_chance/fox"),this.fox.x=-3,this.fox.y=this.back.top-10,this.add(this.fox),this.foxPaws=this.scene.add.image(0,0,this.atlas,"second_chance/fox_paws"),this.foxPaws.x=this.fox.x+4,this.foxPaws.y=this.fox.y+19,this.add(this.foxPaws),this.foxBubble=this.scene.add.image(0,0,this.atlas,"second_chance/fox_bubble"),this.foxBubble.x=this.fox.x-100,this.foxBubble.y=this.fox.y-116,this.add(this.foxBubble)},n.prototype.addTitle=function(){var e=this.scene.texts.second_chance.title,t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"44px",color:"#B62D35"};this.title=this.scene.add.text(0,0,e,t),this.title.setOrigin(.5,.5),this.title.y=this.back.top+this.title.height/2+20,this.add(this.title)},n.prototype.addBlocksLabel=function(){var e={backFrame:"level_complete/blocks_label_back",iconFrame:"level_complete/tick",textColor:12202809};this.blocksLabel=new o.ComplexBlocksLabel(this.scene,e),this.blocksLabel.tick.kill(),this.add(this.blocksLabel)},n.prototype.addSubtitle=function(){var e=this.getSubtitleContent(),t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"32px",color:"#B62D35",align:"center"};this.subtitle=this.scene.add.text(0,0,e,t),this.subtitle.setOrigin(.5,.5),this.subtitle.setWordWrapWidth(this.back.width*.85),this.subtitle.setLineSpacing(-6),this.subtitle.bottom=this.back.bottom-28,this.add(this.subtitle)},n.prototype.getSubtitleContent=function(){return this.scene.texts.second_chance.subtitle.replace("#",o.SecondChance.ROWS.toString())},n.prototype.alignBlocksLabel=function(){var e=this.title.bottom,t=this.subtitle.top,i=t-e,s=i*.9;this.blocksLabel.scale=Math.min(1,s/this.blocksLabel.getHeight()),this.blocksLabel.y=e+i/2-this.blocksLabel.getDisplayHeight()/2},n.prototype.updateData=function(e,t,i,s){this.blocksLabel.updateData(t,i,s),this.subtitle.text=e===1?this.scene.texts.start_level_popup.task.replace("#",s.toString()):this.scene.texts.second_chance.subtitle.replace("#",o.SecondChance.ROWS.toString())},n.prototype.getHeight=function(){return this.back.height},n}(Phaser.GameObjects.Container);o.SecondChancePopup=h})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.Screen,r=Phaser.Math.EasingString,n;(function(t){t.HIDE_START="SecondChanceScreen_HIDE_START",t.HIDE_COMPLETE="SecondChanceScreen_HIDE_COMPLETE"})(n=o.SecondChanceScreenEvent||(o.SecondChanceScreenEvent={}));var e=function(t){__extends(i,t);function i(s,a){var l=t.call(this,s,{backgroundKey:a,backgroundFrame:"black_rect",backgroundAlpha:.85})||this;return l.name="second_chance",l.atlas=a,l.background.name="second_chance_screen_back",l.addPopup(),l.addCloseButton(),l.addPlayButton(),l.bringToTop(l.popup),l}return i.prototype.addPopup=function(){this.popup=new o.SecondChancePopup(this.scene,this.atlas),this.add(this.popup)},i.prototype.addCloseButton=function(){this.closeButton=this.scene.add.button(this.atlas,"second_chance/button_close",this)},i.prototype.addPlayButton=function(){this.playButton=this.scene.add.button(this.atlas,"second_chance/button_video",this),this.playButton.y=this.popup.y+this.popup.getHeight()/2+this.playButton.height/2+50,this.playButton.areTweensEnabled=!1},i.prototype.resize=function(){this.background.displayHeight=(o.Config.GAME_HEIGHT+4)/this.scale,this.alignPlayButton(),this.alignCloseButton()},i.prototype.alignPlayButton=function(){var s=this.popup.y+this.popup.getHeight()/2,a=this.background.displayHeight/2,l=a-s;this.playButton.y=s+l/2},i.prototype.alignCloseButton=function(){var s=70;this.closeButton.x=o.Config.SOURCE_GAME_WIDTH/2-s,this.closeButton.y=-this.background.displayHeight/2+s},i.prototype.updateData=function(s,a,l,c){this.popup.updateData(s,a,l,c)},i.prototype.show=function(){var s=this;this.alpha=1;var a=[this.popup,this.playButton,this.popup.foxBubble,this.closeButton];a.forEach(function(l){l.alpha=0,l.scale=.8}),this.scene.tweens.add({targets:a,alpha:{value:1,duration:200,ease:r.Cubic},scale:{value:1,duration:500,ease:r.Back},delay:this.scene.tweens.stagger(100)}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,function(){s.animatePlayButton()}),this.playRevealSound()},i.prototype.animatePlayButton=function(){this.animatePlayButtonEvent=this.scene.time.addEvent({repeat:-1,startAt:2999,delay:3e3,callback:this.shakePlayButton,callbackScope:this})},i.prototype.shakePlayButton=function(){this.scene.tweens.add({targets:this.playButton,duration:266,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.1,scaleY:1.1,repeat:2,yoyo:!0})},i.prototype.playRevealSound=function(){this.scene.cache.audio.has(o.GameSoundKey.GIFT_REVEAL)&&this.scene.sound.play(o.GameSoundKey.GIFT_REVEAL,{volume:.66})},i.prototype.hide=function(){var s=this;this.animatePlayButtonEvent&&(this.animatePlayButtonEvent.remove(),this.animatePlayButtonEvent=null),this.scene.tweens.killTweensOf(this.playButton),this.scene.tweens.add({targets:this,duration:150,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onStart:function(){s.emit(n.HIDE_START,s),s.scene.game.toasts.dismissAll()},onComplete:function(){s.emit(n.HIDE_COMPLETE,s),s.destroy()}})},i.prototype.shakeCloseButton=function(){this.closeButton.scale=1,this.scene.tweens.killTweensOf(this.closeButton),this.scene.tweens.add({targets:this.closeButton,duration:200,ease:Phaser.Math.Easing.Sine.InOut,scale:1.25,yoyo:!0,repeat:1})},i}(h);o.SecondChanceScreen=e})(game||(game={}));var game;(function(o){var h=Phaser.Math.EasingString,r;(function(e){e.HIDE_START="FreeBoostersScreen_HIDE_START",e.HIDE_COMPLETE="FreeBoostersScreen_HIDE_COMPLETE"})(r=o.FreeBoostersScreenEvent||(o.FreeBoostersScreenEvent={}));var n=function(e){__extends(t,e);function t(i){var s=e.call(this,i,{backgroundKey:"gameplay_gui",backgroundFrame:"black_rect",backgroundAlpha:.85})||this;return s.name="free_booster_screen",s.addBoosters(),s.addTitle(),s.addPlayButton(),s.addCloseButton(),s.bringToTop(s.title),s}return t.prototype.addBoosters=function(){this.boosters=new o.GiftedBooster(this.scene,"gameplay_gui",o.BoosterType.BOMB,1),this.boosters.y=-30,this.add(this.boosters)},t.prototype.addTitle=function(){var i=this.scene.texts.free_boosters,s={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"45px",color:"#ffffff",align:"center"};this.title=this.scene.add.text(0,0,i,s),this.title.setOrigin(.5,1),this.title.setWordWrapWidth(o.Config.SOURCE_GAME_WIDTH*.66),this.title.y=this.boosters.y-160,this.add(this.title)},t.prototype.addPlayButton=function(){this.playButton=this.scene.add.button("gameplay_gui","boosters/button_video",this),this.playButton.top=this.boosters.y+205,this.playButton.areTweensEnabled=!1},t.prototype.addCloseButton=function(){this.closeButton=this.scene.add.button("gameplay_gui","second_chance/button_close",this)},t.prototype.resize=function(){this.background.displayHeight=(o.Config.GAME_HEIGHT+4)/this.scale,this.alignCloseButton()},t.prototype.alignCloseButton=function(){var i=70;this.closeButton.x=o.Config.SOURCE_GAME_WIDTH/2-i,this.closeButton.y=-this.background.displayHeight/2+i},t.prototype.updateData=function(i,s){this.boosters.updateData(i,s),this.currentBooster=i},t.prototype.show=function(){this.alpha=1,this.playButton.scale=1,this.boosters.startFloat(0),this.showContent()},t.prototype.showContent=function(){var i=[this.title,this.boosters,this.playButton,this.closeButton];i.forEach(function(s){s.alpha=0,s.scale=.8}),this.scene.tweens.add({targets:i,alpha:{value:1,duration:200,ease:h.Cubic},scale:{value:1,duration:400,ease:h.Back}}).on(Phaser.Tweens.Events.TIMELINE_COMPLETE,this.onShowComplete,this)},t.prototype.onShowComplete=function(){this.animatePlayButton()},t.prototype.animatePlayButton=function(){this.animatePlayButtonEvent=this.scene.time.addEvent({repeat:-1,startAt:2999,delay:3e3,callback:this.shakePlayButton,callbackScope:this})},t.prototype.shakePlayButton=function(){this.scene.tweens.add({targets:this.playButton,duration:266,ease:Phaser.Math.Easing.Sine.InOut,scaleX:1.1,scaleY:1.1,repeat:2,yoyo:!0})},t.prototype.hide=function(){var i=this;this.emit(r.HIDE_START,this),this.animatePlayButtonEvent&&(this.animatePlayButtonEvent.remove(),this.animatePlayButtonEvent=null),this.scene.tweens.add({targets:this,duration:100,ease:Phaser.Math.Easing.Linear.Linear,alpha:0,onComplete:function(){i.boosters.stopFloat(),i.scene.game.toasts.dismissAll(),i.emit(r.HIDE_COMPLETE,i),i.kill()}})},t}(Phaser.GameObjects.Screen);o.FreeBoostersScreen=n})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ButtonEvent,r;(function(e){e.PAUSE="GUI_PAUSE",e.RESUME="GUI_RESUME",e.GOTO_LEVEL="GOTO_LEVEL",e.GOTO_LEVELS_MAP="GOTO_LEVELS_MAP"})(r=o.GameplayGuiEvent||(o.GameplayGuiEvent={}));var n=function(e){__extends(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return Object.defineProperty(t.prototype,"boostersPanel",{get:function(){return this.bottomPanel.boostersPanel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pauseButton",{get:function(){return this.bottomPanel.pauseButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fastForwardButton",{get:function(){return this.bottomPanel.fastForwardButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dropBallsButton",{get:function(){return this.bottomPanel.dropBallsButton},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"blocksLabel",{get:function(){return this.topPanel.mainLabel.blocksLabel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pointsLabel",{get:function(){return this.topPanel.pointsLabel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ballsLabel",{get:function(){return this.topPanel.mainLabel.ballsLabel},enumerable:!1,configurable:!0}),t.prototype.init=function(i){e.prototype.init.call(this),this.levelConfig=i.levelConfig,this.gameField=i.gameplay,this.tutorial=null,this.giftScreen=null},t.prototype.create=function(){this.addFlash(),this.addTopPanel(),this.addBottomPanel(),this.addFastForwardPopover(),this.addCollectedBlocks(),this.addFastForward(),this.addGiftScreen(),this.addTutorial(),this.addBoosterHintScreen(),this.addFreeBoostersScreen(),this.addSecondChanceScreen(),this.addPauseScreen(),this.addCompleteScreen(),this.addFailedScreen(),this.addKeyboardCallbacks(),this.cameras.main.visible=!utils.NetUtil.getParamBool("hideGui")},t.prototype.addFlash=function(){this.flash=new o.Flash(this,"gameplay_gui","white_rect"),this.flash.kill(),this.add.existing(this.flash)},t.prototype.addTopPanel=function(){this.topPanel=new o.TopPanel(this,this.levelConfig)},t.prototype.addBottomPanel=function(){this.bottomPanel=new o.BottomPanel(this),this.bottomPanel.setDepth(o.GameplayGuiDepth.BOTTOM_PANEL),this.bottomPanel.pauseButton.on(h.PRESS,this.onPauseButtonClick,this)},t.prototype.onPauseButtonClick=function(){this.events.emit(r.PAUSE,this)},t.prototype.addFastForwardPopover=function(){var i=this.game.store.getBoolean(o.GameStoreKey.FAST_FORWARD_WAS_USED);if(i)return;this.fastForwardPopover=new o.FastForwardPopover(this,this.gameField),this.fastForwardPopover.on(o.FastForwardPopoverEvent.SHOW,this.alignFastForwardPopover,this),this.fastForwardPopover.kill(),this.add.existing(this.fastForwardPopover)},t.prototype.addCollectedBlocks=function(){var i=this;this.collectedBlocks=this.add.group({classType:o.CollectedBlock,createCallback:function(a){a.kill(),a.setDepth(o.GameplayGuiDepth.COLLECTED_BLOCKS)}});var s=5;_.times(s,function(){i.collectedBlocks.create()})},t.prototype.addFastForward=function(){this.fastForward=new o.FastForwardFx(this),this.fastForward.kill(),this.add.existing(this.fastForward)},t.prototype.addCompleteScreen=function(){this.completeScreen=new o.LevelCompleteScreen(this),this.completeScreen.buttons.restartButton.once(h.PRESS,this.onRestartButtonClick,this),this.completeScreen.buttons.nextLevelButton.once(h.PRESS,this.onNextLevelButtonClick,this),this.completeScreen.buttons.homeButton.once(h.PRESS,this.onMenuButtonClick,this),this.completeScreen.kill(),this.completeScreen.setDepth(o.GameplayGuiDepth.COMPLETE_SCREEN),this.add.existing(this.completeScreen)},t.prototype.addFailedScreen=function(){this.failedScreen=new o.LevelFailedScreen(this),this.failedScreen.restartButton.once(Phaser.GameObjects.ButtonEvent.PRESS,this.onRestartButtonClick,this),this.failedScreen.homeButton.once(Phaser.GameObjects.ButtonEvent.PRESS,this.onMenuButtonClick,this),this.failedScreen.setDepth(o.GameplayGuiDepth.FAILED_SCREEN),this.failedScreen.kill(),this.add.existing(this.failedScreen)},t.prototype.onRestartButtonClick=function(){var i=this;this.poki.commercialBreak("Restart").catch(function(){}).finally(function(){i.gotoLevel(i.levelConfig.levelNumber)})},t.prototype.onNextLevelButtonClick=function(){var i=this;this.poki.commercialBreak("NextLevelButton").catch(function(){}).finally(function(){var s=i.levelConfig.levelNumber+1,a=i.game.levelConfigs.check(s);a===!1&&i.gotoLevelsMap(),i.gotoLevel(s)})},t.prototype.onMenuButtonClick=function(){this.gotoLevelsMap()},t.prototype.gotoLevelsMap=function(){this.events.emit(r.GOTO_LEVELS_MAP)},t.prototype.gotoLevel=function(i){this.events.emit(r.GOTO_LEVEL,i)},t.prototype.addGiftScreen=function(){if(!this.levelConfig.gift)return;var i=Object.values(this.levelConfig.gift).some(function(c){return c>0});if(i===!1)return;var s=this.game.store.getValue(o.GameStoreKey.LEVEL_GIFTS),a=s[this.levelConfig.levelNumber]===!0;if(a)return;var l=utils.NetUtil.getParamBool("skipGifts");if(l)return;this.giftScreen=new o.GiftScreen(this,"gameplay_gui",this.levelConfig.gift,this.bottomPanel.boostersPanel),this.giftScreen.on(o.GiftScreenEvent.BOOSTERS_SHOW_COMPLETE,this.onGiftBoostersShowComplete,this),this.giftScreen.on(o.GiftScreenEvent.HIDE_COMPLETE,this.onGiftScreenHideComplete,this),this.giftScreen.setDepth(o.GameplayGuiDepth.GIFT_SCREEN),this.add.existing(this.giftScreen),this.giftScreen.autoPlay=utils.NetUtil.getParamBool("giftAutoPlay"),this.giftScreen.show(),this.onGiftScreenShow()},t.prototype.onGiftScreenShow=function(){var i=this;this.time.delayedCall(100,function(){i.gameField.scene.pause(),i.gameField.removePointerCallbacks()}),this.bottomPanel.disableInput(),this.bottomPanel.kill()},t.prototype.onGiftBoostersShowComplete=function(){this.bottomPanel.revive(),this.bottomPanel.pauseButton.visible=!1,this.boostersPanel.alpha=0,this.tweens.add({targets:this.boostersPanel,duration:266,ease:Phaser.Math.Easing.Cubic.Out,alpha:1})},t.prototype.onGiftScreenHideComplete=function(i){this.saveGifts(i.content),this.gameField.scene.resume(),this.gameField.addPointerCallbacks(),this.bottomPanel.enableInput(),this.bottomPanel.pauseButton.visible=!0},t.prototype.saveGifts=function(i){var s;this.game.boosters.updateFromGift(i);var a=this.game.store.getValue(o.GameStoreKey.LEVEL_GIFTS),l=__assign(__assign({},a),(s={},s[this.levelConfig.levelNumber]=!0,s));this.game.store.saveValue(o.GameStoreKey.LEVEL_GIFTS,l)},t.prototype.addTutorial=function(){if(!this.levelConfig.tutorial)return;var i=utils.NetUtil.getParamBool("skipTutorial");if(i)return;this.tutorial=new o.TutorialScreen(this,this.levelConfig.tutorial),this.tutorial.setDepth(o.GameplayGuiDepth.TUTORIAL_SCREEN),this.add.existing(this.tutorial)},t.prototype.showTutorial=function(){this.onTutorialStart(),this.tutorial.once(o.TutorialEvent.COMPLETE,this.onTutorialComplete,this),this.tutorial.show(400)},t.prototype.onTutorialStart=function(){this.gameField.removePointerCallbacks(),this.bottomPanel.kill()},t.prototype.onTutorialComplete=function(){this.gameField.addPointerCallbacks(),this.bottomPanel.revive()},t.prototype.addBoosterHintScreen=function(){this.boosterHintScreen=new o.BoosterHintScreen(this,this.bottomPanel),this.boosterHintScreen.kill(),this.add.existing(this.boosterHintScreen)},t.prototype.addFreeBoostersScreen=function(){if(o.Main.areRewardAdsEnabled===!1)return;this.freeBoostersScreen=new o.FreeBoostersScreen(this),this.freeBoostersScreen.kill(),this.freeBoostersScreen.setDepth(o.GameplayGuiDepth.FREE_BOOSTERS_SCREEN),this.add.existing(this.freeBoostersScreen)},t.prototype.addSecondChanceScreen=function(){if(o.Main.areRewardAdsEnabled===!1)return;this.secondChanceScreen=new o.SecondChanceScreen(this,"gameplay_gui"),this.secondChanceScreen.kill(),this.secondChanceScreen.setDepth(o.GameplayGuiDepth.SECOND_CHANCE_SCREEN),this.add.existing(this.secondChanceScreen)},t.prototype.addPauseScreen=function(){this.pauseScreen=new o.PauseScreen(this),this.pauseScreen.kill(),this.pauseScreen.setDepth(o.GameplayGuiDepth.PAUSE_SCREEN),this.pauseScreen.resumeButton.on(h.PRESS,this.onResumeButtonClick,this),this.pauseScreen.restartButton.once(h.PRESS,this.onRestartButtonClick,this),this.pauseScreen.homeButton.once(h.PRESS,this.gotoLevelsMap,this),this.add.existing(this.pauseScreen)},t.prototype.onResumeButtonClick=function(){this.events.emit(r.RESUME,this)},t.prototype.addKeyboardCallbacks=function(){},t.prototype.resizeTutorial=function(i){this.tutorial&&this.tutorial.resize(i)},t.prototype.doResize=function(){this.flash.resize(),this.alignTopPanel(),this.alignBottomPanel(),this.alignFastForwardPopover(),this.resizeGiftScreen(),this.resizeSecondChanceScreen(),this.resizeFreeBoostersScreen(),this.fastForward.resize(),this.completeScreen.resize(),this.failedScreen.resize(),this.resizePauseScreen()},t.prototype.resizePauseScreen=function(){this.pauseScreen.scale=(o.Config.GAME_WIDTH+4)/o.Config.SOURCE_GAME_WIDTH,this.pauseScreen.x=o.Config.HALF_GAME_WIDTH,this.pauseScreen.y=o.Config.HALF_GAME_HEIGHT,this.pauseScreen.resize()},t.prototype.alignTopPanel=function(){var i=o.Config.GAME_WIDTH*.5,s=o.Config.GAME_WIDTH-14,a=.6,l=1,c=Phaser.Math.MapLinear(o.Config.ASPECT_RATIO,l,a,i,s);c=Phaser.Math.Clamp(c,i,s),this.topPanel.scale=c/this.topPanel.getWidth(),this.topPanel.x=o.Config.HALF_GAME_WIDTH,this.topPanel.y=0,this.topPanel.originalY=this.topPanel.y},t.prototype.alignBottomPanel=function(){this.bottomPanel.scale=this.topPanel.scale,this.bottomPanel.x=o.Config.HALF_GAME_WIDTH,this.bottomPanel.y=o.Config.GAME_HEIGHT-this.bottomPanel.getVeticalOffset()*this.bottomPanel.scale},t.prototype.alignFastForwardPopover=function(){if(!this.fastForwardPopover)return;var i=this.bottomPanel.scale,s=this.bottomPanel.fastForwardButton,a=s.getWorldPosition();this.fastForwardPopover.scale=i,this.fastForwardPopover.y=a.y-s.height/2*i,this.fastForwardPopover.originalY=this.fastForwardPopover.y;var l=o.Config.GAME_WIDTH-20*i,c=l-(this.fastForwardPopover.getWidth()-20)*i/2;a.x>c?(this.fastForwardPopover.x=c,this.fastForwardPopover.offsetTip(c-a.x)):(this.fastForwardPopover.x=a.x,this.fastForwardPopover.offsetTip(0))},t.prototype.resizeGiftScreen=function(){if(!this.giftScreen)return;this.giftScreen.scale=(o.Config.GAME_WIDTH+4)/o.Config.SOURCE_GAME_WIDTH,this.giftScreen.x=o.Config.HALF_GAME_WIDTH,this.giftScreen.y=o.Config.HALF_GAME_HEIGHT,this.giftScreen.resize()},t.prototype.resizeSecondChanceScreen=function(){if(!this.secondChanceScreen)return;this.secondChanceScreen.scale=(o.Config.GAME_WIDTH+4)/o.Config.SOURCE_GAME_WIDTH,this.secondChanceScreen.x=o.Config.HALF_GAME_WIDTH,this.secondChanceScreen.y=o.Config.HALF_GAME_HEIGHT,this.secondChanceScreen.resize()},t.prototype.resizeFreeBoostersScreen=function(){if(!this.freeBoostersScreen)return;this.freeBoostersScreen.scale=(o.Config.GAME_WIDTH+4)/o.Config.SOURCE_GAME_WIDTH,this.freeBoostersScreen.x=o.Config.HALF_GAME_WIDTH,this.freeBoostersScreen.y=o.Config.HALF_GAME_HEIGHT,this.freeBoostersScreen.resize()},t.prototype.resizeBoosterHintScreen=function(i){this.boosterHintScreen.resize(i)},t.prototype.onTurnStart=function(){this.hideBoostersPanel(),this.bottomPanel.showTurnButtons()},t.prototype.showBoostersPanel=function(){this.bottomPanel.boostersPanel.enableInput(),this.bottomPanel.boostersPanel.show()},t.prototype.hideBoostersPanel=function(){this.bottomPanel.boostersPanel.disableInput(),this.bottomPanel.boostersPanel.hide()},t.prototype.onLevelComplete=function(i){this.input.keyboard.once("keydown-SPACE",this.onNextLevelButtonClick,this),this.bottomPanel.disableInput(),this.completeScreen.updateData(i),this.completeScreen.show()},t.prototype.onLevelFailed=function(i){this.input.keyboard.once("keydown-SPACE",this.onRestartButtonClick,this),this.bottomPanel.disableInput(),this.failedScreen.updateData(i),this.failedScreen.show()},t.prototype.onPause=function(){this.bottomPanel.disableInput(),this.pauseScreen.show()},t.prototype.onResume=function(){this.bottomPanel.enableInput(),this.pauseScreen.hide()},t.prototype.onTargetBlockKilled=function(i){var s=this.getBlockGlobalPosition(i),a=this.blocksLabel.getWorldPosition(),l=this.collectedBlocks.getFirstDead(!0);l.x=s.x,l.y=s.y,l.scale=this.gameField.camera.zoom,l.updateFrame(i),l.revive(),l.once(o.CollectedBlockEvent.MOVE_IN_MIDDLE,this.playBlockCollectedWhooshSound,this),l.once(o.CollectedBlockEvent.MOVE_COMPLETE,this.playBlockCollectedCompleteSound,this),l.once(o.CollectedBlockEvent.MOVE_COMPLETE,this.onTargetBlockMoveComplete,this),l.moveTo(a,this.blocksLabel.blockOriginalScale)},t.prototype.getBlockGlobalPosition=function(i){var s=this.gameField.camera,a=s.getPadding(),l=s.zoom,c=s.x+a.x+i.x*l,u=s.y+a.y+i.y*l;return{x:c,y:u}},t.prototype.playBlockCollectedWhooshSound=function(){this.gameField.audio.blockCollectWhoosh()},t.prototype.playBlockCollectedCompleteSound=function(){this.gameField.audio.blockCollectComplete()},t.prototype.onTargetBlockMoveComplete=function(){this.blocksLabel.incrementCurrent(),this.blocksLabel.showWhiteCopy(),this.blocksLabel.tweenBlockIcon()},t.prototype.showSecondChanceScreen=function(i,s){this.levelConfig.levelNumber===1?this.secondChanceScreen.playButton.on(h.PRESS,this.onSecondChanceSuccess,this):this.secondChanceScreen.playButton.on(h.PRESS,this.showSecondChanceVideoAd,this),this.secondChanceScreen.closeButton.once(h.PRESS,this.onSecondChanceScreenClose,this),this.secondChanceScreen.updateData(this.levelConfig.levelNumber,this.levelConfig.generator.targetItemType,i,s),this.secondChanceScreen.revive(),this.secondChanceScreen.show()},t.prototype.onSecondChanceScreenClose=function(){this.secondChanceScreen.playButton.off(h.PRESS,this.showSecondChanceVideoAd,this),this.secondChanceScreen.hide()},t.prototype.showSecondChanceVideoAd=function(){var i=this;this.analytics.sendRewardedAd("second_chance","screen","request"),this.poki.rewardedBreak("SecondChance",{onSuccess:function(){i.onSecondChanceSuccess(),i.analytics.sendRewardedAd("second_chance","screen","receive")},onFail:function(){i.analytics.sendRewardedAd("second_chance","screen","fail")}}).catch(function(s){s==="AdBlock"&&i.secondChanceScreen.shakeCloseButton()})},t.prototype.onSecondChanceSuccess=function(){this.gameField.applySecondChance(),this.gameField.scene.resume(),this.secondChanceScreen.closeButton.off(h.PRESS,this.onSecondChanceScreenClose,this),this.secondChanceScreen.playButton.off(h.PRESS,this.showSecondChanceVideoAd,this),this.secondChanceScreen.hide()},t.prototype.update=function(i,s){e.prototype.update.call(this,i,s),this.fastForwardPopover&&this.fastForwardPopover.preUpdate(i,s)},t.prototype.shutdown=function(){},t.FONT_COLOR_STR="#E9EBEC",t.FONT_COLOR=15330284,t}(o.BaseScene);o.GameplayGui=n})(game||(game={}));var game;(function(o){var h=function(){function r(n,e){this.scene=n,this.worldIndex=e,this.addSky(),this.addGround(),this.addBottomGrass()}return r.prototype.addSky=function(){this.sky=this.scene.add.image(0,0,"backgrounds","sky_"+this.worldIndex),this.sky.setOrigin(.5,1)},r.prototype.addGround=function(){this.ground=this.scene.add.image(0,0,"backgrounds","ground_"+this.worldIndex)},r.prototype.addBottomGrass=function(){this.bottomGrass=this.scene.add.image(0,0,"backgrounds","bottom_grass_"+this.worldIndex),this.bottomGrass.setOrigin(.5,1)},r.prototype.resize=function(n){if(!n||!n.camera)return;this.resizeGround(n),this.resizeSky(),this.resizeBottomGrass()},r.prototype.resizeGround=function(n){this.ground.scale=o.Config.GAME_WIDTH/this.ground.width,this.ground.x=o.Config.HALF_GAME_WIDTH,this.ground.y=this.getFieldBottom(n.camera)},r.prototype.getFieldBottom=function(n){return n.height-n.getPadding().y},r.prototype.resizeSky=function(){var n=0,e=this.ground.y,t=e-n;this.sky.displayWidth=o.Config.GAME_WIDTH,this.sky.displayHeight=t,this.sky.x=o.Config.HALF_GAME_WIDTH,this.sky.y=e},r.prototype.resizeBottomGrass=function(){this.bottomGrass.scale=o.Config.GAME_WIDTH/this.bottomGrass.width,this.bottomGrass.x=o.Config.HALF_GAME_WIDTH,this.bottomGrass.y=Math.max(o.Config.GAME_HEIGHT,this.ground.y+this.bottomGrass.displayHeight*.9)},r}();o.GameplayRootBackground=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(){return r!==null&&r.apply(this,arguments)||this}return n.getPhysicsConfig=function(){return{matter:{debug:o.Main.development,enableSleeping:!0,runner:{isFixed:!0},gravity:{x:0,y:7},positionIterations:6,velocityIterations:4,constraintIterations:0,broadphase:{bucketWidth:o.GameGrid.CELL_SIZE,bucketHeight:o.GameGrid.CELL_SIZE}}}},n.prototype.init=function(e){this.initData=e||this.getDefaultInitData(),this.levelNumber=this.initData.levelNumber,this.levelConfig=this.game.levelConfigs.get(this.levelNumber),this.gameplay=null,this.gui=null,this.background=null,this.events.once("shutdown",this.shutdown,this),""+e.levelNumber},n.prototype.getDefaultInitData=function(){return{levelNumber:1,fromEditor:!1}},n.prototype.preload=function(){var e=this.game.globalScene.delayedLoader,t=e.areGameplayAssetsLoaded;if(t)return;this.analytics.sendLoadingEvent("gameplay","start"),this.waitForGameplayAssets(e)},n.prototype.waitForGameplayAssets=function(e){var t=this;this.game.loadingOverlay.fadeIn(),this.load.rexAwait(Phaser.Math.RND.uuid(),{callback:function(i){e.once(o.DelayedLoaderEvent.GAMEPLAY_ASSETS_READY,function(){t.analytics.sendLoadingEvent("gameplay","complete"),i()})}})},n.prototype.create=function(){if(!this.levelConfig){""+this.levelNumber,this.gotoLevelsMap();return}_.omit(this.levelConfig,"items","generator"),this.launchGameplayScene(),this.addBackground(),this.addKeyboardCallbacks()},n.prototype.launchGameplayScene=function(){this.gameplay=this.launchScene(o.SceneKey.GAMEPLAY,this.levelConfig),this.gameplay.events.once(Phaser.Scenes.Events.CREATE,this.launchGameplayGuiScene,this),this.game.raven.trackSceneInput(this.gameplay.scene.key)},n.prototype.launchGameplayGuiScene=function(){this.gui=this.launchScene(o.SceneKey.GAMEPLAY_GUI,{levelConfig:this.levelConfig,gameplay:this.gameplay}),this.gui.events.once(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this),this.gui.events.once(o.GameplayGuiEvent.GOTO_LEVELS_MAP,this.gotoLevelsMap,this),this.gui.events.once(o.GameplayGuiEvent.GOTO_LEVEL,this.gotoLevel,this),this.gui.events.on(o.GameplayGuiEvent.PAUSE,this.pause,this),this.gui.events.on(o.GameplayGuiEvent.RESUME,this.resume,this),this.game.raven.trackSceneInput(this.gui.scene.key)},n.prototype.onGuiCreated=function(){this.gameplay.gui=this.gui,this.gameplay.onGuiCreated(),this.resize(),this.gui.tutorial&&this.gui.showTutorial(),this.game.loadingOverlay.fadeOut()},n.prototype.launchScene=function(e,t){return this.scene.launch(e,t).get(e)},n.prototype.addBackground=function(){var e=this.levelConfig.background.split("_").pop(),t=parseInt(e)||1;this.background=new o.GameplayRootBackground(this,t)},n.prototype.addKeyboardCallbacks=function(){o.Main.development&&(this.input.keyboard.on("keydown-P",this.togglePause,this),this.input.keyboard.once("keydown-R",this.restart,this),this.input.keyboard.once("keydown-ESC",this.onEscKeyDown,this),this.input.keyboard.once("keydown-RIGHT",this.gotoNextLevel,this),this.input.keyboard.once("keydown-LEFT",this.gotoPrevLevel,this)),o.Main.editorEnabled&&this.input.keyboard.once("keydown-E",this.gotoEditor,this)},n.prototype.gotoPrevLevel=function(){var e=this.levelNumber-1,t=this.game.levelConfigs.check(e);if(t===!1)return;this.gotoLevel(e)},n.prototype.gotoNextLevel=function(){var e=this.levelNumber+1,t=this.game.levelConfigs.check(e);if(t===!1)return;this.gotoLevel(e)},n.prototype.gotoLevel=function(e){this.game.changeScene(this.scene.key,o.SceneKey.GAMEPLAY_ROOT,{levelNumber:e})},n.prototype.onEscKeyDown=function(){this.initData.fromEditor?this.gotoEditor():this.gotoLevelsMap()},n.prototype.gotoEditor=function(){this.scene.start(o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:this.levelNumber})},n.prototype.gotoTutorialEditor=function(){this.scene.start(o.SceneKey.TUTORIAL_EDITOR,{levelNumber:this.levelNumber})},n.prototype.gotoLevelsMap=function(){this.game.changeScene(this.scene.key,o.SceneKey.LEVELS_MAP)},n.prototype.restart=function(){this.game.changeScene(this.scene.key,o.SceneKey.GAMEPLAY_ROOT,{levelNumber:this.levelNumber})},n.prototype.togglePause=function(){var e;((e=this.gameplay)===null||e===void 0?void 0:e.scene.isPaused())?this.resume():this.pause()},n.prototype.resize=function(){var e,t,i,s,a;(e=this.gui)===null||e===void 0||e.doResize(),(t=this.gameplay)===null||t===void 0||t.doResize(),(i=this.background)===null||i===void 0||i.resize(this.gameplay),(s=this.gui)===null||s===void 0||s.resizeTutorial(this.gameplay),(a=this.gui)===null||a===void 0||a.resizeBoosterHintScreen(this.gameplay)},n.prototype.pause=function(){this.gameplay.onPause(),this.gui.onPause()},n.prototype.resume=function(){this.gameplay.onResume(),this.gui.onResume()},n.prototype.shutdown=function(){this.stopChildScenes()},n.prototype.stopChildScenes=function(){this.getChildScenes().forEach(function(e){e&&e.scene.stop()}),this.gameplay&&this.gameplay.events.off(Phaser.Scenes.Events.CREATE,this.launchGameplayGuiScene,this),this.gui&&(this.gui.events.off(Phaser.Scenes.Events.CREATE,this.onGuiCreated,this),this.gui.events.off(o.GameplayGuiEvent.GOTO_LEVELS_MAP,this.gotoLevelsMap,this),this.gui.events.off(o.GameplayGuiEvent.GOTO_LEVEL,this.gotoLevel,this),this.gui.events.off(o.GameplayGuiEvent.PAUSE,this.pause,this),this.gui.events.off(o.GameplayGuiEvent.RESUME,this.resume,this))},n.prototype.getChildScenes=function(){return[this.gameplay,this.gui]},n}(Phaser.Scene);o.GameplayRoot=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.name="tutorial_text",t.addBackground(),t.addText(),t}return n.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,"editor","back"),this.add(this.background)},n.prototype.addText=function(){var e="Tutorial",t={fontFamily:o.GameFont.SOUSES,fontStyle:o.FontWeight.BOLD,fontSize:"30px",color:"#B72C35",align:"center"};this.text=this.scene.add.text(0,0,e,t),this.text.setWordWrapWidth(this.background.width*.9),this.text.setOrigin(.5,.5),this.add(this.text)},n.prototype.updateText=function(e){this.text.setText(e);var t=this.background.height*.7;this.text.scale=1,this.text.scale=Math.min(1,t/this.text.height)},n.prototype.getWidth=function(){return this.background.width},n.prototype.getHeight=function(){return this.background.height},n.prototype.getDisplayHeight=function(){return this.getHeight()*this.scaleY},n}(Phaser.GameObjects.Container);o.EditorTutorialText=h})(game||(game={}));var game;(function(o){var h=Phaser.Geom.Rectangle,r=function(n){__extends(e,n);function e(t){var i=n.call(this,t,{x:0,y:0,fillStyle:{color:0,alpha:.5},lineStyle:{width:0}})||this;return i.width=0,i.height=0,i.setInteractive(i.getHitArea(),h.Contains),i.setSize(e.INITIAL_WIDTH,e.INITIAL_HEIGHT),i.input.cursor="pointer",i}return e.prototype.getHitArea=function(){return new h(-this.width/2,-this.height/2,this.width,this.height)},e.prototype.changeSize=function(t,i){this.setSize(this.width+t,this.height+i)},e.prototype.setSize=function(t,i){this.width=Math.max(e.INITIAL_WIDTH,t),this.height=Math.max(e.INITIAL_HEIGHT,i),this.clear(),this.fillRoundedRect(-t/2,-i/2,t,i),this.input.hitArea=this.getHitArea()},e.prototype.destroy=function(t){n.prototype.destroy.call(this,t)},e.INITIAL_WIDTH=o.GameGrid.CELL_SIZE*1.5,e.INITIAL_HEIGHT=o.GameGrid.CELL_SIZE*1.5,e}(Phaser.GameObjects.Graphics);o.EditorTutorialArea=r})(game||(game={}));var game;(function(o){var h;(function(n){n.TEXT_CHANGE="TEXT_CHANGE"})(h=o.TutorialConfigPanelEvent||(o.TutorialConfigPanelEvent={}));var r=function(n){__extends(e,n);function e(t,i,s){var a=n.call(this,t,"Level "+i)||this;return a.tutorialConfig=s,a.panel.addInput(a.tutorialConfig,"text").on("change",a.onTextChange.bind(a)),a.panel.addInput(a.tutorialConfig,"textKey"),a.panel.addSeparator(),a.panel.addInput(a.tutorialConfig,"tweenMask"),a.panel.addInput(a.tutorialConfig,"tweenScale",{min:1,max:1.3,step:.01}),a.panel.addSeparator(),a.panel.addInput(a.tutorialConfig,"snapping"),a.panel.addSeparator(),a.addButtons(),a}return e.prototype.onTextChange=function(t){this.events.emit(h.TEXT_CHANGE,t)},e.prototype.addButtons=function(){this.editorButton=this.panel.addButton({title:"Editor"}),this.deleteButton=this.panel.addButton({title:"Delete"}),this.saveButton=this.panel.addButton({title:"Save"}),this.testButton=this.panel.addButton({title:"Test"})},e}(o.EditorPanel);o.TutorialConfigPanel=r})(game||(game={}));var game;(function(o){var h=Phaser.GameObjects.ButtonEvent,r=function(n){__extends(e,n);function e(){var t=n!==null&&n.apply(this,arguments)||this;return t.lastPointerDownTime=0,t}return e.prototype.init=function(t){this.levelNumber=t?t.levelNumber:1,this.levelConfig=this.game.levelConfigs.get(this.levelNumber),this.tutorialConfig=_.cloneDeep(this.levelConfig.tutorial)||this.getDefaultTutorialConfig(),""+this.levelNumber,this.tutorialConfig,this.getDefaultTutorialConfig(),this.lastPointerDownTime=0,this.tutorialArea=null,this.events.once("shutdown",this.shutdown,this)},e.prototype.getDefaultTutorialConfig=function(){var t={autoGenerated:!0,tweenMask:!1,tweenScale:1.15,width:0,height:0,x:0,y:0,snapping:!0,text:"",textKey:""};return t},e.prototype.preload=function(){this.load.atlas("gameplay","assets/graphics/gameplay.png","assets/graphics/gameplay.json"),this.load.atlas("gameplay_gui","assets/graphics/gameplay_gui.png","assets/graphics/gameplay_gui.json"),this.load.bitmapFontFromAtlas(o.BitmapGameFont.INGAME_GUI_DIGITS,"gameplay_gui","ingame_gui_digits","assets/fonts/bitmap/ingame_gui_digits.fnt")},e.prototype.create=function(){this.addEditorsPanels(),this.addBackground(),this.addLevelLabel(),this.addGrid(),this.addItemsLayer(),this.loadFromConfig(),this.addKeyboardCallbacks(),this.addPointerCallbacks(),this.resize()},e.prototype.addEditorsPanels=function(){var t=this;this.panelsContainer=document.getElementById("editor-panels"),this.panelsContainer.style.visibility="visible",this.time.delayedCall(100,function(){t.panelsContainer.style.visibility="visible"}),this.panel=new o.TutorialConfigPanel(this,this.levelConfig.levelNumber,this.tutorialConfig),this.panel.events.on(o.TutorialConfigPanelEvent.TEXT_CHANGE,this.onTutorialTextChange,this),this.panel.editorButton.on("click",this.gotoLevelEditor.bind(this)),this.panel.deleteButton.on("click",this.onDeleteButtonClick.bind(this)),this.panel.testButton.on("click",this.onTestButtonClick.bind(this)),this.panel.saveButton.on("click",this.onSaveButtonClick.bind(this))},e.prototype.gotoLevelEditor=function(){this.scene.start(o.SceneKey.LEVEL_EDITOR_ROOT,{levelNumber:this.levelNumber})},e.prototype.onTutorialTextChange=function(t){if(!this.tutorialText)return;this.tutorialText.updateText(t)},e.prototype.onDeleteButtonClick=function(){var t=this;if(!this.tutorialArea)return;var i=window.confirm("Delete tutorial for level "+this.levelConfig.levelNumber+"?");if(!i)return;this.tutorialArea.destroy(),this.tutorialArea=null,this.tutorialText.destroy(),this.tutorialText=null,Object.assign(this.tutorialConfig,this.getDefaultTutorialConfig()),this.panel.refresh(),delete this.levelConfig.tutorial,this.panel.disableInput(),""+this.levelConfig.levelNumber,this.game.levelConfigs.saveLocally(),this.game.levelConfigs.saveRemotely().then(function(){}).catch(function(s){}).finally(function(){t.panel.enableInput()})},e.prototype.onTestButtonClick=function(){if(!this.tutorialArea)return;Object.assign(this.tutorialConfig,this.createTutorialConfig()),this.levelConfig.tutorial=this.tutorialConfig,this.game.changeScene(this.scene.key,o.SceneKey.GAMEPLAY_ROOT,{levelNumber:this.levelNumber})},e.prototype.onSaveButtonClick=function(){var t=this;if(!this.tutorialArea)return;if(!this.tutorialConfig.textKey)return;Object.assign(this.tutorialConfig,this.createTutorialConfig()),this.levelConfig.tutorial=this.tutorialConfig,this.panel.disableInput(),""+this.levelConfig.levelNumber,this.tutorialConfig,this.game.levelConfigs.saveLocally().then(function(){}).catch(function(i){}),this.game.levelConfigs.saveRemotely().then(function(){}).catch(function(i){}).finally(function(){t.panel.enableInput()})},e.prototype.createTutorialConfig=function(){return __assign(__assign({},this.tutorialConfig),{x:this.tutorialArea.x,y:this.tutorialArea.y,width:this.tutorialArea.width,height:this.tutorialArea.height,autoGenerated:!1})},e.prototype.addBackground=function(){this.background=this.add.image(0,0,"editor",this.levelConfig.background),this.background.setOrigin(.5,1)},e.prototype.addLevelLabel=function(){this.levelLabel=new o.EditorLevelLabel(this,this.levelNumber),this.levelLabel.prevLevelButton.once(h.PRESS,this.gotoPrevLevel,this),this.levelLabel.nextLevelButton.once(h.PRESS,this.gotoNextLevel,this),this.add.existing(this.levelLabel)},e.prototype.gotoPrevLevel=function(){this.gotoLevel(this.levelNumber-1)},e.prototype.gotoNextLevel=function(){this.gotoLevel(this.levelNumber+1)},e.prototype.gotoLevel=function(t){var i=this.game.levelConfigs.check(t);if(i===!1){""+t;return}this.scene.start(o.SceneKey.TUTORIAL_EDITOR,{levelNumber:t})},e.prototype.addGrid=function(){this.grid=new o.GameGrid(this,o.GameGrid.COLUMNS,o.GameGrid.ROWS),this.add.existing(this.grid)},e.prototype.addItemsLayer=function(){this.itemsContainer=this.add.container(0,0)},e.prototype.loadFromConfig=function(){this.loadItems(),this.loadTutorial()},e.prototype.loadItems=function(){var t=this;this.items=[],this.levelConfig.items.filter(function(i){return i.row<o.GameGrid.ROWS}).forEach(function(i){var s=t.grid.getCellAt(i.row,i.column),a=new o.EditorItem(t,"editor",i.type);a.x=s.x,a.y=s.y,a.column=s.column,a.row=s.row,a.disableInteractive(),t.itemsContainer.add(a),t.items.push(a)})},e.prototype.loadTutorial=function(){if(this.tutorialConfig.autoGenerated)return;this.addTutorialArea(this.tutorialConfig.x,this.tutorialConfig.y),this.tutorialArea.setSize(this.tutorialConfig.width,this.tutorialConfig.height),this.addTutorialText(),this.tutorialText.updateText(this.tutorialConfig.text)},e.prototype.addKeyboardCallbacks=function(){var t=this;this.shiftKey=this.input.keyboard.addKey("shift"),this.input.keyboard.once("keydown-PLUS",function(){t.addTutorialArea(t.input.activePointer.x,t.input.activePointer.y)}),this.input.keyboard.once("keydown-ESC",this.gotoLevelsMapDev,this)},e.prototype.gotoLevelsMapDev=function(){this.scene.start(o.SceneKey.LEVELS_MAP_DEV)},e.prototype.addPointerCallbacks=function(){this.input.on(Phaser.Input.Events.POINTER_DOWN,this.onPointerDown,this),this.input.on("drag",function(t,i,s,a){i.x=s,i.y=a})},e.prototype.onPointerDown=function(t){var i=Date.now(),s=i-this.lastPointerDownTime;if(s<300){if(this.tutorialArea)return;this.tutorialConfig.autoGenerated=!1,this.addTutorialArea(t.x,t.y),this.addTutorialText(),this.alignTutorialText(),this.tutorialConfig.snapping&&this.snapToGrid(this.tutorialArea)}this.lastPointerDownTime=i},e.prototype.addTutorialArea=function(t,i){var s=this.itemsContainer.pointToContainer({x:t,y:i});this.tutorialArea=new o.EditorTutorialArea(this),this.tutorialArea.x=s.x,this.tutorialArea.y=s.y,this.tutorialArea.on(Phaser.Input.Events.GAMEOBJECT_POINTER_WHEEL,this.onTutorialAreaWheel,this),this.tutorialArea.on(Phaser.Input.Events.GAMEOBJECT_DRAG_END,this.onTutorialAreaDragEnd,this),this.itemsContainer.add(this.tutorialArea),this.input.setDraggable(this.tutorialArea)},e.prototype.onTutorialAreaWheel=function(t,i,s){var a=0,l=0,c=Phaser.Math.Sign(s)*-1,u=o.GameGrid.CELL_SIZE/2;this.shiftKey.isDown?a=u*c:l=u*c,this.tutorialArea.changeSize(a,l)},e.prototype.onTutorialAreaDragEnd=function(t,i,s){this.tutorialConfig.snapping&&this.snapToGrid(this.tutorialArea)},e.prototype.snapToGrid=function(t){var i=this.grid.getCellAtXY(t.x,t.y);if(i)t.x=i.x,t.y=i.y;else{var s=function(l){return Phaser.Math.Distance.Between(l.x,l.y,t.x,t.y)},a=_.sortBy(this.grid.cells,s)[0];t.x=a.x,t.y=a.y}},e.prototype.addTutorialText=function(){this.tutorialText=new o.EditorTutorialText(this),this.tutorialText.updateText(this.tutorialConfig.text),this.add.existing(this.tutorialText)},e.prototype.resize=function(){this.resizeBackground(),this.alignLevelLabel(),this.resizeGrid(),this.resizeItemsContainer(),this.alignTutorialText()},e.prototype.resizeBackground=function(){this.background.envelop(o.Config.GAME_WIDTH,o.Config.GAME_HEIGHT),this.background.x=o.Config.HALF_GAME_WIDTH,this.background.y=o.Config.GAME_HEIGHT},e.prototype.alignLevelLabel=function(){this.levelLabel.scale=.66,this.levelLabel.x=o.Config.HALF_GAME_WIDTH,this.levelLabel.y=this.levelLabel.getBounds().height/2+20},e.prototype.resizeGrid=function(){var t=o.Config.GAME_WIDTH*.85,i=o.Config.GAME_HEIGHT*.8,s=t/this.grid.getWidth(),a=i/this.grid.getHeight(),l=Math.min(s,a);this.grid.scale=l,this.grid.x=(o.Config.GAME_WIDTH-this.grid.getWidth()*l)/2,this.grid.y=(o.Config.GAME_HEIGHT-this.grid.getHeight()*l)/2},e.prototype.resizeItemsContainer=function(){this.itemsContainer.scale=this.grid.scale,this.itemsContainer.x=this.grid.x,this.itemsContainer.y=this.grid.y},e.prototype.alignTutorialText=function(){if(!this.tutorialText)return;var t=o.Config.GAME_WIDTH*.8;this.tutorialText.scale=t/this.tutorialText.getWidth(),this.tutorialText.x=o.Config.HALF_GAME_WIDTH,this.tutorialText.y=o.Config.GAME_HEIGHT-this.tutorialText.getDisplayHeight()/2-20},e.prototype.shutdown=function(){this.destroyPanels()},e.prototype.destroyPanels=function(){this.panelsContainer.style.visibility="hidden",this.panelsContainer=null,this.panel&&this.panel.destroy()},e}(Phaser.Scene);o.TutorialEditor=r})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.allConfigs=n}return r.prototype.fixConfigs=function(){this.saveLocally(),this.saveRemotely().then(function(){}).catch(function(){})},r.prototype.fixBackgrounds=function(){this.getAll().forEach(function(n){n.levelNumber<=13?n.background="background_1":n.levelNumber>=14&&n.levelNumber<=27?n.background="background_2":n.background="background_3"})},r.prototype.fixStars=function(){var n=this;Object.keys(this.allConfigs).forEach(function(e){var t=n.allConfigs[e];t.stars=o.Editor.createStarsConfig(t.levelNumber,t.items)})},r.prototype.getAll=function(){return Object.values(this.allConfigs)},r.prototype.get=function(n){return this.allConfigs[n]},r.prototype.remove=function(n){delete this.allConfigs[n.toString()]},r.prototype.check=function(n){return this.allConfigs.hasOwnProperty(n.toString())},r.prototype.add=function(n){this.allConfigs[n.levelNumber]=n},r.prototype.create=function(n,e){e===void 0&&(e=!0);var t=this.createDefaultLevelConfig(n);return e&&(this.allConfigs[n]=t),t},r.prototype.createDefaultLevelConfig=function(n){return{levelNumber:n,background:"background_001",balls:5,autoThrow:this.createDefaultAutoThrowConfig(),generator:this.createDefaultGeneratorConfig(),stars:[100,200,300],items:[]}},r.prototype.createDefaultAutoThrowConfig=function(){return{enabled:!1,fastForward:!0,snapping:!1,delay:300,x:0,y:0}},r.prototype.createDefaultGeneratorConfig=function(){return{seed:Date.now().toString(),general:50,startRow:5,targetItemsNum:10,targetItemType:o.ItemType.BASIC_BLOCK,minHealth:2,maxHealth:30,deltaHealth:0,incrementHealth:1,itemTypes:this.getDefaultItemTypes(),weights:this.getDefaultWeights(),sides:0}},r.prototype.getDefaultItemTypes=function(){var n=[o.ItemType.COLLECTABLE_BALL,o.ItemType.BASIC_BLOCK],e=this.getGeneratorItemTypes(),t=e.map(function(i){return n.includes(i)});return _.zipObject(e,t)},r.prototype.getDefaultWeights=function(){var n=this.getGeneratorItemTypes(),e=n.map(function(t){return 100});return _.zipObject(n,e)},r.prototype.getGeneratorItemTypes=function(){var n=o.ItemTypeUtil.getAllTypes(),e=[o.ItemType.SHATTER_BLOCK_PIECE];return _.without.apply(_,__spreadArrays([n],e))},r.prototype.saveLocally=function(){var n=typeof window.___browserSync___!="undefined";if(n===!1)return Promise.resolve(!1);var e=location.protocol+"//"+location.host+"/files",t="dev/assets/configs/";return this.doSave(e,t)},r.prototype.saveRemotely=function(){var n=o.Config.SERVER_URL+"upload.php";return this.doSave(n,"")},r.prototype.doSave=function(n,e){var t=this;return new Promise(function(i,s){var a,l=(a=utils.NetUtil.getParam("levelsFile"))!==null&&a!==void 0?a:"levels",c={filename:e+l+".json",content:JSON.stringify(t.allConfigs)},u=new XMLHttpRequest;u.open("POST",n,!0),u.onload=function(){i(u)},u.onerror=function(){s(u)},u.send(t.convertObjectToURLSearchParams(c))})},r.prototype.convertObjectToURLSearchParams=function(n){return new URLSearchParams(n)},r.prototype.getLevelNumbers=function(){var n=Object.keys(this.allConfigs);return n.map(function(e){return parseInt(e)})},r}();o.LevelConfigsManager=h})(game||(game={}));var game;(function(o){var h=function(r){__extends(n,r);function n(e){var t=r.call(this,e)||this;return t.isSimulating=!1,t.updateTimer=0,t.updateInterval=0,t.progress=0,t.scene.scale.on(Phaser.Scale.Events.RESIZE,t.resize,t),t.scene.events.on(Phaser.Scenes.Events.UPDATE,t.customUpdate,t),t.name="preloader",t.addBackground(),t.addLogo(),t}return n.prototype.reset=function(){this.visible=!0,this.active=!0,this.alpha=1,this.updateTimer=0,this.progress=0,this.isSimulating=!1,this.logo.setProgressInstant(0)},n.prototype.addBackground=function(){this.background=this.scene.add.image(0,0,"preloader","bg"),this.add(this.background)},n.prototype.addLogo=function(){this.logo=new o.LoadingLogo(this.scene),this.add(this.logo)},n.prototype.resize=function(e){var t,i,s=(t=e==null?void 0:e.width)!==null&&t!==void 0?t:o.Config.GAME_WIDTH,a=(i=e==null?void 0:e.height)!==null&&i!==void 0?i:o.Config.GAME_HEIGHT;this.resizeBackground(s,a),this.alignLogo(s,a)},n.prototype.resizeBackground=function(e,t){this.background.envelop(e,t),this.background.x=e/2,this.background.y=t/2},n.prototype.alignLogo=function(e,t){var i=e*.45;this.logo.scale=Math.min(1,i/this.logo.getWidth()),this.logo.x=e/2,this.logo.y=t/2},n.prototype.simulateLoading=function(){this.isSimulating=!0},n.prototype.customUpdate=function(e,t){if(this.isSimulating===!1)return;if(this.progress>=99)return;this.updateTimer+=t,this.updateTimer>this.updateInterval&&(this.updateTimer-=this.updateInterval,this.updateInterval=Phaser.Math.RND.between(300,800),this.progress+=Phaser.Math.RND.between(1,3),this.progress>=99&&(this.progress=99),this.logo.setProgress(this.progress/100))},n.prototype.setComplete=function(){this.isSimulating=!1,this.progress=100,this.logo.setProgress(1)},n.prototype.hide=function(){this.scene.tweens.add({targets:this,delay:150,duration:200,ease:Phaser.Math.Easing.Cubic.Out,alpha:0,onComplete:this.onHideComplete.bind(this)})},n.prototype.onHideComplete=function(){this.kill()},n.prototype.destroy=function(e){this.scene&&(this.scene.scale.off(Phaser.Scale.Events.RESIZE,this.resize,this),this.scene.events.off(Phaser.Scenes.Events.UPDATE,this.customUpdate,this)),r.prototype.destroy.call(this,e)},n}(Phaser.GameObjects.Container);o.IngamePreloader=h})(game||(game={}));var game;(function(o){var h;(function(r){r.BOMB="bomb",r.CRACKER="cracker",r.STOP="stop"})(h=o.BoosterType||(o.BoosterType={}))})(game||(game={}));var game;(function(o){var h=Phaser.Events.EventEmitter,r;(function(e){e.NUM_CHANGED="IngameBooster_NUM_CHANGED"})(r=o.BoosterEvent||(o.BoosterEvent={}));var n=function(e){__extends(t,e);function t(i,s){var a=e.call(this)||this;return a._type=i,a._num=s,a}return Object.defineProperty(t.prototype,"num",{get:function(){return this._num},set:function(i){this._num=Math.max(0,i),this.emit(r.NUM_CHANGED,this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),t}(h);o.Booster=n})(game||(game={}));var game;(function(o){var h=function(){function r(n){this.game=n,this.store=this.game.store,this.store.on(o.GameStoreEvent.CLEAR,this.onSaveDataCleared,this),this.texts=this.game.texts,this.texts.on(o.GameTextsEvent.LANGUAGE_CHANGE,this.onLanguageChange,this),this.initBoosters()}return r.prototype.onSaveDataCleared=function(){this.boosters.forEach(function(n){n.num=0})},r.prototype.onLanguageChange=function(){var n=this.game.texts.texts.ingame_boosters;this.boosters.forEach(function(e){var t=n[e.type];e.title=t.title,e.hint=t.hint})},r.prototype.initBoosters=function(){var n=this,e=this.game.texts.texts.ingame_boosters,t=this.store.getValue(o.GameStoreKey.INGAME_BOOSTERS),i=[o.BoosterType.BOMB,o.BoosterType.CRACKER,o.BoosterType.STOP];this.boosters=i.map(function(s){var a,l=(a=t[s])!==null&&a!==void 0?a:0,c=e[s],u=new o.Booster(s,l);return u.title=c.title,u.hint=c.hint,u.on(o.BoosterEvent.NUM_CHANGED,n.onBoosterNumChanged,n),u})},r.prototype.onBoosterNumChanged=function(n){var e,t=this.store.getValue(o.GameStoreKey.INGAME_BOOSTERS),i=__assign(__assign({},t),(e={},e[n.type]=n.num,e));this.store.saveValue(o.GameStoreKey.INGAME_BOOSTERS,i)},r.prototype.getByType=function(n){return this.boosters.find(function(e){return e.type===n})},r.prototype.getRandom=function(){return Phaser.Math.RND.pick(this.boosters)},r.prototype.updateFromGift=function(n){var e=this;Object.entries(n).forEach(function(t){var i=t[0],s=t[1];e.getByType(i).num+=s})},r}();o.BoostersManager=h})(game||(game={}));var game;(function(o){var h=gameanalytics.GameAnalytics,r=gameanalytics.EGAProgressionStatus,n=gameanalytics.EGAErrorSeverity,e;(function(i){i.BOOSTERS_NUM="boosters_num"})(e=o.RemoteConfigKey||(o.RemoteConfigKey={}));var t=function(){function i(s){this.isEnabled=!1;var a=this.disableAnalytics();if(a){this.isEnabled=!1;return}this.game=s,this.isEnabled=!0,this.loadingTimes={},this.setLog(),this.setCustomDimensions(),this.endSessionOnUnload(),h.configureBuild(window.game.config.build_version.toString()),h.initialize("3646a9cdd69f7984bf5ae9413a451f80","311c306197a6aa747e3ac552ba7fdeb1adb7c100"),h.addDesignEvent("Startup"),this.sendAvifEvent(),this.sendWebpEvent()}return i.prototype.disableAnalytics=function(){var s=utils.NetUtil.getParamBool("analytics");return s?!1:o.Main.development||typeof h=="undefined"||this.isRobowhale()},i.prototype.isRobowhale=function(){var s;return(s=location.hostname)===null||s===void 0?void 0:s.includes("robowhale")},i.prototype.setLog=function(){var s=utils.NetUtil.getParamInt("analyticsLog");s===1?h.setEnabledInfoLog(!0):s===2&&h.setEnabledVerboseLog(!0)},i.prototype.setCustomDimensions=function(){h.configureAvailableCustomDimensions01(["poki","yandex","game-distribution","worker-bee","orange-fr"]),h.setCustomDimension01("poki"),h.configureAvailableCustomDimensions02([o.RendererType.CANVAS,o.RendererType.WEBGL,o.RendererType.HEADLESS]),h.setCustomDimension02(this.game.rendererType);var s=["chrome","edge","firefox","ie","mobileSafari","opera","safari","silk","trident","other"],a=this.getCurrentBrowser(s);h.configureAvailableCustomDimensions03(s),h.setCustomDimension03(a)},i.prototype.getCurrentBrowser=function(s){var a=this,l=s.find(function(c){return a.game.device.browser[c]===!0});return l!=null?l:"other"},i.prototype.endSessionOnUnload=function(){window.addEventListener("unload",function(){h.endSession()},{once:!0})},i.prototype.sendLevelStart=function(s){this.sendProgressionEvent(r.Start,s)},i.prototype.sendLevelComplete=function(s,a){this.sendProgressionEvent(r.Complete,s,a)},i.prototype.sendLevelFail=function(s,a){this.sendProgressionEvent(r.Fail,s,a)},i.prototype.sendProgressionEvent=function(s,a,l){if(this.isEnabled===!1)return;var c="level_"+_.padStart(a.toString(),3,"0");h.addProgressionEvent(s,c,"","",l)},i.prototype.sendBoosterUseEvent=function(s,a){if(this.isEnabled===!1)return;var l="Level_"+_.padStart(s.toString(),3,"0");h.addDesignEvent(l+":Booster:"+a)},i.prototype.sendAdEvent=function(s,a,l,c){if(this.isEnabled===!1)return;h.addAdEvent(s,a,c,l)},i.prototype.sendRewardedAd=function(s,a,l){if(this.isEnabled===!1)return;h.addDesignEvent("Rewarded_Ad:"+s+":"+a+":"+l)},i.prototype.sendLoadingEvent=function(s,a){if(this.isEnabled===!1)return;if(a==="start"&&(this.loadingTimes[s]=Date.now(),h.addDesignEvent("Loading:"+s+":"+a)),a==="complete"){var l=Date.now()-this.loadingTimes[s],c=Phaser.Math.RoundTo(l/1e3,-1);h.addDesignEvent("Loading:"+s+":"+a,c)}},i.prototype.sendDesignEvent=function(s,a){if(this.isEnabled===!1)return;h.addDesignEvent(s,a)},i.prototype.sendError=function(s,a){if(a===void 0&&(a=n.Error),this.isEnabled===!1)return;h.addErrorEvent(a,s)},i.prototype.sendAvifEvent=function(){var s=this.game.avif?"avif:supported":"avif:not_supported";this.sendDesignEvent(s,this.game.avif?1:0)},i.prototype.sendWebpEvent=function(){var s=this.game.webp?"webp:supported":"webp:not_supported";this.sendDesignEvent(s,this.game.webp?1:0)},i.prototype.getRemoteConfigValue=function(s,a){return this.isEnabled===!1?a:h.getRemoteConfigsValueAsString(s,a)},i}();o.GameAnalyticsWrapper=t})(game||(game={}));var game;(function(o){var h=gameanalytics.EGAAdAction,r=gameanalytics.EGAAdType,n=function(){function t(){}return t.prototype.init=function(){return Promise.resolve()},t.prototype.setDebug=function(i){},t.prototype.gameLoadingStart=function(){},t.prototype.gameLoadingProgress=function(i){},t.prototype.gameLoadingFinished=function(){},t.prototype.gameplayStart=function(){},t.prototype.gameplayStop=function(){},t.prototype.commercialBreak=function(){return Promise.resolve(void 0)},t.prototype.rewardedBreak=function(){return Promise.resolve(void 0)},t.prototype.happyTime=function(i){},t}();o.PokiDummySdk=n;var e=function(){function t(i){this.isEnabled=!1,this.wasMuted=!1,this.isAdBlockEnabled=!1,this.game=i,this.isEnabled=typeof PokiSDK!="undefined",this.sdk=this.isEnabled?PokiSDK:new n,this.sdk.setDebug(utils.NetUtil.getParamBool("pokiDev"))}return t.prototype.init=function(){var i=this;return this.sdk.init().then(function(){i.game.analytics.sendDesignEvent("AdBlock:disabled")}).catch(function(){i.game.analytics.sendDesignEvent("AdBlock:enabled",!0),i.isAdBlockEnabled=!0}).finally(function(){var s;(s=i.game.raven)===null||s===void 0||s.addExtraContext({adblock:i.isAdBlockEnabled})})},t.prototype.injectIntoScenes=function(){var i=this;this.game.scene.scenes.forEach(function(s){return s.poki=i})},t.prototype.commercialBreak=function(i){var s=this,a;return this.isAdBlockEnabled?Promise.reject("AdBlock"):((a=this.game.analytics)===null||a===void 0||a.sendAdEvent(h.Clicked,r.Interstitial,i,"poki"),this.onBreakStart().finally(function(){s.sdk.commercialBreak().then(function(){var l;(l=s.game.analytics)===null||l===void 0||l.sendAdEvent(h.Show,r.Interstitial,i,"poki")}).catch(function(){var l;(l=s.game.analytics)===null||l===void 0||l.sendAdEvent(h.FailedShow,r.Interstitial,i,"poki")}).finally(function(){s.onBreakComplete()})}))},t.prototype.rewardedBreak=function(i,s){var a=this,l;return this.isAdBlockEnabled?(this.game.toasts.showNoRewardedAdsWarning(),Promise.reject("AdBlock")):((l=this.game.analytics)===null||l===void 0||l.sendAdEvent(h.Clicked,r.RewardedVideo,i,"poki"),this.onBreakStart().finally(function(){a.sdk.rewardedBreak().then(function(c){var u;(u=a.game.analytics)===null||u===void 0||u.sendAdEvent(h.Show,r.RewardedVideo,i,"poki"),c?s.onSuccess():(s.onCancel&&s.onCancel(),a.game.toasts.showRewardedAdsDontSkipWarning())}).catch(function(){var c;s.onFail&&s.onFail(),a.game.toasts.showNoRewardedAdsWarning(),(c=a.game.analytics)===null||c===void 0||c.sendAdEvent(h.FailedShow,r.RewardedVideo,i,"poki")}).finally(function(){a.onBreakComplete()})}))},t.prototype.onBreakStart=function(){return this.wasMuted=this.game.sound.mute,this.game.sound.mute=!0,this.game.canvas.style.pointerEvents="none",this.game.input.keyboard.enabled=!1,this.game.audio.suspendAudioContext()},t.prototype.onBreakComplete=function(){this.game.sound.mute=this.wasMuted,this.game.canvas.style.pointerEvents="auto",this.game.input.keyboard.enabled=!0,this.game.audio.resumeAudioContext()},t}();o.PokiSdkWrapper=e})(game||(game={}));var game;(function(o){var h;(function(r){r.GAMEPLAY_LOADED="GAMEPLAY_LOADED"})(h=o.RegistryKey||(o.RegistryKey={}))})(game||(game={}));var game;(function(o){var h=function(){function r(){this.element=document.getElementById("loading-spinner-container")}return r.prototype.fadeIn=function(){this.element.style.display="flex",this.element.style.opacity="1",this.element.classList.remove("spinner-fadeout"),this.element.classList.add("spinner-fadein")},r.prototype.fadeOut=function(){var n=this;this.element.classList.remove("spinner-fadein"),this.element.classList.add("spinner-fadeout"),setTimeout(function(){n.element.style.display="none"},150)},r.prototype.isVisible=function(){return this.element.style.display==="flex"},r}();o.LoadingOverlay=h})(game||(game={}));var game;(function(o){var h;(function(n){n.WEBGL="webgl",n.CANVAS="canvas",n.HEADLESS="headless"})(h=o.RendererType||(o.RendererType={}));var r=function(n){__extends(e,n);function e(){var t=this;return e.detectDevMode(),e.detectEditorMode(),utils.Polyfills.polyfill(),utils.Phaser3Extensions.extend(),utils.MatterExtensions.extend(),t=n.call(this,o.GameConfigCreator.create())||this,t.webp=!1,t.avif=!1,t.fonts=new o.GameFonts(t),t.store=new o.GameStore(t,"BouncyWoods"),t.loadingOverlay=new o.LoadingOverlay,t.decoratePage(),t.addScenes(),t}return e.detectDevMode=function(){e.development=utils.NetUtil.getParamBool("dev"),e.development},e.detectEditorMode=function(){var t=["localhost","192.168","robowhale"],i=t.some(function(s){return location.hostname.includes(s)});i&&utils.NetUtil.getParamBool("editor")&&(e.editorEnabled=!0,document.title=document.title+" + Editor")},e.prototype.decoratePage=function(){var t=this.config.scaleMode===Phaser.Scale.FIT;if(t===!1)return;this.surroundCanvasWithSidebars(this.canvas),this.canvas.style.boxShadow="0px 0px 5px 5px rgba(0, 0, 0, 0.1)",this.scale.updateBounds()},e.prototype.getDefaultImageFormat=function(t){return this.avif?"avif":this.webp?"webp":t},e.prototype.surroundCanvasWithSidebars=function(t){var i=document.createElement("div");i.className="sidebar",i.id="left-sidebar",t.parentNode.insertBefore(i,t);var s=document.createElement("div");s.className="sidebar",s.id="right-sidebar",t.parentNode.insertBefore(s,t.nextSibling)},e.prototype.addScenes=function(){this.scene.add(o.SceneKey.GLOBAL,o.GlobalScene),this.scene.add(o.SceneKey.BOOT,o.Boot,!0),this.scene.add(o.SceneKey.PRELOADER,o.Preloader),this.scene.add(o.SceneKey.LEVELS_MAP,o.LevelsMap),this.scene.add(o.SceneKey.LEVELS_MAP_DEV,o.LevelsMapDev),this.scene.add(o.SceneKey.GAMEPLAY_ROOT,o.GameplayRoot),this.scene.add(o.SceneKey.GAMEPLAY,o.Gameplay),this.scene.add(o.SceneKey.GAMEPLAY_GUI,o.GameplayGui),e.editorEnabled&&(this.scene.add(o.SceneKey.LEVELS_MAP_EDITOR,o.LevelsMapEditor),this.scene.add(o.SceneKey.LEVEL_EDITOR_ROOT,o.EditorRoot),this.scene.add(o.SceneKey.LEVEL_EDITOR,o.Editor),this.scene.add(o.SceneKey.LEVEL_EDITOR_GUI,o.EditorGui),this.scene.add(o.SceneKey.TUTORIAL_EDITOR,o.TutorialEditor))},e.prototype.changeScene=function(t,i,s){this.globalScene.sceneTransition.changeScene(t,i,s)},e.prototype.restartScene=function(t,i){this.globalScene.sceneTransition.changeScene(t,t,i)},e.prototype.injectIntoScenes=function(t,i){this.scene.scenes.forEach(function(s){var a=s.hasOwnProperty(i);if(a){""+i+s.scene.key;return}s[i]=t})},e.editorEnabled=!1,e.development=!1,e.areRewardAdsEnabled=!0,e}(Phaser.Game);o.Main=r})(game||(game={}));var GameEnvironment;(function(o){o.DEVELOP="develop",o.DEPLOY_WEB="deploy-web",o.DEPLOY_POKI="deploy-poki"})(GameEnvironment||(GameEnvironment={}));var game;(function(o){function h(){if(window.environment!==GameEnvironment.DEPLOY_POKI)return;var r=utils.NetUtil.getParamBool("sitelock","0");if(r)return;var n=["top","indexOf","I3ViZzIzNQ==","hostname","length","location","LnBva2ktZ2RuLmNvbQ==","href"];(function(t,i){var s=function(a){for(;--a;)t.push(t.shift())};s(++i)})(n,430);var e=function(t,i){t-=0;var s=n[t];return s};(function(){for(var i=["bG9jYWxob3N0","LnBva2kuY29t",e("0x0")],s=![],a=window[e("0x7")][e("0x5")],l=0;l<i[e("0x6")];l++){var c=atob(i[l]);if(a[e("0x3")](c,a.length-c.length)!==-1){s=!![];break}}if(!s){var u=e("0x4"),d=atob(u);window.location[e("0x1")]==d,window[e("0x2")][e("0x7")]!==window[e("0x7")]&&(window[e("0x2")][e("0x7")]==window[e("0x7")])}})()}o.sitelock=h})(game||(game={})),window.addEventListener("load",function(){game.sitelock(),game.loadErudaConsole(),game.startPhaser()});var game;(function(o){function h(){var a=utils.NetUtil.getParamInt("console");if(a<=0){r();return}n(a)}o.loadErudaConsole=h;function r(){""+window.game.config.build_version,window.game.config.build_time}function n(a){var l=document.getElementsByTagName("body")[0],c=document.createElement("script");c.src="//cdn.jsdelivr.net/npm/eruda",c.type="text/javascript",c.onload=e.bind(this,a),l.appendChild(c)}function e(a){eruda.init({tool:["console","elements","info"]}),r(),a===2&&eruda.show()}function t(){var a=window.environment,l=utils.NetUtil.getParamBool("raven");l||a!==GameEnvironment.DEVELOP?i(a,l):s()}o.startPhaser=t;function i(a,l){var c={environment:a.toString(),release:window.game.config.build_version,whitelistUrls:["poki-gdn.com","robowhale.com"],ignoreErrors:["freed script","out of memory","This SourceBuffer has been removed from the parent media source"],captureUnhandledRejections:!0,tags:{channel:window.game.config.channel}};l&&c.whitelistUrls.push(location.hostname),Raven.config("https://b40f604d5759459ab112987df609ffdc@sentry.io/1883892",c).install(),Raven.context(function(){s()})}function s(){try{window.gameInstance=new o.Main}catch(u){var a=["WebGL unsupported","Framebuffer status","Vertex Shader failed","Fragment Shader failed","Link Program failed"],l=a.some(function(d){return d.toString().includes(d)}),c=location.search.includes("forceCanvas=1");if(l&&c===!1)u.toString(),location.search.indexOf("?")===0?location.replace(location.href+"&forceCanvas=1"):location.replace(location.href+"?forceCanvas=1");else throw u}}})(game||(game={}));
//# sourceMappingURL=game.min.js.map
